import{P as pb}from"./BA-6VyUO.js";import{g as mb}from"./Btn4EMYn.js";import{p as um,r as Rr,N as gb,j as _b,c as kn,o as In,k as Dt,a as tt,O as yb,l as $o,P as wb,Q as bb,t as jd,R as vb,S as Eb,T as Tb,U as Sb,_ as lm,V as xb,b as zd,g as kb}from"#entry";import{m as Dd,r as ma,d as Ib}from"./BWXbqUL3.js";import{u as Ob}from"./Dc3vLzw9.js";function ga(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}function se(e,t,n,r,s){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}function S(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)}let dm=function(){const{crypto:e}=globalThis;if(e?.randomUUID)return dm=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};function au(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const iu=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class ne extends Error{}class lt extends ne{constructor(t,n,r,s){super(`${lt.makeMessage(t,n,r)}`),this.status=t,this.headers=s,this.requestID=s?.get("x-request-id"),this.error=n;const a=n;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(t,n,r){const s=n?.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&s?`${t} ${s}`:t?`${t} status code (no body)`:s||"(no status code or body)"}static generate(t,n,r,s){if(!t||!s)return new Bi({message:r,cause:iu(n)});const a=n?.error;return t===400?new fm(t,a,r,s):t===401?new hm(t,a,r,s):t===403?new pm(t,a,r,s):t===404?new mm(t,a,r,s):t===409?new gm(t,a,r,s):t===422?new _m(t,a,r,s):t===429?new ym(t,a,r,s):t>=500?new wm(t,a,r,s):new lt(t,a,r,s)}}class Pt extends lt{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Bi extends lt{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class Zi extends Bi{constructor({message:t}={}){super({message:t??"Request timed out."})}}class fm extends lt{}class hm extends lt{}class pm extends lt{}class mm extends lt{}class gm extends lt{}class _m extends lt{}class ym extends lt{}class wm extends lt{}class bm extends ne{constructor(){super("Could not parse response content as the length limit was reached")}}class vm extends ne{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ps extends Error{constructor(t){super(t)}}const Ab=/^[a-z][a-z0-9+.-]*:/i,Cb=e=>Ab.test(e);let St=e=>(St=Array.isArray,St(e)),Ud=St;function Em(e){return typeof e!="object"?{}:e??{}}function $b(e){if(!e)return!0;for(const t in e)return!1;return!0}function Rb(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ro(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}const Nb=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new ne(`${e} must be an integer`);if(t<0)throw new ne(`${e} must be a positive integer`);return t},Pb=e=>{try{return JSON.parse(e)}catch{return}},Ks=e=>new Promise(t=>setTimeout(t,e)),Nr="6.17.0",Mb=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Lb(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const jb=()=>{const e=Lb();if(e==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Nr,"X-Stainless-OS":Bd(Deno.build.os),"X-Stainless-Arch":Fd(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Nr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(e==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Nr,"X-Stainless-OS":Bd(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Fd(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=zb();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Nr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Nr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function zb(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:t,version:`${s}.${a}.${i}`}}}return null}const Fd=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",Bd=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let Zd;const Db=()=>Zd??(Zd=jb());function Ub(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Tm(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Sm(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Tm({start(){},async pull(n){const{done:r,value:s}=await t.next();r?n.close():n.enqueue(s)},async cancel(){await t.return?.()}})}function xm(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n?.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Fb(e){if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}const Bb=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),km="RFC3986",Im=e=>String(e),qd={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:Im},Zb="RFC1738";let ou=(e,t)=>(ou=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),ou(e,t));const dn=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),No=1024,qb=(e,t,n,r,s)=>{if(e.length===0)return e;let a=e;if(typeof e=="symbol"?a=Symbol.prototype.toString.call(e):typeof e!="string"&&(a=String(e)),n==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=No){const c=a.length>=No?a.slice(o,o+No):a,u=[];for(let l=0;l<c.length;++l){let d=c.charCodeAt(l);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===Zb&&(d===40||d===41)){u[u.length]=c.charAt(l);continue}if(d<128){u[u.length]=dn[d];continue}if(d<2048){u[u.length]=dn[192|d>>6]+dn[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=dn[224|d>>12]+dn[128|d>>6&63]+dn[128|d&63];continue}l+=1,d=65536+((d&1023)<<10|c.charCodeAt(l)&1023),u[u.length]=dn[240|d>>18]+dn[128|d>>12&63]+dn[128|d>>6&63]+dn[128|d&63]}i+=u.join("")}return i};function Hb(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function Hd(e,t){if(St(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const Om={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}},Am=function(e,t){Array.prototype.push.apply(e,St(t)?t:[t])};let Vd;const Qe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:qb,encodeValuesOnly:!1,format:km,formatter:Im,indices:!1,serializeDate(e){return(Vd??(Vd=Function.prototype.call.bind(Date.prototype.toISOString)))(e)},skipNulls:!1,strictNullHandling:!1};function Vb(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"}const Po={};function Cm(e,t,n,r,s,a,i,o,c,u,l,d,f,h,p,m,b,_){let w=e,E=_,x=0,I=!1;for(;(E=E.get(Po))!==void 0&&!I;){const le=E.get(e);if(x+=1,typeof le<"u"){if(le===x)throw new RangeError("Cyclic object value");I=!0}typeof E.get(Po)>"u"&&(x=0)}if(typeof u=="function"?w=u(t,w):w instanceof Date?w=f?.(w):n==="comma"&&St(w)&&(w=Hd(w,function(le){return le instanceof Date?f?.(le):le})),w===null){if(a)return c&&!m?c(t,Qe.encoder,b,"key",h):t;w=""}if(Vb(w)||Hb(w)){if(c){const le=m?t:c(t,Qe.encoder,b,"key",h);return[p?.(le)+"="+p?.(c(w,Qe.encoder,b,"value",h))]}return[p?.(t)+"="+p?.(String(w))]}const P=[];if(typeof w>"u")return P;let j;if(n==="comma"&&St(w))m&&c&&(w=Hd(w,c)),j=[{value:w.length>0?w.join(",")||null:void 0}];else if(St(u))j=u;else{const le=Object.keys(w);j=l?le.sort(l):le}const v=o?String(t).replace(/\./g,"%2E"):String(t),oe=r&&St(w)&&w.length===1?v+"[]":v;if(s&&St(w)&&w.length===0)return oe+"[]";for(let le=0;le<j.length;++le){const K=j[le],Ge=typeof K=="object"&&typeof K.value<"u"?K.value:w[K];if(i&&Ge===null)continue;const Ot=d&&o?K.replace(/\./g,"%2E"):K,z=St(w)?typeof n=="function"?n(oe,Ot):oe:oe+(d?"."+Ot:"["+Ot+"]");_.set(e,x);const N=new WeakMap;N.set(Po,_),Am(P,Cm(Ge,z,n,r,s,a,i,o,n==="comma"&&m&&St(w)?null:c,u,l,d,f,h,p,m,b,N))}return P}function Gb(e=Qe){if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=e.charset||Qe.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=km;if(typeof e.format<"u"){if(!ou(qd,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=qd[n];let s=Qe.filter;(typeof e.filter=="function"||St(e.filter))&&(s=e.filter);let a;if(e.arrayFormat&&e.arrayFormat in Om?a=e.arrayFormat:"indices"in e?a=e.indices?"indices":"repeat":a=Qe.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof e.allowDots>"u"?e.encodeDotInKeys?!0:Qe.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Qe.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Qe.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Qe.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?Qe.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Qe.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:Qe.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:Qe.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Qe.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Qe.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Qe.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Qe.strictNullHandling}}function Jb(e,t={}){let n=e;const r=Gb(t);let s,a;typeof r.filter=="function"?(a=r.filter,n=a("",n)):St(r.filter)&&(a=r.filter,s=a);const i=[];if(typeof n!="object"||n===null)return"";const o=Om[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];r.skipNulls&&n[h]===null||Am(i,Cm(n[h],h,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const l=i.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}function Wb(e){let t=0;for(const s of e)t+=s.length;const n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}let Gd;function ll(e){let t;return(Gd??(t=new globalThis.TextEncoder,Gd=t.encode.bind(t)))(e)}let Jd;function Wd(e){let t;return(Jd??(t=new globalThis.TextDecoder,Jd=t.decode.bind(t)))(e)}var At,Ct;class qi{constructor(){At.set(this,void 0),Ct.set(this,void 0),se(this,At,new Uint8Array),se(this,Ct,null)}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?ll(t):t;se(this,At,Wb([S(this,At,"f"),n]));const r=[];let s;for(;(s=Kb(S(this,At,"f"),S(this,Ct,"f")))!=null;){if(s.carriage&&S(this,Ct,"f")==null){se(this,Ct,s.index);continue}if(S(this,Ct,"f")!=null&&(s.index!==S(this,Ct,"f")+1||s.carriage)){r.push(Wd(S(this,At,"f").subarray(0,S(this,Ct,"f")-1))),se(this,At,S(this,At,"f").subarray(S(this,Ct,"f"))),se(this,Ct,null);continue}const a=S(this,Ct,"f")!==null?s.preceding-1:s.preceding,i=Wd(S(this,At,"f").subarray(0,a));r.push(i),se(this,At,S(this,At,"f").subarray(s.index)),se(this,Ct,null)}return r}flush(){return S(this,At,"f").length?this.decode(`
`):[]}}At=new WeakMap,Ct=new WeakMap;qi.NEWLINE_CHARS=new Set([`
`,"\r"]);qi.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Kb(e,t){for(let s=t??0;s<e.length;s++){if(e[s]===10)return{preceding:s,index:s+1,carriage:!1};if(e[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Xb(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}const ri={off:0,error:200,warn:300,info:400,debug:500},Kd=(e,t,n)=>{if(e){if(Rb(ri,e))return e;ot(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ri))}`)}};function ms(){}function _a(e,t,n){return!t||ri[e]>ri[n]?ms:t[e].bind(t)}const Yb={error:ms,warn:ms,info:ms,debug:ms};let Xd=new WeakMap;function ot(e){const t=e.logger,n=e.logLevel??"off";if(!t)return Yb;const r=Xd.get(t);if(r&&r[0]===n)return r[1];const s={error:_a("error",t,n),warn:_a("warn",t,n),info:_a("info",t,n),debug:_a("debug",t,n)};return Xd.set(t,[n,s]),s}const ur=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,n])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var ds;class gn{constructor(t,n,r){this.iterator=t,ds.set(this,void 0),this.controller=n,se(this,ds,r)}static fromSSEResponse(t,n,r){let s=!1;const a=r?ot(r):console;async function*i(){if(s)throw new ne("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const c of Qb(t,n))if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let u;try{u=JSON.parse(c.data)}catch(l){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),l}if(u&&u.error)throw new lt(void 0,u.error,void 0,t.headers);yield u}else{let u;try{u=JSON.parse(c.data)}catch(l){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),l}if(c.event=="error")throw new lt(void 0,u.error,u.message,void 0);yield{event:c.event,data:u}}}o=!0}catch(c){if(au(c))return;throw c}finally{o||n.abort()}}return new gn(i,n,r)}static fromReadableStream(t,n,r){let s=!1;async function*a(){const o=new qi,c=xm(t);for await(const u of c)for(const l of o.decode(u))yield l;for(const u of o.flush())yield u}async function*i(){if(s)throw new ne("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const c of a())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(au(c))return;throw c}finally{o||n.abort()}}return new gn(i,n,r)}[(ds=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();t.push(i),n.push(i)}return a.shift()}});return[new gn(()=>s(t),this.controller,S(this,ds,"f")),new gn(()=>s(n),this.controller,S(this,ds,"f"))]}toReadableStream(){const t=this;let n;return Tm({async start(){n=t[Symbol.asyncIterator]()},async pull(r){try{const{value:s,done:a}=await n.next();if(a)return r.close();const i=ll(JSON.stringify(s)+`
`);r.enqueue(i)}catch(s){r.error(s)}},async cancel(){await n.return?.()}})}}async function*Qb(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ne("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ne("Attempted to iterate over a response with no body");const n=new tv,r=new qi,s=xm(e.body);for await(const a of ev(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*ev(e){let t=new Uint8Array;for await(const n of e){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?ll(n):n;let s=new Uint8Array(t.length+r.length);s.set(t),s.set(r,t.length),t=s;let a;for(;(a=Xb(t))!==-1;)yield t.slice(0,a),t=t.slice(a)}t.length>0&&(yield t)}class tv{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,s]=nv(t,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function nv(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}async function $m(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:s,startTime:a}=t,i=await(async()=>{if(t.options.stream)return ot(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):gn.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;const c=n.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){const d=await n.json();return Rm(d,n)}return await n.text()})();return ot(e).debug(`[${r}] response parsed`,ur({retryOfRequestLogID:s,url:n.url,status:n.status,body:i,durationMs:Date.now()-a})),i}function Rm(e,t){return!e||typeof e!="object"||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}var gs;class Hi extends Promise{constructor(t,n,r=$m){super(s=>{s(null)}),this.responsePromise=n,this.parseResponse=r,gs.set(this,void 0),se(this,gs,t)}_thenUnwrap(t){return new Hi(S(this,gs,"f"),this.responsePromise,async(n,r)=>Rm(t(await this.parseResponse(n,r),r),r.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(S(this,gs,"f"),t))),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}gs=new WeakMap;var ya;class dl{constructor(t,n,r,s){ya.set(this,void 0),se(this,ya,t),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const t=this.nextPageRequestOptions();if(!t)throw new ne("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await S(this,ya,"f").requestAPIList(this.constructor,t)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(ya=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const n of t.getPaginatedItems())yield n}}class rv extends Hi{constructor(t,n,r){super(t,n,async(s,a)=>new r(s,a.response,await $m(s,a),a.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const n of t)yield n}}class Vi extends dl{constructor(t,n,r,s){super(t,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class Ke extends dl{constructor(t,n,r,s){super(t,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.getPaginatedItems(),n=t[t.length-1]?.id;return n?{...this.options,query:{...Em(this.options.query),after:n}}:null}}class si extends dl{constructor(t,n,r,s){super(t,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.last_id;return t?{...this.options,query:{...Em(this.options.query),after:t}}:null}}const Nm=()=>{if(typeof File>"u"){const{process:e}=globalThis,t=typeof e?.versions?.node=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Os(e,t,n){return Nm(),new File(e,t??"unknown_file",n)}function Za(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const fl=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",Yd=async(e,t)=>cu(e.body)?{...e,body:await Pm(e.body,t)}:e,vr=async(e,t)=>({...e,body:await Pm(e.body,t)}),Qd=new WeakMap;function sv(e){const t=typeof e=="function"?e:e.fetch,n=Qd.get(t);if(n)return n;const r=(async()=>{try{const s="Response"in t?t.Response:(await t("data:,")).constructor,a=new FormData;return a.toString()!==await new s(a).text()}catch{return!0}})();return Qd.set(t,r),r}const Pm=async(e,t)=>{if(!await sv(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(([r,s])=>uu(n,r,s))),n},Mm=e=>e instanceof Blob&&"name"in e,av=e=>typeof e=="object"&&e!==null&&(e instanceof Response||fl(e)||Mm(e)),cu=e=>{if(av(e))return!0;if(Array.isArray(e))return e.some(cu);if(e&&typeof e=="object"){for(const t in e)if(cu(e[t]))return!0}return!1},uu=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(n instanceof Response)e.append(t,Os([await n.blob()],Za(n)));else if(fl(n))e.append(t,Os([await new Response(Sm(n)).blob()],Za(n)));else if(Mm(n))e.append(t,n,Za(n));else if(Array.isArray(n))await Promise.all(n.map(r=>uu(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>uu(e,`${t}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},Lm=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",iv=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&Lm(e),ov=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function cv(e,t,n){if(Nm(),e=await e,iv(e))return e instanceof File?e:Os([await e.arrayBuffer()],e.name);if(ov(e)){const s=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Os(await lu(s),t,n)}const r=await lu(e);if(t||(t=Za(e)),!n?.type){const s=r.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof s=="string"&&(n={...n,type:s})}return Os(r,t,n)}async function lu(e){let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Lm(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(fl(e))for await(const n of e)t.push(...await lu(n));else{const n=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${n?`; constructor: ${n}`:""}${uv(e)}`)}return t}function uv(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}class Q{constructor(t){this._client=t}}function jm(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ef=Object.freeze(Object.create(null)),lv=(e=jm)=>function(n,...r){if(n.length===1)return n[0];let s=!1;const a=[],i=n.reduce((l,d,f)=>{/[?#]/.test(d)&&(s=!0);const h=r[f];let p=(s?encodeURIComponent:e)(""+h);return f!==r.length&&(h==null||typeof h=="object"&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??ef)??ef)?.toString)&&(p=h+"",a.push({start:l.length+d.length,length:p.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),l+d+(f===r.length?"":p)},""),o=i.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let u;for(;(u=c.exec(o))!==null;)a.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(a.sort((l,d)=>l.start-d.start),a.length>0){let l=0;const d=a.reduce((f,h)=>{const p=" ".repeat(h.start-l),m="^".repeat(h.length);return l=h.start+h.length,f+p+m},"");throw new ne(`Path parameters result in path with invalid segments:
${a.map(f=>f.error).join(`
`)}
${i}
${d}`)}return i},$=lv(jm);let zm=class extends Q{list(t,n={},r){return this._client.getAPIList($`/chat/completions/${t}/messages`,Ke,{query:n,...r})}};function ai(e){return e!==void 0&&"function"in e&&e.function!==void 0}function dv(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}function hl(e){return e?.$brand==="auto-parseable-response-format"}function Xs(e){return e?.$brand==="auto-parseable-tool"}function fv(e,t){return!t||!Dm(t)?{...e,choices:e.choices.map(n=>(Um(n.message.tool_calls),{...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:pl(e,t)}function pl(e,t){const n=e.choices.map(r=>{if(r.finish_reason==="length")throw new bm;if(r.finish_reason==="content_filter")throw new vm;return Um(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>pv(t,s))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?hv(t,r.message.content):null}}});return{...e,choices:n}}function hv(e,t){return e.response_format?.type!=="json_schema"?null:e.response_format?.type==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function pv(e,t){const n=e.tools?.find(r=>ai(r)&&r.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:Xs(n)?n.$parseRaw(t.function.arguments):n?.function.strict?JSON.parse(t.function.arguments):null}}}function mv(e,t){if(!e||!("tools"in e)||!e.tools)return!1;const n=e.tools?.find(r=>ai(r)&&r.function?.name===t.function.name);return ai(n)&&(Xs(n)||n?.function.strict||!1)}function Dm(e){return hl(e.response_format)?!0:e.tools?.some(t=>Xs(t)||t.type==="function"&&t.function.strict===!0)??!1}function Um(e){for(const t of e||[])if(t.type!=="function")throw new ne(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function gv(e){for(const t of e??[]){if(t.type!=="function")throw new ne(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new ne(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const ii=e=>e?.role==="assistant",Fm=e=>e?.role==="tool";var du,qa,Ha,_s,ys,Va,ws,On,bs,oi,ci,Pr,Bm;class ml{constructor(){du.add(this),this.controller=new AbortController,qa.set(this,void 0),Ha.set(this,()=>{}),_s.set(this,()=>{}),ys.set(this,void 0),Va.set(this,()=>{}),ws.set(this,()=>{}),On.set(this,{}),bs.set(this,!1),oi.set(this,!1),ci.set(this,!1),Pr.set(this,!1),se(this,qa,new Promise((t,n)=>{se(this,Ha,t,"f"),se(this,_s,n,"f")})),se(this,ys,new Promise((t,n)=>{se(this,Va,t,"f"),se(this,ws,n,"f")})),S(this,qa,"f").catch(()=>{}),S(this,ys,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},S(this,du,"m",Bm).bind(this))},0)}_connected(){this.ended||(S(this,Ha,"f").call(this),this._emit("connect"))}get ended(){return S(this,bs,"f")}get errored(){return S(this,oi,"f")}get aborted(){return S(this,ci,"f")}abort(){this.controller.abort()}on(t,n){return(S(this,On,"f")[t]||(S(this,On,"f")[t]=[])).push({listener:n}),this}off(t,n){const r=S(this,On,"f")[t];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(t,n){return(S(this,On,"f")[t]||(S(this,On,"f")[t]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{se(this,Pr,!0),t!=="error"&&this.once("error",r),this.once(t,n)})}async done(){se(this,Pr,!0),await S(this,ys,"f")}_emit(t,...n){if(S(this,bs,"f"))return;t==="end"&&(se(this,bs,!0),S(this,Va,"f").call(this));const r=S(this,On,"f")[t];if(r&&(S(this,On,"f")[t]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),t==="abort"){const s=n[0];!S(this,Pr,"f")&&!r?.length&&Promise.reject(s),S(this,_s,"f").call(this,s),S(this,ws,"f").call(this,s),this._emit("end");return}if(t==="error"){const s=n[0];!S(this,Pr,"f")&&!r?.length&&Promise.reject(s),S(this,_s,"f").call(this,s),S(this,ws,"f").call(this,s),this._emit("end")}}_emitFinal(){}}qa=new WeakMap,Ha=new WeakMap,_s=new WeakMap,ys=new WeakMap,Va=new WeakMap,ws=new WeakMap,On=new WeakMap,bs=new WeakMap,oi=new WeakMap,ci=new WeakMap,Pr=new WeakMap,du=new WeakSet,Bm=function(t){if(se(this,oi,!0),t instanceof Error&&t.name==="AbortError"&&(t=new Pt),t instanceof Pt)return se(this,ci,!0),this._emit("abort",t);if(t instanceof ne)return this._emit("error",t);if(t instanceof Error){const n=new ne(t.message);return n.cause=t,this._emit("error",n)}return this._emit("error",new ne(String(t)))};function _v(e){return typeof e.parse=="function"}var _t,fu,ui,hu,pu,mu,Zm,qm;const yv=10;class Hm extends ml{constructor(){super(...arguments),_t.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);const n=t.choices[0]?.message;return n&&this._addMessage(n),t}_addMessage(t,n=!0){if("content"in t||(t.content=null),this.messages.push(t),n){if(this._emit("message",t),Fm(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(ii(t)&&t.tool_calls)for(const r of t.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new ne("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),S(this,_t,"m",fu).call(this)}async finalMessage(){return await this.done(),S(this,_t,"m",ui).call(this)}async finalFunctionToolCall(){return await this.done(),S(this,_t,"m",hu).call(this)}async finalFunctionToolCallResult(){return await this.done(),S(this,_t,"m",pu).call(this)}async totalUsage(){return await this.done(),S(this,_t,"m",mu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const n=S(this,_t,"m",ui).call(this);n&&this._emit("finalMessage",n);const r=S(this,_t,"m",fu).call(this);r&&this._emit("finalContent",r);const s=S(this,_t,"m",hu).call(this);s&&this._emit("finalFunctionToolCall",s);const a=S(this,_t,"m",pu).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",S(this,_t,"m",mu).call(this))}async _createChatCompletion(t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),S(this,_t,"m",Zm).call(this,n);const a=await t.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(pl(a,n))}async _runChatCompletion(t,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(t,n,r)}async _runTools(t,n,r){const s="tool",{tool_choice:a="auto",stream:i,...o}=n,c=typeof a!="string"&&a.type==="function"&&a?.function?.name,{maxChatCompletions:u=yv}=r||{},l=n.tools.map(h=>{if(Xs(h)){if(!h.$callback)throw new ne("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:h.$callback,name:h.function.name,description:h.function.description||"",parameters:h.function.parameters,parse:h.$parseRaw,strict:!0}}}return h}),d={};for(const h of l)h.type==="function"&&(d[h.function.name||h.function.function.name]=h.function);const f="tools"in n?l.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description,strict:h.function.strict}}:h):void 0;for(const h of n.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(await this._createChatCompletion(t,{...o,tool_choice:a,tools:f,messages:[...this.messages]},r)).choices[0]?.message;if(!m)throw new ne("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(const b of m.tool_calls){if(b.type!=="function")continue;const _=b.id,{name:w,arguments:E}=b.function,x=d[w];if(x){if(c&&c!==w){const v=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:_,content:v});continue}}else{const v=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(d).map(oe=>JSON.stringify(oe)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:_,content:v});continue}let I;try{I=_v(x)?await x.parse(E):E}catch(v){const oe=v instanceof Error?v.message:String(v);this._addMessage({role:s,tool_call_id:_,content:oe});continue}const P=await x.function(I,this),j=S(this,_t,"m",qm).call(this,P);if(this._addMessage({role:s,tool_call_id:_,content:j}),c)return}}}}_t=new WeakSet,fu=function(){return S(this,_t,"m",ui).call(this).content??null},ui=function(){let t=this.messages.length;for(;t-- >0;){const n=this.messages[t];if(ii(n))return{...n,content:n.content??null,refusal:n.refusal??null}}throw new ne("stream ended without producing a ChatCompletionMessage with role=assistant")},hu=function(){for(let t=this.messages.length-1;t>=0;t--){const n=this.messages[t];if(ii(n)&&n?.tool_calls?.length)return n.tool_calls.filter(r=>r.type==="function").at(-1)?.function}},pu=function(){for(let t=this.messages.length-1;t>=0;t--){const n=this.messages[t];if(Fm(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===n.tool_call_id)))return n.content}},mu=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(t.completion_tokens+=n.completion_tokens,t.prompt_tokens+=n.prompt_tokens,t.total_tokens+=n.total_tokens);return t},Zm=function(t){if(t.n!=null&&t.n>1)throw new ne("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},qm=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class gl extends Hm{static runTools(t,n,r){const s=new gl,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,n,a)),s}_addMessage(t,n=!0){super._addMessage(t,n),ii(t)&&t.content&&this._emit("content",t.content)}}const Vm=1,Gm=2,Jm=4,Wm=8,Km=16,Xm=32,Ym=64,Qm=128,eg=256,tg=Qm|eg,ng=Km|Xm|tg|Ym,rg=Vm|Gm|ng,sg=Jm|Wm,wv=rg|sg,rt={STR:Vm,NUM:Gm,ARR:Jm,OBJ:Wm,NULL:Km,BOOL:Xm,NAN:Ym,INFINITY:Qm,MINUS_INFINITY:eg,INF:tg,SPECIAL:ng,ATOM:rg,COLLECTION:sg,ALL:wv};class bv extends Error{}class vv extends Error{}function Ev(e,t=rt.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return Tv(e.trim(),t)}const Tv=(e,t)=>{const n=e.length;let r=0;const s=f=>{throw new bv(`${f} at position ${r}`)},a=f=>{throw new vv(`${f} at position ${r}`)},i=()=>(d(),r>=n&&s("Unexpected end of input"),e[r]==='"'?o():e[r]==="{"?c():e[r]==="["?u():e.substring(r,r+4)==="null"||rt.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)==="true"||rt.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)==="false"||rt.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)==="Infinity"||rt.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)==="-Infinity"||rt.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)==="NaN"||rt.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):l()),o=()=>{const f=r;let h=!1;for(r++;r<n&&(e[r]!=='"'||h&&e[r-1]==="\\");)h=e[r]==="\\"?!h:!1,r++;if(e.charAt(r)=='"')try{return JSON.parse(e.substring(f,++r-Number(h)))}catch(p){a(String(p))}else if(rt.STR&t)try{return JSON.parse(e.substring(f,r-Number(h))+'"')}catch{return JSON.parse(e.substring(f,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,d();const f={};try{for(;e[r]!=="}";){if(d(),r>=n&&rt.OBJ&t)return f;const h=o();d(),r++;try{const p=i();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(rt.OBJ&t)return f;throw p}d(),e[r]===","&&r++}}catch{if(rt.OBJ&t)return f;s("Expected '}' at end of object")}return r++,f},u=()=>{r++;const f=[];try{for(;e[r]!=="]";)f.push(i()),d(),e[r]===","&&r++}catch{if(rt.ARR&t)return f;s("Expected ']' at end of array")}return r++,f},l=()=>{if(r===0){e==="-"&&rt.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(h){if(rt.NUM&t)try{return e[e.length-1]==="."?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}a(String(h))}}const f=r;for(e[r]==="-"&&r++;e[r]&&!",]}".includes(e[r]);)r++;r==n&&!(rt.NUM&t)&&s("Unterminated number literal");try{return JSON.parse(e.substring(f,r))}catch{e.substring(f,r)==="-"&&rt.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(f,e.lastIndexOf("e")))}catch(p){a(String(p))}}},d=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return i()},tf=e=>Ev(e,rt.ALL^rt.NUM);var Ye,xn,Or,Bn,Mo,wa,Lo,jo,zo,ba,Do,nf;class js extends Hm{constructor(t){super(),Ye.add(this),xn.set(this,void 0),Or.set(this,void 0),Bn.set(this,void 0),se(this,xn,t),se(this,Or,[])}get currentChatCompletionSnapshot(){return S(this,Bn,"f")}static fromReadableStream(t){const n=new js(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){const s=new js(n);return s._run(()=>s._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(t,n,r){super._createChatCompletion;const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),S(this,Ye,"m",Mo).call(this);const a=await t.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const i of a)S(this,Ye,"m",Lo).call(this,i);if(a.controller.signal?.aborted)throw new Pt;return this._addChatCompletion(S(this,Ye,"m",ba).call(this))}async _fromReadableStream(t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),S(this,Ye,"m",Mo).call(this),this._connected();const s=gn.fromReadableStream(t,this.controller);let a;for await(const i of s)a&&a!==i.id&&this._addChatCompletion(S(this,Ye,"m",ba).call(this)),S(this,Ye,"m",Lo).call(this,i),a=i.id;if(s.controller.signal?.aborted)throw new Pt;return this._addChatCompletion(S(this,Ye,"m",ba).call(this))}[(xn=new WeakMap,Or=new WeakMap,Bn=new WeakMap,Ye=new WeakSet,Mo=function(){this.ended||se(this,Bn,void 0)},wa=function(n){let r=S(this,Or,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},S(this,Or,"f")[n.index]=r,r)},Lo=function(n){if(this.ended)return;const r=S(this,Ye,"m",nf).call(this,n);this._emit("chunk",n,r);for(const s of n.choices){const a=r.choices[s.index];s.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",s.delta.content,a.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),s.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:a.message.refusal}),s.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:a.logprobs?.content??[]}),s.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});const i=S(this,Ye,"m",wa).call(this,a);a.finish_reason&&(S(this,Ye,"m",zo).call(this,a),i.current_tool_call_index!=null&&S(this,Ye,"m",jo).call(this,a,i.current_tool_call_index));for(const o of s.delta.tool_calls??[])i.current_tool_call_index!==o.index&&(S(this,Ye,"m",zo).call(this,a),i.current_tool_call_index!=null&&S(this,Ye,"m",jo).call(this,a,i.current_tool_call_index)),i.current_tool_call_index=o.index;for(const o of s.delta.tool_calls??[]){const c=a.message.tool_calls?.[o.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:o.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(c?.type,void 0))}}},jo=function(n,r){if(S(this,Ye,"m",wa).call(this,n).done_tool_calls.has(r))return;const a=n.message.tool_calls?.[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const i=S(this,xn,"f")?.tools?.find(o=>ai(o)&&o.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Xs(i)?i.$parseRaw(a.function.arguments):i?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},zo=function(n){const r=S(this,Ye,"m",wa).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const s=S(this,Ye,"m",Do).call(this);this._emit("content.done",{content:n.message.content,parsed:s?s.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),n.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),n.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},ba=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");const n=S(this,Bn,"f");if(!n)throw new ne("request ended without sending any chunks");return se(this,Bn,void 0),se(this,Or,[]),Sv(n,S(this,xn,"f"))},Do=function(){const n=S(this,xn,"f")?.response_format;return hl(n)?n:null},nf=function(n){var r,s,a,i;let o=S(this,Bn,"f");const{choices:c,...u}=n;o?Object.assign(o,u):o=se(this,Bn,{...u,choices:[]});for(const{delta:l,finish_reason:d,index:f,logprobs:h=null,...p}of n.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:P,refusal:j,...v}=h;Object.assign(m.logprobs,v),P&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...P)),j&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...j))}if(d&&(m.finish_reason=d,S(this,xn,"f")&&Dm(S(this,xn,"f")))){if(d==="length")throw new bm;if(d==="content_filter")throw new vm}if(Object.assign(m,p),!l)continue;const{content:b,refusal:_,function_call:w,role:E,tool_calls:x,...I}=l;if(Object.assign(m.message,I),_&&(m.message.refusal=(m.message.refusal||"")+_),E&&(m.message.role=E),w&&(m.message.function_call?(w.name&&(m.message.function_call.name=w.name),w.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=w.arguments)):m.message.function_call=w),b&&(m.message.content=(m.message.content||"")+b,!m.message.refusal&&S(this,Ye,"m",Do).call(this)&&(m.message.parsed=tf(m.message.content))),x){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:P,id:j,type:v,function:oe,...le}of x){const K=(i=m.message.tool_calls)[P]??(i[P]={});Object.assign(K,le),j&&(K.id=j),v&&(K.type=v),oe&&(K.function??(K.function={name:oe.name??"",arguments:""})),oe?.name&&(K.function.name=oe.name),oe?.arguments&&(K.function.arguments+=oe.arguments,mv(S(this,xn,"f"),K)&&(K.function.parsed_arguments=tf(K.function.arguments)))}}}return o},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("chunk",s=>{const a=n.shift();a?a.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new gn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Sv(e,t){const{id:n,choices:r,created:s,model:a,system_fingerprint:i,...o}=e,c={...o,id:n,choices:r.map(({message:u,finish_reason:l,index:d,logprobs:f,...h})=>{if(!l)throw new ne(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:b,..._}=u,w=u.role;if(!w)throw new ne(`missing role for choice ${d}`);if(m){const{arguments:E,name:x}=m;if(E==null)throw new ne(`missing function_call.arguments for choice ${d}`);if(!x)throw new ne(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:E,name:x},role:w,refusal:u.refusal??null},finish_reason:l,index:d,logprobs:f}}return b?{...h,index:d,finish_reason:l,logprobs:f,message:{..._,role:w,content:p,refusal:u.refusal??null,tool_calls:b.map((E,x)=>{const{function:I,type:P,id:j,...v}=E,{arguments:oe,name:le,...K}=I||{};if(j==null)throw new ne(`missing choices[${d}].tool_calls[${x}].id
${va(e)}`);if(P==null)throw new ne(`missing choices[${d}].tool_calls[${x}].type
${va(e)}`);if(le==null)throw new ne(`missing choices[${d}].tool_calls[${x}].function.name
${va(e)}`);if(oe==null)throw new ne(`missing choices[${d}].tool_calls[${x}].function.arguments
${va(e)}`);return{...v,id:j,type:P,function:{...K,name:le,arguments:oe}}})}}:{...h,message:{..._,content:p,role:w,refusal:u.refusal??null},finish_reason:l,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return fv(c,t)}function va(e){return JSON.stringify(e)}class li extends js{static fromReadableStream(t){const n=new li(null);return n._run(()=>n._fromReadableStream(t)),n}static runTools(t,n,r){const s=new li(n),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(t,n,a)),s}}let _l=class extends Q{constructor(){super(...arguments),this.messages=new zm(this._client)}create(t,n){return this._client.post("/chat/completions",{body:t,...n,stream:t.stream??!1})}retrieve(t,n){return this._client.get($`/chat/completions/${t}`,n)}update(t,n,r){return this._client.post($`/chat/completions/${t}`,{body:n,...r})}list(t={},n){return this._client.getAPIList("/chat/completions",Ke,{query:t,...n})}delete(t,n){return this._client.delete($`/chat/completions/${t}`,n)}parse(t,n){return gv(t.tools),this._client.chat.completions.create(t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>pl(r,t))}runTools(t,n){return t.stream?li.runTools(this._client,t,n):gl.runTools(this._client,t,n)}stream(t,n){return js.createChatCompletion(this._client,t,n)}};_l.Messages=zm;class yl extends Q{constructor(){super(...arguments),this.completions=new _l(this._client)}}yl.Completions=_l;const ag=Symbol("brand.privateNullableHeaders");function*xv(e){if(!e)return;if(ag in e){const{values:r,nulls:s}=e;yield*r.entries();for(const a of s)yield[a,null];return}let t=!1,n;e instanceof Headers?n=e.entries():Ud(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let r of n){const s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const a=Ud(r[1])?r[1]:[r[1]];let i=!1;for(const o of a)o!==void 0&&(t&&!i&&(i=!0,yield[s,null]),yield[s,o])}}const B=e=>{const t=new Headers,n=new Set;for(const r of e){const s=new Set;for(const[a,i]of xv(r)){const o=a.toLowerCase();s.has(o)||(t.delete(a),s.add(o)),i===null?(t.delete(a),n.add(o)):(t.append(a,i),n.delete(o))}}return{[ag]:!0,values:t,nulls:n}};class ig extends Q{create(t,n){return this._client.post("/audio/speech",{body:t,...n,headers:B([{Accept:"application/octet-stream"},n?.headers]),__binaryResponse:!0})}}class og extends Q{create(t,n){return this._client.post("/audio/transcriptions",vr({body:t,...n,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class cg extends Q{create(t,n){return this._client.post("/audio/translations",vr({body:t,...n,__metadata:{model:t.model}},this._client))}}class Ys extends Q{constructor(){super(...arguments),this.transcriptions=new og(this._client),this.translations=new cg(this._client),this.speech=new ig(this._client)}}Ys.Transcriptions=og;Ys.Translations=cg;Ys.Speech=ig;class ug extends Q{create(t,n){return this._client.post("/batches",{body:t,...n})}retrieve(t,n){return this._client.get($`/batches/${t}`,n)}list(t={},n){return this._client.getAPIList("/batches",Ke,{query:t,...n})}cancel(t,n){return this._client.post($`/batches/${t}/cancel`,n)}}class lg extends Q{create(t,n){return this._client.post("/assistants",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,n){return this._client.get($`/assistants/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,n,r){return this._client.post($`/assistants/${t}`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t={},n){return this._client.getAPIList("/assistants",Ke,{query:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,n){return this._client.delete($`/assistants/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}let dg=class extends Q{create(t,n){return this._client.post("/realtime/sessions",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};class fg extends Q{create(t,n){return this._client.post("/realtime/transcription_sessions",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}let Gi=class extends Q{constructor(){super(...arguments),this.sessions=new dg(this._client),this.transcriptionSessions=new fg(this._client)}};Gi.Sessions=dg;Gi.TranscriptionSessions=fg;class hg extends Q{create(t,n){return this._client.post("/chatkit/sessions",{body:t,...n,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}cancel(t,n){return this._client.post($`/chatkit/sessions/${t}/cancel`,{...n,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}let pg=class extends Q{retrieve(t,n){return this._client.get($`/chatkit/threads/${t}`,{...n,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}list(t={},n){return this._client.getAPIList("/chatkit/threads",si,{query:t,...n,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}delete(t,n){return this._client.delete($`/chatkit/threads/${t}`,{...n,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}listItems(t,n={},r){return this._client.getAPIList($`/chatkit/threads/${t}/items`,si,{query:n,...r,headers:B([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};class Ji extends Q{constructor(){super(...arguments),this.sessions=new hg(this._client),this.threads=new pg(this._client)}}Ji.Sessions=hg;Ji.Threads=pg;class mg extends Q{create(t,n,r){return this._client.post($`/threads/${t}/messages`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(t,n,r){const{thread_id:s}=n;return this._client.get($`/threads/${s}/messages/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(t,n,r){const{thread_id:s,...a}=n;return this._client.post($`/threads/${s}/messages/${t}`,{body:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t,n={},r){return this._client.getAPIList($`/threads/${t}/messages`,Ke,{query:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(t,n,r){const{thread_id:s}=n;return this._client.delete($`/threads/${s}/messages/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class gg extends Q{retrieve(t,n,r){const{thread_id:s,run_id:a,...i}=n;return this._client.get($`/threads/${s}/runs/${a}/steps/${t}`,{query:i,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t,n,r){const{thread_id:s,...a}=n;return this._client.getAPIList($`/threads/${s}/runs/${t}/steps`,Ke,{query:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}const kv=e=>{if(typeof Buffer<"u"){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var Iv={};const Ar=e=>{if(typeof globalThis.process<"u")return Iv?.[e]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(e)?.trim()};var ct,mr,gu,pn,Ga,Yt,gr,zr,hr,di,Rt,Ja,Wa,As,vs,Es,rf,sf,af,of,cf,uf,lf;class Cs extends ml{constructor(){super(...arguments),ct.add(this),gu.set(this,[]),pn.set(this,{}),Ga.set(this,{}),Yt.set(this,void 0),gr.set(this,void 0),zr.set(this,void 0),hr.set(this,void 0),di.set(this,void 0),Rt.set(this,void 0),Ja.set(this,void 0),Wa.set(this,void 0),As.set(this,void 0)}[(gu=new WeakMap,pn=new WeakMap,Ga=new WeakMap,Yt=new WeakMap,gr=new WeakMap,zr=new WeakMap,hr=new WeakMap,di=new WeakMap,Rt=new WeakMap,Ja=new WeakMap,Wa=new WeakMap,As=new WeakMap,ct=new WeakSet,Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const n=new mr;return n._run(()=>n._fromReadableStream(t)),n}async _fromReadableStream(t,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=gn.fromReadableStream(t,this.controller);for await(const a of s)S(this,ct,"m",vs).call(this,a);if(s.controller.signal?.aborted)throw new Pt;return this._addRun(S(this,ct,"m",Es).call(this))}toReadableStream(){return new gn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,n,r,s){const a=new mr;return a._run(()=>a._runToolAssistantStream(t,n,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(t,n,r,s){const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await t.submitToolOutputs(n,i,{...s,signal:this.controller.signal});this._connected();for await(const c of o)S(this,ct,"m",vs).call(this,c);if(o.controller.signal?.aborted)throw new Pt;return this._addRun(S(this,ct,"m",Es).call(this))}static createThreadAssistantStream(t,n,r){const s=new mr;return s._run(()=>s._threadAssistantStream(t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(t,n,r,s){const a=new mr;return a._run(()=>a._runAssistantStream(t,n,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return S(this,Ja,"f")}currentRun(){return S(this,Wa,"f")}currentMessageSnapshot(){return S(this,Yt,"f")}currentRunStepSnapshot(){return S(this,As,"f")}async finalRunSteps(){return await this.done(),Object.values(S(this,pn,"f"))}async finalMessages(){return await this.done(),Object.values(S(this,Ga,"f"))}async finalRun(){if(await this.done(),!S(this,gr,"f"))throw Error("Final run was not received.");return S(this,gr,"f")}async _createThreadAssistantStream(t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await t.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const o of i)S(this,ct,"m",vs).call(this,o);if(i.controller.signal?.aborted)throw new Pt;return this._addRun(S(this,ct,"m",Es).call(this))}async _createAssistantStream(t,n,r,s){const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await t.create(n,i,{...s,signal:this.controller.signal});this._connected();for await(const c of o)S(this,ct,"m",vs).call(this,c);if(o.controller.signal?.aborted)throw new Pt;return this._addRun(S(this,ct,"m",Es).call(this))}static accumulateDelta(t,n){for(const[r,s]of Object.entries(n)){if(!t.hasOwnProperty(r)){t[r]=s;continue}let a=t[r];if(a==null){t[r]=s;continue}if(r==="index"||r==="type"){t[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Ro(a)&&Ro(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!Ro(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);t[r]=a}return t}_addRun(t){return t}async _threadAssistantStream(t,n,r){return await this._createThreadAssistantStream(n,t,r)}async _runAssistantStream(t,n,r,s){return await this._createAssistantStream(n,t,r,s)}async _runToolAssistantStream(t,n,r,s){return await this._createToolAssistantStream(n,t,r,s)}}mr=Cs,vs=function(t){if(!this.ended)switch(se(this,Ja,t),S(this,ct,"m",af).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":S(this,ct,"m",lf).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":S(this,ct,"m",sf).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":S(this,ct,"m",rf).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Es=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");if(!S(this,gr,"f"))throw Error("Final run has not been received");return S(this,gr,"f")},rf=function(t){const[n,r]=S(this,ct,"m",cf).call(this,t,S(this,Yt,"f"));se(this,Yt,n),S(this,Ga,"f")[n.id]=n;for(const s of r){const a=n.content[s.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const s of t.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=n.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=S(this,zr,"f")){if(S(this,hr,"f"))switch(S(this,hr,"f").type){case"text":this._emit("textDone",S(this,hr,"f").text,S(this,Yt,"f"));break;case"image_file":this._emit("imageFileDone",S(this,hr,"f").image_file,S(this,Yt,"f"));break}se(this,zr,s.index)}se(this,hr,n.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(S(this,zr,"f")!==void 0){const s=t.data.content[S(this,zr,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,S(this,Yt,"f"));break;case"text":this._emit("textDone",s.text,S(this,Yt,"f"));break}}S(this,Yt,"f")&&this._emit("messageDone",t.data),se(this,Yt,void 0)}},sf=function(t){const n=S(this,ct,"m",of).call(this,t);switch(se(this,As,n),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const r=t.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==S(this,di,"f")?this._emit("toolCallDelta",a,n.step_details.tool_calls[a.index]):(S(this,Rt,"f")&&this._emit("toolCallDone",S(this,Rt,"f")),se(this,di,a.index),se(this,Rt,n.step_details.tool_calls[a.index]),S(this,Rt,"f")&&this._emit("toolCallCreated",S(this,Rt,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":se(this,As,void 0),t.data.step_details.type=="tool_calls"&&S(this,Rt,"f")&&(this._emit("toolCallDone",S(this,Rt,"f")),se(this,Rt,void 0)),this._emit("runStepDone",t.data,n);break}},af=function(t){S(this,gu,"f").push(t),this._emit("event",t)},of=function(t){switch(t.event){case"thread.run.step.created":return S(this,pn,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let n=S(this,pn,"f")[t.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=t.data;if(r.delta){const s=mr.accumulateDelta(n,r.delta);S(this,pn,"f")[t.data.id]=s}return S(this,pn,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":S(this,pn,"f")[t.data.id]=t.data;break}if(S(this,pn,"f")[t.data.id])return S(this,pn,"f")[t.data.id];throw new Error("No snapshot available")},cf=function(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=t.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in n.content){let i=n.content[a.index];n.content[a.index]=S(this,ct,"m",uf).call(this,a,i)}else n.content[a.index]=a,r.push(a);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},uf=function(t,n){return mr.accumulateDelta(n,t)},lf=function(t){switch(se(this,Wa,t.data),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":se(this,gr,t.data),S(this,Rt,"f")&&(this._emit("toolCallDone",S(this,Rt,"f")),se(this,Rt,void 0));break}};let wl=class extends Q{constructor(){super(...arguments),this.steps=new gg(this._client)}create(t,n,r){const{include:s,...a}=n;return this._client.post($`/threads/${t}/runs`,{query:{include:s},body:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:n.stream??!1})}retrieve(t,n,r){const{thread_id:s}=n;return this._client.get($`/threads/${s}/runs/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(t,n,r){const{thread_id:s,...a}=n;return this._client.post($`/threads/${s}/runs/${t}`,{body:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t,n={},r){return this._client.getAPIList($`/threads/${t}/runs`,Ke,{query:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(t,n,r){const{thread_id:s}=n;return this._client.post($`/threads/${s}/runs/${t}/cancel`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(t,n,r){const s=await this.create(t,n,r);return await this.poll(s.id,{thread_id:t},r)}createAndStream(t,n,r){return Cs.createAssistantStream(t,this._client.beta.threads.runs,n,r)}async poll(t,n,r){const s=B([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:i}=await this.retrieve(t,n,{...r,headers:{...r?.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ks(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(t,n,r){return Cs.createAssistantStream(t,this._client.beta.threads.runs,n,r)}submitToolOutputs(t,n,r){const{thread_id:s,...a}=n;return this._client.post($`/threads/${s}/runs/${t}/submit_tool_outputs`,{body:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:n.stream??!1})}async submitToolOutputsAndPoll(t,n,r){const s=await this.submitToolOutputs(t,n,r);return await this.poll(s.id,n,r)}submitToolOutputsStream(t,n,r){return Cs.createToolAssistantStream(t,this._client.beta.threads.runs,n,r)}};wl.Steps=gg;class Wi extends Q{constructor(){super(...arguments),this.runs=new wl(this._client),this.messages=new mg(this._client)}create(t={},n){return this._client.post("/threads",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,n){return this._client.get($`/threads/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,n,r){return this._client.post($`/threads/${t}`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(t,n){return this._client.delete($`/threads/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}createAndRun(t,n){return this._client.post("/threads/runs",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async createAndRunPoll(t,n){const r=await this.createAndRun(t,n);return await this.runs.poll(r.id,{thread_id:r.thread_id},n)}createAndRunStream(t,n){return Cs.createThreadAssistantStream(t,this._client.beta.threads,n)}}Wi.Runs=wl;Wi.Messages=mg;class as extends Q{constructor(){super(...arguments),this.realtime=new Gi(this._client),this.chatkit=new Ji(this._client),this.assistants=new lg(this._client),this.threads=new Wi(this._client)}}as.Realtime=Gi;as.ChatKit=Ji;as.Assistants=lg;as.Threads=Wi;class _g extends Q{create(t,n){return this._client.post("/completions",{body:t,...n,stream:t.stream??!1})}}class yg extends Q{retrieve(t,n,r){const{container_id:s}=n;return this._client.get($`/containers/${s}/files/${t}/content`,{...r,headers:B([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}let bl=class extends Q{constructor(){super(...arguments),this.content=new yg(this._client)}create(t,n,r){return this._client.post($`/containers/${t}/files`,vr({body:n,...r},this._client))}retrieve(t,n,r){const{container_id:s}=n;return this._client.get($`/containers/${s}/files/${t}`,r)}list(t,n={},r){return this._client.getAPIList($`/containers/${t}/files`,Ke,{query:n,...r})}delete(t,n,r){const{container_id:s}=n;return this._client.delete($`/containers/${s}/files/${t}`,{...r,headers:B([{Accept:"*/*"},r?.headers])})}};bl.Content=yg;class vl extends Q{constructor(){super(...arguments),this.files=new bl(this._client)}create(t,n){return this._client.post("/containers",{body:t,...n})}retrieve(t,n){return this._client.get($`/containers/${t}`,n)}list(t={},n){return this._client.getAPIList("/containers",Ke,{query:t,...n})}delete(t,n){return this._client.delete($`/containers/${t}`,{...n,headers:B([{Accept:"*/*"},n?.headers])})}}vl.Files=bl;class wg extends Q{create(t,n,r){const{include:s,...a}=n;return this._client.post($`/conversations/${t}/items`,{query:{include:s},body:a,...r})}retrieve(t,n,r){const{conversation_id:s,...a}=n;return this._client.get($`/conversations/${s}/items/${t}`,{query:a,...r})}list(t,n={},r){return this._client.getAPIList($`/conversations/${t}/items`,si,{query:n,...r})}delete(t,n,r){const{conversation_id:s}=n;return this._client.delete($`/conversations/${s}/items/${t}`,r)}}class El extends Q{constructor(){super(...arguments),this.items=new wg(this._client)}create(t={},n){return this._client.post("/conversations",{body:t,...n})}retrieve(t,n){return this._client.get($`/conversations/${t}`,n)}update(t,n,r){return this._client.post($`/conversations/${t}`,{body:n,...r})}delete(t,n){return this._client.delete($`/conversations/${t}`,n)}}El.Items=wg;let bg=class extends Q{create(t,n){const r=!!t.encoding_format;let s=r?t.encoding_format:"base64";r&&ot(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);const a=this._client.post("/embeddings",{body:{...t,encoding_format:s},...n});return r?a:(ot(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const c=o.embedding;o.embedding=kv(c)}),i)))}};class vg extends Q{retrieve(t,n,r){const{eval_id:s,run_id:a}=n;return this._client.get($`/evals/${s}/runs/${a}/output_items/${t}`,r)}list(t,n,r){const{eval_id:s,...a}=n;return this._client.getAPIList($`/evals/${s}/runs/${t}/output_items`,Ke,{query:a,...r})}}class Tl extends Q{constructor(){super(...arguments),this.outputItems=new vg(this._client)}create(t,n,r){return this._client.post($`/evals/${t}/runs`,{body:n,...r})}retrieve(t,n,r){const{eval_id:s}=n;return this._client.get($`/evals/${s}/runs/${t}`,r)}list(t,n={},r){return this._client.getAPIList($`/evals/${t}/runs`,Ke,{query:n,...r})}delete(t,n,r){const{eval_id:s}=n;return this._client.delete($`/evals/${s}/runs/${t}`,r)}cancel(t,n,r){const{eval_id:s}=n;return this._client.post($`/evals/${s}/runs/${t}`,r)}}Tl.OutputItems=vg;class Sl extends Q{constructor(){super(...arguments),this.runs=new Tl(this._client)}create(t,n){return this._client.post("/evals",{body:t,...n})}retrieve(t,n){return this._client.get($`/evals/${t}`,n)}update(t,n,r){return this._client.post($`/evals/${t}`,{body:n,...r})}list(t={},n){return this._client.getAPIList("/evals",Ke,{query:t,...n})}delete(t,n){return this._client.delete($`/evals/${t}`,n)}}Sl.Runs=Tl;let Eg=class extends Q{create(t,n){return this._client.post("/files",vr({body:t,...n},this._client))}retrieve(t,n){return this._client.get($`/files/${t}`,n)}list(t={},n){return this._client.getAPIList("/files",Ke,{query:t,...n})}delete(t,n){return this._client.delete($`/files/${t}`,n)}content(t,n){return this._client.get($`/files/${t}/content`,{...n,headers:B([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:n=5e3,maxWait:r=1800*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(t);for(;!i.status||!s.has(i.status);)if(await Ks(n),i=await this.retrieve(t),Date.now()-a>r)throw new Zi({message:`Giving up on waiting for file ${t} to finish processing after ${r} milliseconds.`});return i}};class Tg extends Q{}let Sg=class extends Q{run(t,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...n})}validate(t,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...n})}};class xl extends Q{constructor(){super(...arguments),this.graders=new Sg(this._client)}}xl.Graders=Sg;class xg extends Q{create(t,n,r){return this._client.getAPIList($`/fine_tuning/checkpoints/${t}/permissions`,Vi,{body:n,method:"post",...r})}retrieve(t,n={},r){return this._client.get($`/fine_tuning/checkpoints/${t}/permissions`,{query:n,...r})}delete(t,n,r){const{fine_tuned_model_checkpoint:s}=n;return this._client.delete($`/fine_tuning/checkpoints/${s}/permissions/${t}`,r)}}let kl=class extends Q{constructor(){super(...arguments),this.permissions=new xg(this._client)}};kl.Permissions=xg;class kg extends Q{list(t,n={},r){return this._client.getAPIList($`/fine_tuning/jobs/${t}/checkpoints`,Ke,{query:n,...r})}}class Il extends Q{constructor(){super(...arguments),this.checkpoints=new kg(this._client)}create(t,n){return this._client.post("/fine_tuning/jobs",{body:t,...n})}retrieve(t,n){return this._client.get($`/fine_tuning/jobs/${t}`,n)}list(t={},n){return this._client.getAPIList("/fine_tuning/jobs",Ke,{query:t,...n})}cancel(t,n){return this._client.post($`/fine_tuning/jobs/${t}/cancel`,n)}listEvents(t,n={},r){return this._client.getAPIList($`/fine_tuning/jobs/${t}/events`,Ke,{query:n,...r})}pause(t,n){return this._client.post($`/fine_tuning/jobs/${t}/pause`,n)}resume(t,n){return this._client.post($`/fine_tuning/jobs/${t}/resume`,n)}}Il.Checkpoints=kg;class is extends Q{constructor(){super(...arguments),this.methods=new Tg(this._client),this.jobs=new Il(this._client),this.checkpoints=new kl(this._client),this.alpha=new xl(this._client)}}is.Methods=Tg;is.Jobs=Il;is.Checkpoints=kl;is.Alpha=xl;class Ig extends Q{}class Ol extends Q{constructor(){super(...arguments),this.graderModels=new Ig(this._client)}}Ol.GraderModels=Ig;class Og extends Q{createVariation(t,n){return this._client.post("/images/variations",vr({body:t,...n},this._client))}edit(t,n){return this._client.post("/images/edits",vr({body:t,...n,stream:t.stream??!1},this._client))}generate(t,n){return this._client.post("/images/generations",{body:t,...n,stream:t.stream??!1})}}class Ag extends Q{retrieve(t,n){return this._client.get($`/models/${t}`,n)}list(t){return this._client.getAPIList("/models",Vi,t)}delete(t,n){return this._client.delete($`/models/${t}`,n)}}class Cg extends Q{create(t,n){return this._client.post("/moderations",{body:t,...n})}}class $g extends Q{accept(t,n,r){return this._client.post($`/realtime/calls/${t}/accept`,{body:n,...r,headers:B([{Accept:"*/*"},r?.headers])})}hangup(t,n){return this._client.post($`/realtime/calls/${t}/hangup`,{...n,headers:B([{Accept:"*/*"},n?.headers])})}refer(t,n,r){return this._client.post($`/realtime/calls/${t}/refer`,{body:n,...r,headers:B([{Accept:"*/*"},r?.headers])})}reject(t,n={},r){return this._client.post($`/realtime/calls/${t}/reject`,{body:n,...r,headers:B([{Accept:"*/*"},r?.headers])})}}class Rg extends Q{create(t,n){return this._client.post("/realtime/client_secrets",{body:t,...n})}}class Ki extends Q{constructor(){super(...arguments),this.clientSecrets=new Rg(this._client),this.calls=new $g(this._client)}}Ki.ClientSecrets=Rg;Ki.Calls=$g;function Ov(e,t){return!t||!Cv(t)?{...e,output_parsed:null,output:e.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:Ng(e,t)}function Ng(e,t){const n=e.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:Nv(t,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:Av(t,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||_u(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function Av(e,t){return e.text?.format?.type!=="json_schema"?null:"$parseRaw"in e.text?.format?(e.text?.format).$parseRaw(t):JSON.parse(t)}function Cv(e){return!!hl(e.text?.format)}function $v(e){return e?.$brand==="auto-parseable-tool"}function Rv(e,t){return e.find(n=>n.type==="function"&&n.name===t)}function Nv(e,t){const n=Rv(e.tools??[],t.name);return{...t,...t,parsed_arguments:$v(n)?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}function _u(e){const t=[];for(const n of e.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&t.push(r.text);e.output_text=t.join("")}var Cr,Ea,Zn,Ta,df,ff,hf,pf;class Al extends ml{constructor(t){super(),Cr.add(this),Ea.set(this,void 0),Zn.set(this,void 0),Ta.set(this,void 0),se(this,Ea,t)}static createResponse(t,n,r){const s=new Al(n);return s._run(()=>s._createOrRetrieveResponse(t,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(t,n,r){const s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),S(this,Cr,"m",df).call(this);let a,i=null;"response_id"in n?(a=await t.responses.retrieve(n.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=n.starting_after??null):a=await t.responses.create({...n,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const o of a)S(this,Cr,"m",ff).call(this,o,i);if(a.controller.signal?.aborted)throw new Pt;return S(this,Cr,"m",hf).call(this)}[(Ea=new WeakMap,Zn=new WeakMap,Ta=new WeakMap,Cr=new WeakSet,df=function(){this.ended||se(this,Zn,void 0)},ff=function(n,r){if(this.ended)return;const s=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},a=S(this,Cr,"m",pf).call(this,n);switch(s("event",n),n.type){case"response.output_text.delta":{const i=a.output[n.output_index];if(!i)throw new ne(`missing output at index ${n.output_index}`);if(i.type==="message"){const o=i.content[n.content_index];if(!o)throw new ne(`missing content at index ${n.content_index}`);if(o.type!=="output_text")throw new ne(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...n,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[n.output_index];if(!i)throw new ne(`missing output at index ${n.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...n,snapshot:i.arguments});break}default:s(n.type,n);break}},hf=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");const n=S(this,Zn,"f");if(!n)throw new ne("request ended without sending any events");se(this,Zn,void 0);const r=Pv(n,S(this,Ea,"f"));return se(this,Ta,r),r},pf=function(n){let r=S(this,Zn,"f");if(!r){if(n.type!=="response.created")throw new ne(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=se(this,Zn,n.response),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const s=r.output[n.output_index];if(!s)throw new ne(`missing output at index ${n.output_index}`);const a=s.type,i=n.part;a==="message"&&i.type!=="reasoning_text"?s.content.push(i):a==="reasoning"&&i.type==="reasoning_text"&&(s.content||(s.content=[]),s.content.push(i));break}case"response.output_text.delta":{const s=r.output[n.output_index];if(!s)throw new ne(`missing output at index ${n.output_index}`);if(s.type==="message"){const a=s.content[n.content_index];if(!a)throw new ne(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new ne(`expected content to be 'output_text', got ${a.type}`);a.text+=n.delta}break}case"response.function_call_arguments.delta":{const s=r.output[n.output_index];if(!s)throw new ne(`missing output at index ${n.output_index}`);s.type==="function_call"&&(s.arguments+=n.delta);break}case"response.reasoning_text.delta":{const s=r.output[n.output_index];if(!s)throw new ne(`missing output at index ${n.output_index}`);if(s.type==="reasoning"){const a=s.content?.[n.content_index];if(!a)throw new ne(`missing content at index ${n.content_index}`);if(a.type!=="reasoning_text")throw new ne(`expected content to be 'reasoning_text', got ${a.type}`);a.text+=n.delta}break}case"response.completed":{se(this,Zn,n.response);break}}return r},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):t.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=S(this,Ta,"f");if(!t)throw new ne("stream ended without producing a ChatCompletion");return t}}function Pv(e,t){return Ov(e,t)}class Pg extends Q{list(t,n={},r){return this._client.getAPIList($`/responses/${t}/input_items`,Ke,{query:n,...r})}}class Mg extends Q{count(t={},n){return this._client.post("/responses/input_tokens",{body:t,...n})}}class Xi extends Q{constructor(){super(...arguments),this.inputItems=new Pg(this._client),this.inputTokens=new Mg(this._client)}create(t,n){return this._client.post("/responses",{body:t,...n,stream:t.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&_u(r),r))}retrieve(t,n={},r){return this._client.get($`/responses/${t}`,{query:n,...r,stream:n?.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&_u(s),s))}delete(t,n){return this._client.delete($`/responses/${t}`,{...n,headers:B([{Accept:"*/*"},n?.headers])})}parse(t,n){return this._client.responses.create(t,n)._thenUnwrap(r=>Ng(r,t))}stream(t,n){return Al.createResponse(this._client,t,n)}cancel(t,n){return this._client.post($`/responses/${t}/cancel`,n)}compact(t,n){return this._client.post("/responses/compact",{body:t,...n})}}Xi.InputItems=Pg;Xi.InputTokens=Mg;class Lg extends Q{create(t,n,r){return this._client.post($`/uploads/${t}/parts`,vr({body:n,...r},this._client))}}class Cl extends Q{constructor(){super(...arguments),this.parts=new Lg(this._client)}create(t,n){return this._client.post("/uploads",{body:t,...n})}cancel(t,n){return this._client.post($`/uploads/${t}/cancel`,n)}complete(t,n,r){return this._client.post($`/uploads/${t}/complete`,{body:n,...r})}}Cl.Parts=Lg;const Mv=async e=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of t)s.status==="fulfilled"&&r.push(s.value);return r};class jg extends Q{create(t,n,r){return this._client.post($`/vector_stores/${t}/file_batches`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(t,n,r){const{vector_store_id:s}=n;return this._client.get($`/vector_stores/${s}/file_batches/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(t,n,r){const{vector_store_id:s}=n;return this._client.post($`/vector_stores/${s}/file_batches/${t}/cancel`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(t,n,r){const s=await this.create(t,n);return await this.poll(t,s.id,r)}listFiles(t,n,r){const{vector_store_id:s,...a}=n;return this._client.getAPIList($`/vector_stores/${s}/file_batches/${t}/files`,Ke,{query:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(t,n,r){const s=B([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:a,response:i}=await this.retrieve(n,{vector_store_id:t},{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{const c=i.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ks(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(t,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=s?.maxConcurrency??5,i=Math.min(a,n.length),o=this._client,c=n.values(),u=[...r];async function l(f){for(let h of f){const p=await o.files.create({file:h,purpose:"assistants"},s);u.push(p.id)}}const d=Array(i).fill(c).map(l);return await Mv(d),await this.createAndPoll(t,{file_ids:u})}}class zg extends Q{create(t,n,r){return this._client.post($`/vector_stores/${t}/files`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(t,n,r){const{vector_store_id:s}=n;return this._client.get($`/vector_stores/${s}/files/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(t,n,r){const{vector_store_id:s,...a}=n;return this._client.post($`/vector_stores/${s}/files/${t}`,{body:a,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t,n={},r){return this._client.getAPIList($`/vector_stores/${t}/files`,Ke,{query:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(t,n,r){const{vector_store_id:s}=n;return this._client.delete($`/vector_stores/${s}/files/${t}`,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(t,n,r){const s=await this.create(t,n,r);return await this.poll(t,s.id,r)}async poll(t,n,r){const s=B([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){const a=await this.retrieve(n,{vector_store_id:t},{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{const c=a.response.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(o=u)}}await Ks(o);break;case"failed":case"completed":return i}}}async upload(t,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(t,{file_id:s.id},r)}async uploadAndPoll(t,n,r){const s=await this.upload(t,n,r);return await this.poll(t,s.id,r)}content(t,n,r){const{vector_store_id:s}=n;return this._client.getAPIList($`/vector_stores/${s}/files/${t}/content`,Vi,{...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class Yi extends Q{constructor(){super(...arguments),this.files=new zg(this._client),this.fileBatches=new jg(this._client)}create(t,n){return this._client.post("/vector_stores",{body:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,n){return this._client.get($`/vector_stores/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,n,r){return this._client.post($`/vector_stores/${t}`,{body:n,...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(t={},n){return this._client.getAPIList("/vector_stores",Ke,{query:t,...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,n){return this._client.delete($`/vector_stores/${t}`,{...n,headers:B([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}search(t,n,r){return this._client.getAPIList($`/vector_stores/${t}/search`,Vi,{body:n,method:"post",...r,headers:B([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}Yi.Files=zg;Yi.FileBatches=jg;class Dg extends Q{create(t,n){return this._client.post("/videos",Yd({body:t,...n},this._client))}retrieve(t,n){return this._client.get($`/videos/${t}`,n)}list(t={},n){return this._client.getAPIList("/videos",si,{query:t,...n})}delete(t,n){return this._client.delete($`/videos/${t}`,n)}downloadContent(t,n={},r){return this._client.get($`/videos/${t}/content`,{query:n,...r,headers:B([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(t,n,r){return this._client.post($`/videos/${t}/remix`,Yd({body:n,...r},this._client))}}var Mr,Ug,Ka;class Fg extends Q{constructor(){super(...arguments),Mr.add(this)}async unwrap(t,n,r=this._client.webhookSecret,s=300){return await this.verifySignature(t,n,r,s),JSON.parse(t)}async verifySignature(t,n,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");S(this,Mr,"m",Ug).call(this,r);const a=B([n]).values,i=S(this,Mr,"m",Ka).call(this,a,"webhook-signature"),o=S(this,Mr,"m",Ka).call(this,a,"webhook-timestamp"),c=S(this,Mr,"m",Ka).call(this,a,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new ps("Invalid webhook timestamp format");const l=Math.floor(Date.now()/1e3);if(l-u>s)throw new ps("Webhook timestamp is too old");if(u>l+s)throw new ps("Webhook timestamp is too new");const d=i.split(" ").map(m=>m.startsWith("v1,")?m.substring(3):m),f=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),h=c?`${c}.${o}.${t}`:`${o}.${t}`,p=await crypto.subtle.importKey("raw",f,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const m of d)try{const b=Buffer.from(m,"base64");if(await crypto.subtle.verify("HMAC",p,b,new TextEncoder().encode(h)))return}catch{continue}throw new ps("The given webhook signature does not match the expected signature")}}Mr=new WeakSet,Ug=function(t){if(typeof t!="string"||t.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Ka=function(t,n){if(!t)throw new Error("Headers are required");const r=t.get(n);if(r==null)throw new Error(`Missing required header: ${n}`);return r};var yu,$l,Xa,Bg;class _e{constructor({baseURL:t=Ar("OPENAI_BASE_URL"),apiKey:n=Ar("OPENAI_API_KEY"),organization:r=Ar("OPENAI_ORG_ID")??null,project:s=Ar("OPENAI_PROJECT_ID")??null,webhookSecret:a=Ar("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(yu.add(this),Xa.set(this,void 0),this.completions=new _g(this),this.chat=new yl(this),this.embeddings=new bg(this),this.files=new Eg(this),this.images=new Og(this),this.audio=new Ys(this),this.moderations=new Cg(this),this.models=new Ag(this),this.fineTuning=new is(this),this.graders=new Ol(this),this.vectorStores=new Yi(this),this.webhooks=new Fg(this),this.beta=new as(this),this.batches=new ug(this),this.uploads=new Cl(this),this.responses=new Xi(this),this.realtime=new Ki(this),this.conversations=new El(this),this.evals=new Sl(this),this.containers=new vl(this),this.videos=new Dg(this),n===void 0)throw new ne("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:n,organization:r,project:s,webhookSecret:a,...i,baseURL:t||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&Mb())throw new ne(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??$l.DEFAULT_TIMEOUT,this.logger=o.logger??console;const c="warn";this.logLevel=c,this.logLevel=Kd(o.logLevel,"ClientOptions.logLevel",this)??Kd(Ar("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??Ub(),se(this,Xa,Bb),this._options=o,this.apiKey=typeof n=="string"?n:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=a}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){}async authHeaders(t){return B([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return Jb(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Nr}`}defaultIdempotencyKey(){return`stainless-node-retry-${dm()}`}makeStatusError(t,n,r,s){return lt.generate(t,n,r,s)}async _callApiKey(){const t=this._options.apiKey;if(typeof t!="function")return!1;let n;try{n=await t()}catch(r){throw r instanceof ne?r:new ne(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof n!="string"||!n)throw new ne(`Expected 'apiKey' function argument to return a string but it returned ${n}`);return this.apiKey=n,!0}buildURL(t,n,r){const s=!S(this,yu,"m",Bg).call(this)&&r||this.baseURL,a=Cb(t)?new URL(t):new URL(s+(s.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),i=this.defaultQuery();return $b(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(a.search=this.stringifyQuery(n)),a.toString()}async prepareOptions(t){await this._callApiKey()}async prepareRequest(t,{url:n,options:r}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(s=>({method:t,path:n,...s})))}request(t,n=null){return new Hi(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,r){const s=await t,a=s.maxRetries??this.maxRetries;n==null&&(n=a),await this.prepareOptions(s);const{req:i,url:o,timeout:c}=await this.buildRequest(s,{retryCount:a-n});await this.prepareRequest(i,{url:o,options:s});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),l=r===void 0?"":`, retryOf: ${r}`,d=Date.now();if(ot(this).debug(`[${u}] sending request`,ur({retryOfRequestLogID:r,method:s.method,url:o,options:s,headers:i.headers})),s.signal?.aborted)throw new Pt;const f=new AbortController,h=await this.fetchWithTimeout(o,i,c,f).catch(iu),p=Date.now();if(h instanceof globalThis.Error){const _=`retrying, ${n} attempts remaining`;if(s.signal?.aborted)throw new Pt;const w=au(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(n)return ot(this).info(`[${u}] connection ${w?"timed out":"failed"} - ${_}`),ot(this).debug(`[${u}] connection ${w?"timed out":"failed"} (${_})`,ur({retryOfRequestLogID:r,url:o,durationMs:p-d,message:h.message})),this.retryRequest(s,n,r??u);throw ot(this).info(`[${u}] connection ${w?"timed out":"failed"} - error; no more retries left`),ot(this).debug(`[${u}] connection ${w?"timed out":"failed"} (error; no more retries left)`,ur({retryOfRequestLogID:r,url:o,durationMs:p-d,message:h.message})),w?new Zi:new Bi({cause:h})}const m=[...h.headers.entries()].filter(([_])=>_==="x-request-id").map(([_,w])=>", "+_+": "+JSON.stringify(w)).join(""),b=`[${u}${l}${m}] ${i.method} ${o} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${p-d}ms`;if(!h.ok){const _=await this.shouldRetry(h);if(n&&_){const j=`retrying, ${n} attempts remaining`;return await Fb(h.body),ot(this).info(`${b} - ${j}`),ot(this).debug(`[${u}] response error (${j})`,ur({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-d})),this.retryRequest(s,n,r??u,h.headers)}const w=_?"error; no more retries left":"error; not retryable";ot(this).info(`${b} - ${w}`);const E=await h.text().catch(j=>iu(j).message),x=Pb(E),I=x?void 0:E;throw ot(this).debug(`[${u}] response error (${w})`,ur({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,message:I,durationMs:Date.now()-d})),this.makeStatusError(h.status,x,I,h.headers)}return ot(this).info(b),ot(this).debug(`[${u}] response start`,ur({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-d})),{response:h,options:s,controller:f,requestLogID:u,retryOfRequestLogID:r,startTime:d}}getAPIList(t,n,r){return this.requestAPIList(n,{method:"get",path:t,...r})}requestAPIList(t,n){const r=this.makeRequest(n,null,void 0);return new rv(this,r,t)}async fetchWithTimeout(t,n,r,s){const{signal:a,method:i,...o}=n||{};a&&a.addEventListener("abort",()=>s.abort());const c=setTimeout(()=>s.abort(),r),u=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,l={signal:s.signal,...u?{duplex:"half"}:{},method:"GET",...o};i&&(l.method=i.toUpperCase());try{return await this.fetch.call(void 0,t,l)}finally{clearTimeout(c)}}async shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r,s){let a;const i=s?.get("retry-after-ms");if(i){const c=parseFloat(i);Number.isNaN(c)||(a=c)}const o=s?.get("retry-after");if(o&&!a){const c=parseFloat(o);Number.isNaN(c)?a=Date.parse(o)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=t.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(n,c)}return await Ks(a),this.makeRequest(t,n-1,r)}calculateDefaultRetryTimeoutMillis(t,n){const a=n-t,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}async buildRequest(t,{retryCount:n=0}={}){const r={...t},{method:s,path:a,query:i,defaultBaseURL:o}=r,c=this.buildURL(a,i,o);"timeout"in r&&Nb("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:u,body:l}=this.buildBody({options:r}),d=await this.buildHeaders({options:t,method:s,bodyHeaders:u,retryCount:n});return{req:{method:s,headers:d,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...r.fetchOptions??{}},url:c,timeout:r.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:r,retryCount:s}){let a={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=t.idempotencyKey);const i=B([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...Db(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(t),this._options.defaultHeaders,r,t.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=B([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:Sm(t)}:S(this,Xa,"f").call(this,{body:t,headers:r})}}$l=_e,Xa=new WeakMap,yu=new WeakSet,Bg=function(){return this.baseURL!=="https://api.openai.com/v1"};_e.OpenAI=$l;_e.DEFAULT_TIMEOUT=6e5;_e.OpenAIError=ne;_e.APIError=lt;_e.APIConnectionError=Bi;_e.APIConnectionTimeoutError=Zi;_e.APIUserAbortError=Pt;_e.NotFoundError=mm;_e.ConflictError=gm;_e.RateLimitError=ym;_e.BadRequestError=fm;_e.AuthenticationError=hm;_e.InternalServerError=wm;_e.PermissionDeniedError=pm;_e.UnprocessableEntityError=_m;_e.InvalidWebhookSignatureError=ps;_e.toFile=cv;_e.Completions=_g;_e.Chat=yl;_e.Embeddings=bg;_e.Files=Eg;_e.Images=Og;_e.Audio=Ys;_e.Moderations=Cg;_e.Models=Ag;_e.FineTuning=is;_e.Graders=Ol;_e.VectorStores=Yi;_e.Webhooks=Fg;_e.Beta=as;_e.Batches=ug;_e.Uploads=Cl;_e.Responses=Xi;_e.Realtime=Ki;_e.Conversations=El;_e.Evals=Sl;_e.Containers=vl;_e.Videos=Dg;function Rl(e){if(!e||typeof e!="object")return e;let t;return e.constructor.name===Zi.name&&"message"in e&&typeof e.message=="string"?(t=new Error(e.message),t.name="TimeoutError"):e.constructor.name===Pt.name&&"message"in e&&typeof e.message=="string"?(t=new Error(e.message),t.name="AbortError"):"status"in e&&e.status===400&&"message"in e&&typeof e.message=="string"&&e.message.includes("tool_calls")?t=ga(e,"INVALID_TOOL_RESULTS"):"status"in e&&e.status===401?t=ga(e,"MODEL_AUTHENTICATION"):"status"in e&&e.status===429?t=ga(e,"MODEL_RATE_LIMIT"):"status"in e&&e.status===404?t=ga(e,"MODEL_NOT_FOUND"):t=e,t}var Lv=Object.defineProperty,be=(e,t)=>{for(var n in t)Lv(e,n,{get:t[n],enumerable:!0})};function vn(e){return typeof e=="object"&&e!==null&&"type"in e&&typeof e.type=="string"&&"source_type"in e&&(e.source_type==="url"||e.source_type==="base64"||e.source_type==="text"||e.source_type==="id")}function Nl(e){return vn(e)&&e.source_type==="url"&&"url"in e&&typeof e.url=="string"}function Pl(e){return vn(e)&&e.source_type==="base64"&&"data"in e&&typeof e.data=="string"}function jv(e){return vn(e)&&e.source_type==="text"&&"text"in e&&typeof e.text=="string"}function Zg(e){return vn(e)&&e.source_type==="id"&&"id"in e&&typeof e.id=="string"}function qg(e){if(vn(e)){if(e.source_type==="url")return{type:"image_url",image_url:{url:e.url}};if(e.source_type==="base64"){if(!e.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${e.mime_type};base64,${e.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function wu(e){const t=e.split(";")[0].split("/");if(t.length!==2)throw new Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);const n=t[0].trim(),r=t[1].trim();if(n===""||r==="")throw new Error(`Invalid mime type: "${e}" - type or subtype is empty.`);const s={};for(const a of e.split(";").slice(1)){const i=a.split("=");if(i.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${e}".`);const o=i[0].trim(),c=i[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${e}".`);s[o]=c}return{type:n,subtype:r,parameters:s}}function zs({dataUrl:e,asTypedArray:t=!1}){const n=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(n){r=n[1].toLowerCase();const s=t?Uint8Array.from(atob(n[2]),a=>a.charCodeAt(0)):n[2];return{mime_type:r,data:s}}}function Ml(e,t){if(e.type==="text"){if(!t.fromStandardTextBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if(e.type==="image"){if(!t.fromStandardImageBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if(e.type==="audio"){if(!t.fromStandardAudioBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if(e.type==="file"){if(!t.fromStandardFileBlock)throw new Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw new Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}function Hg(e){return typeof e=="object"&&e!==null&&"type"in e&&"content"in e&&(typeof e.content=="string"||Array.isArray(e.content))}function Qi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Uo,mf;function zv(){return mf||(mf=1,Uo=function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");return t=typeof t>"u"?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}),Uo}var Dv=zv();const Uv=Qi(Dv);var Sa={exports:{}},gf;function Fv(){if(gf)return Sa.exports;gf=1;const e=/[\p{Lu}]/u,t=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,a=new RegExp("^"+s.source),i=new RegExp(s.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),c=(f,h,p)=>{let m=!1,b=!1,_=!1;for(let w=0;w<f.length;w++){const E=f[w];m&&e.test(E)?(f=f.slice(0,w)+"-"+f.slice(w),m=!1,_=b,b=!0,w++):b&&_&&t.test(E)?(f=f.slice(0,w-1)+"-"+f.slice(w-1),_=b,b=!1,m=!0):(m=h(E)===E&&p(E)!==E,_=b,b=p(E)===E&&h(E)!==E)}return f},u=(f,h)=>(n.lastIndex=0,f.replace(n,p=>h(p))),l=(f,h)=>(i.lastIndex=0,o.lastIndex=0,f.replace(i,(p,m)=>h(m)).replace(o,p=>h(p))),d=(f,h)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(h={pascalCase:!1,preserveConsecutiveUppercase:!1,...h},Array.isArray(f)?f=f.map(_=>_.trim()).filter(_=>_.length).join("-"):f=f.trim(),f.length===0)return"";const p=h.locale===!1?_=>_.toLowerCase():_=>_.toLocaleLowerCase(h.locale),m=h.locale===!1?_=>_.toUpperCase():_=>_.toLocaleUpperCase(h.locale);return f.length===1?h.pascalCase?m(f):p(f):(f!==p(f)&&(f=c(f,p,m)),f=f.replace(a,""),h.preserveConsecutiveUppercase?f=u(f,p):f=p(f),h.pascalCase&&(f=m(f.charAt(0))+f.slice(1)),l(f,m))};return Sa.exports=d,Sa.exports.default=d,Sa.exports}Fv();function Bv(e,t){return t?.[e]||Uv(e)}function Zv(e,t,n){const r={};for(const s in e)Object.hasOwn(e,s)&&(r[t(s,n)]=e[s]);return r}const Vg="__lc_escaped__";function qv(e){return"lc"in e||Object.keys(e).length===1&&Vg in e}function Hv(e){return{[Vg]:e}}function Vv(e){return e!==null&&typeof e=="object"&&"lc_serializable"in e&&typeof e.toJSON=="function"}function Gv(e){let t;return e!==null&&typeof e=="object"?"lc_id"in e&&Array.isArray(e.lc_id)?t=e.lc_id:t=[e.constructor?.name??"Object"]:t=[typeof e],{lc:1,type:"not_implemented",id:t}}function bu(e,t=new WeakSet){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){if(t.has(e))return Gv(e);if(Vv(e))return e;t.add(e);const n=e;if(qv(n))return t.delete(e),Hv(n);const r={};for(const[s,a]of Object.entries(n))r[s]=bu(a,t);return t.delete(e),r}return Array.isArray(e)?e.map(n=>bu(n,t)):e}var Jv={};be(Jv,{Serializable:()=>Vr,get_lc_unique_name:()=>Ll});function _f(e){return Array.isArray(e)?[...e]:{...e}}function Wv(e,t){const n=_f(e);for(const[r,s]of Object.entries(t)){const[a,...i]=r.split(".").reverse();let o=n;for(const c of i.reverse()){if(o[c]===void 0)break;o[c]=_f(o[c]),o=o[c]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return n}function Ll(e){const t=Object.getPrototypeOf(e);return typeof e.lc_name=="function"&&(typeof t.lc_name!="function"||e.lc_name()!==t.lc_name())?e.lc_name():e.name}var Vr=class Gg{lc_serializable=!1;lc_kwargs;static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ll(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(t,...n){this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(t||{}).filter(([r])=>this.lc_serializable_keys?.includes(r))):this.lc_kwargs=t??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Gg||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const t={},n={},r=Object.keys(this.lc_kwargs).reduce((c,u)=>(c[u]=u in this?this[u]:this.lc_kwargs[u],c),{});for(let c=Object.getPrototypeOf(this);c;c=Object.getPrototypeOf(c))Object.assign(t,Reflect.get(c,"lc_aliases",this)),Object.assign(n,Reflect.get(c,"lc_secrets",this)),Object.assign(r,Reflect.get(c,"lc_attributes",this));Object.keys(n).forEach(c=>{let u=this,l=r;const[d,...f]=c.split(".").reverse();for(const h of f.reverse()){if(!(h in u)||u[h]===void 0)return;(!(h in l)||l[h]===void 0)&&(typeof u[h]=="object"&&u[h]!=null?l[h]={}:Array.isArray(u[h])&&(l[h]=[])),u=u[h],l=l[h]}d in u&&u[d]!==void 0&&(l[d]=l[d]||u[d])});const s={},a=new WeakSet;a.add(this);for(const[c,u]of Object.entries(r))s[c]=bu(u,a);const i=Object.keys(n).length?Wv(s,n):s,o=Zv(i,Bv,t);return{lc:1,type:"constructor",id:this.lc_id,kwargs:o}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Y(e,t){return ue(e)&&e.type===t}function ue(e){return typeof e=="object"&&e!==null}function rn(e){return Array.isArray(e)}function L(e){return typeof e=="string"}function Qt(e){return typeof e=="number"}function jl(e){return e instanceof Uint8Array}function yf(e){try{return JSON.parse(e)}catch{return}}const Ds=e=>e();function Kv(e){if(e.type==="char_location"&&L(e.document_title)&&Qt(e.start_char_index)&&Qt(e.end_char_index)&&L(e.cited_text)){const{document_title:t,start_char_index:n,end_char_index:r,cited_text:s,...a}=e;return{...a,type:"citation",source:"char",title:t??void 0,startIndex:n,endIndex:r,citedText:s}}if(e.type==="page_location"&&L(e.document_title)&&Qt(e.start_page_number)&&Qt(e.end_page_number)&&L(e.cited_text)){const{document_title:t,start_page_number:n,end_page_number:r,cited_text:s,...a}=e;return{...a,type:"citation",source:"page",title:t??void 0,startIndex:n,endIndex:r,citedText:s}}if(e.type==="content_block_location"&&L(e.document_title)&&Qt(e.start_block_index)&&Qt(e.end_block_index)&&L(e.cited_text)){const{document_title:t,start_block_index:n,end_block_index:r,cited_text:s,...a}=e;return{...a,type:"citation",source:"block",title:t??void 0,startIndex:n,endIndex:r,citedText:s}}if(e.type==="web_search_result_location"&&L(e.url)&&L(e.title)&&L(e.encrypted_index)&&L(e.cited_text)){const{url:t,title:n,encrypted_index:r,cited_text:s,...a}=e;return{...a,type:"citation",source:"url",url:t,title:n,startIndex:Number(r),endIndex:Number(r),citedText:s}}if(e.type==="search_result_location"&&L(e.source)&&L(e.title)&&Qt(e.start_block_index)&&Qt(e.end_block_index)&&L(e.cited_text)){const{source:t,title:n,start_block_index:r,end_block_index:s,cited_text:a,...i}=e;return{...i,type:"citation",source:"search",url:t,title:n??void 0,startIndex:r,endIndex:s,citedText:a}}}function Jg(e){if(Y(e,"document")&&ue(e.source)&&"type"in e.source){if(e.source.type==="base64"&&L(e.source.media_type)&&L(e.source.data))return{type:"file",mimeType:e.source.media_type,data:e.source.data};if(e.source.type==="url"&&L(e.source.url))return{type:"file",url:e.source.url};if(e.source.type==="file"&&L(e.source.file_id))return{type:"file",fileId:e.source.file_id};if(e.source.type==="text"&&L(e.source.data))return{type:"file",mimeType:String(e.source.media_type??"text/plain"),data:e.source.data}}else if(Y(e,"image")&&ue(e.source)&&"type"in e.source){if(e.source.type==="base64"&&L(e.source.media_type)&&L(e.source.data))return{type:"image",mimeType:e.source.media_type,data:e.source.data};if(e.source.type==="url"&&L(e.source.url))return{type:"image",url:e.source.url};if(e.source.type==="file"&&L(e.source.file_id))return{type:"image",fileId:e.source.file_id}}}function Xv(e){function*t(){for(const n of e){const r=Jg(n);r?yield r:yield n}}return Array.from(t())}function wf(e){function*t(){const n=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content;for(const r of n){if(Y(r,"text")&&L(r.text)){const{text:s,citations:a,...i}=r;if(rn(a)&&a.length){const o=a.reduce((c,u)=>{const l=Kv(u);return l?[...c,l]:c},[]);yield{...i,type:"text",text:s,annotations:o};continue}else{yield{...i,type:"text",text:s};continue}}else if(Y(r,"thinking")&&L(r.thinking)){const{thinking:s,signature:a,...i}=r;yield{...i,type:"reasoning",reasoning:s,signature:a};continue}else if(Y(r,"redacted_thinking")){yield{type:"non_standard",value:r};continue}else if(Y(r,"tool_use")&&L(r.name)&&L(r.id)){yield{type:"tool_call",id:r.id,name:r.name,args:r.input};continue}else if(Y(r,"input_json_delta")){if(Qv(e)&&e.tool_call_chunks?.length){const s=e.tool_call_chunks[0];yield{type:"tool_call_chunk",id:s.id,name:s.name,args:s.args,index:s.index};continue}}else if(Y(r,"server_tool_use")&&L(r.name)&&L(r.id)){const{name:s,id:a}=r;if(s==="web_search"){const i=Ds(()=>{if(typeof r.input=="string")return r.input;if(ue(r.input)&&L(r.input.query))return r.input.query;if(L(r.partial_json)){const o=yf(r.partial_json);if(o?.query)return o.query}return""});yield{id:a,type:"server_tool_call",name:"web_search",args:{query:i}};continue}else if(r.name==="code_execution"){const i=Ds(()=>{if(typeof r.input=="string")return r.input;if(ue(r.input)&&L(r.input.code))return r.input.code;if(L(r.partial_json)){const o=yf(r.partial_json);if(o?.code)return o.code}return""});yield{id:a,type:"server_tool_call",name:"code_execution",args:{code:i}};continue}}else if(Y(r,"web_search_tool_result")&&L(r.tool_use_id)&&rn(r.content)){const{content:s,tool_use_id:a}=r,i=s.reduce((o,c)=>Y(c,"web_search_result")?[...o,c.url]:o,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:a,status:"success",output:{urls:i}};continue}else if(Y(r,"code_execution_tool_result")&&L(r.tool_use_id)&&ue(r.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(Y(r,"mcp_tool_use")){yield{id:r.id,type:"server_tool_call",name:"mcp_tool_use",args:r.input};continue}else if(Y(r,"mcp_tool_result")&&L(r.tool_use_id)&&ue(r.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(Y(r,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:r.input};continue}else if(Y(r,"search_result")){yield{id:r.id,type:"non_standard",value:r};continue}else if(Y(r,"tool_result")){yield{id:r.id,type:"non_standard",value:r};continue}else{const s=Jg(r);if(s){yield s;continue}}yield{type:"non_standard",value:r}}}return Array.from(t())}const Yv={translateContent:wf,translateContentChunk:wf};function Qv(e){return typeof e?._getType=="function"&&typeof e.concat=="function"&&e._getType()==="ai"}function e0(e){return Nl(e)?{type:e.type,mimeType:e.mime_type,url:e.url,metadata:e.metadata}:Pl(e)?{type:e.type,mimeType:e.mime_type??"application/octet-stream",data:e.data,metadata:e.metadata}:Zg(e)?{type:e.type,mimeType:e.mime_type,fileId:e.id,metadata:e.metadata}:e}function t0(e){return e.map(e0)}function n0(e){return!!(Y(e,"image_url")&&ue(e.image_url)||Y(e,"input_audio")&&ue(e.input_audio)||Y(e,"file")&&ue(e.file))}function r0(e){if(Y(e,"image_url")&&ue(e.image_url)&&L(e.image_url.url)){const t=zs({dataUrl:e.image_url.url});return t?{type:"image",mimeType:t.mime_type,data:t.data}:{type:"image",url:e.image_url.url}}else{if(Y(e,"input_audio")&&ue(e.input_audio)&&L(e.input_audio.data)&&L(e.input_audio.format))return{type:"audio",data:e.input_audio.data,mimeType:`audio/${e.input_audio.format}`};if(Y(e,"file")&&ue(e.file)&&L(e.file.data)){const t=zs({dataUrl:e.file.data});if(t)return{type:"file",data:t.data,mimeType:t.mime_type};if(L(e.file.file_id))return{type:"file",fileId:e.file.file_id}}}return e}function s0(e){const t=[];typeof e.content=="string"?t.push({type:"text",text:e.content}):t.push(...zl(e.content));for(const n of e.tool_calls??[])t.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return t}function a0(e){const t=[];typeof e.content=="string"?t.push({type:"text",text:e.content}):t.push(...zl(e.content));for(const n of e.tool_calls??[])t.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return t}function zl(e){const t=[];for(const n of e)n0(n)?t.push(r0(n)):t.push(n);return t}function i0(e){if(e.type==="url_citation"){const{url:t,title:n,start_index:r,end_index:s}=e;return{type:"citation",url:t,title:n,startIndex:r,endIndex:s}}if(e.type==="file_citation"){const{file_id:t,filename:n,index:r}=e;return{type:"citation",title:n,startIndex:r,endIndex:r,fileId:t}}return e}function Wg(e){function*t(){ue(e.additional_kwargs?.reasoning)&&rn(e.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:e.additional_kwargs.reasoning.summary.reduce((s,a)=>ue(a)&&L(a.text)?`${s}${a.text}`:s,"")});const n=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content;for(const r of n)if(Y(r,"text")){const{text:s,annotations:a,...i}=r;Array.isArray(a)?yield{...i,type:"text",text:String(s),annotations:a.map(i0)}:yield{...i,type:"text",text:String(s)}}for(const r of e.tool_calls??[])yield{type:"tool_call",id:r.id,name:r.name,args:r.args};if(ue(e.additional_kwargs)&&rn(e.additional_kwargs.tool_outputs))for(const r of e.additional_kwargs.tool_outputs){if(Y(r,"web_search_call")){yield{id:r.id,type:"server_tool_call",name:"web_search",args:{query:r.query}};continue}else if(Y(r,"file_search_call")){yield{id:r.id,type:"server_tool_call",name:"file_search",args:{query:r.query}};continue}else if(Y(r,"computer_call")){yield{type:"non_standard",value:r};continue}else if(Y(r,"code_interpreter_call")){if(L(r.code)&&(yield{id:r.id,type:"server_tool_call",name:"code_interpreter",args:{code:r.code}}),rn(r.outputs)){const s=Ds(()=>{if(r.status!=="in_progress"){if(r.status==="completed")return 0;if(r.status==="incomplete")return 127;if(r.status!=="interpreting"&&r.status==="failed")return 1}});for(const a of r.outputs)if(Y(a,"logs")){yield{type:"server_tool_call_result",toolCallId:r.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:s??0,stderr:[0,void 0].includes(s)?void 0:String(a.logs),stdout:[0,void 0].includes(s)?String(a.logs):void 0}};continue}}continue}else if(Y(r,"mcp_call")){yield{id:r.id,type:"server_tool_call",name:"mcp_call",args:r.input};continue}else if(Y(r,"mcp_list_tools")){yield{id:r.id,type:"server_tool_call",name:"mcp_list_tools",args:r.input};continue}else if(Y(r,"mcp_approval_request")){yield{type:"non_standard",value:r};continue}else if(Y(r,"image_generation_call")){L(r.result)&&(yield{type:"image",mimeType:"image/png",data:r.result,id:L(r.id)?r.id:void 0,metadata:{status:L(r.status)?r.status:void 0}}),yield{type:"non_standard",value:r};continue}ue(r)&&(yield{type:"non_standard",value:r})}}return Array.from(t())}function o0(e){function*t(){yield*Wg(e);for(const n of e.tool_call_chunks??[])yield{type:"tool_call_chunk",id:n.id,name:n.name,args:n.args}}return Array.from(t())}const c0={translateContent:e=>typeof e.content=="string"?s0(e):Wg(e),translateContentChunk:e=>typeof e.content=="string"?a0(e):o0(e)};function u0(e,t="pretty"){return t==="pretty"?l0(e):JSON.stringify(e)}function l0(e){const t=[],n=` ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} Message `,r=Math.floor((80-n.length)/2),s="=".repeat(r),a=n.length%2===0?s:`${s}=`;if(t.push(`${s}${n}${a}`),e.type==="ai"){const i=e;if(i.tool_calls&&i.tool_calls.length>0){t.push("Tool Calls:");for(const o of i.tool_calls){t.push(`  ${o.name} (${o.id})`),t.push(` Call ID: ${o.id}`),t.push("  Args:");for(const[c,u]of Object.entries(o.args))t.push(`    ${c}: ${typeof u=="object"?JSON.stringify(u):u}`)}}}if(e.type==="tool"){const i=e;i.name&&t.push(`Name: ${i.name}`)}return typeof e.content=="string"&&e.content.trim()&&(t.length>1&&t.push(""),t.push(e.content)),t.join(`
`)}const Fo=Symbol.for("langchain.message");function Pn(e,t){return typeof e=="string"?e===""?t:typeof t=="string"?e+t:Array.isArray(t)&&t.length===0?e:Array.isArray(t)&&t.some(n=>vn(n))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t]:Array.isArray(t)?Qs(e,t)??[...e,...t]:t===""?e:Array.isArray(e)&&e.some(n=>vn(n))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function Kg(e,t){return e==="error"||t==="error"?"error":"success"}function d0(e,t){function n(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=t)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>n(i,s+1));const a={};for(const i of Object.keys(r))a[i]=n(r[i],s+1);return a}return JSON.stringify(n(e,0),null,2)}var Un=class extends Vr{lc_namespace=["langchain_core","messages"];lc_serializable=!0;get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}[Fo]=!0;id;name;content;additional_kwargs;response_metadata;_getType(){return this.type}getType(){return this._getType()}constructor(e){const t=typeof e=="string"||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={}),super(t),this.name=t.name,t.content===void 0&&t.contentBlocks!==void 0?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):t.content!==void 0?(this.content=t.content??[],this.response_metadata=t.response_metadata):(this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){const e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[t0,zl,Xv].reduce((r,s)=>s(r),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&Fo in e&&e[Fo]===!0&&Hg(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=d0(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}toFormattedString(e="pretty"){return u0(this,e)}};function f0(e){return Array.isArray(e)&&e.every(t=>typeof t.index=="number")}const Xg=["index","created","timestamp"];function ft(e,t,n){const r=n?.ignoreKeys??Xg;if(e==null&&t==null)return;if(e==null||t==null)return e??t;const s={...e};for(const[a,i]of Object.entries(t))if(s[a]==null)s[a]=i;else{if(i==null)continue;if(typeof s[a]!=typeof i||Array.isArray(s[a])!==Array.isArray(i))throw new Error(`field[${a}] already exists in the message chunk, but with a different type.`);if(typeof s[a]=="string"){if(a==="type")continue;if(["id","name","output_version","model_provider"].includes(a))i&&(s[a]=i);else{if(r.includes(a))continue;s[a]+=i}}else if(typeof s[a]=="number"){if(r.includes(a))continue;s[a]=s[a]+i}else if(typeof s[a]=="object"&&!Array.isArray(s[a]))s[a]=ft(s[a],i,n);else if(Array.isArray(s[a]))s[a]=Qs(s[a],i,n);else{if(s[a]===i)continue;console.warn(`field[${a}] already exists in this message chunk and value has unsupported type.`)}}return s}function Qs(e,t,n){if(!(e==null&&t==null)){if(e==null||t==null)return e||t;{const r=[...e];for(const s of t)if(typeof s=="object"&&s!==null&&"index"in s&&typeof s.index=="number"){const a=r.findIndex(i=>{const o=typeof i=="object",c="index"in i&&i.index===s.index,u="id"in i&&"id"in s&&i?.id===s?.id,l=!("id"in i)||!i?.id||!("id"in s)||!s?.id;return o&&c&&(u||l)});a!==-1&&typeof r[a]=="object"&&r[a]!==null?r[a]=ft(r[a],s,n):r.push(s)}else{if(typeof s=="object"&&s!==null&&"text"in s&&s.text==="")continue;r.push(s)}return r}}}function Yg(e,t,n){if(!(e==null&&t==null)){if(e==null||t==null)return e??t;if(typeof e!=typeof t)throw new Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if(typeof e=="string"&&typeof t=="string")return e+t;if(Array.isArray(e)&&Array.isArray(t))return Qs(e,t,n);if(typeof e=="object"&&typeof t=="object")return ft(e,t,n);if(e===t)return e;throw new Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}}var ar=class Qg extends Un{static isInstance(t){if(!super.isInstance(t))return!1;let n=Object.getPrototypeOf(t);for(;n!==null;){if(n===Qg.prototype)return!0;n=Object.getPrototypeOf(n)}return!1}};function e_(e){return typeof e.role=="string"}function Jn(e){return typeof e?._getType=="function"}function Dl(e){return ar.isInstance(e)}function t_(e,t){return ft(e,t)??{}}function n_(e,t){const n={};return(e?.audio!==void 0||t?.audio!==void 0)&&(n.audio=(e?.audio??0)+(t?.audio??0)),(e?.image!==void 0||t?.image!==void 0)&&(n.image=(e?.image??0)+(t?.image??0)),(e?.video!==void 0||t?.video!==void 0)&&(n.video=(e?.video??0)+(t?.video??0)),(e?.document!==void 0||t?.document!==void 0)&&(n.document=(e?.document??0)+(t?.document??0)),(e?.text!==void 0||t?.text!==void 0)&&(n.text=(e?.text??0)+(t?.text??0)),n}function h0(e,t){const n={...n_(e,t)};return(e?.cache_read!==void 0||t?.cache_read!==void 0)&&(n.cache_read=(e?.cache_read??0)+(t?.cache_read??0)),(e?.cache_creation!==void 0||t?.cache_creation!==void 0)&&(n.cache_creation=(e?.cache_creation??0)+(t?.cache_creation??0)),n}function p0(e,t){const n={...n_(e,t)};return(e?.reasoning!==void 0||t?.reasoning!==void 0)&&(n.reasoning=(e?.reasoning??0)+(t?.reasoning??0)),n}function Ul(e,t){return{input_tokens:(e?.input_tokens??0)+(t?.input_tokens??0),output_tokens:(e?.output_tokens??0)+(t?.output_tokens??0),total_tokens:(e?.total_tokens??0)+(t?.total_tokens??0),input_token_details:h0(e?.input_token_details,t?.input_token_details),output_token_details:p0(e?.output_token_details,t?.output_token_details)}}var m0={};be(m0,{ToolMessage:()=>En,ToolMessageChunk:()=>ea,defaultToolCallParser:()=>Bl,isDirectToolOutput:()=>Fl,isToolMessage:()=>r_,isToolMessageChunk:()=>s_});function Fl(e){return e!=null&&typeof e=="object"&&"lc_direct_tool_output"in e&&e.lc_direct_tool_output===!0}var En=class extends Un{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}lc_direct_tool_output=!0;type="tool";status;tool_call_id;metadata;artifact;constructor(e,t,n){const r=typeof e=="string"||Array.isArray(e)?{content:e,name:n,tool_call_id:t}:e;super(r),this.tool_call_id=r.tool_call_id,this.artifact=r.artifact,this.status=r.status,this.metadata=r.metadata}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},ea=class extends ar{type="tool";tool_call_id;status;artifact;constructor(e){super(e),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){const t=this.constructor;return new t({content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:ft(this.response_metadata,e.response_metadata),artifact:Yg(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Kg(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function Bl(e){const t=[],n=[];for(const r of e)if(r.function){const s=r.function.name;try{const a=JSON.parse(r.function.arguments);t.push({name:s||"",args:a||{},id:r.id})}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[t,n]}function r_(e){return typeof e=="object"&&e!==null&&"getType"in e&&typeof e.getType=="function"&&e.getType()==="tool"}function s_(e){return e._getType()==="tool"}var Sr=class a_ extends Un{static lc_name(){return"ChatMessage"}type="generic";role;static _chatMessageClass(){return a_}constructor(t,n){(typeof t=="string"||Array.isArray(t))&&(t={content:t,role:n}),super(t),this.role=t.role}static isInstance(t){return super.isInstance(t)&&t.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},ta=class extends ar{static lc_name(){return"ChatMessageChunk"}type="generic";role;constructor(e,t){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}concat(e){const t=this.constructor;return new t({content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:ft(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function g0(e){return e._getType()==="generic"}function _0(e){return e._getType()==="generic"}var eo=class extends Un{static lc_name(){return"FunctionMessage"}type="function";name;constructor(e){super(e),this.name=e.name}},na=class extends ar{static lc_name(){return"FunctionMessageChunk"}type="function";concat(e){const t=this.constructor;return new t({content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:ft(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function y0(e){return e._getType()==="function"}function w0(e){return e._getType()==="function"}var sn=class extends Un{static lc_name(){return"HumanMessage"}type="human";constructor(e){super(e)}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},ra=class extends ar{static lc_name(){return"HumanMessageChunk"}type="human";constructor(e){super(e)}concat(e){const t=this.constructor;return new t({content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:ft(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function b0(e){return e.getType()==="human"}function v0(e){return e.getType()==="human"}var fi=class extends Un{type="remove";id;constructor(e){super({...e,content:[]}),this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}},Mn=class Ya extends Un{static lc_name(){return"SystemMessage"}type="system";constructor(t){super(t)}concat(t){if(typeof t=="string")return new Ya({...this,content:Pn(this.content,t)});if(Ya.isInstance(t))return new Ya({...this,additional_kwargs:{...this.additional_kwargs,...t.additional_kwargs},response_metadata:{...this.response_metadata,...t.response_metadata},content:Pn(this.content,t.content)});throw new Error("Unexpected chunk type for system message")}static isInstance(t){return super.isInstance(t)&&t.type==="system"}},Yn=class extends ar{static lc_name(){return"SystemMessageChunk"}type="system";constructor(e){super(e)}concat(e){const t=this.constructor;return new t({content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:ft(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function E0(e){return e._getType()==="system"}function T0(e){return e._getType()==="system"}var S0={};be(S0,{ModelAbortError:()=>vu,addLangChainErrorFields:()=>Zl});function Zl(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}var vu=class i_ extends Error{name="ModelAbortError";lc_error_code="MODEL_ABORTED";partialOutput;constructor(t,n){super(t),this.partialOutput=n,Error.captureStackTrace&&Error.captureStackTrace(this,i_)}static isInstance(t){return typeof t=="object"&&t!==null&&"name"in t&&t.name==="ModelAbortError"&&"lc_error_code"in t&&t.lc_error_code==="MODEL_ABORTED"}};function $s(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="tool_call")}function x0(e){return!!(e&&typeof e=="object"&&"toolCall"in e&&e.toolCall!=null&&typeof e.toolCall=="object"&&"id"in e.toolCall&&typeof e.toolCall.id=="string")}var hi=class extends Error{output;constructor(e,t){super(e),this.output=t}};function Eu(e,t=to){e=e.trim();const n=e.indexOf("```");if(n===-1)return t(e);let r=e.substring(n+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const s=r.indexOf("```");let a=r;return s!==-1&&(a=r.substring(0,s)),t(a.trim())}function k0(e){try{return JSON.parse(e)}catch{}const t=e.trim();if(t.length===0)throw new Error("Unexpected end of JSON input");let n=0;function r(){for(;n<t.length&&/\s/.test(t[n]);)n+=1}function s(){if(t[n]!=='"')throw new Error(`Expected '"' at position ${n}, got '${t[n]}'`);n+=1;let l="",d=!1;for(;n<t.length;){const f=t[n];if(d){if(f==="n")l+=`
`;else if(f==="t")l+="	";else if(f==="r")l+="\r";else if(f==="\\")l+="\\";else if(f==='"')l+='"';else if(f==="b")l+="\b";else if(f==="f")l+="\f";else if(f==="/")l+="/";else if(f==="u"){const h=t.substring(n+1,n+5);if(/^[0-9A-Fa-f]{0,4}$/.test(h))h.length===4?l+=String.fromCharCode(Number.parseInt(h,16)):l+=`u${h}`,n+=h.length;else throw new Error(`Invalid unicode escape sequence '\\u${h}' at position ${n}`)}else throw new Error(`Invalid escape sequence '\\${f}' at position ${n}`);d=!1}else if(f==="\\")d=!0;else{if(f==='"')return n+=1,l;l+=f}n+=1}return d&&(l+="\\"),l}function a(){const l=n;let d="";if(t[n]==="-"&&(d+="-",n+=1),n<t.length&&t[n]==="0"&&(d+="0",n+=1,t[n]>="0"&&t[n]<="9"))throw new Error(`Invalid number at position ${l}`);if(n<t.length&&t[n]>="1"&&t[n]<="9")for(;n<t.length&&t[n]>="0"&&t[n]<="9";)d+=t[n],n+=1;if(n<t.length&&t[n]===".")for(d+=".",n+=1;n<t.length&&t[n]>="0"&&t[n]<="9";)d+=t[n],n+=1;if(n<t.length&&(t[n]==="e"||t[n]==="E"))for(d+=t[n],n+=1,n<t.length&&(t[n]==="+"||t[n]==="-")&&(d+=t[n],n+=1);n<t.length&&t[n]>="0"&&t[n]<="9";)d+=t[n],n+=1;if(d==="-")return-0;const f=Number.parseFloat(d);if(Number.isNaN(f))throw n=l,new Error(`Invalid number '${d}' at position ${l}`);return f}function i(){if(r(),n>=t.length)throw new Error(`Unexpected end of input at position ${n}`);const l=t[n];if(l==="{")return c();if(l==="[")return o();if(l==='"')return s();if("null".startsWith(t.substring(n,n+4)))return n+=Math.min(4,t.length-n),null;if("true".startsWith(t.substring(n,n+4)))return n+=Math.min(4,t.length-n),!0;if("false".startsWith(t.substring(n,n+5)))return n+=Math.min(5,t.length-n),!1;if(l==="-"||l>="0"&&l<="9")return a();throw new Error(`Unexpected character '${l}' at position ${n}`)}function o(){if(t[n]!=="[")throw new Error(`Expected '[' at position ${n}, got '${t[n]}'`);const l=[];if(n+=1,r(),n>=t.length)return l;if(t[n]==="]")return n+=1,l;for(;n<t.length;){if(r(),n>=t.length||(l.push(i()),r(),n>=t.length))return l;if(t[n]==="]")return n+=1,l;if(t[n]===","){n+=1;continue}throw new Error(`Expected ',' or ']' at position ${n}, got '${t[n]}'`)}return l}function c(){if(t[n]!=="{")throw new Error(`Expected '{' at position ${n}, got '${t[n]}'`);const l={};if(n+=1,r(),n>=t.length)return l;if(t[n]==="}")return n+=1,l;for(;n<t.length;){if(r(),n>=t.length)return l;const d=s();if(r(),n>=t.length)return l;if(t[n]!==":")throw new Error(`Expected ':' at position ${n}, got '${t[n]}'`);if(n+=1,r(),n>=t.length||(l[d]=i(),r(),n>=t.length))return l;if(t[n]==="}")return n+=1,l;if(t[n]===","){n+=1;continue}throw new Error(`Expected ',' or '}' at position ${n}, got '${t[n]}'`)}return l}const u=i();if(r(),n<t.length)throw new Error(`Unexpected character '${t[n]}' at position ${n}`);return u}function to(e){try{return typeof e>"u"?null:k0(e)}catch{return null}}function ql(e){switch(e){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function I0(e){if(ue(e.document)&&ue(e.document.source)){const t=ue(e.document)&&L(e.document.format)?e.document.format:"",n=ql(t);if(ue(e.document.source)){if(ue(e.document.source.s3Location)&&L(e.document.source.s3Location.uri))return{type:"file",mimeType:n,fileId:e.document.source.s3Location.uri};if(jl(e.document.source.bytes))return{type:"file",mimeType:n,data:e.document.source.bytes};if(L(e.document.source.text))return{type:"file",mimeType:n,data:Buffer.from(e.document.source.text).toString("base64")};if(rn(e.document.source.content)){const r=e.document.source.content.reduce((s,a)=>ue(a)&&L(a.text)?s+a.text:s,"");return{type:"file",mimeType:n,data:r}}}}return{type:"non_standard",value:e}}function O0(e){if(Y(e,"image")&&ue(e.image)){const t=ue(e.image)&&L(e.image.format)?e.image.format:"",n=ql(t);if(ue(e.image.source)){if(ue(e.image.source.s3Location)&&L(e.image.source.s3Location.uri))return{type:"image",mimeType:n,fileId:e.image.source.s3Location.uri};if(jl(e.image.source.bytes))return{type:"image",mimeType:n,data:e.image.source.bytes}}}return{type:"non_standard",value:e}}function A0(e){if(Y(e,"video")&&ue(e.video)){const t=ue(e.video)&&L(e.video.format)?e.video.format:"",n=ql(t);if(ue(e.video.source)){if(ue(e.video.source.s3Location)&&L(e.video.source.s3Location.uri))return{type:"video",mimeType:n,fileId:e.video.source.s3Location.uri};if(jl(e.video.source.bytes))return{type:"video",mimeType:n,data:e.video.source.bytes}}}return{type:"non_standard",value:e}}function bf(e){function*t(){const n=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content;for(const r of n){if(Y(r,"cache_point")){yield{type:"non_standard",value:r};continue}else if(Y(r,"citations_content")&&ue(r.citationsContent)){const s=rn(r.citationsContent.content)?r.citationsContent.content.reduce((i,o)=>ue(o)&&L(o.text)?i+o.text:i,""):"",a=rn(r.citationsContent.citations)?r.citationsContent.citations.reduce((i,o)=>{if(ue(o)){const c=rn(o.sourceContent)?o.sourceContent.reduce((l,d)=>ue(d)&&L(d.text)?l+d.text:l,""):"",u=Ds(()=>{if(ue(o.location)){const l=o.location.documentChar||o.location.documentPage||o.location.documentChunk;if(ue(l))return{source:Qt(l.documentIndex)?l.documentIndex.toString():void 0,startIndex:Qt(l.start)?l.start:void 0,endIndex:Qt(l.end)?l.end:void 0}}return{}});i.push({type:"citation",citedText:c,...u})}return i},[]):[];yield{type:"text",text:s,annotations:a};continue}else if(Y(r,"document")&&ue(r.document)){yield I0(r);continue}else if(Y(r,"guard_content")){yield{type:"non_standard",value:r};continue}else if(Y(r,"image")&&ue(r.image)){yield O0(r);continue}else if(Y(r,"reasoning_content")&&L(r.reasoningText)){yield{type:"reasoning",reasoning:r.reasoningText};continue}else if(Y(r,"text")&&L(r.text)){yield{type:"text",text:r.text};continue}else if(Y(r,"tool_result")){yield{type:"non_standard",value:r};continue}else{if(Y(r,"tool_call"))continue;if(Y(r,"video")&&ue(r.video)){yield A0(r);continue}}yield{type:"non_standard",value:r}}}return Array.from(t())}const C0={translateContent:bf,translateContentChunk:bf};function vf(e){const t=[],n=e.additional_kwargs?.reasoning_content;if(L(n)&&n.length>0&&t.push({type:"reasoning",reasoning:n}),typeof e.content=="string")e.content.length>0&&t.push({type:"text",text:e.content});else for(const r of e.content)typeof r=="object"&&"type"in r&&r.type==="text"&&"text"in r&&L(r.text)&&t.push({type:"text",text:r.text});for(const r of e.tool_calls??[])t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}const $0={translateContent:vf,translateContentChunk:vf};function Ef(e){function*t(){const n=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content;for(const r of n){if(Y(r,"text")&&L(r.text)){yield{type:"text",text:r.text};continue}else if(Y(r,"thinking")&&L(r.thinking)){yield{type:"reasoning",reasoning:r.thinking,...r.signature?{signature:r.signature}:{}};continue}else if(Y(r,"inlineData")&&ue(r.inlineData)&&L(r.inlineData.mimeType)&&L(r.inlineData.data)){yield{type:"file",mimeType:r.inlineData.mimeType,data:r.inlineData.data};continue}else if(Y(r,"functionCall")&&ue(r.functionCall)&&L(r.functionCall.name)&&ue(r.functionCall.args)){yield{type:"tool_call",id:e.id,name:r.functionCall.name,args:r.functionCall.args};continue}else if(Y(r,"functionResponse")){yield{type:"non_standard",value:r};continue}else if(Y(r,"fileData")&&ue(r.fileData)&&L(r.fileData.mimeType)&&L(r.fileData.fileUri)){yield{type:"file",mimeType:r.fileData.mimeType,fileId:r.fileData.fileUri};continue}else if(Y(r,"executableCode")){yield{type:"non_standard",value:r};continue}else if(Y(r,"codeExecutionResult")){yield{type:"non_standard",value:r};continue}yield{type:"non_standard",value:r}}}return Array.from(t())}const R0={translateContent:Ef,translateContentChunk:Ef};function Tf(e){function*t(){const n=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content;for(const r of n){if(Y(r,"reasoning")&&L(r.reasoning)){const s=Ds(()=>{const a=n.indexOf(r);if(rn(e.additional_kwargs?.signatures)&&a>=0)return e.additional_kwargs.signatures.at(a)});L(s)?yield{type:"reasoning",reasoning:r.reasoning,signature:s}:yield{type:"reasoning",reasoning:r.reasoning};continue}else if(Y(r,"thinking")&&L(r.thinking)){yield{type:"reasoning",reasoning:r.thinking,...r.signature?{signature:r.signature}:{}};continue}else if(Y(r,"text")&&L(r.text)){yield{type:"text",text:r.text};continue}else if(Y(r,"image_url")){if(L(r.image_url))if(r.image_url.startsWith("data:")){const s=/^data:([^;]+);base64,(.+)$/,a=r.image_url.match(s);a?yield{type:"image",data:a[2],mimeType:a[1]}:yield{type:"image",url:r.image_url}}else yield{type:"image",url:r.image_url};continue}else if(Y(r,"media")&&L(r.mimeType)&&L(r.data)){yield{type:"file",mimeType:r.mimeType,data:r.data};continue}yield{type:"non_standard",value:r}}}return Array.from(t())}const N0={translateContent:Tf,translateContentChunk:Tf};function Sf(e){const t=[],n=e.additional_kwargs?.reasoning;if(L(n)&&n.length>0&&t.push({type:"reasoning",reasoning:n}),typeof e.content=="string"){let r=e.content;const s=r.match(/<think>([\s\S]*?)<\/think>/);if(s){const a=s[1].trim();a.length>0&&t.push({type:"reasoning",reasoning:a}),r=r.replace(/<think>[\s\S]*?<\/think>/,"").trim()}r.length>0&&t.push({type:"text",text:r})}else for(const r of e.content)if(typeof r=="object"&&"type"in r&&r.type==="text"&&"text"in r&&L(r.text)){let s=r.text;const a=s.match(/<think>([\s\S]*?)<\/think>/);if(a){const i=a[1].trim();i.length>0&&t.push({type:"reasoning",reasoning:i}),s=s.replace(/<think>[\s\S]*?<\/think>/,"").trim()}s.length>0&&t.push({type:"text",text:s})}for(const r of e.tool_calls??[])t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}const P0={translateContent:Sf,translateContentChunk:Sf};function xf(e){const t=[],n=e.additional_kwargs?.reasoning_content;if(L(n)&&n.length>0&&t.push({type:"reasoning",reasoning:n}),typeof e.content=="string")e.content.length>0&&t.push({type:"text",text:e.content});else for(const r of e.content)typeof r=="object"&&"type"in r&&r.type==="text"&&"text"in r&&L(r.text)&&t.push({type:"text",text:r.text});for(const r of e.tool_calls??[])t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}const M0={translateContent:xf,translateContentChunk:xf};function kf(e){const t=[];if(ue(e.additional_kwargs?.reasoning)){const r=e.additional_kwargs.reasoning;if(rn(r.summary)){const s=r.summary.reduce((a,i)=>ue(i)&&L(i.text)?`${a}${i.text}`:a,"");s.length>0&&t.push({type:"reasoning",reasoning:s})}}const n=e.additional_kwargs?.reasoning_content;if(L(n)&&n.length>0&&t.push({type:"reasoning",reasoning:n}),typeof e.content=="string")e.content.length>0&&t.push({type:"text",text:e.content});else for(const r of e.content)typeof r=="object"&&"type"in r&&r.type==="text"&&"text"in r&&L(r.text)&&t.push({type:"text",text:r.text});for(const r of e.tool_calls??[])t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}const L0={translateContent:kf,translateContentChunk:kf};globalThis.lc_block_translators_registry??=new Map([["anthropic",Yv],["bedrock-converse",C0],["deepseek",$0],["google-genai",R0],["google-vertexai",N0],["groq",P0],["ollama",M0],["openai",c0],["xai",L0]]);function o_(e){return globalThis.lc_block_translators_registry.get(e)}var wt=class extends Un{type="ai";tool_calls=[];invalid_tool_calls=[];usage_metadata;get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e){let t;if(typeof e=="string"||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const n=t.additional_kwargs?.tool_calls,r=t.tool_calls;n!=null&&n.length>0&&(r===void 0||r.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(n!=null&&r===void 0){const[s,a]=Bl(n);t.tool_calls=s??[],t.invalid_tool_calls=a??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(t.response_metadata!==void 0&&"output_version"in t.response_metadata&&t.response_metadata.output_version==="v1"&&(t.contentBlocks=t.content,t.content=void 0),t.contentBlocks!==void 0){t.tool_calls&&t.contentBlocks.push(...t.tool_calls.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})));const s=t.contentBlocks.filter(a=>a.type==="tool_call").filter(a=>!t.tool_calls?.some(i=>i.id===a.id&&i.name===a.name));s.length>0&&(t.tool_calls=s.map(a=>({type:"tool_call",id:a.id,name:a.name,args:a.args})))}}super(t),typeof t!="string"&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=o_(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls){const t=this.tool_calls.filter(n=>!e.some(r=>r.id===n.id&&r.name===n.name));e.push(...t.map(n=>({type:"tool_call",id:n.id,name:n.name,args:n.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function no(e){return e._getType()==="ai"}function Tu(e){return e._getType()==="ai"}var Sn=class extends ar{type="ai";tool_calls=[];invalid_tool_calls=[];tool_call_chunks=[];usage_metadata;constructor(e){let t;if(typeof e=="string"||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const n=u_(e.tool_call_chunks??[]);t={...e,tool_call_chunks:n.tool_call_chunks,tool_calls:n.tool_calls,invalid_tool_calls:n.invalid_tool_calls,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const t=o_(this.response_metadata.model_provider);if(t)return t.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){const t=this.content.filter(n=>n.type==="tool_call").map(n=>n.id);for(const n of this.tool_calls)n.id&&!t.includes(n.id)&&e.push({...n,type:"tool_call",id:n.id,name:n.name,args:n.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:Pn(this.content,e.content),additional_kwargs:ft(this.additional_kwargs,e.additional_kwargs),response_metadata:t_(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=Qs(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(t.usage_metadata=Ul(this.usage_metadata,e.usage_metadata));const n=this.constructor;return new n(t)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};const c_=e=>e();function j0(e){return $s(e)?e:typeof e.id=="string"&&e.type==="function"&&typeof e.function=="object"&&e.function!==null&&"arguments"in e.function&&typeof e.function.arguments=="string"&&"name"in e.function&&typeof e.function.name=="string"?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function z0(e){return typeof e=="object"&&e!=null&&e.lc===1&&Array.isArray(e.id)&&e.kwargs!=null&&typeof e.kwargs=="object"}function Bo(e){let t,n;if(z0(e)){const r=e.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?t="user":r==="AIMessage"||r==="AIMessageChunk"?t="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?t="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?t="function":r==="ToolMessage"||r==="ToolMessageChunk"?t="tool":t="unknown",n=e.kwargs}else{const{type:r,...s}=e;t=r,n=s}if(t==="human"||t==="user")return new sn(n);if(t==="ai"||t==="assistant"){const{tool_calls:r,...s}=n;if(!Array.isArray(r))return new wt(n);const a=r.map(j0);return new wt({...s,tool_calls:a})}else{if(t==="system")return new Mn(n);if(t==="developer")return new Mn({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if(t==="tool"&&"tool_call_id"in n)return new En({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});if(t==="remove"&&"id"in n&&typeof n.id=="string")return new fi({...n,id:n.id});throw Zl(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Rs(e){if(typeof e=="string")return new sn(e);if(Jn(e))return e;if(Array.isArray(e)){const[t,n]=e;return Bo({type:t,content:n})}else if(e_(e)){const{role:t,...n}=e;return Bo({...n,type:t})}else return Bo(e)}function Hl(e,t="Human",n="AI"){const r=[];for(const s of e){let a;if(s.type==="human")a=t;else if(s.type==="ai")a=n;else if(s.type==="system")a="System";else if(s.type==="tool")a="Tool";else if(s.type==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s.type}`);const i=s.name?`${s.name}, `:"",o=s.text;let c=`${a}: ${i}${o}`;if(s.type==="ai"){const u=s;u.tool_calls&&u.tool_calls.length>0?c+=JSON.stringify(u.tool_calls):u.additional_kwargs&&"function_call"in u.additional_kwargs&&(c+=JSON.stringify(u.additional_kwargs.function_call))}r.push(c)}return r.join(`
`)}function D0(e){if(e.data!==void 0)return e;{const t=e;return{type:t.type,data:{content:t.text,role:t.role,name:void 0,tool_call_id:void 0}}}}function Vl(e){const t=D0(e);switch(t.type){case"human":return new sn(t.data);case"ai":return new wt(t.data);case"system":return new Mn(t.data);case"function":if(t.data.name===void 0)throw new Error("Name must be defined for function messages");return new eo(t.data);case"tool":if(t.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new En(t.data);case"generic":if(t.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Sr(t.data);default:throw new Error(`Got unexpected type: ${t.type}`)}}function U0(e){return e.map(Vl)}function F0(e){return e.map(t=>t.toDict())}function pi(e){const t=e._getType();if(t==="human")return new ra({...e});if(t==="ai"){let n={...e};return"tool_calls"in n&&(n={...n,tool_call_chunks:n.tool_calls?.map(r=>({...r,type:"tool_call_chunk",index:void 0,args:JSON.stringify(r.args)}))}),new Sn({...n})}else{if(t==="system")return new Yn({...e});if(t==="function")return new na({...e});if(Sr.isInstance(e))return new ta({...e});throw new Error("Unknown message type.")}}function u_(e){const t=e.reduce((s,a)=>{const i=s.findIndex(([o])=>"id"in a&&a.id&&"index"in a&&a.index!==void 0?a.id===o.id&&a.index===o.index:"id"in a&&a.id?a.id===o.id:"index"in a&&a.index!==void 0?a.index===o.index:!1);return i!==-1?s[i].push(a):s.push([a]),s},[]),n=[],r=[];for(const s of t){let a=null;const i=s[0]?.name??"",o=s.map(l=>l.args||"").join("").trim(),c=o.length?o:"{}",u=s[0]?.id;try{if(a=to(c),!u||a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");n.push({name:i,args:a,id:u,type:"tool_call"})}catch{r.push({name:i,args:c,id:u,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:e,tool_calls:n,invalid_tool_calls:r}}const l_=Symbol.for("ls:tracing_async_local_storage"),Ns=Symbol.for("lc:context_variables"),B0=e=>{globalThis[l_]=e},Us=()=>globalThis[l_];var Z0={},q0={};be(q0,{getEnv:()=>Gl,getEnvironmentVariable:()=>wn,getRuntimeEnvironment:()=>m_,isBrowser:()=>d_,isDeno:()=>ro,isJsDom:()=>h_,isNode:()=>p_,isWebWorker:()=>f_});const d_=()=>typeof window<"u"&&typeof window.document<"u",f_=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",h_=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),ro=()=>typeof Deno<"u",p_=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!ro(),Gl=()=>{let e;return d_()?e="browser":p_()?e="node":f_()?e="webworker":h_()?e="jsdom":ro()?e="deno":e="other",e};let Zo;function m_(){return Zo===void 0&&(Zo={library:"langchain-js",runtime:Gl()}),Zo}function wn(e){try{return typeof process<"u"?Z0?.[e]:ro()?Deno?.env.get(e):void 0}catch{return}}const H0=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ps(e){return typeof e=="string"&&H0.test(e)}function V0(e){if(!Ps(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=t&255,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=t&255,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=t&255,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=t&255,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=t&255,n}var it=[];for(var qo=0;qo<256;++qo)it.push((qo+256).toString(16).slice(1));function Jl(e,t=0){return(it[e[t+0]]+it[e[t+1]]+it[e[t+2]]+it[e[t+3]]+"-"+it[e[t+4]]+it[e[t+5]]+"-"+it[e[t+6]]+it[e[t+7]]+"-"+it[e[t+8]]+it[e[t+9]]+"-"+it[e[t+10]]+it[e[t+11]]+it[e[t+12]]+it[e[t+13]]+it[e[t+14]]+it[e[t+15]]).toLowerCase()}var xa,G0=new Uint8Array(16);function g_(){if(!xa&&(xa=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xa))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xa(G0)}function J0(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}var W0="6ba7b810-9dad-11d1-80b4-00c04fd430c8",K0="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function X0(e,t,n){function r(s,a,i,o){var c;if(typeof s=="string"&&(s=J0(s)),typeof a=="string"&&(a=V0(a)),((c=a)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+s.length);if(u.set(a),u.set(s,a.length),u=n(u),u[6]=u[6]&15|t,u[8]=u[8]&63|128,i){o=o||0;for(var l=0;l<16;++l)i[o+l]=u[l];return i}return Jl(u)}try{r.name=e}catch{}return r.DNS=W0,r.URL=K0,r}var Y0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const If={randomUUID:Y0};function pr(e,t,n){if(If.randomUUID&&!e)return If.randomUUID();e=e||{};var r=e.random||(e.rng||g_)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Jl(r)}function Q0(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function Ho(e,t){return e<<t|e>>>32-t}function eE(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){var r=unescape(encodeURIComponent(e));e=[];for(var s=0;s<r.length;++s)e.push(r.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,i=Math.ceil(a/16),o=new Array(i),c=0;c<i;++c){for(var u=new Uint32Array(16),l=0;l<16;++l)u[l]=e[c*64+l*4]<<24|e[c*64+l*4+1]<<16|e[c*64+l*4+2]<<8|e[c*64+l*4+3];o[c]=u}o[i-1][14]=(e.length-1)*8/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=(e.length-1)*8&4294967295;for(var d=0;d<i;++d){for(var f=new Uint32Array(80),h=0;h<16;++h)f[h]=o[d][h];for(var p=16;p<80;++p)f[p]=Ho(f[p-3]^f[p-8]^f[p-14]^f[p-16],1);for(var m=n[0],b=n[1],_=n[2],w=n[3],E=n[4],x=0;x<80;++x){var I=Math.floor(x/20),P=Ho(m,5)+Q0(I,b,_,w)+E+t[I]+f[x]>>>0;E=w,w=_,_=Ho(b,30)>>>0,b=m,m=P}n[0]=n[0]+m>>>0,n[1]=n[1]+b>>>0,n[2]=n[2]+_>>>0,n[3]=n[3]+w>>>0,n[4]=n[4]+E>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var tE=X0("v5",80,eE),Of=null,Af=null,qt=0;function Vn(e,t,n){e=e||{};var r=0,s=new Uint8Array(16),a=e.random||(e.rng||g_)(),i=e.msecs!==void 0?e.msecs:Date.now(),o=e.seq!==void 0?e.seq:null,c=Af,u=Of;return i>qt&&e.msecs===void 0&&(qt=i,o!==null&&(c=null,u=null)),o!==null&&(o>2147483647&&(o=2147483647),c=o>>>19&4095,u=o&524287),(c===null||u===null)&&(c=a[6]&127,c=c<<8|a[7],u=a[8]&63,u=u<<8|a[9],u=u<<5|a[10]>>>3),i+1e4>qt&&o===null?++u>524287&&(u=0,++c>4095&&(c=0,qt++)):qt=i,Af=c,Of=u,s[r++]=qt/1099511627776&255,s[r++]=qt/4294967296&255,s[r++]=qt/16777216&255,s[r++]=qt/65536&255,s[r++]=qt/256&255,s[r++]=qt&255,s[r++]=c>>>4&15|112,s[r++]=c&255,s[r++]=u>>>13&63|128,s[r++]=u>>>5&255,s[r++]=u<<3&255|a[10]&7,s[r++]=a[11],s[r++]=a[12],s[r++]=a[13],s[r++]=a[14],s[r++]=a[15],Jl(s)}var nE={};be(nE,{BaseCallbackHandler:()=>sa,callbackHandlerPrefersStreaming:()=>Wl,isBaseCallbackHandler:()=>__});var rE=class{};function Wl(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}var sa=class extends rE{lc_serializable=!1;get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Ll(this.constructor)]}lc_kwargs;ignoreLLM=!1;ignoreChain=!1;ignoreAgent=!1;ignoreRetriever=!1;ignoreCustomEvent=!1;raiseError=!1;awaitHandlers=wn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false";constructor(e){super(),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Vr.prototype.toJSON.call(this)}toJSONNotImplemented(){return Vr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends sa{name=Vn();constructor(){super(),Object.assign(this,e)}}return new t}};const __=e=>{const t=e;return t!==void 0&&typeof t.copy=="function"&&typeof t.name=="string"&&typeof t.awaitHandlers=="boolean"},sE="gen_ai.operation.name",aE="gen_ai.system",Cf="gen_ai.request.model",iE="gen_ai.response.model",$f="gen_ai.usage.input_tokens",Rf="gen_ai.usage.output_tokens",Nf="gen_ai.usage.total_tokens",oE="gen_ai.request.max_tokens",cE="gen_ai.request.temperature",uE="gen_ai.request.top_p",lE="gen_ai.request.frequency_penalty",dE="gen_ai.request.presence_penalty",fE="gen_ai.response.finish_reasons",hE="gen_ai.prompt",pE="gen_ai.completion",mE="gen_ai.request.extra_query",gE="gen_ai.request.extra_body",_E="gen_ai.serialized.name",yE="gen_ai.serialized.signature",wE="gen_ai.serialized.doc",bE="gen_ai.response.id",vE="gen_ai.response.service_tier",EE="gen_ai.response.system_fingerprint",TE="gen_ai.usage.input_token_details",SE="gen_ai.usage.output_token_details",xE="langsmith.trace.session_id",kE="langsmith.trace.session_name",IE="langsmith.span.kind",OE="langsmith.trace.name",AE="langsmith.metadata",Pf="langsmith.span.tags",CE="langsmith.request.streaming",$E="langsmith.request.headers",RE=(...e)=>fetch(...e),y_=Symbol.for("ls:fetch_implementation"),NE=()=>{const e=globalThis[y_];return e?typeof e=="function"&&"Headers"in e&&"Request"in e&&"Response"in e:!1},PE=e=>async(...t)=>{if(e||yt("DEBUG")==="true"){const[r,s]=t;console.log(` ${s?.method||"GET"} ${r}`)}const n=await(globalThis[y_]??RE)(...t);return(e||yt("DEBUG")==="true")&&console.log(` ${n.status} ${n.statusText} ${n.url}`),n},w_=()=>yt("PROJECT")??Tn("LANGCHAIN_SESSION")??"default",Mf={};function b_(e){Mf[e]||(console.warn(e),Mf[e]=!0)}const C=e=>BigInt(e),v_=C("0x9E3779B1"),E_=C("0x85EBCA77"),ME=C("0xC2B2AE3D"),Qn=C("0x9E3779B185EBCA87"),Er=C("0xC2B2AE3D27D4EB4F"),T_=C("0x165667B19E3779F9"),Kl=C("0x85EBCA77C2B2AE63"),LE=C("0x27D4EB2F165667C5"),jE=C("0x165667919E3779F9"),zE=C("0x9FB21C651E98DF25");function DE(e){const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t}const mn=DE("b8fe6c3923a44bbe7c01812cf721ad1cded46de9839097db7240a4a4b7b3671fcb79e64eccc0e578825ad07dccff7221b8084674f743248ee03590e6813a264c3c2852bb91c300cb88d0658b1b532ea371644897a20df94e3819ef46a9deacd8a8fa763fe39c343ff9dcbbc7c70b4f1d8a51e04bcdb45931c89f7ec9d9787364eac5ac8334d3ebc3c581a0fffa1363eb170ddd51b7f0da49d316552629d4689e2b16be587d47a1fc8ff8b8d17ad031ce45cb3a8f95160428afd7fbcabb4b407e"),qr=(C(1)<<C(128))-C(1),me=(C(1)<<C(64))-C(1),mi=(C(1)<<C(32))-C(1),Cn=64,S_=Cn/8,UE=8,ka=4;function Re(e,t=0){return new Uint8Array(e.buffer,e.byteOffset+t,e.length-t)}function Me(e,t=0){return new DataView(e.buffer,e.byteOffset+t).getBigUint64(0,!0)}function Dr(e,t=0){return new DataView(e.buffer,e.byteOffset+t).getUint32(0,!0)}function Vo(e,t=0){return e[t]}const FE=e=>(e&C(255))<<C(56)|(e&C(65280))<<C(40)|(e&C(16711680))<<C(24)|(e&C(4278190080))<<C(8)|(e&C(0xff00000000))>>C(8)|(e&C(0xff0000000000))>>C(24)|(e&C(0xff000000000000))>>C(40)|(e&C(0xff00000000000000))>>C(56),BE=e=>(e=(e&C(65535))<<C(16)|(e&C(4294901760))>>C(16),e=(e&C(16711935))<<C(8)|(e&C(4278255360))>>C(8),e),ZE=(e,t)=>(e&mi)*(t&mi)&me,Gr=e=>{if(!e)throw new Error("Assert failed")};function qE(e,t){return(e<<t|e>>C(32)-t)&mi}function x_(e,t,n){for(let r=0;r<S_;r++){const s=Me(t,r*8),a=s^Me(n,r*8);e[r^1]+=s,e[r]+=ZE(a,a>>C(32))}return e}function Lf(e,t,n,r){for(let s=0;s<r;s++)x_(e,Re(t,s*Cn),Re(n,s*8));return e}function HE(e,t){for(let n=0;n<S_;n++){const r=Me(t,n*8);let s=e[n];s=Su(s,C(47)),s^=r,s*=v_,e[n]=s&me}return e}function Ia(e,t){return k_(e[0]^Me(t,0),e[1]^Me(t,UE))}function jf(e,t,n){let r=n;return r+=Ia(e.slice(0),Re(t,0*ka)),r+=Ia(e.slice(2),Re(t,4*ka)),r+=Ia(e.slice(4),Re(t,8*ka)),r+=Ia(e.slice(6),Re(t,12*ka)),_n(r&me)}function VE(e,t,n,r,s){const a=Math.floor((n.byteLength-Cn)/8),i=Cn*a,o=Math.floor((t.byteLength-1)/i);for(let c=0;c<o;c++)e=Lf(e,Re(t,c*i),n,a),e=s(e,Re(n,n.byteLength-Cn));{const c=Math.floor((t.byteLength-1-i*o)/Cn);e=Lf(e,Re(t,o*i),n,c),e=r(e,Re(t,t.byteLength-Cn),Re(n,n.byteLength-Cn-7))}return e}function GE(e,t,n){let r=new BigUint64Array([ME,Qn,Er,T_,Kl,E_,LE,v_]);Gr(e.length>128),r=VE(r,e,t,x_,HE),Gr(r.length*8==64);{const s=jf(r,Re(t,11),C(e.byteLength)*Qn&me);return jf(r,Re(t,t.byteLength-Cn-11),~(C(e.byteLength)*Er)&me)<<C(64)|s}}function k_(e,t){const n=e*t&qr;return n&me^n>>C(64)}function zf(e,t,n){return k_((Me(e,0)^Me(t,0)+n)&me,(Me(e,8)^Me(t,8)-n)&me)}function Qa(e,t,n,r,s){let a=e&me,i=e>>C(64)&me;return a+=zf(t,r,s),a^=Me(n,0)+Me(n,8),a&=me,i+=zf(n,Re(r,16),s),i^=Me(t,0)+Me(t,8),i&=me,i<<C(64)|a}function _n(e){return e^=e>>C(37),e*=jE,e&=me,e^=e>>C(32),e}function gi(e){return e^=e>>C(33),e*=Er,e&=me,e^=e>>C(29),e*=T_,e&=me,e^=e>>C(32),e}function JE(e,t,n){const r=e.byteLength;Gr(r>0&&r<=3);const s=C(Vo(e,r-1))|C(r<<8)|C(Vo(e,0)<<16)|C(Vo(e,r>>1)<<24),a=(C(Dr(t,0))^C(Dr(t,4)))+n,i=(s^a)&me,o=(C(Dr(t,8))^C(Dr(t,12)))-n,c=(qE(BE(s),C(13))^o)&me;return(gi(c)&me)<<C(64)|gi(i)}function Su(e,t){return e^e>>t}function WE(e,t,n){const r=e.byteLength;Gr(r>=4&&r<=8);{const s=Dr(e,0),a=Dr(e,r-4),i=C(s)|C(a)<<C(32),o=(Me(t,16)^Me(t,24))+n&me;let u=(i^o)*(Qn+(C(r)<<C(2)))&qr;return u+=(u&me)<<C(65),u&=qr,u^=u>>C(67),Su(Su(u&me,C(35))*zE&me,C(28))|_n(u>>C(64))<<C(64)}}function KE(e,t,n){const r=e.byteLength;Gr(r>=9&&r<=16);{const s=(Me(t,32)^Me(t,40))+n&me,a=(Me(t,48)^Me(t,56))-n&me,i=Me(e);let o=Me(e,r-8),c=(i^o^s)*Qn;const u=(c&me)+(C(r-1)<<C(54));c=c&(qr^me)|u,o^=a,c+=o+(o&mi)*(E_-C(1))<<C(64),c&=qr,c^=FE(c>>C(64));let l=(c&me)*Er;return l+=(c>>C(64))*Er<<C(64),l&=qr,_n(l&me)|_n(l>>C(64))<<C(64)}}function XE(e,t){const n=e.byteLength;return Gr(n<=16),n>8?KE(e,mn,t):n>=4?WE(e,mn,t):n>0?JE(e,mn,t):gi(t^Me(mn,64)^Me(mn,72))|gi(t^Me(mn,80)^Me(mn,88))<<C(64)}function xu(e){return~e+C(1)&me}function YE(e,t,n){let r=C(e.byteLength)*Qn&me,s=C(e.byteLength-1)/C(32);for(;s>=0;){const o=Number(s);r=Qa(r,Re(e,16*o),Re(e,e.byteLength-16*(o+1)),Re(t,32*o),n),s--}let a=r+(r>>C(64))&me;a=_n(a);let i=(r&me)*Qn+(r>>C(64))*Kl+(C(e.byteLength)-n&me)*Er;return i&=me,i=xu(_n(i)),a|i<<C(64)}function QE(e,t,n){let r=C(e.byteLength)*Qn&me;for(let i=32;i<160;i+=32)r=Qa(r,Re(e,i-32),Re(e,i-16),Re(t,i-32),n);r=_n(r&me)|_n(r>>C(64))<<C(64);for(let i=160;i<=e.byteLength;i+=32)r=Qa(r,Re(e,i-32),Re(e,i-16),Re(t,3+i-160),n);r=Qa(r,Re(e,e.byteLength-16),Re(e,e.byteLength-32),Re(t,103),xu(n));let s=r+(r>>C(64))&me;s=_n(s);let a=(r&me)*Qn+(r>>C(64))*Kl+(C(e.byteLength)-n&me)*Er;return a&=me,a=xu(_n(a)),s|a<<C(64)}function eT(e,t=C(0)){const n=e.byteLength;return n<=16?XE(e,t):n<=128?YE(e,mn,t):n<=240?QE(e,mn,t):GE(e,mn)}function tT(e){const t=new Uint8Array(16),n=new DataView(t.buffer),r=e&me,s=e>>C(64);return n.setBigUint64(0,s,!1),n.setBigUint64(8,r,!1),t}const I_=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function he(e,t){if(!I_.test(e)){const n=t!==void 0?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`;throw new Error(n)}return e}function nT(e){const t=typeof e=="string"?Date.parse(e):e;return Vn({msecs:t,seq:0})}function rT(e){if(!I_.test(e))return null;const t=e[14];return parseInt(t,16)}function sT(e){const t=e.replace(/-/g,""),n=new Uint8Array(16);for(let r=0;r<16;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}function aT(e){const t=Array.from(e).map(n=>n.toString(16).padStart(2,"0")).join("");return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20)}`}const iT=new TextEncoder;function oT(e){const t=iT.encode(e),n=eT(t);return tT(n)}function Oa(e,t){const n=`${e}:${t}`,r=oT(n),s=new Uint8Array(16);if(rT(e)===7){const i=sT(e);s.set(i.slice(0,6),0)}else{const i=Date.now();s[0]=i/1099511627776&255,s[1]=i/4294967296&255,s[2]=i/16777216&255,s[3]=i/65536&255,s[4]=i/256&255,s[5]=i&255}return s[6]=112|r[0]&15,s[7]=r[1],s[8]=128|r[2]&63,s.set(r.slice(3,10),9),aT(s)}function cT(e,t){throw new Error("dump() is not supported in browser environments.")}function uT(e){throw new Error("load() is not supported in browser environments.")}function lT(e,t){return t===null?!1:Date.now()-e.createdAt>t*1e3}class dT{constructor(t={}){Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ttlSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshIntervalSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,refreshes:0,refreshErrors:0}}),this.maxSize=t.maxSize??100,this.ttlSeconds=t.ttlSeconds??3600,this.refreshIntervalSeconds=t.refreshIntervalSeconds??60,this.fetchFunc=t.fetchFunc,this.fetchFunc&&this.ttlSeconds!==null&&this.startRefreshLoop()}get metrics(){return{...this._metrics}}get totalRequests(){return this._metrics.hits+this._metrics.misses}get hitRate(){const t=this.totalRequests;return t>0?this._metrics.hits/t:0}resetMetrics(){this._metrics={hits:0,misses:0,refreshes:0,refreshErrors:0}}get(t){const n=this.cache.get(t);if(!n){this._metrics.misses+=1;return}return this.cache.delete(t),this.cache.set(t,n),this._metrics.hits+=1,n.value}set(t,n){if(!this.cache.has(t)&&this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s!==void 0&&this.cache.delete(s)}const r={value:n,createdAt:Date.now()};this.cache.delete(t),this.cache.set(t,r)}invalidate(t){this.cache.delete(t)}clear(){this.cache.clear()}get size(){return this.cache.size}stop(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}dump(t){for(const[n,r]of this.cache.entries())r.value;cT()}load(t){const n=uT();if(!n)return 0;let r=0;const s=Date.now();for(const[a,i]of Object.entries(n)){if(this.cache.size>=this.maxSize)break;const o={value:i,createdAt:s};this.cache.set(a,o),r+=1}return r}startRefreshLoop(){this.refreshTimer=setInterval(()=>{this.refreshStaleEntries().catch(t=>{console.warn("Unexpected error in cache refresh loop:",t)})},this.refreshIntervalSeconds*1e3),this.refreshTimer.unref&&this.refreshTimer.unref()}getStaleKeys(){const t=[];for(const[n,r]of this.cache.entries())lT(r,this.ttlSeconds)&&t.push(n);return t}async refreshStaleEntries(){if(!this.fetchFunc)return;const t=this.getStaleKeys();if(t.length!==0)for(const n of t)try{const r=await this.fetchFunc(n);this.set(n,r),this._metrics.refreshes+=1}catch(r){this._metrics.refreshErrors+=1,console.warn(`Failed to refresh cache entry ${n}:`,r)}}}const O_="0.4.12";var ku={};let fn;const fT=()=>typeof window<"u"&&typeof window.document<"u",hT=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",pT=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),A_=()=>typeof Deno<"u",mT=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!A_(),C_=()=>fn||(typeof Bun<"u"?fn="bun":fT()?fn="browser":mT()?fn="node":hT()?fn="webworker":pT()?fn="jsdom":A_()?fn="deno":fn="other",fn);let Go;function $_(){if(Go===void 0){const e=C_(),t=_T();Go={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:O_,...t}}return Go}function R_(){const e=gT(),t={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(e))typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?t.revision_id=s:t[r]=s);return t}function gT(){const e={};try{if(typeof process<"u"&&ku)for(const[t,n]of Object.entries(ku))(t.startsWith("LANGCHAIN_")||t.startsWith("LANGSMITH_"))&&n!=null&&((t.toLowerCase().includes("key")||t.toLowerCase().includes("secret")||t.toLowerCase().includes("token"))&&typeof n=="string"?e[t]=n.slice(0,2)+"*".repeat(n.length-4)+n.slice(-2):e[t]=n)}catch{}return e}function Tn(e){try{return typeof process<"u"?ku?.[e]:void 0}catch{return}}function yt(e){return Tn(`LANGSMITH_${e}`)||Tn(`LANGCHAIN_${e}`)}let Jo;function _T(){if(Jo!==void 0)return Jo;const e=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],t={};for(const n of e){const r=Tn(n);r!==void 0&&(t[n]=r)}return Jo=t,t}function N_(){return Tn("OTEL_ENABLED")==="true"||yt("OTEL_ENABLED")==="true"}class yT{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(t,...n){!this.hasWarned&&N_()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let r;if(n.length===1&&typeof n[0]=="function"?r=n[0]:n.length===2&&typeof n[1]=="function"?r=n[1]:n.length===3&&typeof n[2]=="function"&&(r=n[2]),typeof r=="function")return r()}}class wT{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new yT})}getTracer(t,n){return this.mockTracer}getActiveSpan(){}setSpan(t,n){return t}getSpan(t){}setSpanContext(t,n){return t}getTracerProvider(){}setGlobalTracerProvider(t){return!1}}class bT{active(){return{}}with(t,n){return n()}}const Wo=Symbol.for("ls:otel_trace"),Ko=Symbol.for("ls:otel_context"),Df=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),vT=new wT,ET=new bT;class TT{getTraceInstance(){return globalThis[Wo]??vT}getContextInstance(){return globalThis[Ko]??ET}initializeGlobalInstances(t){globalThis[Wo]===void 0&&(globalThis[Wo]=t.trace),globalThis[Ko]===void 0&&(globalThis[Ko]=t.context)}setDefaultOTLPTracerComponents(t){globalThis[Df]=t}getDefaultOTLPTracerComponents(){return globalThis[Df]??void 0}}const Xl=new TT;function P_(){return Xl.getTraceInstance()}function ST(){return Xl.getContextInstance()}function xT(){return Xl.getDefaultOTLPTracerComponents()}const kT={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function IT(e){return kT[e]||e}class OT{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(t,n){for(const r of t)try{if(!r.run)continue;if(r.operation==="post"){const s=this.createSpanForRun(r,r.run,n.get(r.id));s&&!r.run.end_time&&this.spans.set(r.id,s)}else this.updateSpanForRun(r,r.run)}catch(s){console.error(`Error processing operation ${r.id}:`,s)}}createSpanForRun(t,n,r){const s=r&&P_().getSpan(r);if(s)try{return this.finishSpanSetup(s,n,t)}catch(a){console.error(`Failed to create span for run ${t.id}:`,a);return}}finishSpanSetup(t,n,r){return this.setSpanAttributes(t,n,r),n.error?(t.setStatus({code:2}),t.recordException(new Error(n.error))):t.setStatus({code:1}),n.end_time&&t.end(new Date(n.end_time)),t}updateSpanForRun(t,n){try{const r=this.spans.get(t.id);if(!r){console.debug(`No span found for run ${t.id} during update`);return}this.setSpanAttributes(r,n,t),n.error?(r.setStatus({code:2}),r.recordException(new Error(n.error))):r.setStatus({code:1});const s=n.end_time;s&&(r.end(new Date(s)),this.spans.delete(t.id))}catch(r){console.error(`Failed to update span for run ${t.id}:`,r)}}extractModelName(t){if(t.extra?.metadata){const n=t.extra.metadata;if(n.ls_model_name)return n.ls_model_name;if(n.invocation_params){const r=n.invocation_params;if(r.model)return r.model;if(r.model_name)return r.model_name}}}setSpanAttributes(t,n,r){if("run_type"in n&&n.run_type){t.setAttribute(IE,n.run_type);const o=IT(n.run_type||"chain");t.setAttribute(sE,o)}"name"in n&&n.name&&t.setAttribute(OE,n.name),"session_id"in n&&n.session_id&&t.setAttribute(xE,n.session_id),"session_name"in n&&n.session_name&&t.setAttribute(kE,n.session_name),this.setGenAiSystem(t,n);const s=this.extractModelName(n);s&&t.setAttribute(Cf,s),"prompt_tokens"in n&&typeof n.prompt_tokens=="number"&&t.setAttribute($f,n.prompt_tokens),"completion_tokens"in n&&typeof n.completion_tokens=="number"&&t.setAttribute(Rf,n.completion_tokens),"total_tokens"in n&&typeof n.total_tokens=="number"&&t.setAttribute(Nf,n.total_tokens),this.setInvocationParameters(t,n);const a=n.extra?.metadata||{};for(const[o,c]of Object.entries(a))c!=null&&t.setAttribute(`${AE}.${o}`,String(c));const i=n.tags;if(i&&Array.isArray(i)?t.setAttribute(Pf,i.join(", ")):i&&t.setAttribute(Pf,String(i)),"serialized"in n&&typeof n.serialized=="object"){const o=n.serialized;o.name&&t.setAttribute(_E,String(o.name)),o.signature&&t.setAttribute(yE,String(o.signature)),o.doc&&t.setAttribute(wE,String(o.doc))}this.setIOAttributes(t,r)}setGenAiSystem(t,n){let r="langchain";const s=this.extractModelName(n);if(s){const a=s.toLowerCase();a.includes("anthropic")||a.startsWith("claude")?r="anthropic":a.includes("bedrock")?r="aws.bedrock":a.includes("azure")&&a.includes("openai")?r="az.ai.openai":a.includes("azure")&&a.includes("inference")?r="az.ai.inference":a.includes("cohere")?r="cohere":a.includes("deepseek")?r="deepseek":a.includes("gemini")?r="gemini":a.includes("groq")?r="groq":a.includes("watson")||a.includes("ibm")?r="ibm.watsonx.ai":a.includes("mistral")?r="mistral_ai":a.includes("gpt")||a.includes("openai")?r="openai":a.includes("perplexity")||a.includes("sonar")?r="perplexity":a.includes("vertex")?r="vertex_ai":(a.includes("xai")||a.includes("grok"))&&(r="xai")}t.setAttribute(aE,r)}setInvocationParameters(t,n){if(!n.extra?.metadata?.invocation_params)return;const r=n.extra.metadata.invocation_params;r.max_tokens!==void 0&&t.setAttribute(oE,r.max_tokens),r.temperature!==void 0&&t.setAttribute(cE,r.temperature),r.top_p!==void 0&&t.setAttribute(uE,r.top_p),r.frequency_penalty!==void 0&&t.setAttribute(lE,r.frequency_penalty),r.presence_penalty!==void 0&&t.setAttribute(dE,r.presence_penalty)}setIOAttributes(t,n){if(n.run.inputs)try{const r=n.run.inputs;typeof r=="object"&&r!==null&&(r.model&&Array.isArray(r.messages)&&t.setAttribute(Cf,r.model),r.stream!==void 0&&t.setAttribute(CE,r.stream),r.extra_headers&&t.setAttribute($E,JSON.stringify(r.extra_headers)),r.extra_query&&t.setAttribute(mE,JSON.stringify(r.extra_query)),r.extra_body&&t.setAttribute(gE,JSON.stringify(r.extra_body))),t.setAttribute(hE,JSON.stringify(r))}catch(r){console.debug(`Failed to process inputs for run ${n.id}`,r)}if(n.run.outputs)try{const r=n.run.outputs,s=this.getUnifiedRunTokens(r);if(s&&(t.setAttribute($f,s[0]),t.setAttribute(Rf,s[1]),t.setAttribute(Nf,s[0]+s[1])),r&&typeof r=="object"){if(r.model&&t.setAttribute(iE,String(r.model)),r.id&&t.setAttribute(bE,r.id),r.choices&&Array.isArray(r.choices)){const a=r.choices.map(i=>i.finish_reason).filter(i=>i).map(String);a.length>0&&t.setAttribute(fE,a.join(", "))}if(r.service_tier&&t.setAttribute(vE,r.service_tier),r.system_fingerprint&&t.setAttribute(EE,r.system_fingerprint),r.usage_metadata&&typeof r.usage_metadata=="object"){const a=r.usage_metadata;a.input_token_details&&t.setAttribute(TE,JSON.stringify(a.input_token_details)),a.output_token_details&&t.setAttribute(SE,JSON.stringify(a.output_token_details))}}t.setAttribute(pE,JSON.stringify(r))}catch(r){console.debug(`Failed to process outputs for run ${n.id}`,r)}}getUnifiedRunTokens(t){if(!t)return null;let n=this.extractUnifiedRunTokens(t.usage_metadata);if(n)return n;const r=Object.keys(t);for(const i of r){const o=t[i];if(!(!o||typeof o!="object")&&(n=this.extractUnifiedRunTokens(o.usage_metadata),n||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(n=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),n)))return n}const s=t.generations||[];if(!Array.isArray(s))return null;const a=Array.isArray(s[0])?s.flat():s;for(const i of a)if(typeof i=="object"&&i.message&&typeof i.message=="object"&&i.message.kwargs&&typeof i.message.kwargs=="object"&&(n=this.extractUnifiedRunTokens(i.message.kwargs.usage_metadata),n))return n;return null}extractUnifiedRunTokens(t){return!t||typeof t!="object"||typeof t.input_tokens!="number"||typeof t.output_tokens!="number"?null:[t.input_tokens,t.output_tokens]}}const AT=Object.prototype.toString,CT=e=>AT.call(e)==="[object Error]",$T=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function RT(e){if(!(e&&CT(e)&&e.name==="TypeError"&&typeof e.message=="string"))return!1;const{message:n,stack:r}=e;return n==="Load failed"?r===void 0||"__sentry_captured__"in e:n.startsWith("error sending request for url")?!0:$T.has(n)}function NT(e){if(typeof e=="number"){if(e<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(e))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(e!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function Aa(e,t,{min:n=0,allowInfinity:r=!1}={}){if(t!==void 0){if(typeof t!="number"||Number.isNaN(t))throw new TypeError(`Expected \`${e}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(t))throw new TypeError(`Expected \`${e}\` to be a finite number.`);if(t<n)throw new TypeError(`Expected \`${e}\` to be  ${n}.`)}}let PT=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}};function MT(e,t){const n=Math.max(1,e+1),r=t.randomize?Math.random()+1:1;let s=Math.round(r*t.minTimeout*t.factor**(n-1));return s=Math.min(s,t.maxTimeout),s}function Uf(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function LT({error:e,attemptNumber:t,retriesConsumed:n,startTime:r,options:s}){const a=e instanceof Error?e:new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(a instanceof PT)throw a.originalError;const i=Number.isFinite(s.retries)?Math.max(0,s.retries-n):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:a,attemptNumber:t,retriesLeft:i,retriesConsumed:n});if(await s.onFailedAttempt(c),Uf(r,o)<=0)throw a;const u=await s.shouldConsumeRetry(c),l=Uf(r,o);if(l<=0||i<=0)throw a;if(a instanceof TypeError&&!RT(a)){if(u)throw a;return s.signal?.throwIfAborted(),!1}if(!await s.shouldRetry(c))throw a;if(!u)return s.signal?.throwIfAborted(),!1;const d=MT(n,s),f=Math.min(d,l);return f>0&&await new Promise((h,p)=>{const m=()=>{clearTimeout(b),s.signal?.removeEventListener("abort",m),p(s.signal.reason)},b=setTimeout(()=>{s.signal?.removeEventListener("abort",m),h()},f);s.unref&&b.unref?.(),s.signal?.addEventListener("abort",m,{once:!0})}),s.signal?.throwIfAborted(),!0}async function jT(e,t={}){if(t={...t},NT(t.retries),Object.hasOwn(t,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=Number.POSITIVE_INFINITY,t.maxRetryTime??=Number.POSITIVE_INFINITY,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,Aa("factor",t.factor,{min:0,allowInfinity:!1}),Aa("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),Aa("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),Aa("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let n=0,r=0;const s=performance.now();for(;!Number.isFinite(t.retries)||r<=t.retries;){n++;try{t.signal?.throwIfAborted();const a=await e(n);return t.signal?.throwIfAborted(),a}catch(a){await LT({error:a,attemptNumber:n,retriesConsumed:r,startTime:s,options:t})&&r++}}throw new Error("Retry attempts exhausted without throwing an error.")}var Ca={},Xo={exports:{}},Ff;function zT(){return Ff||(Ff=1,(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function a(c,u,l,d,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var h=new s(l,d||c,f),p=n?n+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],h]:c._events[p].push(h):(c._events[p]=h,c._eventsCount++),c}function i(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,d;if(this._eventsCount===0)return u;for(d in l=this._events)t.call(l,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=n?n+u:u,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var l=n?n+u:u,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,l,d,f,h,p){var m=n?n+u:u;if(!this._events[m])return!1;var b=this._events[m],_=arguments.length,w,E;if(b.fn){switch(b.once&&this.removeListener(u,b.fn,void 0,!0),_){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,l),!0;case 3:return b.fn.call(b.context,l,d),!0;case 4:return b.fn.call(b.context,l,d,f),!0;case 5:return b.fn.call(b.context,l,d,f,h),!0;case 6:return b.fn.call(b.context,l,d,f,h,p),!0}for(E=1,w=new Array(_-1);E<_;E++)w[E-1]=arguments[E];b.fn.apply(b.context,w)}else{var x=b.length,I;for(E=0;E<x;E++)switch(b[E].once&&this.removeListener(u,b[E].fn,void 0,!0),_){case 1:b[E].fn.call(b[E].context);break;case 2:b[E].fn.call(b[E].context,l);break;case 3:b[E].fn.call(b[E].context,l,d);break;case 4:b[E].fn.call(b[E].context,l,d,f);break;default:if(!w)for(I=1,w=new Array(_-1);I<_;I++)w[I-1]=arguments[I];b[E].fn.apply(b[E].context,w)}}return!0},o.prototype.on=function(u,l,d){return a(this,u,l,d,!1)},o.prototype.once=function(u,l,d){return a(this,u,l,d,!0)},o.prototype.removeListener=function(u,l,d,f){var h=n?n+u:u;if(!this._events[h])return this;if(!l)return i(this,h),this;var p=this._events[h];if(p.fn)p.fn===l&&(!f||p.once)&&(!d||p.context===d)&&i(this,h);else{for(var m=0,b=[],_=p.length;m<_;m++)(p[m].fn!==l||f&&!p[m].once||d&&p[m].context!==d)&&b.push(p[m]);b.length?this._events[h]=b.length===1?b[0]:b:i(this,h)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=n?n+u:u,this._events[l]&&i(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o})(Xo)),Xo.exports}var fs={exports:{}},Yo,Bf;function DT(){return Bf||(Bf=1,Yo=(e,t)=>(t=t||(()=>{}),e.then(n=>new Promise(r=>{r(t())}).then(()=>n),n=>new Promise(r=>{r(t())}).then(()=>{throw n})))),Yo}var Zf;function UT(){if(Zf)return fs.exports;Zf=1;const e=DT();class t extends Error{constructor(s){super(s),this.name="TimeoutError"}}const n=(r,s,a)=>new Promise((i,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){i(r);return}const c=setTimeout(()=>{if(typeof a=="function"){try{i(a())}catch(d){o(d)}return}const u=typeof a=="string"?a:`Promise timed out after ${s} milliseconds`,l=a instanceof Error?a:new t(u);typeof r.cancel=="function"&&r.cancel(),o(l)},s);e(r.then(i,o),()=>{clearTimeout(c)})});return fs.exports=n,fs.exports.default=n,fs.exports.TimeoutError=t,fs.exports}var $a={},Ra={},qf;function FT(){if(qf)return Ra;qf=1,Object.defineProperty(Ra,"__esModule",{value:!0});function e(t,n,r){let s=0,a=t.length;for(;a>0;){const i=a/2|0;let o=s+i;r(t[o],n)<=0?(s=++o,a-=i+1):a=i}return s}return Ra.default=e,Ra}var Hf;function BT(){if(Hf)return $a;Hf=1,Object.defineProperty($a,"__esModule",{value:!0});const e=FT();class t{constructor(){this._queue=[]}enqueue(r,s){s=Object.assign({priority:0},s);const a={priority:s.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(a);return}const i=e.default(this._queue,a,(o,c)=>c.priority-o.priority);this._queue.splice(i,0,a)}dequeue(){const r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(s=>s.priority===r.priority).map(s=>s.run)}get size(){return this._queue.length}}return $a.default=t,$a}var Vf;function ZT(){if(Vf)return Ca;Vf=1,Object.defineProperty(Ca,"__esModule",{value:!0});const e=zT(),t=UT(),n=BT(),r=()=>{},s=new t.TimeoutError;class a extends e{constructor(o){var c,u,l,d;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(u=(c=o.intervalCap)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(d=(l=o.interval)===null||l===void 0?void 0:l.toString())!==null&&d!==void 0?d:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const c=this._intervalEnd-o;if(c<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},c)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const c=this._queue.dequeue();return c?(this.emit("active"),c(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,c={}){return new Promise((u,l)=>{const d=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&c.timeout===void 0?o():t.default(Promise.resolve(o()),c.timeout===void 0?this._timeout:c.timeout,()=>{(c.throwOnTimeout===void 0?this._throwOnTimeout:c.throwOnTimeout)&&l(s)});u(await f)}catch(f){l(f)}this._next()};this._queue.enqueue(d,c),this._tryToStartAnother(),this.emit("add")})}async addAll(o,c){return Promise.all(o.map(async u=>this.add(u,c)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const c=this._resolveEmpty;this._resolveEmpty=()=>{c(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const c=this._resolveIdle;this._resolveIdle=()=>{c(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return Ca.default=a,Ca}var qT=ZT();const Rn=Qi(qT),HT=[408,425,429,500,502,503,504];let Gf=class{constructor(t){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.maxQueueSizeBytes=t.maxQueueSizeBytes,"default"in Rn?this.queue=new Rn.default({concurrency:this.maxConcurrency}):this.queue=new Rn({concurrency:this.maxConcurrency}),this.onFailedResponseHook=t?.onFailedResponseHook}call(t,...n){return this.callWithOptions({},t,...n)}callWithOptions(t,n,...r){const s=t.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&s>0&&this.queueSizeBytes+s>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${s} bytes.`));s>0&&(this.queueSizeBytes+=s);const a=this.onFailedResponseHook;let i=this.queue.add(()=>jT(()=>n(...r).catch(o=>{throw o instanceof Error?o:new Error(o)}),{async onFailedAttempt({error:o}){if(typeof o!="object"||o==null)throw o;const c="message"in o&&typeof o.message=="string"?o.message:void 0;if(c?.startsWith("Cancel")||c?.startsWith("TimeoutError")||c?.startsWith("AbortError")||"name"in o&&o.name==="TimeoutError"||"code"in o&&o.code==="ECONNABORTED")throw o;const u="response"in o?o.response:void 0;if(a&&await a(u))return;const l=u?.status??("status"in o?o.status:void 0);if(l!=null&&(typeof l=="number"||typeof l=="string")&&!HT.includes(+l))throw o},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return s>0&&(i=i.finally(()=>{this.queueSizeBytes-=s})),t.signal?Promise.race([i,new Promise((o,c)=>{t.signal?.addEventListener("abort",()=>{c(new Error("AbortError"))})})]):i}};function Jf(e){return typeof e?._getType=="function"}function Wf(e){const t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var Na={exports:{}},Qo,Kf;function so(){if(Kf)return Qo;Kf=1;const e="2.0.0",t=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,s=t-6;return Qo={MAX_LENGTH:t,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:n,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Qo}var ec,Xf;function ao(){if(Xf)return ec;Xf=1;var e={};return ec=typeof process=="object"&&e&&e.NODE_DEBUG&&/\bsemver\b/i.test(e.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{},ec}var Yf;function aa(){return Yf||(Yf=1,(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=so(),a=ao();t=e.exports={};const i=t.re=[],o=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],l=t.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[f,r]],p=b=>{for(const[_,w]of h)b=b.split(`${_}*`).join(`${_}{0,${w}}`).split(`${_}+`).join(`${_}{1,${w}}`);return b},m=(b,_,w)=>{const E=p(_),x=d++;a(b,x,_),l[b]=x,c[x]=_,u[x]=E,i[x]=new RegExp(_,w?"g":void 0),o[x]=new RegExp(E,w?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NONNUMERICIDENTIFIER]}|${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),m("FULL",`^${c[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),m("LOOSE",`^${c[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),m("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?(?:${c[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[l.COERCE],!0),m("COERCERTLFULL",c[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Na,Na.exports)),Na.exports}var tc,Qf;function Yl(){if(Qf)return tc;Qf=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return tc=r=>r?typeof r!="object"?e:r:t,tc}var nc,eh;function M_(){if(eh)return nc;eh=1;const e=/^[0-9]+$/,t=(r,s)=>{const a=e.test(r),i=e.test(s);return a&&i&&(r=+r,s=+s),r===s?0:a&&!i?-1:i&&!a?1:r<s?-1:1};return nc={compareIdentifiers:t,rcompareIdentifiers:(r,s)=>t(s,r)},nc}var rc,th;function bt(){if(th)return rc;th=1;const e=ao(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:n}=so(),{safeRe:r,t:s}=aa(),a=Yl(),{compareIdentifiers:i}=M_();class o{constructor(u,l){if(l=a(l),u instanceof o){if(u.loose===!!l.loose&&u.includePrerelease===!!l.includePrerelease)return u;u=u.version}else if(typeof u!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof u}".`);if(u.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",u,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const d=u.trim().match(l.loose?r[s.LOOSE]:r[s.FULL]);if(!d)throw new TypeError(`Invalid Version: ${u}`);if(this.raw=u,this.major=+d[1],this.minor=+d[2],this.patch=+d[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");d[4]?this.prerelease=d[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const h=+f;if(h>=0&&h<n)return h}return f}):this.prerelease=[],this.build=d[5]?d[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(u){if(e("SemVer.compare",this.version,this.options,u),!(u instanceof o)){if(typeof u=="string"&&u===this.version)return 0;u=new o(u,this.options)}return u.version===this.version?0:this.compareMain(u)||this.comparePre(u)}compareMain(u){return u instanceof o||(u=new o(u,this.options)),i(this.major,u.major)||i(this.minor,u.minor)||i(this.patch,u.patch)}comparePre(u){if(u instanceof o||(u=new o(u,this.options)),this.prerelease.length&&!u.prerelease.length)return-1;if(!this.prerelease.length&&u.prerelease.length)return 1;if(!this.prerelease.length&&!u.prerelease.length)return 0;let l=0;do{const d=this.prerelease[l],f=u.prerelease[l];if(e("prerelease compare",l,d,f),d===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(d===void 0)return-1;if(d===f)continue;return i(d,f)}while(++l)}compareBuild(u){u instanceof o||(u=new o(u,this.options));let l=0;do{const d=this.build[l],f=u.build[l];if(e("build compare",l,d,f),d===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(d===void 0)return-1;if(d===f)continue;return i(d,f)}while(++l)}inc(u,l,d){if(u.startsWith("pre")){if(!l&&d===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const f=`-${l}`.match(this.options.loose?r[s.PRERELEASELOOSE]:r[s.PRERELEASE]);if(!f||f[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(u){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,d);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,d);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,d),this.inc("pre",l,d);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,d),this.inc("pre",l,d);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(d)?1:0;if(this.prerelease.length===0)this.prerelease=[f];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);if(h===-1){if(l===this.prerelease.join(".")&&d===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(l){let h=[l,f];d===!1&&(h=[l]),i(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=h):this.prerelease=h}break}default:throw new Error(`invalid increment argument: ${u}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return rc=o,rc}var sc,nh;function os(){if(nh)return sc;nh=1;const e=bt();return sc=(n,r,s=!1)=>{if(n instanceof e)return n;try{return new e(n,r)}catch(a){if(!s)return null;throw a}},sc}var ac,rh;function VT(){if(rh)return ac;rh=1;const e=os();return ac=(n,r)=>{const s=e(n,r);return s?s.version:null},ac}var ic,sh;function GT(){if(sh)return ic;sh=1;const e=os();return ic=(n,r)=>{const s=e(n.trim().replace(/^[=v]+/,""),r);return s?s.version:null},ic}var oc,ah;function JT(){if(ah)return oc;ah=1;const e=bt();return oc=(n,r,s,a,i)=>{typeof s=="string"&&(i=a,a=s,s=void 0);try{return new e(n instanceof e?n.version:n,s).inc(r,a,i).version}catch{return null}},oc}var cc,ih;function WT(){if(ih)return cc;ih=1;const e=os();return cc=(n,r)=>{const s=e(n,null,!0),a=e(r,null,!0),i=s.compare(a);if(i===0)return null;const o=i>0,c=o?s:a,u=o?a:s,l=!!c.prerelease.length;if(!!u.prerelease.length&&!l){if(!u.patch&&!u.minor)return"major";if(u.compareMain(c)===0)return u.minor&&!u.patch?"minor":"patch"}const f=l?"pre":"";return s.major!==a.major?f+"major":s.minor!==a.minor?f+"minor":s.patch!==a.patch?f+"patch":"prerelease"},cc}var uc,oh;function KT(){if(oh)return uc;oh=1;const e=bt();return uc=(n,r)=>new e(n,r).major,uc}var lc,ch;function XT(){if(ch)return lc;ch=1;const e=bt();return lc=(n,r)=>new e(n,r).minor,lc}var dc,uh;function YT(){if(uh)return dc;uh=1;const e=bt();return dc=(n,r)=>new e(n,r).patch,dc}var fc,lh;function QT(){if(lh)return fc;lh=1;const e=os();return fc=(n,r)=>{const s=e(n,r);return s&&s.prerelease.length?s.prerelease:null},fc}var hc,dh;function un(){if(dh)return hc;dh=1;const e=bt();return hc=(n,r,s)=>new e(n,s).compare(new e(r,s)),hc}var pc,fh;function eS(){if(fh)return pc;fh=1;const e=un();return pc=(n,r,s)=>e(r,n,s),pc}var mc,hh;function tS(){if(hh)return mc;hh=1;const e=un();return mc=(n,r)=>e(n,r,!0),mc}var gc,ph;function Ql(){if(ph)return gc;ph=1;const e=bt();return gc=(n,r,s)=>{const a=new e(n,s),i=new e(r,s);return a.compare(i)||a.compareBuild(i)},gc}var _c,mh;function nS(){if(mh)return _c;mh=1;const e=Ql();return _c=(n,r)=>n.sort((s,a)=>e(s,a,r)),_c}var yc,gh;function rS(){if(gh)return yc;gh=1;const e=Ql();return yc=(n,r)=>n.sort((s,a)=>e(a,s,r)),yc}var wc,_h;function io(){if(_h)return wc;_h=1;const e=un();return wc=(n,r,s)=>e(n,r,s)>0,wc}var bc,yh;function ed(){if(yh)return bc;yh=1;const e=un();return bc=(n,r,s)=>e(n,r,s)<0,bc}var vc,wh;function L_(){if(wh)return vc;wh=1;const e=un();return vc=(n,r,s)=>e(n,r,s)===0,vc}var Ec,bh;function j_(){if(bh)return Ec;bh=1;const e=un();return Ec=(n,r,s)=>e(n,r,s)!==0,Ec}var Tc,vh;function td(){if(vh)return Tc;vh=1;const e=un();return Tc=(n,r,s)=>e(n,r,s)>=0,Tc}var Sc,Eh;function nd(){if(Eh)return Sc;Eh=1;const e=un();return Sc=(n,r,s)=>e(n,r,s)<=0,Sc}var xc,Th;function z_(){if(Th)return xc;Th=1;const e=L_(),t=j_(),n=io(),r=td(),s=ed(),a=nd();return xc=(o,c,u,l)=>{switch(c){case"===":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o===u;case"!==":return typeof o=="object"&&(o=o.version),typeof u=="object"&&(u=u.version),o!==u;case"":case"=":case"==":return e(o,u,l);case"!=":return t(o,u,l);case">":return n(o,u,l);case">=":return r(o,u,l);case"<":return s(o,u,l);case"<=":return a(o,u,l);default:throw new TypeError(`Invalid operator: ${c}`)}},xc}var kc,Sh;function sS(){if(Sh)return kc;Sh=1;const e=bt(),t=os(),{safeRe:n,t:r}=aa();return kc=(a,i)=>{if(a instanceof e)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;i=i||{};let o=null;if(!i.rtl)o=a.match(i.includePrerelease?n[r.COERCEFULL]:n[r.COERCE]);else{const h=i.includePrerelease?n[r.COERCERTLFULL]:n[r.COERCERTL];let p;for(;(p=h.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),h.lastIndex=p.index+p[1].length+p[2].length;h.lastIndex=-1}if(o===null)return null;const c=o[2],u=o[3]||"0",l=o[4]||"0",d=i.includePrerelease&&o[5]?`-${o[5]}`:"",f=i.includePrerelease&&o[6]?`+${o[6]}`:"";return t(`${c}.${u}.${l}${d}${f}`,i)},kc}var Ic,xh;function aS(){if(xh)return Ic;xh=1;class e{constructor(){this.max=1e3,this.map=new Map}get(n){const r=this.map.get(n);if(r!==void 0)return this.map.delete(n),this.map.set(n,r),r}delete(n){return this.map.delete(n)}set(n,r){if(!this.delete(n)&&r!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(n,r)}return this}}return Ic=e,Ic}var Oc,kh;function ln(){if(kh)return Oc;kh=1;const e=/\s+/g;class t{constructor(N,M){if(M=s(M),N instanceof t)return N.loose===!!M.loose&&N.includePrerelease===!!M.includePrerelease?N:new t(N.raw,M);if(N instanceof a)return this.raw=N.value,this.set=[[N]],this.formatted=void 0,this;if(this.options=M,this.loose=!!M.loose,this.includePrerelease=!!M.includePrerelease,this.raw=N.trim().replace(e," "),this.set=this.raw.split("||").map(G=>this.parseRange(G.trim())).filter(G=>G.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const G=this.set[0];if(this.set=this.set.filter(X=>!m(X[0])),this.set.length===0)this.set=[G];else if(this.set.length>1){for(const X of this.set)if(X.length===1&&b(X[0])){this.set=[X];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let N=0;N<this.set.length;N++){N>0&&(this.formatted+="||");const M=this.set[N];for(let G=0;G<M.length;G++)G>0&&(this.formatted+=" "),this.formatted+=M[G].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(N){const G=((this.options.includePrerelease&&h)|(this.options.loose&&p))+":"+N,X=r.get(G);if(X)return X;const H=this.options.loose,re=H?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];N=N.replace(re,Ge(this.options.includePrerelease)),i("hyphen replace",N),N=N.replace(c[u.COMPARATORTRIM],l),i("comparator trim",N),N=N.replace(c[u.TILDETRIM],d),i("tilde trim",N),N=N.replace(c[u.CARETTRIM],f),i("caret trim",N);let ge=N.split(" ").map(Ee=>w(Ee,this.options)).join(" ").split(/\s+/).map(Ee=>K(Ee,this.options));H&&(ge=ge.filter(Ee=>(i("loose invalid filter",Ee,this.options),!!Ee.match(c[u.COMPARATORLOOSE])))),i("range list",ge);const fe=new Map,ke=ge.map(Ee=>new a(Ee,this.options));for(const Ee of ke){if(m(Ee))return[Ee];fe.set(Ee.value,Ee)}fe.size>1&&fe.has("")&&fe.delete("");const He=[...fe.values()];return r.set(G,He),He}intersects(N,M){if(!(N instanceof t))throw new TypeError("a Range is required");return this.set.some(G=>_(G,M)&&N.set.some(X=>_(X,M)&&G.every(H=>X.every(re=>H.intersects(re,M)))))}test(N){if(!N)return!1;if(typeof N=="string")try{N=new o(N,this.options)}catch{return!1}for(let M=0;M<this.set.length;M++)if(Ot(this.set[M],N,this.options))return!0;return!1}}Oc=t;const n=aS(),r=new n,s=Yl(),a=oo(),i=ao(),o=bt(),{safeRe:c,t:u,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:f}=aa(),{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:p}=so(),m=z=>z.value==="<0.0.0-0",b=z=>z.value==="",_=(z,N)=>{let M=!0;const G=z.slice();let X=G.pop();for(;M&&G.length;)M=G.every(H=>X.intersects(H,N)),X=G.pop();return M},w=(z,N)=>(i("comp",z,N),z=P(z,N),i("caret",z),z=x(z,N),i("tildes",z),z=v(z,N),i("xrange",z),z=le(z,N),i("stars",z),z),E=z=>!z||z.toLowerCase()==="x"||z==="*",x=(z,N)=>z.trim().split(/\s+/).map(M=>I(M,N)).join(" "),I=(z,N)=>{const M=N.loose?c[u.TILDELOOSE]:c[u.TILDE];return z.replace(M,(G,X,H,re,ge)=>{i("tilde",z,G,X,H,re,ge);let fe;return E(X)?fe="":E(H)?fe=`>=${X}.0.0 <${+X+1}.0.0-0`:E(re)?fe=`>=${X}.${H}.0 <${X}.${+H+1}.0-0`:ge?(i("replaceTilde pr",ge),fe=`>=${X}.${H}.${re}-${ge} <${X}.${+H+1}.0-0`):fe=`>=${X}.${H}.${re} <${X}.${+H+1}.0-0`,i("tilde return",fe),fe})},P=(z,N)=>z.trim().split(/\s+/).map(M=>j(M,N)).join(" "),j=(z,N)=>{i("caret",z,N);const M=N.loose?c[u.CARETLOOSE]:c[u.CARET],G=N.includePrerelease?"-0":"";return z.replace(M,(X,H,re,ge,fe)=>{i("caret",z,X,H,re,ge,fe);let ke;return E(H)?ke="":E(re)?ke=`>=${H}.0.0${G} <${+H+1}.0.0-0`:E(ge)?H==="0"?ke=`>=${H}.${re}.0${G} <${H}.${+re+1}.0-0`:ke=`>=${H}.${re}.0${G} <${+H+1}.0.0-0`:fe?(i("replaceCaret pr",fe),H==="0"?re==="0"?ke=`>=${H}.${re}.${ge}-${fe} <${H}.${re}.${+ge+1}-0`:ke=`>=${H}.${re}.${ge}-${fe} <${H}.${+re+1}.0-0`:ke=`>=${H}.${re}.${ge}-${fe} <${+H+1}.0.0-0`):(i("no pr"),H==="0"?re==="0"?ke=`>=${H}.${re}.${ge}${G} <${H}.${re}.${+ge+1}-0`:ke=`>=${H}.${re}.${ge}${G} <${H}.${+re+1}.0-0`:ke=`>=${H}.${re}.${ge} <${+H+1}.0.0-0`),i("caret return",ke),ke})},v=(z,N)=>(i("replaceXRanges",z,N),z.split(/\s+/).map(M=>oe(M,N)).join(" ")),oe=(z,N)=>{z=z.trim();const M=N.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return z.replace(M,(G,X,H,re,ge,fe)=>{i("xRange",z,G,X,H,re,ge,fe);const ke=E(H),He=ke||E(re),Ee=He||E(ge),y=Ee;return X==="="&&y&&(X=""),fe=N.includePrerelease?"-0":"",ke?X===">"||X==="<"?G="<0.0.0-0":G="*":X&&y?(He&&(re=0),ge=0,X===">"?(X=">=",He?(H=+H+1,re=0,ge=0):(re=+re+1,ge=0)):X==="<="&&(X="<",He?H=+H+1:re=+re+1),X==="<"&&(fe="-0"),G=`${X+H}.${re}.${ge}${fe}`):He?G=`>=${H}.0.0${fe} <${+H+1}.0.0-0`:Ee&&(G=`>=${H}.${re}.0${fe} <${H}.${+re+1}.0-0`),i("xRange return",G),G})},le=(z,N)=>(i("replaceStars",z,N),z.trim().replace(c[u.STAR],"")),K=(z,N)=>(i("replaceGTE0",z,N),z.trim().replace(c[N.includePrerelease?u.GTE0PRE:u.GTE0],"")),Ge=z=>(N,M,G,X,H,re,ge,fe,ke,He,Ee,y)=>(E(G)?M="":E(X)?M=`>=${G}.0.0${z?"-0":""}`:E(H)?M=`>=${G}.${X}.0${z?"-0":""}`:re?M=`>=${M}`:M=`>=${M}${z?"-0":""}`,E(ke)?fe="":E(He)?fe=`<${+ke+1}.0.0-0`:E(Ee)?fe=`<${ke}.${+He+1}.0-0`:y?fe=`<=${ke}.${He}.${Ee}-${y}`:z?fe=`<${ke}.${He}.${+Ee+1}-0`:fe=`<=${fe}`,`${M} ${fe}`.trim()),Ot=(z,N,M)=>{for(let G=0;G<z.length;G++)if(!z[G].test(N))return!1;if(N.prerelease.length&&!M.includePrerelease){for(let G=0;G<z.length;G++)if(i(z[G].semver),z[G].semver!==a.ANY&&z[G].semver.prerelease.length>0){const X=z[G].semver;if(X.major===N.major&&X.minor===N.minor&&X.patch===N.patch)return!0}return!1}return!0};return Oc}var Ac,Ih;function oo(){if(Ih)return Ac;Ih=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(l,d){if(d=n(d),l instanceof t){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),i("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===e?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(l){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],f=l.match(d);if(!f)throw new TypeError(`Invalid comparator: ${l}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=e}toString(){return this.value}test(l){if(i("Comparator.test",l,this.options.loose),this.semver===e||l===e)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return a(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new c(this.value,d).test(l.semver):(d=n(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||a(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||a(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Ac=t;const n=Yl(),{safeRe:r,t:s}=aa(),a=z_(),i=ao(),o=bt(),c=ln();return Ac}var Cc,Oh;function co(){if(Oh)return Cc;Oh=1;const e=ln();return Cc=(n,r,s)=>{try{r=new e(r,s)}catch{return!1}return r.test(n)},Cc}var $c,Ah;function iS(){if(Ah)return $c;Ah=1;const e=ln();return $c=(n,r)=>new e(n,r).set.map(s=>s.map(a=>a.value).join(" ").trim().split(" ")),$c}var Rc,Ch;function oS(){if(Ch)return Rc;Ch=1;const e=bt(),t=ln();return Rc=(r,s,a)=>{let i=null,o=null,c=null;try{c=new t(s,a)}catch{return null}return r.forEach(u=>{c.test(u)&&(!i||o.compare(u)===-1)&&(i=u,o=new e(i,a))}),i},Rc}var Nc,$h;function cS(){if($h)return Nc;$h=1;const e=bt(),t=ln();return Nc=(r,s,a)=>{let i=null,o=null,c=null;try{c=new t(s,a)}catch{return null}return r.forEach(u=>{c.test(u)&&(!i||o.compare(u)===1)&&(i=u,o=new e(i,a))}),i},Nc}var Pc,Rh;function uS(){if(Rh)return Pc;Rh=1;const e=bt(),t=ln(),n=io();return Pc=(s,a)=>{s=new t(s,a);let i=new e("0.0.0");if(s.test(i)||(i=new e("0.0.0-0"),s.test(i)))return i;i=null;for(let o=0;o<s.set.length;++o){const c=s.set[o];let u=null;c.forEach(l=>{const d=new e(l.semver.version);switch(l.operator){case">":d.prerelease.length===0?d.patch++:d.prerelease.push(0),d.raw=d.format();case"":case">=":(!u||n(d,u))&&(u=d);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${l.operator}`)}}),u&&(!i||n(i,u))&&(i=u)}return i&&s.test(i)?i:null},Pc}var Mc,Nh;function lS(){if(Nh)return Mc;Nh=1;const e=ln();return Mc=(n,r)=>{try{return new e(n,r).range||"*"}catch{return null}},Mc}var Lc,Ph;function rd(){if(Ph)return Lc;Ph=1;const e=bt(),t=oo(),{ANY:n}=t,r=ln(),s=co(),a=io(),i=ed(),o=nd(),c=td();return Lc=(l,d,f,h)=>{l=new e(l,h),d=new r(d,h);let p,m,b,_,w;switch(f){case">":p=a,m=o,b=i,_=">",w=">=";break;case"<":p=i,m=c,b=a,_="<",w="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(l,d,h))return!1;for(let E=0;E<d.set.length;++E){const x=d.set[E];let I=null,P=null;if(x.forEach(j=>{j.semver===n&&(j=new t(">=0.0.0")),I=I||j,P=P||j,p(j.semver,I.semver,h)?I=j:b(j.semver,P.semver,h)&&(P=j)}),I.operator===_||I.operator===w||(!P.operator||P.operator===_)&&m(l,P.semver))return!1;if(P.operator===w&&b(l,P.semver))return!1}return!0},Lc}var jc,Mh;function dS(){if(Mh)return jc;Mh=1;const e=rd();return jc=(n,r,s)=>e(n,r,">",s),jc}var zc,Lh;function fS(){if(Lh)return zc;Lh=1;const e=rd();return zc=(n,r,s)=>e(n,r,"<",s),zc}var Dc,jh;function hS(){if(jh)return Dc;jh=1;const e=ln();return Dc=(n,r,s)=>(n=new e(n,s),r=new e(r,s),n.intersects(r,s)),Dc}var Uc,zh;function pS(){if(zh)return Uc;zh=1;const e=co(),t=un();return Uc=(n,r,s)=>{const a=[];let i=null,o=null;const c=n.sort((f,h)=>t(f,h,s));for(const f of c)e(f,r,s)?(o=f,i||(i=f)):(o&&a.push([i,o]),o=null,i=null);i&&a.push([i,null]);const u=[];for(const[f,h]of a)f===h?u.push(f):!h&&f===c[0]?u.push("*"):h?f===c[0]?u.push(`<=${h}`):u.push(`${f} - ${h}`):u.push(`>=${f}`);const l=u.join(" || "),d=typeof r.raw=="string"?r.raw:String(r);return l.length<d.length?l:r},Uc}var Fc,Dh;function mS(){if(Dh)return Fc;Dh=1;const e=ln(),t=oo(),{ANY:n}=t,r=co(),s=un(),a=(d,f,h={})=>{if(d===f)return!0;d=new e(d,h),f=new e(f,h);let p=!1;e:for(const m of d.set){for(const b of f.set){const _=c(m,b,h);if(p=p||_!==null,_)continue e}if(p)return!1}return!0},i=[new t(">=0.0.0-0")],o=[new t(">=0.0.0")],c=(d,f,h)=>{if(d===f)return!0;if(d.length===1&&d[0].semver===n){if(f.length===1&&f[0].semver===n)return!0;h.includePrerelease?d=i:d=o}if(f.length===1&&f[0].semver===n){if(h.includePrerelease)return!0;f=o}const p=new Set;let m,b;for(const v of d)v.operator===">"||v.operator===">="?m=u(m,v,h):v.operator==="<"||v.operator==="<="?b=l(b,v,h):p.add(v.semver);if(p.size>1)return null;let _;if(m&&b){if(_=s(m.semver,b.semver,h),_>0)return null;if(_===0&&(m.operator!==">="||b.operator!=="<="))return null}for(const v of p){if(m&&!r(v,String(m),h)||b&&!r(v,String(b),h))return null;for(const oe of f)if(!r(v,String(oe),h))return!1;return!0}let w,E,x,I,P=b&&!h.includePrerelease&&b.semver.prerelease.length?b.semver:!1,j=m&&!h.includePrerelease&&m.semver.prerelease.length?m.semver:!1;P&&P.prerelease.length===1&&b.operator==="<"&&P.prerelease[0]===0&&(P=!1);for(const v of f){if(I=I||v.operator===">"||v.operator===">=",x=x||v.operator==="<"||v.operator==="<=",m){if(j&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===j.major&&v.semver.minor===j.minor&&v.semver.patch===j.patch&&(j=!1),v.operator===">"||v.operator===">="){if(w=u(m,v,h),w===v&&w!==m)return!1}else if(m.operator===">="&&!r(m.semver,String(v),h))return!1}if(b){if(P&&v.semver.prerelease&&v.semver.prerelease.length&&v.semver.major===P.major&&v.semver.minor===P.minor&&v.semver.patch===P.patch&&(P=!1),v.operator==="<"||v.operator==="<="){if(E=l(b,v,h),E===v&&E!==b)return!1}else if(b.operator==="<="&&!r(b.semver,String(v),h))return!1}if(!v.operator&&(b||m)&&_!==0)return!1}return!(m&&x&&!b&&_!==0||b&&I&&!m&&_!==0||j||P)},u=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p>0?d:p<0||f.operator===">"&&d.operator===">="?f:d},l=(d,f,h)=>{if(!d)return f;const p=s(d.semver,f.semver,h);return p<0?d:p>0||f.operator==="<"&&d.operator==="<="?f:d};return Fc=a,Fc}var Bc,Uh;function gS(){if(Uh)return Bc;Uh=1;const e=aa(),t=so(),n=bt(),r=M_(),s=os(),a=VT(),i=GT(),o=JT(),c=WT(),u=KT(),l=XT(),d=YT(),f=QT(),h=un(),p=eS(),m=tS(),b=Ql(),_=nS(),w=rS(),E=io(),x=ed(),I=L_(),P=j_(),j=td(),v=nd(),oe=z_(),le=sS(),K=oo(),Ge=ln(),Ot=co(),z=iS(),N=oS(),M=cS(),G=uS(),X=lS(),H=rd(),re=dS(),ge=fS(),fe=hS(),ke=pS(),He=mS();return Bc={parse:s,valid:a,clean:i,inc:o,diff:c,major:u,minor:l,patch:d,prerelease:f,compare:h,rcompare:p,compareLoose:m,compareBuild:b,sort:_,rsort:w,gt:E,lt:x,eq:I,neq:P,gte:j,lte:v,cmp:oe,coerce:le,Comparator:K,Range:Ge,satisfies:Ot,toComparators:z,maxSatisfying:N,minSatisfying:M,minVersion:G,validRange:X,outside:H,gtr:re,ltr:ge,intersects:fe,simplifyRange:ke,subset:He,SemVer:n,re:e.re,src:e.src,tokens:e.t,SEMVER_SPEC_VERSION:t.SEMVER_SPEC_VERSION,RELEASE_TYPES:t.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},Bc}gS();function qn(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw new Error(`Invalid identifier format: ${e}`);const[t,n]=e.split(":"),r=n||"latest";if(t.includes("/")){const[s,a]=t.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${e}`);return[s,a,r]}else{if(!t)throw new Error(`Invalid identifier format: ${e}`);return["-",t,r]}}class _S extends Error{constructor(t){super(t),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}class yS extends Error{constructor(t){super(t),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithNotFoundError",this.status=404}}function Fh(e){return e!=null&&typeof e=="object"&&"name"in e&&e?.name==="LangSmithNotFoundError"}async function W(e,t,n){let r;if(e.ok){n&&(r=await e.text());return}if(e.status===403)try{(await e.json())?.error==="org_scoped_key_requires_workspace"&&(r="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${e.status} ${e.statusText}`);throw o.status=e?.status,o}if(r===void 0)try{r=await e.text()}catch{r=""}const s=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${r}`;if(e.status===404)throw new yS(s);if(e.status===409)throw new _S(s);const a=new Error(s);throw a.status=e.status,a}const D_="ERR_CONFLICTING_ENDPOINTS";class wS extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:D_}),this.name="ConflictingEndpointsError"}}function bS(e){return typeof e=="object"&&e!==null&&e.code===D_}var Bh="[...]",vS={result:"[Circular]"},_i=[],Ur=[];const ES=new TextEncoder;function TS(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Pa(e){return ES.encode(e)}function U_(e){if(e&&typeof e=="object"&&e!==null){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();if(e instanceof Error)return{name:e.name,message:e.message}}else if(typeof e=="bigint")return e.toString();return e}function SS(e){return function(t,n){return U_(n)}}function $t(e,t,n,r,s){try{const a=JSON.stringify(e,SS(n),r);return Pa(a)}catch(a){if(!a.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),Pa("[Unserializable]");yt("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),typeof s>"u"&&(s=TS()),Iu(e,"",0,[],void 0,0,s);let i;try{Ur.length===0?i=JSON.stringify(e,n,r):i=JSON.stringify(e,xS(n),r)}catch{return Pa("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;_i.length!==0;){const o=_i.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return Pa(i)}}function Zc(e,t,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:e}),_i.push([r,n,t,s])):Ur.push([t,n,e]):(r[n]=e,_i.push([r,n,t]))}function Iu(e,t,n,r,s,a,i){a+=1;var o;if(typeof e=="object"&&e!==null){for(o=0;o<r.length;o++)if(r[o]===e){Zc(vS,e,t,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Zc(Bh,e,t,s);return}if(typeof i.edgesLimit<"u"&&n+1>i.edgesLimit){Zc(Bh,e,t,s);return}if(r.push(e),Array.isArray(e))for(o=0;o<e.length;o++)Iu(e[o],o,o,r,e,a,i);else{e=U_(e);var c=Object.keys(e);for(o=0;o<c.length;o++){var u=c[o];Iu(e[u],u,o,r,e,a,i)}}r.pop()}}function xS(e){return e=typeof e<"u"?e:function(t,n){return n},function(t,n){if(Ur.length>0)for(var r=0;r<Ur.length;r++){var s=Ur[r];if(s[1]===t&&s[0]===n){n=s[2],Ur.splice(r,1);break}}return e.call(this,t,n)}}function Zh(e,t,n){if(n)return e;const r=$_(),s=t??R_(),a=e.extra??{},i=a.metadata;return e.extra={...a,runtime:{...r,...a?.runtime},metadata:{...s,...s.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??s.revision_id}:{},...i}},e}const kS=e=>{const t=e?.toString()??yt("TRACING_SAMPLING_RATE");if(t===void 0)return;const n=parseFloat(t);if(n<0||n>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${n}`);return n},IS=e=>{const n=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function OS(e){const t=[];for await(const n of e)t.push(n);return t}function Ma(e){if(e!==void 0)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const AS=async e=>{if(e?.status===429){const t=parseInt(e.headers.get("retry-after")??"10",10)*1e3;if(t>0)return await new Promise(n=>setTimeout(n,t)),!0}return!1};function qh(e){return typeof e=="number"?Number(e.toFixed(4)):e}const CS=24*1024*1024,F_=1024*1024*1024,$S=1e4,RS=100,Hh="https://api.smith.langchain.com";class NS{constructor(t){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=t??F_}peek(){return this.items[0]}push(t){let n;const r=new Promise(a=>{n=a}),s=$t(t.item,`Serializing run with id: ${t.item.id}`).length;return this.sizeBytes+s>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${t.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${s} bytes.`),n(),r):(this.items.push({action:t.action,payload:t.item,otelContext:t.otelContext,apiKey:t.apiKey,apiUrl:t.apiUrl,itemPromiseResolve:n,itemPromise:r,size:s}),this.sizeBytes+=s,r)}pop({upToSizeBytes:t,upToSize:n}){if(t<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let s=0;for(;s+(this.peek()?.size??0)<t&&this.items.length>0&&r.length<n;){const a=this.items.shift();a&&(r.push(a),s+=a.size,this.sizeBytes-=a.size)}if(r.length===0&&this.items.length>0){const a=this.items.shift();r.push(a),s+=a.size,this.sizeBytes-=a.size}return[r.map(a=>({action:a.action,item:a.payload,otelContext:a.otelContext,apiKey:a.apiKey,apiUrl:a.apiUrl,size:a.size})),()=>r.forEach(a=>a.itemPromiseResolve())]}}class Fs{get _fetch(){return this.fetchImplementation||PE(this.debug)}constructor(t={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Tn("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_multipartDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_runCompressionDisabled",{enumerable:!0,configurable:!0,writable:!0,value:yt("DISABLE_RUN_COMPRESSION")==="true"}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Tn("LANGSMITH_DEBUG")==="true"});const n=Fs.getDefaultClientConfig();if(this.tracingSampleRate=kS(t.tracingSamplingRate),this.apiUrl=Ma(t.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Ma(t.apiKey??n.apiKey),this.webUrl=Ma(t.webUrl??n.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=Ma(t.workspaceId??yt("WORKSPACE_ID")),this.timeout_ms=t.timeout_ms??9e4,this.caller=new Gf({...t.callerOptions??{},maxRetries:4,debug:t.debug??this.debug}),this.traceBatchConcurrency=t.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=t.debug??this.debug,this.fetchImplementation=t.fetchImplementation;const r=t.maxIngestMemoryBytes??F_;this.batchIngestCaller=new Gf({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:r,...t.callerOptions??{},onFailedResponseHook:AS,debug:t.debug??this.debug}),this.hideInputs=t.hideInputs??t.anonymizer??n.hideInputs,this.hideOutputs=t.hideOutputs??t.anonymizer??n.hideOutputs,this.omitTracedRuntimeInfo=t.omitTracedRuntimeInfo??!1,this.autoBatchTracing=t.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new NS(r),this.blockOnRootRunFinalization=t.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=t.batchSizeBytesLimit,this.batchSizeLimit=t.batchSizeLimit,this.fetchOptions=t.fetchOptions||{},this.manualFlushMode=t.manualFlushMode??this.manualFlushMode,N_()&&(this.langSmithToOTELTranslator=new OT),this.cachedLSEnvVarsForMetadata=R_(),t.cache===!0?this._cache=new dT:t.cache&&typeof t.cache=="object"?this._cache=t.cache:this._cache=void 0}static getDefaultClientConfig(){const t=yt("API_KEY"),n=yt("ENDPOINT")??Hh,r=yt("HIDE_INPUTS")==="true",s=yt("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:t,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:IS(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const t={"User-Agent":`langsmith-js/${O_}`};return this.apiKey&&(t["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(t["x-tenant-id"]=this.workspaceId),t}_getPlatformEndpointPath(t){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${t}`:`/platform/${t}`}async processInputs(t){return this.hideInputs===!1?t:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(t):t}async processOutputs(t){return this.hideOutputs===!1?t:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(t):t}async prepareRunCreateOrUpdateInputs(t){const n={...t};return n.inputs!==void 0&&(n.inputs=await this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=await this.processOutputs(n.outputs)),n}async _getResponse(t,n){const r=n?.toString()??"",s=`${this.apiUrl}${t}?${r}`;return await this.caller.call(async()=>{const i=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,`fetch ${t}`),i})}async _get(t,n){return(await this._getResponse(t,n)).json()}async*_getPaginated(t,n=new URLSearchParams,r){let s=Number(n.get("offset"))||0;const a=Number(n.get("limit"))||100;for(;;){n.set("offset",String(s)),n.set("limit",String(a));const i=`${this.apiUrl}${t}?${n}`,o=await this.caller.call(async()=>{const u=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(u,`fetch ${t}`),u}),c=r?r(await o.json()):await o.json();if(c.length===0||(yield c,c.length<a))break;s+=c.length}}async*_getCursorPaginatedList(t,n=null,r="POST",s="runs"){const a=n?{...n}:{};for(;;){const i=JSON.stringify(a),c=await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}${t}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(l,`fetch ${t}`),l})).json();if(!c||!c[s])break;yield c[s];const u=c.cursors;if(!u||!u.next)break;a.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(t,n=!1){if(this.tracingSampleRate===void 0)return t;if(n){const r=[];for(const s of t)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):r.push(s);return r}else{const r=[];for(const s of t){const a=s.trace_id??s.id;this.filteredPostUuids.has(a)||(s.id===a?this._shouldSample()?r.push(s):this.filteredPostUuids.add(a):r.push(s))}return r}}async _getBatchSizeLimitBytes(){const t=await this._ensureServerInfo();return this.batchSizeBytesLimit??t?.batch_ingest_config?.size_limit_bytes??CS}async _getBatchSizeLimit(){const t=await this._ensureServerInfo();return this.batchSizeLimit??t?.batch_ingest_config?.size_limit??RS}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:t,batchSizeLimit:n}){const r=[];for(;this.autoBatchQueue.items.length>0;){const[s,a]=this.autoBatchQueue.pop({upToSizeBytes:t,upToSize:n});if(!s.length){a();break}const i=s.reduce((u,l)=>{const d=l.apiUrl??this.apiUrl,f=l.apiKey??this.apiKey,p=l.apiKey===this.apiKey&&l.apiUrl===this.apiUrl?"default":`${d}|${f}`;return u[p]||(u[p]=[]),u[p].push(l),u},{}),o=[];for(const[u,l]of Object.entries(i)){const d=this._processBatch(l,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});o.push(d)}const c=Promise.all(o).finally(a);r.push(c)}return Promise.all(r)}async _processBatch(t,n){if(!t.length)return;const r=t.reduce((s,a)=>s+(a.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(t);else{const s={runCreates:t.filter(o=>o.action==="create").map(o=>o.item),runUpdates:t.filter(o=>o.action==="update").map(o=>o.item)},a=await this._ensureServerInfo();if(!this._multipartDisabled&&(a?.batch_ingest_config?.use_multipart_endpoint??!0)){const o=!this._runCompressionDisabled&&a?.instance_flags?.gzip_body_enabled;try{await this.multipartIngestRuns(s,{...n,useGzip:o,sizeBytes:r})}catch(c){if(Fh(c))this._multipartDisabled=!0,await this.batchIngestRuns(s,{...n,sizeBytes:r});else throw c}}else await this.batchIngestRuns(s,{...n,sizeBytes:r})}}catch(s){console.error("Error exporting batch:",s)}}_sendBatchToOTELTranslator(t){if(this.langSmithToOTELTranslator!==void 0){const n=new Map,r=[];for(const s of t)s.item.id&&s.otelContext&&(n.set(s.item.id,s.otelContext),s.action==="create"?r.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):r.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(r,n)}}async processRunOperation(t){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,t.item=Zh(t.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);const n=this.autoBatchQueue.push(t);if(this.manualFlushMode)return n;const r=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),n}async _getServerInfo(){const n=await(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout($S),...this.fetchOptions});return await W(r,"get server info"),r})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(n,null,2)+`
`),n}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(t){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${t.status??"Unspecified status code"} ${t.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(t=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),t))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const t=await this._getBatchSizeLimitBytes(),n=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:t,batchSizeLimit:n})}_cloneCurrentOTELContext(){const t=P_(),n=ST();if(this.langSmithToOTELTranslator!==void 0){const r=t.getActiveSpan();if(r)return t.setSpan(n.active(),r)}}async createRun(t,n){if(!this._filterForSampling([t]).length)return;const r={...this.headers,"Content-Type":"application/json"},s=t.project_name;delete t.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:s,...t,start_time:t.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){const c=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:c,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}const i=Zh(a,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);n?.apiKey!==void 0&&(r["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(r["x-tenant-id"]=n.workspaceId);const o=$t(i,`Creating run with id: ${i.id}`);await this.caller.call(async()=>{const c=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await W(c,"create run",!0),c})}async batchIngestRuns({runCreates:t,runUpdates:n},r){if(t===void 0&&n===void 0)return;let s=await Promise.all(t?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]),a=await Promise.all(n?.map(c=>this.prepareRunCreateOrUpdateInputs(c))??[]);if(s.length>0&&a.length>0){const c=s.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of a)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);s=Object.values(c),a=u}const i={post:s,patch:a};if(!i.post.length&&!i.patch.length)return;const o={post:[],patch:[]};for(const c of["post","patch"]){const u=c,l=i[u].reverse();let d=l.pop();for(;d!==void 0;)o[u].push(d),d=l.pop()}if(o.post.length>0||o.patch.length>0){const c=o.post.map(u=>u.id).concat(o.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns($t(o,`Ingesting runs with ids: ${c}`),r)}}async _postBatchIngestRuns(t,n){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};n?.apiKey!==void 0&&(r["x-api-key"]=n.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:n?.sizeBytes},async()=>{const s=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await W(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:t,runUpdates:n},r){if(t===void 0&&n===void 0)return;const s={};let a=[];for(const d of t??[]){const f=await this.prepareRunCreateOrUpdateInputs(d);f.id!==void 0&&f.attachments!==void 0&&(s[f.id]=f.attachments),delete f.attachments,a.push(f)}let i=[];for(const d of n??[])i.push(await this.prepareRunCreateOrUpdateInputs(d));if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){const d=a.reduce((h,p)=>(p.id&&(h[p.id]=p),h),{}),f=[];for(const h of i)h.id!==void 0&&d[h.id]?d[h.id]={...d[h.id],...h}:f.push(h);a=Object.values(d),i=f}if(a.length===0&&i.length===0)return;const u=[],l=[];for(const[d,f]of[["post",a],["patch",i]])for(const h of f){const{inputs:p,outputs:m,events:b,extra:_,error:w,serialized:E,attachments:x,...I}=h,P={inputs:p,outputs:m,events:b,extra:_,error:w,serialized:E},j=$t(I,`Serializing for multipart ingestion of run with id: ${I.id}`);l.push({name:`${d}.${I.id}`,payload:new Blob([j],{type:`application/json; length=${j.length}`})});for(const[v,oe]of Object.entries(P)){if(oe===void 0)continue;const le=$t(oe,`Serializing ${v} for multipart ingestion of run with id: ${I.id}`);l.push({name:`${d}.${I.id}.${v}`,payload:new Blob([le],{type:`application/json; length=${le.length}`})})}if(I.id!==void 0){const v=s[I.id];if(v){delete s[I.id];for(const[oe,le]of Object.entries(v)){let K,Ge;if(Array.isArray(le)?[K,Ge]=le:(K=le.mimeType,Ge=le.data),oe.includes(".")){console.warn(`Skipping attachment '${oe}' for run ${I.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${I.id}.${oe}`,payload:new Blob([Ge],{type:`${K}; length=${Ge.byteLength}`})})}}}u.push(`trace=${I.trace_id},id=${I.id}`)}await this._sendMultipartRequest(l,u.join("; "),r)}async _createNodeFetchBody(t,n){const r=[];for(const i of t)r.push(new Blob([`--${n}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${n}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(t,n){const r=new TextEncoder;return new ReadableStream({async start(a){const i=async o=>{typeof o=="string"?a.enqueue(r.encode(o)):a.enqueue(o)};for(const o of t){await i(`--${n}\r
`),await i(`Content-Disposition: form-data; name="${o.name}"\r
`),await i(`Content-Type: ${o.payload.type}\r
\r
`);const u=o.payload.stream().getReader();try{let l;for(;!(l=await u.read()).done;)a.enqueue(l.value)}finally{u.releaseLock()}await i(`\r
`)}await i(`--${n}--\r
`),a.close()}})}async _sendMultipartRequest(t,n,r){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=NE(),i=()=>this._createNodeFetchBody(t,s),o=()=>this._createMultipartStream(t,s),c=async u=>this.batchIngestCaller.callWithOptions({sizeBytes:r?.sizeBytes},async()=>{const l=await u(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};r?.apiKey!==void 0&&(d["x-api-key"]=r.apiKey);let f=l;r?.useGzip&&typeof l=="object"&&"pipeThrough"in l&&(f=l.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");const h=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(h,"Failed to send multipart request",!0),h});try{let u,l=!1;!a&&!this.multipartStreamingDisabled&&C_()!=="bun"?(l=!0,u=await c(o)):u=await c(i),(!this.multipartStreamingDisabled||l)&&u.status===422&&(r?.apiUrl??this.apiUrl)!==Hh&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${n}".`),this.multipartStreamingDisabled=!0,u=await c(i))}catch(u){if(Fh(u))throw u;console.warn(`${u.message.trim()}

Context: ${n}`)}}async updateRun(t,n,r){he(t),n.inputs&&(n.inputs=await this.processInputs(n.inputs)),n.outputs&&(n.outputs=await this.processOutputs(n.outputs));const s={...n,id:t};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(n.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(a["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(a["x-tenant-id"]=r.workspaceId);const i=$t(n,`Serializing payload to update run with id: ${t}`);await this.caller.call(async()=>{const o=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${t}`,{method:"PATCH",headers:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(o,"update run",!0),o})}async readRun(t,{loadChildRuns:n}={loadChildRuns:!1}){he(t);let r=await this._get(`/runs/${t}`);return n&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:t,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r?.projectName?s=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(await this.readProject({projectName:yt("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${n.id}?poll=true`}else if(t!==void 0){const s=await this.readRun(t);if(!s.app_path)throw new Error(`Run ${t} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(t){const n=await OS(this.listRuns({isRoot:!1,projectId:t.session_id,traceId:t.trace_id})),r={},s={};n.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(const a of n){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(t.dotted_order??"")&&a.id!==t.id&&(a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a)}t.child_runs=r[t.id]||[];for(const a in r)a!==t.id&&(s[a].child_runs=r[a]);return t}async*listRuns(t){const{projectId:n,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:c,isRoot:u,runType:l,error:d,id:f,query:h,filter:p,traceFilter:m,treeFilter:b,limit:_,select:w,order:E}=t;let x=[];if(n&&(x=Array.isArray(n)?n:[n]),r){const v=Array.isArray(r)?r:[r],oe=await Promise.all(v.map(le=>this.readProject({projectName:le}).then(K=>K.id)));x.push(...oe)}const I=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],P={session:x.length?x:null,run_type:l,reference_example:i,query:h,filter:p,trace_filter:m,tree_filter:b,execution_order:c,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:_,trace:a,select:w||I,is_root:u,order:E};P.select.includes("child_run_ids")&&b_("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let j=0;for await(const v of this._getCursorPaginatedList("/runs/query",P))if(_){if(j>=_)break;if(v.length+j>_){yield*v.slice(0,_-j);break}j+=v.length,yield*v}else yield*v}async*listGroupRuns(t){const{projectId:n,projectName:r,groupBy:s,filter:a,startTime:i,endTime:o,limit:c,offset:u}=t,d={session_id:n||(await this.readProject({projectName:r})).id,group_by:s,filter:a,start_time:i?i.toISOString():null,end_time:o?o.toISOString():null,limit:Number(c)||100};let f=Number(u)||0;const h="/runs/group",p=`${this.apiUrl}${h}`;for(;;){const m={...d,offset:f},b=Object.fromEntries(Object.entries(m).filter(([P,j])=>j!==void 0)),_=JSON.stringify(b),E=await(await this.caller.call(async()=>{const P=await this._fetch(p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:_});return await W(P,`Failed to fetch ${h}`),P})).json(),{groups:x,total:I}=E;if(x.length===0)break;for(const P of x)yield P;if(f+=x.length,f>=I)break}}async getRunStats({id:t,trace:n,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:c,endTime:u,error:l,query:d,filter:f,traceFilter:h,treeFilter:p,isRoot:m,dataSourceType:b}){let _=i||[];a&&(_=[...i||[],...await Promise.all(a.map(j=>this.readProject({projectName:j}).then(v=>v.id)))]);const E=Object.fromEntries(Object.entries({id:t,trace:n,parent_run:r,run_type:s,session:_,reference_example:o,start_time:c,end_time:u,error:l,query:d,filter:f,trace_filter:h,tree_filter:p,is_root:m,data_source_type:b}).filter(([j,v])=>v!==void 0)),x=JSON.stringify(E);return await(await this.caller.call(async()=>{const j=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:x});return await W(j,"get run stats"),j})).json()}async shareRun(t,{shareId:n}={}){const r={run_id:t,share_token:n||pr()};he(t);const s=JSON.stringify(r),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${t}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await W(o,"share run"),o})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(t){he(t),await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/runs/${t}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(n,"unshare run",!0),n})}async readRunSharedLink(t){he(t);const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/runs/${t}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"read run shared link"),s})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(t,{runIds:n}={}){const r=new URLSearchParams({share_token:t});if(n!==void 0)for(const i of n)r.append("id",i);return he(t),await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/public/${t}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,"list shared runs"),i})).json()}async readDatasetSharedSchema(t,n){if(!t&&!n)throw new Error("Either datasetId or datasetName must be given");t||(t=(await this.readDataset({datasetName:n})).id),he(t);const s=await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/datasets/${t}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(a,"read dataset shared schema"),a})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(t,n){if(!t&&!n)throw new Error("Either datasetId or datasetName must be given");t||(t=(await this.readDataset({datasetName:n})).id);const r={dataset_id:t};he(t);const s=JSON.stringify(r),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${t}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await W(o,"share dataset"),o})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(t){he(t),await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/datasets/${t}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(n,"unshare dataset",!0),n})}async readSharedDataset(t){return he(t),await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/public/${t}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"read shared dataset"),s})).json()}async listSharedExamples(t,n){const r={};n?.exampleIds&&(r.id=n.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,c])=>{Array.isArray(c)?c.forEach(u=>s.append(o,u)):s.append(o,c)});const a=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${t}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(o,"list shared examples"),o}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(i.detail)?i.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:t,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);const l={name:t,extra:u,description:n};i!==null&&(l.reference_dataset_id=i);const d=JSON.stringify(l);return await(await this.caller.call(async()=>{const p=await this._fetch(c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await W(p,"create project"),p})).json()}async updateProject(t,{name:n=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${t}`;let c=a;s&&(c={...c||{},metadata:s});const u=JSON.stringify({name:n,extra:c,description:r,end_time:i?new Date(i).toISOString():null});return await(await this.caller.call(async()=>{const f=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await W(f,"update project"),f})).json()}async hasProject({projectId:t,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(t!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(t!==void 0)he(t),r+=`/${t}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,"has project"),i});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:t,projectName:n,includeStats:r}){let s="/sessions";const a=new URLSearchParams;if(t!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(t!==void 0)he(t),s+=`/${t}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${t}, name=${n}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:t,projectName:n}){if(t===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:t,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:t,datasetName:n}){if(t===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:t,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const t=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",t))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:t,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,includeStats:i,datasetVersion:o,referenceFree:c,metadata:u}={}){const l=new URLSearchParams;if(t!==void 0)for(const d of t)l.append("id",d);if(n!==void 0&&l.append("name",n),r!==void 0&&l.append("name_contains",r),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const d=await this.readDataset({datasetName:a});l.append("reference_dataset",d.id)}i!==void 0&&l.append("include_stats",i.toString()),o!==void 0&&l.append("dataset_version",o),c!==void 0&&l.append("reference_free",c.toString()),u!==void 0&&l.append("metadata",JSON.stringify(u));for await(const d of this._getPaginated("/sessions",l))yield*d}async deleteProject({projectId:t,projectName:n}){let r;if(t===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(t!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");t===void 0?r=(await this.readProject({projectName:n})).id:r=t,he(r),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,`delete session ${r} (${n})`,!0),s})}async uploadCsv({csvFile:t,fileName:n,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData,l=new Blob([t],{type:"text/csv"});return u.append("file",l,n),r.forEach(h=>{u.append("input_keys",h)}),s.forEach(h=>{u.append("output_keys",h)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o),await(await this.caller.call(async()=>{const h=await this._fetch(c,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await W(h,"upload CSV"),h})).json()}async createDataset(t,{description:n,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:t,description:n,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const c=JSON.stringify(o);return await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await W(d,"create dataset"),d})).json()}async readDataset({datasetId:t,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(t&&n)throw new Error("Must provide either datasetName or datasetId, not both");if(t)he(t),r+=`/${t}`;else if(n)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${t}, name=${n}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:t,datasetName:n}){try{return await this.readDataset({datasetId:t,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:t,datasetName:n,fromVersion:r,toVersion:s}){let a=t;if(a===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:n})).id);const i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:t,datasetName:n}){const r="/datasets";if(t===void 0)if(n!==void 0)t=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${t}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:t=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",c=new URLSearchParams({limit:t.toString(),offset:n.toString()});if(r!==void 0)for(const u of r)c.append("id",u);s!==void 0&&c.append("name",s),a!==void 0&&c.append("name_contains",a),i!==void 0&&c.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,c))yield*u}async updateDataset(t){const{datasetId:n,datasetName:r,...s}=t;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const a=n??(await this.readDataset({datasetName:r})).id;he(a);const i=JSON.stringify(s);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(c,"update dataset"),c})).json()}async updateDatasetTag(t){const{datasetId:n,datasetName:r,asOf:s,tag:a}=t;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const i=n??(await this.readDataset({datasetName:r})).id;he(i);const o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:a});await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${i}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await W(c,"update dataset tags",!0),c})}async deleteDataset({datasetId:t,datasetName:n}){let r="/datasets",s=t;if(t!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)he(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const a=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(a,`delete ${r}`,!0),a})}async indexDataset({datasetId:t,datasetName:n,tag:r}){let s=t;if(!s&&!n)throw new Error("Must provide either datasetName or datasetId");if(s&&n)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:n})).id),he(s);const i=JSON.stringify({tag:r});await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(c,"index dataset"),c})).json()}async similarExamples(t,n,r,{filter:s}={}){const a={limit:r,inputs:t};s!==void 0&&(a.filter=s),he(n);const i=JSON.stringify(a);return(await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${n}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:i});return await W(u,"fetch similar examples"),u})).json()).examples}async createExample(t,n,r){if(Vh(t)&&(n!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=n?r?.datasetId:t.dataset_id;const a=n?r?.datasetName:t.dataset_name;if(s===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:a})).id);const i=(n?r?.createdAt:t.created_at)||new Date;let o;Vh(t)?o=t:o={inputs:t,outputs:n,created_at:i?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};const c=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(c.example_ids?.[0]??pr())}async createExamples(t){if(Array.isArray(t)){if(t.length===0)return[];const w=t;let E=w[0].dataset_id;const x=w[0].dataset_name;if(E===void 0&&x===void 0)throw new Error("Must provide either datasetName or datasetId");if(E!==void 0&&x!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");E===void 0&&(E=(await this.readDataset({datasetName:x})).id);const I=await this._uploadExamplesMultipart(E,w);return await Promise.all(I.example_ids.map(j=>this.readExample(j)))}const{inputs:n,outputs:r,metadata:s,splits:a,sourceRunIds:i,useSourceRunIOs:o,useSourceRunAttachments:c,attachments:u,exampleIds:l,datasetId:d,datasetName:f}=t;if(n===void 0)throw new Error("Must provide inputs when using legacy parameters");let h=d;const p=f;if(h===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(h!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");h===void 0&&(h=(await this.readDataset({datasetName:p})).id);const m=n.map((w,E)=>({dataset_id:h,inputs:w,outputs:r?.[E],metadata:s?.[E],split:a?.[E],id:l?.[E],attachments:u?.[E],source_run_id:i?.[E],use_source_run_io:o?.[E],use_source_run_attachments:c?.[E]})),b=await this._uploadExamplesMultipart(h,m);return await Promise.all(b.example_ids.map(w=>this.readExample(w)))}async createLLMExample(t,n,r){return this.createExample({input:t},{output:n},r)}async createChatExample(t,n,r){const s=t.map(i=>Jf(i)?Wf(i):i),a=Jf(n)?Wf(n):n;return this.createExample({input:s},{output:a},r)}async readExample(t){he(t);const n=`/examples/${t}`,r=await this._get(n),{attachment_urls:s,...a}=r,i=a;return s&&(i.attachments=Object.entries(s).reduce((o,[c,u])=>(o[c.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),i}async*listExamples({datasetId:t,datasetName:n,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:c,offset:u,filter:l,includeAttachments:d}={}){let f;if(t!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0)f=t;else if(n!==void 0)f=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:f}),p=s?typeof s=="string"?s:s?.toISOString():void 0;p&&h.append("as_of",p);const m=i??!0;if(h.append("inline_s3_urls",m.toString()),r!==void 0)for(const _ of r)h.append("id",_);if(a!==void 0)for(const _ of a)h.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);h.append("metadata",_)}c!==void 0&&h.append("limit",c.toString()),u!==void 0&&h.append("offset",u.toString()),l!==void 0&&h.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(_=>h.append("select",_));let b=0;for await(const _ of this._getPaginated("/examples",h)){for(const w of _){const{attachment_urls:E,...x}=w,I=x;E&&(I.attachments=Object.entries(E).reduce((P,[j,v])=>(P[j.slice(11)]={presigned_url:v.presigned_url,mime_type:v.mime_type||void 0},P),{})),yield I,b++}if(c!==void 0&&b>=c)break}}async deleteExample(t){he(t);const n=`/examples/${t}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,`delete ${n}`,!0),r})}async deleteExamples(t,n){if(t.forEach(r=>he(r)),n?.hardDelete){const r=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${r}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:t,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"hard delete examples",!0),s})}else{const r=new URLSearchParams;t.forEach(s=>r.append("example_ids",s)),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/examples?${r.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"delete examples",!0),s})}}async updateExample(t,n){let r;n?r=t:r=t.id,he(r);let s;n?s={id:r,...n}:s=t;let a;return s.dataset_id!==void 0?a=s.dataset_id:a=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(a,[s])}async updateExamples(t){let n;return t[0].dataset_id===void 0?n=(await this.readExample(t[0].id)).dataset_id:n=t[0].dataset_id,this._updateExamplesMultipart(n,t)}async readDatasetVersion({datasetId:t,datasetName:n,asOf:r,tag:s}){let a;if(t?a=t:a=(await this.readDataset({datasetName:n})).id,he(a),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const i=new URLSearchParams;return r!==void 0&&i.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&i.append("tag",s),await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}/version?${i.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(c,"read dataset version"),c})).json()}async listDatasetSplits({datasetId:t,datasetName:n,asOf:r}){let s;if(t===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(t!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");t===void 0?s=(await this.readDataset({datasetName:n})).id:s=t,he(s);const a=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:t,datasetName:n,splitName:r,exampleIds:s,remove:a=!1}){let i;if(t===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(t!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");t===void 0?i=(await this.readDataset({datasetName:n})).id:i=t,he(i);const o={split_name:r,examples:s.map(u=>(he(u),u)),remove:a},c=JSON.stringify(o);await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await W(u,"update dataset splits",!0),u})}async createFeedback(t,n,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,feedbackConfig:d,projectId:f,comparativeExperimentId:h,sessionId:p,startTime:m}){if(!t&&!f)throw new Error("One of runId or projectId must be provided");if(t&&f)throw new Error("Only one of runId or projectId can be provided");const b={type:c??"api",metadata:o??{}};u!==void 0&&b?.metadata!==void 0&&!b.metadata.__run&&(b.metadata.__run={run_id:u}),b?.metadata!==void 0&&b.metadata.__run?.run_id!==void 0&&he(b.metadata.__run.run_id);const _={id:l??pr(),run_id:t,key:n,score:qh(r),value:s,correction:a,comment:i,feedback_source:b,comparative_experiment_id:h,feedbackConfig:d,session_id:p??f,start_time:m},w=JSON.stringify(_),E=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const x=await this._fetch(E,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:w});return await W(x,"create feedback",!0),x}),_}async updateFeedback(t,{score:n,value:r,correction:s,comment:a}){const i={};n!=null&&(i.score=qh(n)),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),he(t);const o=JSON.stringify(i);await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/${t}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await W(c,"update feedback",!0),c})}async readFeedback(t){he(t);const n=`/feedback/${t}`;return await this._get(n)}async deleteFeedback(t){he(t);const n=`/feedback/${t}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,`delete ${n}`,!0),r})}async*listFeedback({runIds:t,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(t)for(const a of t)he(a),s.append("run",a);if(n)for(const a of n)s.append("key",a);if(r)for(const a of r)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(t,n,{expiration:r,feedbackConfig:s}={}){const a={run_id:t,feedback_key:n,feedback_config:s};r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3};const i=JSON.stringify(a);return await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(c,"create presigned feedback token"),c})).json()}async createComparativeExperiment({name:t,experimentIds:n,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const c={id:o,name:t,experiment_ids:n,reference_dataset_id:r,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};i&&(c.extra.metadata=i);const u=JSON.stringify(c);return(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await W(d,"create comparative experiment"),d})).json()}async*listPresignedFeedbackTokens(t){he(t);const n=new URLSearchParams({run_id:t});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(t){let n;return"results"in t?n=t.results:Array.isArray(t)?n=t:n=[t],n}async _logEvaluationFeedback(t,n,r){const s=this._selectEvalResults(t),a=[];for(const i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let c=null;i.targetRunId?c=i.targetRunId:n&&(c=n.id),a.push(await this.createFeedback(c,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model",sessionId:n?.session_id,startTime:n?.start_time}))}return[s,a]}async logEvaluationFeedback(t,n,r){const[s]=await this._logEvaluationFeedback(t,n,r);return s}async*listAnnotationQueues(t={}){const{queueIds:n,name:r,nameContains:s,limit:a}=t,i=new URLSearchParams;n&&n.forEach((c,u)=>{he(c,`queueIds[${u}]`),i.append("ids",c)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const c of this._getPaginated("/annotation-queues",i))if(yield*c,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(t){const{name:n,description:r,queueId:s,rubricInstructions:a}=t,i={name:n,description:r,id:s||pr(),rubric_instructions:a},o=JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,l])=>l!==void 0)));return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await W(u,"create annotation queue"),u})).json()}async readAnnotationQueue(t){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,"read annotation queue"),r})).json()}async updateAnnotationQueue(t,n){const{name:r,description:s,rubricInstructions:a}=n,i=JSON.stringify({name:r,description:s,rubric_instructions:a});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(t){await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(n,"delete annotation queue",!0),n})}async addRunsToAnnotationQueue(t,n){const r=JSON.stringify(n.map((s,a)=>he(s,`runIds[${a}]`).toString()));await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await W(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(t,n){const r=`/annotation-queues/${he(t,"queueId")}/run`;return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(a,"get run from annotation queue"),a})).json()}async deleteRunFromAnnotationQueue(t,n){await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}/runs/${he(n,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(t){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${he(t,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(r,"get size from annotation queue"),r})).json()}async _currentTenantIsOwner(t){const n=await this._getSettings();return t=="-"||n.tenant_handle===t}async _ownerConflictError(t,n){const r=await this._getSettings();return new Error(`Cannot ${t} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(t){const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/commits/${t}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"get latest commit hash"),s})).json();if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(t,n){const[r,s,a]=qn(t),i=JSON.stringify({like:n});return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(c,`${n?"like":"unlike"} prompt`),c})).json()}async _getPromptUrl(t){const[n,r,s]=qn(t);if(await this._currentTenantIsOwner(n)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(t){return!!await this.getPrompt(t)}async likePrompt(t){return this._likeOrUnlikePrompt(t,!0)}async unlikePrompt(t){return this._likeOrUnlikePrompt(t,!1)}async*listCommits(t){for await(const n of this._getPaginated(`/commits/${t}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(t){const n=new URLSearchParams;n.append("sort_field",t?.sortField??"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!t?.isArchived).toString()),t?.isPublic!==void 0&&n.append("is_public",t.isPublic.toString()),t?.query&&n.append("query",t.query);for await(const r of this._getPaginated("/repos",n,s=>s.repos))yield*r}async getPrompt(t){const[n,r,s]=qn(t),i=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return o?.status===404?null:(await W(o,"get prompt"),o)}))?.json();return i?.repo?i.repo:null}async createPrompt(t,n){const r=await this._getSettings();if(n?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=qn(t);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...n?.description&&{description:n.description},...n?.readme&&{readme:n.readme},...n?.tags&&{tags:n.tags},is_public:!!n?.isPublic},c=JSON.stringify(o),u=await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await W(d,"create prompt"),d}),{repo:l}=await u.json();return l}async createCommit(t,n,r){if(!await this.promptExists(t))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=qn(t),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${s}/${a}`):r?.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},u=JSON.stringify(c),d=await(await this.caller.call(async()=>{const f=await this._fetch(`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await W(f,"create commit"),f})).json();return this._getPromptUrl(`${s}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(t,n=[]){return this._updateExamplesMultipart(t,n)}async _updateExamplesMultipart(t,n=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const i of n){const o=i.id,c={...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split}},u=$t(c,`Serializing body for example with id: ${o}`),l=new Blob([u],{type:"application/json"});if(r.append(o,l),i.inputs){const d=$t(i.inputs,`Serializing inputs for example with id: ${o}`),f=new Blob([d],{type:"application/json"});r.append(`${o}.inputs`,f)}if(i.outputs){const d=$t(i.outputs,`Serializing outputs whle updating example with id: ${o}`),f=new Blob([d],{type:"application/json"});r.append(`${o}.outputs`,f)}if(i.attachments)for(const[d,f]of Object.entries(i.attachments)){let h,p;Array.isArray(f)?[h,p]=f:(h=f.mimeType,p=f.data);const m=new Blob([p],{type:`${h}; length=${p.byteLength}`});r.append(`${o}.attachment.${d}`,m)}if(i.attachments_operations){const d=$t(i.attachments_operations,`Serializing attachments while updating example with id: ${o}`),f=new Blob([d],{type:"application/json"});r.append(`${o}.attachments_operations`,f)}}const s=t??n[0]?.dataset_id;return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await W(i,"update examples"),i})).json()}async uploadExamplesMultipart(t,n=[]){return this._uploadExamplesMultipart(t,n)}async _uploadExamplesMultipart(t,n=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const a of n){const i=(a.id??pr()).toString(),o={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split},...a.source_run_id&&{source_run_id:a.source_run_id},...a.use_source_run_io&&{use_source_run_io:a.use_source_run_io},...a.use_source_run_attachments&&{use_source_run_attachments:a.use_source_run_attachments}},c=$t(o,`Serializing body for uploaded example with id: ${i}`),u=new Blob([c],{type:"application/json"});if(r.append(i,u),a.inputs){const l=$t(a.inputs,`Serializing inputs for uploaded example with id: ${i}`),d=new Blob([l],{type:"application/json"});r.append(`${i}.inputs`,d)}if(a.outputs){const l=$t(a.outputs,`Serializing outputs for uploaded example with id: ${i}`),d=new Blob([l],{type:"application/json"});r.append(`${i}.outputs`,d)}if(a.attachments)for(const[l,d]of Object.entries(a.attachments)){let f,h;Array.isArray(d)?[f,h]=d:(f=d.mimeType,h=d.data);const p=new Blob([h],{type:`${f}; length=${h.byteLength}`});r.append(`${i}.attachment.${l}`,p)}}return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${t}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await W(a,"upload examples"),a})).json()}async updatePrompt(t,n){if(!await this.promptExists(t))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=qn(t);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if(n?.description!==void 0&&(a.description=n.description),n?.readme!==void 0&&(a.readme=n.readme),n?.tags!==void 0&&(a.tags=n.tags),n?.isPublic!==void 0&&(a.is_public=n.isPublic),n?.isArchived!==void 0&&(a.is_archived=n.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=JSON.stringify(a);return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await W(c,"update prompt"),c})).json()}async deletePrompt(t){if(!await this.promptExists(t))throw new Error("Prompt does not exist, you must create it first.");const[n,r,s]=qn(t);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,"delete prompt"),i})).json()}_getPromptCacheKey(t,n){return`${t}${n?":with_model":""}`}async _fetchPromptFromApi(t,n){const[r,s,a]=qn(t),o=await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/commits/${r}/${s}/${a}${n?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(c,"pull prompt commit"),c})).json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async pullPromptCommit(t,n){if(!n?.skipCache&&this._cache){const r=this._getPromptCacheKey(t,n?.includeModel),s=this._cache.get(r);if(s)return s;const a=await this._fetchPromptFromApi(t,n);return this._cache.set(r,a),a}return this._fetchPromptFromApi(t,n)}async _pullPrompt(t,n){const r=await this.pullPromptCommit(t,{includeModel:n?.includeModel,skipCache:n?.skipCache});return JSON.stringify(r.manifest)}async pushPrompt(t,n){return await this.promptExists(t)?n&&Object.keys(n).some(s=>s!=="object")&&await this.updatePrompt(t,{description:n?.description,readme:n?.readme,tags:n?.tags,isPublic:n?.isPublic}):await this.createPrompt(t,{description:n?.description,readme:n?.readme,tags:n?.tags,isPublic:n?.isPublic}),n?.object?await this.createCommit(t,n?.object,{parentCommitHash:n?.parentCommitHash}):await this._getPromptUrl(t)}async clonePublicDataset(t,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=n,[a,i]=this.parseTokenOrUrl(t,r),o=new Fs({apiUrl:a,apiKey:"placeholder"}),c=await o.readSharedDataset(i),u=s||c.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(i),d=await this.createDataset(u,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(f=>f.inputs),outputs:l.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(t,n,r=2,s="dataset"){try{return he(t),[n,t]}catch{}try{const i=new URL(t).pathname.split("/").filter(o=>o!=="");if(i.length>=r){const o=i[i.length-r];return[n,o]}else throw new Error(`Invalid public ${s} URL: ${t}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${t}`)}}get cache(){return this._cache}cleanup(){this._cache&&this._cache.stop()}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await new Promise(t=>setTimeout(t,1)),await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:t})=>t),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await xT()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function Vh(e){return"dataset_id"in e||"dataset_name"in e}const PS=e=>!!["TRACING_V2","TRACING"].find(n=>yt(n)==="true"),Kn=Symbol.for("lc:context_variables"),qc=Symbol.for("langsmith:replica_trace_roots");function Gh(e,t){if(Kn in e)return e[Kn][t]}function MS(e,t,n){const r=Kn in e?e[Kn]:{};r[t]=n,e[Kn]=r}const LS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function Jh(e){const n=Object.keys(e).sort().map(r=>`${r}:${e[r]??""}`).join("|");return tE(n,LS)}function jS(e){return e.replace(/[-:.]/g,"")}function B_(e,t=1){const n=t.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${n}Z`}function Z_(e,t,n=1){const r=B_(e,n);return{dottedOrder:jS(r)+t,microsecondPrecisionDatestring:r}}const zS=new Set(["projectName","updates","reroot"]);function DS(e){const t={};for(const n of Object.keys(e))zS.has(n)&&(t[n]=e[n]);return t}class yi{constructor(t,n,r,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=t,this.tags=n,this.project_name=r,this.replicas=s}static fromHeader(t){const n=t.split(",");let r={},s=[],a,i;for(const o of n){const[c,u]=o.split("="),l=decodeURIComponent(u);c==="langsmith-metadata"?r=JSON.parse(l):c==="langsmith-tags"?s=l.split(","):c==="langsmith-project"?a=l:c==="langsmith-replicas"&&(i=JSON.parse(l).map(f=>Array.isArray(f)?f:DS(f)))}return new yi(r,s,a,i)}toHeader(){const t=[];return this.metadata&&Object.keys(this.metadata).length>0&&t.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&t.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&t.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),t.join(",")}}class Tt{constructor(t){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_awaitInputsOnPost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),US(t)){Object.assign(this,{...t});return}const n=Tt.getDefaultConfig(),{metadata:r,...s}=t,a=s.client??Tt.getSharedClient(),i={...r,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:i},"id"in s&&s.id==null&&delete s.id,Object.assign(this,{...n,...s,client:a}),this.execution_order??=1,this.child_execution_order??=1,this.dotted_order||(this._serialized_start_time=B_(this.start_time,this.execution_order)),this.id||(this.id=nT(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=qS(this.replicas),!this.dotted_order){const{dottedOrder:o}=Z_(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o}}set metadata(t){this.extra={...this.extra,metadata:{...this.extra?.metadata,...t}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){const t=Date.now();return{run_type:"chain",project_name:w_(),child_runs:[],api_url:Tn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Tn("LANGCHAIN_API_KEY"),caller_options:{},start_time:t,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Tt.sharedClient||(Tt.sharedClient=new Fs),Tt.sharedClient}createChild(t){const n=this.child_execution_order+1,r=this.replicas?.map(l=>{const{reroot:d,...f}=l;return f}),s=t.replicas??r,a=new Tt({...t,parent_run:this,project_name:this.project_name,replicas:s,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:n,child_execution_order:n});Kn in this&&(a[Kn]=this[Kn]);const i=Symbol.for("lc:child_config"),o=t.extra?.[i]??this.extra[i];if(BS(o)){const l={...o},d=FS(l.callbacks)?l.callbacks.copy?.():void 0;d&&(Object.assign(d,{_parentRunId:a.id}),d.handlers?.find(q_)?.updateFromRunTree?.(a),l.callbacks=d),a.extra[i]=l}const c=new Set;let u=this;for(;u!=null&&!c.has(u.id);)c.add(u.id),u.child_execution_order=Math.max(u.child_execution_order,n),u=u.parent_run;return this.child_runs.push(a),a}async end(t,n,r=Date.now(),s){this.outputs=this.outputs??t,this.error=this.error??n,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(t,n,r=!0){const s=t.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),n))for(const[o,c]of Object.entries(n))s.runtime[o]||(s.runtime[o]=c);let a,i;return r?(i=t.parent_run?.id??t.parent_run_id,a=[]):(a=t.child_runs.map(o=>this._convertToCreate(o,n,r)),i=void 0),{id:t.id,name:t.name,start_time:t._serialized_start_time??t.start_time,end_time:t.end_time,run_type:t.run_type,reference_example_id:t.reference_example_id,extra:s,serialized:t.serialized,error:t.error,inputs:t.inputs,outputs:t.outputs,session_name:t.project_name,child_runs:a,parent_run_id:i,trace_id:t.trace_id,dotted_order:t.dotted_order,tags:t.tags,attachments:t.attachments,events:t.events}}_sliceParentId(t,n){if(n.dotted_order){const r=n.dotted_order.split(".");let s=null;for(let a=0;a<r.length;a++)if(r[a].slice(-36)===t){s=a;break}if(s!==null){const a=r.slice(s+1);n.dotted_order=a.join("."),a.length>0?n.trace_id=a[0].slice(-36):n.trace_id=n.id}}n.parent_run_id===t&&(n.parent_run_id=void 0)}_setReplicaTraceRoot(t,n){const r=Gh(this,qc)??{};r[t]=n,MS(this,qc,r);for(const s of this.child_runs)s._setReplicaTraceRoot(t,n)}_remapForProject(t){const{projectName:n,runtimeEnv:r,excludeChildRuns:s=!0,reroot:a=!1,distributedParentId:i,apiUrl:o,apiKey:c,workspaceId:u}=t,l=this._convertToCreate(this,r,s);if(n===this.project_name)return{...l,session_name:n};if(a){if(i)this._sliceParentId(i,l);else if(l.parent_run_id=void 0,l.dotted_order){const w=l.dotted_order.split(".");w.length>0&&(l.dotted_order=w[w.length-1],l.trace_id=l.id)}const _=Jh({projectName:n,apiUrl:o,apiKey:c,workspaceId:u});this._setReplicaTraceRoot(_,l.id)}let d;if(!a){const _=Gh(this,qc)??{},w=Jh({projectName:n,apiUrl:o,apiKey:c,workspaceId:u});if(d=_[w],d&&(l.trace_id=d,l.dotted_order)){const E=l.dotted_order.split(".");let x=null;for(let I=0;I<E.length;I++)if(E[I].slice(-36)===d){x=I;break}if(x!==null){const I=E.slice(x);l.dotted_order=I.join(".")}}}const f=l.id,h=Oa(f,n);let p;l.trace_id?p=Oa(l.trace_id,n):p=h;let m;l.parent_run_id&&(m=Oa(l.parent_run_id,n));let b;return l.dotted_order&&(b=l.dotted_order.split(".").map(E=>{const x=E.slice(-36),I=Oa(x,n);return E.slice(0,-36)+I}).join(".")),{...l,id:h,trace_id:p,parent_run_id:m,dotted_order:b,session_name:n}}async postRun(t=!0){this._awaitInputsOnPost&&(this.inputs=await this.inputs);try{const n=$_();if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:a,workspaceId:i,reroot:o}of this.replicas){const c=this._remapForProject({projectName:r??this.project_name,runtimeEnv:n,excludeChildRuns:!0,reroot:o,distributedParentId:this.distributedParentId,apiUrl:a,apiKey:s,workspaceId:i});await this.client.createRun(c,{apiKey:s,apiUrl:a,workspaceId:i})}else{const r=this._convertToCreate(this,n,t);await this.client.createRun(r)}if(!t){b_("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}this.child_runs=[]}catch(n){console.error(`Error in postRun for run ${this.id}:`,n)}}async patchRun(t){if(this.replicas&&this.replicas.length>0)for(const{projectName:n,apiKey:r,apiUrl:s,workspaceId:a,updates:i,reroot:o}of this.replicas){const c=this._remapForProject({projectName:n??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:o,distributedParentId:this.distributedParentId,apiUrl:s,apiKey:r,workspaceId:a}),u={id:c.id,name:c.name,run_type:c.run_type,start_time:c.start_time,outputs:c.outputs,error:c.error,parent_run_id:c.parent_run_id,session_name:c.session_name,reference_example_id:c.reference_example_id,end_time:c.end_time,dotted_order:c.dotted_order,trace_id:c.trace_id,events:c.events,tags:c.tags,extra:c.extra,attachments:this.attachments,...i};t?.excludeInputs||(u.inputs=c.inputs),await this.client.updateRun(c.id,u,{apiKey:r,apiUrl:s,workspaceId:a})}else try{const n={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};t?.excludeInputs||(n.inputs=this.inputs),await this.client.updateRun(this.id,n)}catch(n){console.error(`Error in patchRun for run ${this.id}`,n)}this.child_runs=[]}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(t){this.events||(this.events=[]),typeof t=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:t}):this.events.push({...t,time:t.time??new Date().toISOString()})}static fromRunnableConfig(t,n){const r=t?.callbacks;let s,a,i,o=PS();if(r){const u=r?.getParentRunId?.()??"",l=r?.handlers?.find(d=>d?.name=="langchain_tracer");s=l?.getRun?.(u),a=l?.projectName,i=l?.client,o=o||!!l}return s?new Tt({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(t?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...t?.metadata}}}).createChild(n):new Tt({...n,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(t){return this.fromHeaders({"langsmith-trace":t})}static fromHeaders(t,n){const r="get"in t&&typeof t.get=="function"?{"langsmith-trace":t.get("langsmith-trace"),baggage:t.get("baggage")}:t,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const a=s.trim(),i=a.split(".").map(l=>{const[d,f]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=i[0].uuid,c={...n,name:n?.name??"parent",run_type:n?.run_type??"chain",start_time:n?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const l=yi.fromHeader(r.baggage);c.metadata=l.metadata,c.tags=l.tags,c.project_name=l.project_name,c.replicas=l.replicas}const u=new Tt(c);return u.distributedParentId=u.id,u}toHeaders(t){const n={"langsmith-trace":this.dotted_order,baggage:new yi(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(t)for(const[r,s]of Object.entries(n))t.set(r,s);return n}}Object.defineProperty(Tt,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function US(e){return e!=null&&typeof e.createChild=="function"&&typeof e.postRun=="function"}function q_(e){return typeof e=="object"&&e!=null&&typeof e.name=="string"&&e.name==="langchain_tracer"}function Wh(e){return Array.isArray(e)&&e.some(t=>q_(t))}function FS(e){return typeof e=="object"&&e!=null&&Array.isArray(e.handlers)}function BS(e){const t=e?.callbacks;return e!=null&&typeof t=="object"&&(Wh(t?.handlers)||Wh(t))}function ZS(){const e=Tn("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{const t=JSON.parse(e);if(Array.isArray(t)){const n=[];for(const r of t){if(typeof r!="object"||r===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if(typeof r.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if(typeof r.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}n.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return n}else if(typeof t=="object"&&t!==null){HS(t);const n=[];for(const[r,s]of Object.entries(t)){const a=r.replace(/\/$/,"");if(typeof s=="string")n.push({apiUrl:a,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof s}`);continue}}return n}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof t}`),[]}catch(t){if(bS(t))throw t;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function qS(e){return e?e.map(t=>Array.isArray(t)?{projectName:t[0],updates:t[1]}:t):ZS()}function HS(e){if(Object.keys(e).length>0&&yt("ENDPOINT"))throw new wS}var VS={};be(VS,{BaseTracer:()=>cs,isBaseTracer:()=>Lr});const GS=e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e};function Ou(e,t){if(e)return new Tt({...e,start_time:e._serialized_start_time??e.start_time,parent_run:Ou(t),child_runs:e.child_runs.map(n=>Ou(n)).filter(n=>n!==void 0),extra:{...e.extra,runtime:m_()},tracingEnabled:!1})}function Hc(e,t){return e&&!Array.isArray(e)&&typeof e=="object"?e:{[t]:e}}function Lr(e){return typeof e._addRunToRunMap=="function"}var cs=class extends sa{runMap=new Map;runTreeMap=new Map;usesRunTreeMap=!1;constructor(e){super(...arguments)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?GS(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const{dottedOrder:t,microsecondPrecisionDatestring:n}=Z_(new Date(e.start_time).getTime(),e.id,e.execution_order),r={...e},s=this.getRunById(r.parent_run_id);if(r.parent_run_id!==void 0?s?(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join("."),r._serialized_start_time=n)):r.parent_run_id=void 0:(r.trace_id=r.id,r.dotted_order=t,r._serialized_start_time=n),this.usesRunTreeMap){const a=Ou(r,s);a!==void 0&&this.runTreeMap.set(r.id,a)}else this.runMap.set(r.id,r);return r}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,r,s,a,i,o){const c=this._getExecutionOrder(r),u=Date.now(),l=i?{...s,metadata:i}:s,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,n,r,s,a,i,o){const c=this.getRunById(n)??this._createRunForLLMStart(e,t,n,r,s,a,i,o);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}_createRunForChatModelStart(e,t,n,r,s,a,i,o){const c=this._getExecutionOrder(r),u=Date.now(),l=i?{...s,metadata:i}:s,d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,n,r,s,a,i,o){const c=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,r,s,a,i,o);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,t,n,r,s){const a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...s},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,n,r,s){const a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...s},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,n,r,s,a,i,o,c){const u=this._getExecutionOrder(r),l=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:r,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:i??"chain",child_runs:[],extra:a?{...c,metadata:a}:{...c},tags:s||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,r,s,a,i,o){const c=this.getRunById(n)??this._createRunForChainStart(e,t,n,r,s,a,i,o);return await this.onRunCreate?.(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,n,r,s){const a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Hc(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=Hc(s.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,n,r,s){const a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=Hc(s.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,n,r,s,a,i){const o=this._getExecutionOrder(r),c=Date.now(),u={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,n,r,s,a,i){const o=this.getRunById(n)??this._createRunForToolStart(e,t,n,r,s,a,i);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){const n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,t){const n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,t){const n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;const r=n;r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,t){const n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,t,n,r,s,a,i){const o=this._getExecutionOrder(r),c=Date.now(),u={id:n,name:i??e.id[e.id.length-1],parent_run_id:r,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,n,r,s,a,i){const o=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,r,s,a,i);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){const n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,t){const n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,t){const n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,t,n,r,s,a){const i=this.getRunById(n);if(!i||i?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(i,e,{chunk:a?.chunk}),i}},ei={exports:{}};ei.exports;var Kh;function JS(){return Kh||(Kh=1,(function(e){const n=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,r=(a=0)=>(i,o,c)=>`\x1B[${38+a};2;${i};${o};${c}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,c]of Object.entries(i)){for(const[u,l]of Object.entries(c))i[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=i[u],a.set(l[0],l[1]);Object.defineProperty(i,o,{value:c,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=n(),i.color.ansi16m=r(),i.bgColor.ansi256=n(10),i.bgColor.ansi16m=r(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(e,"exports",{enumerable:!0,get:s})})(ei)),ei.exports}var WS=JS();const H_=Qi(WS);var KS={};be(KS,{ConsoleCallbackHandler:()=>Au});function pt(e,t){return`${e.open}${t}${e.close}`}function Ut(e,t){try{return JSON.stringify(e,null,2)}catch{return t}}function Xh(e){return typeof e=="string"?e.trim():e==null?e:Ut(e,e.toString())}function Hn(e){if(!e.end_time)return"";const t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}const{color:Et}=H_;var Au=class extends cs{name="console_callback_handler";persistRun(e){return Promise.resolve()}getParents(e){const t=[];let n=e;for(;n.parent_run_id;){const r=this.runMap.get(n.parent_run_id);if(r)t.push(r),n=r;else break}return t}getBreadcrumbs(e){const n=[...this.getParents(e).reverse(),e].map((r,s,a)=>{const i=`${r.execution_order}:${r.run_type}:${r.name}`;return s===a.length-1?pt(H_.bold,i):i}).join(" > ");return pt(Et.grey,n)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ut(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.cyan,"[chain/end]")} [${t}] [${Hn(e)}] Exiting Chain run with output: ${Ut(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.red,"[chain/error]")} [${t}] [${Hn(e)}] Chain run errored with error: ${Ut(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(r=>r.trim())}:e.inputs;console.log(`${pt(Et.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ut(n,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.cyan,"[llm/end]")} [${t}] [${Hn(e)}] Exiting LLM run with output: ${Ut(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.red,"[llm/error]")} [${t}] [${Hn(e)}] LLM run errored with error: ${Ut(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Xh(e.inputs.input)}"`)}onToolEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.cyan,"[tool/end]")} [${t}] [${Hn(e)}] Exiting Tool run with output: "${Xh(e.outputs?.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.red,"[tool/error]")} [${t}] [${Hn(e)}] Tool run errored with error: ${Ut(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ut(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.cyan,"[retriever/end]")} [${t}] [${Hn(e)}] Exiting Retriever run with output: ${Ut(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${pt(Et.red,"[retriever/error]")} [${t}] [${Hn(e)}] Retriever run errored with error: ${Ut(e.error,"[error]")}`)}onAgentAction(e){const t=e,n=this.getBreadcrumbs(e);console.log(`${pt(Et.blue,"[agent/action]")} [${n}] Agent selected action: ${Ut(t.actions[t.actions.length-1],"[action]")}`)}};let Vc;const V_=()=>{if(Vc===void 0){const e=wn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Vc=new Fs(e)}return Vc};let XS=class{getStore(){}run(t,n){return n()}};const Gc=Symbol.for("ls:tracing_async_local_storage"),YS=new XS;let QS=class{getInstance(){return globalThis[Gc]??YS}initializeGlobalInstance(t){globalThis[Gc]===void 0&&(globalThis[Gc]=t)}};const ex=new QS;function tx(e=!1){const t=ex.getInstance().getStore();if(!e&&t===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return t}function sd(e){return typeof e=="function"&&"langsmith:traceable"in e}var nx={};be(nx,{LangChainTracer:()=>ti});function rx(e){let t;for(const n of e)for(const r of n)wt.isInstance(r.message)&&r.message.usage_metadata!==void 0&&(t=Ul(t,r.message.usage_metadata));return t}var ti=class G_ extends cs{name="langchain_tracer";projectName;exampleId;client;replicas;usesRunTreeMap=!0;constructor(t={}){super(t);const{exampleId:n,projectName:r,client:s,replicas:a}=t;this.projectName=r??w_(),this.replicas=a,this.exampleId=n,this.client=s??V_();const i=G_.getTraceableRunTree();i&&this.updateFromRunTree(i)}async persistRun(t){}async onRunCreate(t){t.extra?.lc_defers_inputs||await this.getRunTreeWithTracingConfig(t.id)?.postRun()}async onRunUpdate(t){const n=this.getRunTreeWithTracingConfig(t.id);t.extra?.lc_defers_inputs?await n?.postRun():await n?.patchRun()}onLLMEnd(t){const n=t.outputs;if(n?.generations){const r=rx(n.generations);if(r!==void 0){t.extra=t.extra??{};const s=t.extra.metadata??{};s.usage_metadata=r,t.extra.metadata=s}}}getRun(t){return this.runTreeMap.get(t)}updateFromRunTree(t){this.runTreeMap.set(t.id,t);let n=t;const r=new Set;for(;n.parent_run&&!(r.has(n.id)||(r.add(n.id),!n.parent_run));)n=n.parent_run;r.clear();const s=[n];for(;s.length>0;){const a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=t.client??this.client,this.replicas=t.replicas??this.replicas,this.projectName=t.project_name??this.projectName,this.exampleId=t.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(t){const n=this.runTreeMap.get(t);if(n)return new Tt({...n,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return tx(!0)}catch{return}}};let _r;function sx(){const e="default"in Rn?Rn.default:Rn;return new e({autoStart:!0,concurrency:1})}function ax(){return typeof _r>"u"&&(_r=sx()),_r}async function We(e,t){if(t===!0){const n=Us();n!==void 0?await n.run(void 0,async()=>e()):await e()}else _r=ax(),_r.add(async()=>{const n=Us();n!==void 0?await n.run(void 0,async()=>e()):await e()})}async function ix(){const e=V_();await Promise.allSettled([typeof _r<"u"?_r.onIdle():Promise.resolve(),e.awaitPendingTraceBatches()])}var ox={};be(ox,{awaitAllCallbacks:()=>ix,consumeCallback:()=>We});const cx=e=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(n=>wn(n)==="true");function J_(e){const t=Us();return t===void 0?void 0:t.getStore()?.[Ns]?.[e]}const ux=Symbol("lc:configure_hooks"),lx=()=>J_(ux)||[];var dx={};be(dx,{BaseCallbackManager:()=>W_,BaseRunManager:()=>ia,CallbackManager:()=>xt,CallbackManagerForChainRun:()=>X_,CallbackManagerForLLMRun:()=>Cu,CallbackManagerForRetrieverRun:()=>K_,CallbackManagerForToolRun:()=>Y_,ensureHandler:()=>Bs,parseCallbackConfigArg:()=>uo});function uo(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}var W_=class{setHandler(e){return this.setHandlers([e])}},ia=class{constructor(e,t,n,r,s,a,i,o){this.runId=e,this.handlers=t,this.inheritableHandlers=n,this.tags=r,this.inheritableTags=s,this.metadata=a,this.inheritableMetadata=i,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>We(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,r,s){await Promise.all(this.handlers.map(a=>We(async()=>{try{await a.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(i){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${i}`),a.raiseError)throw i}},a.awaitHandlers)))}},K_=class extends ia{getChild(e){const t=new xt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}},Cu=class extends ia{async handleLLMNewToken(e,t,n,r,s,a){await Promise.all(this.handlers.map(i=>We(async()=>{if(!i.ignoreLLM)try{await i.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMNewToken: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleLLMError(e,t,n,r,s){await Promise.all(this.handlers.map(a=>We(async()=>{if(!a.ignoreLLM)try{await a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(i){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${i}`),a.raiseError)throw i}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,r,s){await Promise.all(this.handlers.map(a=>We(async()=>{if(!a.ignoreLLM)try{await a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(i){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${i}`),a.raiseError)throw i}},a.awaitHandlers)))}},X_=class extends ia{getChild(e){const t=new xt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,r,s){await Promise.all(this.handlers.map(a=>We(async()=>{if(!a.ignoreChain)try{await a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(i){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${i}`),a.raiseError)throw i}},a.awaitHandlers)))}async handleChainEnd(e,t,n,r,s){await Promise.all(this.handlers.map(a=>We(async()=>{if(!a.ignoreChain)try{await a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(i){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${i}`),a.raiseError)throw i}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},Y_=class extends ia{getChild(e){const t=new xt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>We(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},xt=class Ts extends W_{handlers=[];inheritableHandlers=[];tags=[];inheritableTags=[];metadata={};inheritableMetadata={};name="callback_manager";_parentRunId;constructor(t,n){super(),this.handlers=n?.handlers??this.handlers,this.inheritableHandlers=n?.inheritableHandlers??this.inheritableHandlers,this.tags=n?.tags??this.tags,this.inheritableTags=n?.inheritableTags??this.inheritableTags,this.metadata=n?.metadata??this.metadata,this.inheritableMetadata=n?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=t}getParentRunId(){return this._parentRunId}async handleLLMStart(t,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0){return Promise.all(n.map(async(u,l)=>{const d=l===0&&r?r:Vn();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Lr(f)&&f._createRunForLLMStart(t,[u],d,this._parentRunId,a,this.tags,this.metadata,c),We(async()=>{try{await f.handleLLMStart?.(t,[u],d,this._parentRunId,a,this.tags,this.metadata,c)}catch(h){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${h}`),f.raiseError)throw h}},f.awaitHandlers)})),new Cu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(t,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,c=void 0){return Promise.all(n.map(async(u,l)=>{const d=l===0&&r?r:Vn();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Lr(f)&&f._createRunForChatModelStart(t,[u],d,this._parentRunId,a,this.tags,this.metadata,c),We(async()=>{try{if(f.handleChatModelStart)await f.handleChatModelStart?.(t,[u],d,this._parentRunId,a,this.tags,this.metadata,c);else if(f.handleLLMStart){const h=Hl(u);await f.handleLLMStart?.(t,[h],d,this._parentRunId,a,this.tags,this.metadata,c)}}catch(h){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${h}`),f.raiseError)throw h}},f.awaitHandlers)})),new Cu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(t,n,r=Vn(),s=void 0,a=void 0,i=void 0,o=void 0,c=void 0,u=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Lr(l)&&l._createRunForChainStart(t,n,r,this._parentRunId,this.tags,this.metadata,s,o,u),We(async()=>{try{await l.handleChainStart?.(t,n,r,this._parentRunId,this.tags,this.metadata,s,o,u)}catch(d){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${d}`),l.raiseError)throw d}},l.awaitHandlers)})),new X_(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(t,n,r=Vn(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(c=>{if(!c.ignoreAgent)return Lr(c)&&c._createRunForToolStart(t,n,r,this._parentRunId,this.tags,this.metadata,o),We(async()=>{try{await c.handleToolStart?.(t,n,r,this._parentRunId,this.tags,this.metadata,o)}catch(u){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleToolStart: ${u}`),c.raiseError)throw u}},c.awaitHandlers)})),new Y_(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(t,n,r=Vn(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(c=>{if(!c.ignoreRetriever)return Lr(c)&&c._createRunForRetrieverStart(t,n,r,this._parentRunId,this.tags,this.metadata,o),We(async()=>{try{await c.handleRetrieverStart?.(t,n,r,this._parentRunId,this.tags,this.metadata,o)}catch(u){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleRetrieverStart: ${u}`),c.raiseError)throw u}},c.awaitHandlers)})),new K_(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(t,n,r,s,a){await Promise.all(this.handlers.map(i=>We(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(t,n,r,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}addHandler(t,n=!0){this.handlers.push(t),n&&this.inheritableHandlers.push(t)}removeHandler(t){this.handlers=this.handlers.filter(n=>n!==t),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==t)}setHandlers(t,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of t)this.addHandler(r,n)}addTags(t,n=!0){this.removeTags(t),this.tags.push(...t),n&&this.inheritableTags.push(...t)}removeTags(t){this.tags=this.tags.filter(n=>!t.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!t.includes(n))}addMetadata(t,n=!0){this.metadata={...this.metadata,...t},n&&(this.inheritableMetadata={...this.inheritableMetadata,...t})}removeMetadata(t){for(const n of Object.keys(t))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(t=[],n=!0){const r=new Ts(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);r.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(const s of t)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,n);return r}static fromHandlers(t){class n extends sa{name=Vn();constructor(){super(),Object.assign(this,t)}}const r=new this;return r.addHandler(new n),r}static configure(t,n,r,s,a,i,o){return this._configureSync(t,n,r,s,a,i,o)}static _configureSync(t,n,r,s,a,i,o){let c;(t||n)&&(Array.isArray(t)||!t?(c=new Ts,c.setHandlers(t?.map(Bs)??[],!0)):c=t,c=c.copy(Array.isArray(n)?n.map(Bs):n?.handlers,!1));const u=wn("LANGCHAIN_VERBOSE")==="true"||o?.verbose,l=ti.getTraceableRunTree()?.tracingEnabled??cx(),d=l||(wn("LANGCHAIN_TRACING")??!1);if(u||d){if(c||(c=new Ts),u&&!c.handlers.some(f=>f.name===Au.prototype.name)){const f=new Au;c.addHandler(f,!0)}if(d&&!c.handlers.some(f=>f.name==="langchain_tracer")&&l){const f=new ti;c.addHandler(f,!0)}if(l){const f=ti.getTraceableRunTree();f&&c._parentRunId===void 0&&(c._parentRunId=f.id,c.handlers.find(p=>p.name==="langchain_tracer")?.updateFromRunTree(f))}}for(const{contextVar:f,inheritable:h=!0,handlerClass:p,envVar:m}of lx()){const b=m&&wn(m)==="true"&&p;let _;const w=f!==void 0?J_(f):void 0;w&&__(w)?_=w:b&&(_=new p({})),_!==void 0&&(c||(c=new Ts),c.handlers.some(E=>E.name===_.name)||c.addHandler(_,h))}return(r||s)&&c&&(c.addTags(r??[]),c.addTags(s??[],!1)),(a||i)&&c&&(c.addMetadata(a??{}),c.addMetadata(i??{},!1)),c}};function Bs(e){return"name"in e?e:sa.fromMethods(e)}var Q_=class{getStore(){}run(e,t){return t()}enterWith(e){}};const fx=new Q_,Yh=Symbol.for("lc:child_config");var hx=class{getInstance(){return Us()??fx}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[Yh]}runWithConfig(e,t,n){const r=xt._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),a=s.getStore(),i=r?.getParentRunId(),o=r?.handlers?.find(u=>u?.name==="langchain_tracer");let c;return o&&i?c=o.getRunTreeWithTracingConfig(i):n||(c=new Tt({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Yh]:e}),a!==void 0&&a[Ns]!==void 0&&(c===void 0&&(c={}),c[Ns]=a[Ns]),s.run(c,t)}initializeGlobalInstance(e){Us()===void 0&&B0(e)}};const an=new hx;var px={};be(px,{AsyncLocalStorageProviderSingleton:()=>an,MockAsyncLocalStorage:()=>Q_,_CONTEXT_VARIABLES_KEY:()=>Ns});const Jc=25;async function Mt(e){return xt._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function wi(...e){const t={};for(const n of e.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")t[r]={...t[r],...n[r]};else if(r==="tags"){const s=t[r]??[];t[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")t[r]={...t[r],...n[r]};else if(r==="timeout")t.timeout===void 0?t.timeout=n.timeout:n.timeout!==void 0&&(t.timeout=Math.min(t.timeout,n.timeout));else if(r==="signal")t.signal===void 0?t.signal=n.signal:n.signal!==void 0&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,n.signal]):t.signal=n.signal);else if(r==="callbacks"){const s=t.callbacks,a=n.callbacks;if(Array.isArray(a))if(!s)t.callbacks=a;else if(Array.isArray(s))t.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(Bs(o),!0);t.callbacks=i}else if(a)if(!s)t.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(Bs(o),!0);t.callbacks=i}else t.callbacks=new xt(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=r;t[s]=n[s]??t[s]}return t}const mx=new Set(["string","number","boolean"]);function Te(e){const t=an.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){const{runId:r,runName:s,...a}=t;n=Object.entries(a).reduce((i,[o,c])=>(c!==void 0&&(i[o]=c),i),n)}if(e&&(n=Object.entries(e).reduce((r,[s,a])=>(a!==void 0&&(r[s]=a),r),n)),n?.configurable)for(const r of Object.keys(n.configurable))mx.has(typeof n.configurable[r])&&!n.metadata?.[r]&&(n.metadata||(n.metadata={}),n.metadata[r]=n.configurable[r]);if(n.timeout!==void 0){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const r=n.timeout,s=AbortSignal.timeout(r);n.metadata||(n.metadata={}),n.metadata.timeoutMs===void 0&&(n.metadata.timeoutMs=r),n.signal!==void 0?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,s])):n.signal=s,delete n.timeout}return n}function Le(e={},{callbacks:t,maxConcurrency:n,recursionLimit:r,runName:s,configurable:a,runId:i}={}){const o=Te(e);return t!==void 0&&(delete o.runName,o.callbacks=t),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}function Ln(e){if(e)return{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal,store:e.store}}async function jn(e,t){if(t===void 0)return e;let n;return Promise.race([e.catch(r=>{if(!t?.aborted)throw r}),new Promise((r,s)=>{n=()=>{s(Zs(t))},t.addEventListener("abort",n),t.aborted&&s(Zs(t))})]).finally(()=>t.removeEventListener("abort",n))}function Zs(e){return e?.reason instanceof Error?e.reason:typeof e?.reason=="string"?new Error(e.reason):new Error("Aborted")}var gx={};be(gx,{AsyncGeneratorWithSetup:()=>xr,IterableReadableStream:()=>on,atee:()=>ad,concat:()=>er,pipeGeneratorWithSetup:()=>ey});var on=class $u extends ReadableStream{reader;ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const t=await this.reader.read();return t.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:t.value}}catch(t){throw this.reader.releaseLock(),t}}async return(){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}return{done:!0,value:void 0}}async throw(t){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw t}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){const n=t.getReader();return new $u({start(r){return s();function s(){return n.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(t){return new $u({async pull(n){const{value:r,done:s}=await t.next();s&&n.close(),n.enqueue(r)},async cancel(n){await t.return(n)}})}};function ad(e,t=2){const n=Array.from({length:t},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const a=await e.next();for(const i of n)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function er(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if(typeof e=="string"&&typeof t=="string")return e+t;if(typeof e=="number"&&typeof t=="number")return e+t;if("concat"in e&&typeof e.concat=="function")return e.concat(t);if(typeof e=="object"&&typeof t=="object"){const n={...e};for(const[r,s]of Object.entries(t))r in n&&!Array.isArray(n[r])?n[r]=er(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof e} and ${typeof t}`)}var xr=class{generator;setup;config;signal;firstResult;firstResultUsed=!1;constructor(e){this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{an.runWithConfig(Ln(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(r=>t(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?an.runWithConfig(Ln(this.config),this.signal?async()=>jn(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function ey(e,t,n,r,...s){const a=new xr({generator:t,startSetup:n,signal:r}),i=await a.setup;return{output:e(a,i,...s),setup:i}}/*!
* https://github.com/Starcounter-Jack/JSON-Patch
* (c) 2017-2022 Joachim Wester
* MIT licensed
*/const _x=Object.prototype.hasOwnProperty;function Ru(e,t){return _x.call(e,t)}function Nu(e){if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(e);let t=[];for(let n in e)Ru(e,n)&&t.push(n);return t}function en(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Pu(e){let t=0;const n=e.length;let r;for(;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function $r(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function yx(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Mu(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(let n=0,r=e.length;n<r;n++)if(Mu(e[n]))return!0}else if(typeof e=="object"){const n=Nu(e),r=n.length;for(var t=0;t<r;t++)if(Mu(e[n[t]]))return!0}}return!1}function Qh(e,t){const n=[e];for(const r in t){const s=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}var wx=class extends Error{constructor(e,t,n,r,s){super(Qh(e,{name:t,index:n,operation:r,tree:s})),this.name=t,this.index=n,this.operation=r,this.tree=s,Object.setPrototypeOf(this,new.target.prototype),this.message=Qh(e,{name:t,index:n,operation:r,tree:s})}},ty={};be(ty,{JsonPatchError:()=>Be,_areEquals:()=>qs,applyOperation:()=>yr,applyPatch:()=>Jr,applyReducer:()=>Ex,deepClone:()=>bx,getValueByPointer:()=>bi,validate:()=>ny,validator:()=>vi});const Be=wx,bx=en;function Wc(e){return Object.getOwnPropertyNames(Object.prototype).includes(e)}const Fr={add:function(e,t,n){if(Wc(t))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){if(Wc(t))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){if(Wc(t))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){let r=bi(n,this.path);r&&(r=en(r));const s=yr(n,{op:"remove",path:this.from}).removed;return yr(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){const r=bi(n,this.from);return yr(n,{op:"add",path:this.path,value:en(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:qs(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}};var vx={add:function(e,t,n){return Pu(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fr.move,copy:Fr.copy,test:Fr.test,_get:Fr._get};function bi(e,t){if(t=="")return e;var n={op:"_get",path:t};return yr(e,n),n.value}function yr(e,t,n=!1,r=!0,s=!0,a=0){if(n&&(typeof n=="function"?n(t,0,e,t.path):vi(t,0)),t.path===""){let i={newDocument:e};if(t.op==="add")return i.newDocument=t.value,i;if(t.op==="replace")return i.newDocument=t.value,i.removed=e,i;if(t.op==="move"||t.op==="copy")return i.newDocument=bi(e,t.from),t.op==="move"&&(i.removed=e),i;if(t.op==="test"){if(i.test=qs(e,t.value),i.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}else{if(t.op==="remove")return i.removed=e,i.newDocument=null,i;if(t.op==="_get")return t.value=e,i;if(n)throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return i}}else{r||(e=en(e));const o=(t.path||"").split("/");let c=e,u=1,l=o.length,d,f,h;for(typeof n=="function"?h=n:h=vi;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=yx(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(c[f]===void 0?d=o.slice(0,u).join("/"):u==l-1&&(d=t.path),d!==void 0&&h(t,0,e,d)),u++,Array.isArray(c)){if(f==="-")f=c.length;else{if(n&&!Pu(f))throw new Be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Pu(f)&&(f=~~f)}if(u>=l){if(n&&t.op==="add"&&f>c.length)throw new Be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);const p=vx[t.op].call(t,c,f,e);if(p.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return p}}else if(u>=l){const p=Fr[t.op].call(t,c,f,e);if(p.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return p}if(c=c[f],n&&u<l&&(!c||typeof c!="object"))throw new Be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function Jr(e,t,n,r=!0,s=!0){if(n&&!Array.isArray(t))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=en(e));const a=new Array(t.length);for(let i=0,o=t.length;i<o;i++)a[i]=yr(e,t[i],n,!0,s,i),e=a[i].newDocument;return a.newDocument=e,a}function Ex(e,t,n){const r=yr(e,t);if(r.test===!1)throw new Be("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function vi(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Be("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Fr[e.op]){if(typeof e.path!="string")throw new Be("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Mu(e.value))throw new Be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var s=e.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new Be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var i={op:"_get",path:e.from,value:void 0},o=ny([i],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function ny(e,t,n){try{if(!Array.isArray(e))throw new Be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Jr(en(t),en(e),n||!0);else{n=n||vi;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(s){if(s instanceof Be)return s;throw s}}function qs(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),s,a,i;if(n&&r){if(a=e.length,a!=t.length)return!1;for(s=a;s--!==0;)if(!qs(e[s],t[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(e);if(a=o.length,a!==Object.keys(t).length)return!1;for(s=a;s--!==0;)if(!t.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!qs(e[i],t[i]))return!1;return!0}return e!==e&&t!==t}function ry(e,t,n,r,s){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=Nu(t),i=Nu(e),o=!1,c=i.length-1;c>=0;c--){var u=i[c],l=e[u];if(Ru(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var d=t[u];typeof l=="object"&&l!=null&&typeof d=="object"&&d!=null&&Array.isArray(l)===Array.isArray(d)?ry(l,d,n,r+"/"+$r(u),s):l!==d&&(s&&n.push({op:"test",path:r+"/"+$r(u),value:en(l)}),n.push({op:"replace",path:r+"/"+$r(u),value:en(d)}))}else Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+$r(u),value:en(l)}),n.push({op:"remove",path:r+"/"+$r(u)}),o=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!o&&a.length==i.length))for(var c=0;c<a.length;c++){var u=a[c];!Ru(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+$r(u),value:en(t[u])})}}}function id(e,t,n=!1){var r=[];return ry(e,t,r,"",n),r}({...ty});var Tx={};be(Tx,{LogStreamCallbackHandler:()=>ju,RunLog:()=>od,RunLogPatch:()=>$n,isLogStreamHandler:()=>sy});var $n=class{ops;constructor(e){this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),n=Jr({},t);return new od({ops:t,state:n[n.length-1].newDocument})}},od=class Lu extends $n{state;constructor(t){super(t),this.state=t.state}concat(t){const n=this.ops.concat(t.ops),r=Jr(this.state,t.ops);return new Lu({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(t){const n=Jr({},t.ops);return new Lu({ops:t.ops,state:n[n.length-1].newDocument})}};const sy=e=>e.name==="log_stream_tracer";async function ep(e,t){if(t==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=e;if(["retriever","llm","prompt"].includes(e.run_type))return n;if(!(Object.keys(n).length===1&&n?.input===""))return n.input}async function tp(e,t){const{outputs:n}=e;return t==="original"||["retriever","llm","prompt"].includes(e.run_type)?n:n!==void 0&&Object.keys(n).length===1&&n?.output!==void 0?n.output:n}function Sx(e){return e!==void 0&&e.message!==void 0}var ju=class extends cs{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;_schemaFormat="original";rootId;keyMapByRunId={};counterMapByRunName={};transformStream;writer;receiveStream;name="log_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=on.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(r=>this.includeTags?.includes(r))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(r=>!this.excludeTags?.includes(r))),n}async*tapOutputIterable(e,t){for await(const n of t){if(e!==this.rootId){const r=this.keyMapByRunId[e];r&&await this.writer.write(new $n({ops:[{op:"add",path:`/logs/${r}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new $n({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await ep(e,this._schemaFormat)),await this.writer.write(new $n({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await ep(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await tp(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const r=new $n({ops:n});await this.writer.write(r)}finally{if(e.id===this.rootId){const t=new $n({ops:[{op:"replace",path:"/final_output",value:await tp(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){const r=this.keyMapByRunId[e.id];if(r===void 0)return;const s=e.inputs.messages!==void 0;let a;s?Sx(n?.chunk)?a=n?.chunk:a=new Sn({id:`run-${e.id}`,content:t}):a=t;const i=new $n({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${r}/streamed_output/-`,value:a}]});await this.writer.write(i)}},xx={};be(xx,{ChatGenerationChunk:()=>Kr,GenerationChunk:()=>Wr,RUN_KEY:()=>Hs});const Hs="__run";var Wr=class ay{text;generationInfo;constructor(t){this.text=t.text,this.generationInfo=t.generationInfo}concat(t){return new ay({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},Kr=class iy extends Wr{message;constructor(t){super(t),this.message=t.message}concat(t){return new iy({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function La({name:e,serialized:t}){return e!==void 0?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}const kx=e=>e.name==="event_stream_tracer";var Ix=class extends cs{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;runInfoMap=new Map;tappedPromises=new Map;transformStream;writer;receiveStream;readableStreamClosed=!1;name="event_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream({flush:()=>{this.readableStreamClosed=!0}}),this.writer=this.transformStream.writable.getWriter(),this.receiveStream=on.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(r=>this.includeTags?.includes(r))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(r=>!this.excludeTags?.includes(r))),n}async*tapOutputIterable(e,t){const n=await t.next();if(n.done)return;const r=this.runInfoMap.get(e);if(r===void 0){yield n.value;return}function s(i,o){return i==="llm"&&typeof o=="string"?new Wr({text:o}):o}let a=this.tappedPromises.get(e);if(a===void 0){let i;a=new Promise(o=>{i=o}),this.tappedPromises.set(e,a);try{const o={event:`on_${r.runType}_stream`,run_id:e,name:r.name,tags:r.tags,metadata:r.metadata,data:{}};await this.send({...o,data:{chunk:s(r.runType,n.value)}},r),yield n.value;for await(const c of t)r.runType!=="tool"&&r.runType!=="retriever"&&await this.send({...o,data:{chunk:s(r.runType,c)}},r),yield c}finally{i?.()}}else{yield n.value;for await(const i of t)yield i}}async send(e,t){this.readableStreamClosed||this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){const t=La(e),n=e.inputs.messages!==void 0?"chat_model":"llm",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,r);const s=`on_${n}_start`;await this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onLLMNewToken(e,t,n){const r=this.runInfoMap.get(e.id);let s,a;if(r===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(r.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?s=new Sn({content:t,id:`run-${e.id}`}):s=n.chunk.message;else if(r.runType==="llm")a="on_llm_stream",n?.chunk===void 0?s=new Wr({text:t}):s=n.chunk;else throw new Error(`Unexpected run type ${r.runType}`);await this.send({event:a,data:{chunk:s},run_id:e.id,name:r.name,tags:r.tags,metadata:r.metadata},r)}}async onLLMEnd(e){const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const r=e.outputs?.generations;let s;if(t.runType==="chat_model"){for(const a of r??[]){if(s!==void 0)break;s=a[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")s={generations:r?.map(a=>a.map(i=>({text:i.text,generationInfo:i.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){const t=La(e),n=e.run_type??"chain",r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type};let s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},r.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,r.inputs=e.inputs.input):(s.input=e.inputs,r.inputs=e.inputs),this.runInfoMap.set(e.id,r),await this.send({event:`on_${n}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onChainEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const n=`on_${e.run_type}_end`,r=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:r};r.input&&Object.keys(r).length===1&&(a.input=r.input,t.inputs=r.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){const t=La(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onToolError(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);await this.sendEndEvent({event:"on_tool_error",data:{input:t.inputs,error:e.error},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){const t=La(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){const r=this.runInfoMap.get(n);if(r===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:r.tags,metadata:r.metadata,data:t},r)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};const Ox=Object.prototype.toString,Ax=e=>Ox.call(e)==="[object Error]",Cx=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function $x(e){if(!(e&&Ax(e)&&e.name==="TypeError"&&typeof e.message=="string"))return!1;const{message:n,stack:r}=e;return n==="Load failed"?r===void 0||"__sentry_captured__"in e:n.startsWith("error sending request for url")?!0:Cx.has(n)}function Rx(e){if(typeof e=="number"){if(e<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(e))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(e!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function ja(e,t,{min:n=0,allowInfinity:r=!1}={}){if(t!==void 0){if(typeof t!="number"||Number.isNaN(t))throw new TypeError(`Expected \`${e}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(t))throw new TypeError(`Expected \`${e}\` to be a finite number.`);if(t<n)throw new TypeError(`Expected \`${e}\` to be  ${n}.`)}}var Nx=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function Px(e,t){const n=Math.max(1,e+1),r=t.randomize?Math.random()+1:1;let s=Math.round(r*t.minTimeout*t.factor**(n-1));return s=Math.min(s,t.maxTimeout),s}function np(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function Mx({error:e,attemptNumber:t,retriesConsumed:n,startTime:r,options:s}){const a=e instanceof Error?e:new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(a instanceof Nx)throw a.originalError;const i=Number.isFinite(s.retries)?Math.max(0,s.retries-n):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:a,attemptNumber:t,retriesLeft:i,retriesConsumed:n});if(await s.onFailedAttempt(c),np(r,o)<=0)throw a;const u=await s.shouldConsumeRetry(c),l=np(r,o);if(l<=0||i<=0)throw a;if(a instanceof TypeError&&!$x(a)){if(u)throw a;return s.signal?.throwIfAborted(),!1}if(!await s.shouldRetry(c))throw a;if(!u)return s.signal?.throwIfAborted(),!1;const d=Px(n,s),f=Math.min(d,l);return f>0&&await new Promise((h,p)=>{const m=()=>{clearTimeout(b),s.signal?.removeEventListener("abort",m),p(s.signal.reason)},b=setTimeout(()=>{s.signal?.removeEventListener("abort",m),h()},f);s.unref&&b.unref?.(),s.signal?.addEventListener("abort",m,{once:!0})}),s.signal?.throwIfAborted(),!0}async function zu(e,t={}){if(t={...t},Rx(t.retries),Object.hasOwn(t,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=Number.POSITIVE_INFINITY,t.maxRetryTime??=Number.POSITIVE_INFINITY,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,ja("factor",t.factor,{min:0,allowInfinity:!1}),ja("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),ja("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),ja("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let n=0,r=0;const s=performance.now();for(;!Number.isFinite(t.retries)||r<=t.retries;){n++;try{t.signal?.throwIfAborted();const a=await e(n);return t.signal?.throwIfAborted(),a}catch(a){await Mx({error:a,attemptNumber:n,retriesConsumed:r,startTime:s,options:t})&&r++}}throw new Error("Retry attempts exhausted without throwing an error.")}var Lx={};be(Lx,{AsyncCaller:()=>oa});const jx=[400,401,402,403,404,405,406,407,409],zx=e=>{if(typeof e!="object"||e===null)return;if("message"in e&&typeof e.message=="string"&&(e.message.startsWith("Cancel")||e.message.startsWith("AbortError"))||"name"in e&&typeof e.name=="string"&&e.name==="AbortError"||"code"in e&&typeof e.code=="string"&&e.code==="ECONNABORTED")throw e;const t="response"in e&&typeof e.response=="object"&&e.response!==null&&"status"in e.response&&typeof e.response.status=="number"?e.response.status:void 0,n="status"in e&&typeof e.status=="number"?e.status:void 0,r=t??n;if(r&&jx.includes(+r))throw e;if(("error"in e&&typeof e.error=="object"&&e.error!==null&&"code"in e.error&&typeof e.error.code=="string"?e.error.code:void 0)==="insufficient_quota"){const a=new Error("message"in e&&typeof e.message=="string"?e.message:"Insufficient quota");throw a.name="InsufficientQuotaError",a}};var oa=class{maxConcurrency;maxRetries;onFailedAttempt;queue;constructor(e){this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??zx;const t="default"in Rn?Rn.default:Rn;this.queue=new t({concurrency:this.maxConcurrency})}async call(e,...t){return this.queue.add(()=>zu(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:({error:n})=>this.onFailedAttempt?.(n),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){if(e.signal){let r;return Promise.race([this.call(t,...n),new Promise((s,a)=>{r=()=>{a(Zs(e.signal))},e.signal?.addEventListener("abort",r)})]).finally(()=>{e.signal&&r&&e.signal.removeEventListener("abort",r)})}return this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}},oy=class extends cs{name="RootListenersTracer";rootId;config;argOnStart;argOnEnd;argOnError;constructor({config:e,onStart:t,onEnd:n,onError:r}){super({_awaitHandler:!0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=r}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function cd(e){return e?e.lc_runnable:!1}var Dx=class{includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;constructor(e){this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const r=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||r.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&r.every(s=>!this.excludeTags?.includes(s))),n}};const Ux=e=>btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function O(e,t,n){function r(o,c){if(o._zod||Object.defineProperty(o,"_zod",{value:{def:c,constr:i,traits:new Set},enumerable:!1}),o._zod.traits.has(e))return;o._zod.traits.add(e),t(o,c);const u=i.prototype,l=Object.keys(u);for(let d=0;d<l.length;d++){const f=l[d];f in o||(o[f]=u[f].bind(o))}}const s=n?.Parent??Object;class a extends s{}Object.defineProperty(a,"name",{value:e});function i(o){var c;const u=n?.Parent?new a:this;r(u,o),(c=u._zod).deferred??(c.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:o=>n?.Parent&&o instanceof n.Parent?!0:o?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class Hr extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class cy extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const uy={};function tr(e){return uy}function ly(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,s])=>t.indexOf(+r)===-1).map(([r,s])=>s)}function Du(e,t){return typeof t=="bigint"?t.toString():t}function lo(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ud(e){return e==null}function ld(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Fx(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let s=(r.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(r)){const c=r.match(/\d?e-(\d?)/);c?.[1]&&(s=Number.parseInt(c[1]))}const a=n>s?n:s,i=Number.parseInt(e.toFixed(a).replace(".","")),o=Number.parseInt(t.toFixed(a).replace(".",""));return i%o/10**a}const rp=Symbol("evaluating");function Oe(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==rp)return r===void 0&&(r=rp,r=n()),r},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function kr(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ir(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function sp(e){return JSON.stringify(e)}function Bx(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const dy="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Vs(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Zx=lo(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Xr(e){if(Vs(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Vs(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function fy(e){return Xr(e)?{...e}:Array.isArray(e)?[...e]:e}const qx=new Set(["string","number","symbol"]);function Yr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ut(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function ee(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Hx(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Vx={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Gx(e,t){const n=e._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const a=ir(e._zod.def,{get shape(){const i={};for(const o in t){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(i[o]=n.shape[o])}return kr(this,"shape",i),i},checks:[]});return ut(e,a)}function Jx(e,t){const n=e._zod.def,r=n.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const a=ir(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const o in t){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete i[o]}return kr(this,"shape",i),i},checks:[]});return ut(e,a)}function hy(e,t){if(!Xr(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0){const a=e._zod.def.shape;for(const i in t)if(Object.getOwnPropertyDescriptor(a,i)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=ir(e._zod.def,{get shape(){const a={...e._zod.def.shape,...t};return kr(this,"shape",a),a}});return ut(e,s)}function Wx(e,t){if(!Xr(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n=ir(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t};return kr(this,"shape",r),r}});return ut(e,n)}function Kx(e,t){const n=ir(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return kr(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return ut(e,n)}function py(e,t,n){const s=t._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const i=ir(t._zod.def,{get shape(){const o=t._zod.def.shape,c={...o};if(n)for(const u in n){if(!(u in o))throw new Error(`Unrecognized key: "${u}"`);n[u]&&(c[u]=e?new e({type:"optional",innerType:o[u]}):o[u])}else for(const u in o)c[u]=e?new e({type:"optional",innerType:o[u]}):o[u];return kr(this,"shape",c),c},checks:[]});return ut(t,i)}function Xx(e,t,n){const r=ir(t._zod.def,{get shape(){const s=t._zod.def.shape,a={...s};if(n)for(const i in n){if(!(i in a))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(a[i]=new e({type:"nonoptional",innerType:s[i]}))}else for(const i in s)a[i]=new e({type:"nonoptional",innerType:s[i]});return kr(this,"shape",a),a}});return ut(t,r)}function Br(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function Zr(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function za(e){return typeof e=="string"?e:e?.message}function nr(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const s=za(e.inst?._zod.def?.error?.(e))??za(t?.error?.(e))??za(n.customError?.(e))??za(n.localeError?.(e))??"Invalid input";r.message=s}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function dd(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Gs(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const my=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Du,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},gy=O("$ZodError",my),fo=O("$ZodError",my,{Parent:Error});function Yx(e,t=n=>n.message){const n={},r=[];for(const s of e.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):r.push(t(s));return{formErrors:r,fieldErrors:n}}function Qx(e,t=n=>n.message){const n={_errors:[]},r=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(i=>r({issues:i}));else if(a.code==="invalid_key")r({issues:a.issues});else if(a.code==="invalid_element")r({issues:a.issues});else if(a.path.length===0)n._errors.push(t(a));else{let i=n,o=0;for(;o<a.path.length;){const c=a.path[o];o===a.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(a))):i[c]=i[c]||{_errors:[]},i=i[c],o++}}};return r(e),n}function e1(e){const t=[],n=e.map(r=>typeof r=="object"?r.key:r);for(const r of n)typeof r=="number"?t.push(`[${r}]`):typeof r=="symbol"?t.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?t.push(`[${JSON.stringify(r)}]`):(t.length&&t.push("."),t.push(r));return t.join("")}function t1(e){const t=[],n=[...e.issues].sort((r,s)=>(r.path??[]).length-(s.path??[]).length);for(const r of n)t.push(` ${r.message}`),r.path?.length&&t.push(`   at ${e1(r.path)}`);return t.join(`
`)}const ho=e=>(t,n,r,s)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},a);if(i instanceof Promise)throw new Hr;if(i.issues.length){const o=new(s?.Err??e)(i.issues.map(c=>nr(c,a,tr())));throw dy(o,s?.callee),o}return i.value},po=ho(fo),mo=e=>async(t,n,r,s)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},a);if(i instanceof Promise&&(i=await i),i.issues.length){const o=new(s?.Err??e)(i.issues.map(c=>nr(c,a,tr())));throw dy(o,s?.callee),o}return i.value},_y=mo(fo),go=e=>(t,n,r)=>{const s=r?{...r,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new Hr;return a.issues.length?{success:!1,error:new(e??gy)(a.issues.map(i=>nr(i,s,tr())))}:{success:!0,data:a.value}},n1=go(fo),_o=e=>async(t,n,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(i=>nr(i,s,tr())))}:{success:!0,data:a.value}},r1=_o(fo),s1=e=>(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return ho(e)(t,n,s)},a1=e=>(t,n,r)=>ho(e)(t,n,r),i1=e=>async(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return mo(e)(t,n,s)},o1=e=>async(t,n,r)=>mo(e)(t,n,r),c1=e=>(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return go(e)(t,n,s)},u1=e=>(t,n,r)=>go(e)(t,n,r),l1=e=>async(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return _o(e)(t,n,s)},d1=e=>async(t,n,r)=>_o(e)(t,n,r),f1=/^[cC][^\s-]{8,}$/,h1=/^[0-9a-z]+$/,p1=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,m1=/^[0-9a-vA-V]{20}$/,g1=/^[A-Za-z0-9]{27}$/,_1=/^[a-zA-Z0-9_-]{21}$/,y1=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,w1=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ap=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,b1=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,v1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function E1(){return new RegExp(v1,"u")}const T1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,S1=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,x1=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,k1=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,I1=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,yy=/^[A-Za-z0-9_-]*$/,O1=/^\+[1-9]\d{6,14}$/,wy="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",A1=new RegExp(`^${wy}$`);function by(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function C1(e){return new RegExp(`^${by(e)}$`)}function $1(e){const t=by({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${wy}T(?:${r})$`)}const R1=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},N1=/^-?\d+$/,vy=/^-?\d+(?:\.\d+)?$/,P1=/^[^A-Z]*$/,M1=/^[^a-z]*$/,It=O("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Ey={number:"number",bigint:"bigint",object:"date"},Ty=O("$ZodCheckLessThan",(e,t)=>{It.init(e,t);const n=Ey[typeof t.value];e._zod.onattach.push(r=>{const s=r._zod.bag,a=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<a&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Sy=O("$ZodCheckGreaterThan",(e,t)=>{It.init(e,t);const n=Ey[typeof t.value];e._zod.onattach.push(r=>{const s=r._zod.bag,a=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>a&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),L1=O("$ZodCheckMultipleOf",(e,t)=>{It.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Fx(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),j1=O("$ZodCheckNumberFormat",(e,t)=>{It.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),r=n?"int":"number",[s,a]=Vx[t.format];e._zod.onattach.push(i=>{const o=i._zod.bag;o.format=t.format,o.minimum=s,o.maximum=a,n&&(o.pattern=N1)}),e._zod.check=i=>{const o=i.value;if(n){if(!Number.isInteger(o)){i.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:o,inst:e});return}if(!Number.isSafeInteger(o)){o>0?i.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort}):i.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,inclusive:!0,continue:!t.abort});return}}o<s&&i.issues.push({origin:"number",input:o,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),o>a&&i.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inclusive:!0,inst:e,continue:!t.abort})}}),z1=O("$ZodCheckMaxLength",(e,t)=>{var n;It.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!ud(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const s=r.value;if(s.length<=t.maximum)return;const i=dd(s);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),D1=O("$ZodCheckMinLength",(e,t)=>{var n;It.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!ud(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const s=r.value;if(s.length>=t.minimum)return;const i=dd(s);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),U1=O("$ZodCheckLengthEquals",(e,t)=>{var n;It.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!ud(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=r=>{const s=r.value,a=s.length;if(a===t.length)return;const i=dd(s),o=a>t.length;r.issues.push({origin:i,...o?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),yo=O("$ZodCheckStringFormat",(e,t)=>{var n,r;It.init(e,t),e._zod.onattach.push(s=>{const a=s._zod.bag;a.format=t.format,t.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),F1=O("$ZodCheckRegex",(e,t)=>{yo.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),B1=O("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=P1),yo.init(e,t)}),Z1=O("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=M1),yo.init(e,t)}),q1=O("$ZodCheckIncludes",(e,t)=>{It.init(e,t);const n=Yr(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),H1=O("$ZodCheckStartsWith",(e,t)=>{It.init(e,t);const n=new RegExp(`^${Yr(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),V1=O("$ZodCheckEndsWith",(e,t)=>{It.init(e,t);const n=new RegExp(`.*${Yr(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),G1=O("$ZodCheckOverwrite",(e,t)=>{It.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class J1{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(i=>i),s=Math.min(...r.map(i=>i.length-i.trimStart().length)),a=r.map(i=>i.slice(s)).map(i=>" ".repeat(this.indent*2)+i);for(const i of a)this.content.push(i)}compile(){const t=Function,n=this?.args,s=[...(this?.content??[""]).map(a=>`  ${a}`)];return new t(...n,s.join(`
`))}}const W1={major:4,minor:3,patch:6},Ze=O("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=W1;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const a of s._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,o,c)=>{let u=Br(i),l;for(const d of o){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(u)continue;const f=i.issues.length,h=d._zod.check(i);if(h instanceof Promise&&c?.async===!1)throw new Hr;if(l||h instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await h,i.issues.length!==f&&(u||(u=Br(i,f)))});else{if(i.issues.length===f)continue;u||(u=Br(i,f))}}return l?l.then(()=>i):i},a=(i,o,c)=>{if(Br(i))return i.aborted=!0,i;const u=s(o,r,c);if(u instanceof Promise){if(c.async===!1)throw new Hr;return u.then(l=>e._zod.parse(l,c))}return e._zod.parse(u,c)};e._zod.run=(i,o)=>{if(o.skipChecks)return e._zod.parse(i,o);if(o.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...o,skipChecks:!0});return u instanceof Promise?u.then(l=>a(l,i,o)):a(u,i,o)}const c=e._zod.parse(i,o);if(c instanceof Promise){if(o.async===!1)throw new Hr;return c.then(u=>s(u,r,o))}return s(c,r,o)}}Oe(e,"~standard",()=>({validate:s=>{try{const a=n1(e,s);return a.success?{value:a.data}:{issues:a.error?.issues}}catch{return r1(e,s).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}))}),fd=O("$ZodString",(e,t)=>{Ze.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??R1(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),ze=O("$ZodStringFormat",(e,t)=>{yo.init(e,t),fd.init(e,t)}),K1=O("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=w1),ze.init(e,t)}),X1=O("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ap(r))}else t.pattern??(t.pattern=ap());ze.init(e,t)}),Y1=O("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=b1),ze.init(e,t)}),Q1=O("$ZodURL",(e,t)=>{ze.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),s=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=s.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),ek=O("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=E1()),ze.init(e,t)}),tk=O("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=_1),ze.init(e,t)}),nk=O("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=f1),ze.init(e,t)}),rk=O("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=h1),ze.init(e,t)}),sk=O("$ZodULID",(e,t)=>{t.pattern??(t.pattern=p1),ze.init(e,t)}),ak=O("$ZodXID",(e,t)=>{t.pattern??(t.pattern=m1),ze.init(e,t)}),ik=O("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=g1),ze.init(e,t)}),ok=O("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=$1(t)),ze.init(e,t)}),ck=O("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=A1),ze.init(e,t)}),uk=O("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=C1(t)),ze.init(e,t)}),lk=O("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=y1),ze.init(e,t)}),dk=O("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=T1),ze.init(e,t),e._zod.bag.format="ipv4"}),fk=O("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=S1),ze.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),hk=O("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=x1),ze.init(e,t)}),pk=O("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=k1),ze.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[s,a]=r;if(!a)throw new Error;const i=Number(a);if(`${i}`!==a)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${s}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function xy(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const mk=O("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=I1),ze.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{xy(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function gk(e){if(!yy.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return xy(n)}const _k=O("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=yy),ze.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{gk(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),yk=O("$ZodE164",(e,t)=>{t.pattern??(t.pattern=O1),ze.init(e,t)});function wk(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const s=JSON.parse(atob(r));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const bk=O("$ZodJWT",(e,t)=>{ze.init(e,t),e._zod.check=n=>{wk(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),ky=O("$ZodNumber",(e,t)=>{Ze.init(e,t),e._zod.pattern=e._zod.bag.pattern??vy,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...a?{received:a}:{}}),n}}),vk=O("$ZodNumberFormat",(e,t)=>{j1.init(e,t),ky.init(e,t)}),Iy=O("$ZodUnknown",(e,t)=>{Ze.init(e,t),e._zod.parse=n=>n}),Oy=O("$ZodNever",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function ip(e,t,n){e.issues.length&&t.issues.push(...Zr(n,e.issues)),t.value[n]=e.value}const Ek=O("$ZodArray",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const a=[];for(let i=0;i<s.length;i++){const o=s[i],c=t.element._zod.run({value:o,issues:[]},r);c instanceof Promise?a.push(c.then(u=>ip(u,n,i))):ip(c,n,i)}return a.length?Promise.all(a).then(()=>n):n}});function Ei(e,t,n,r,s){if(e.issues.length){if(s&&!(n in r))return;t.issues.push(...Zr(n,e.issues))}e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Ay(e){const t=Object.keys(e.shape);for(const r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=Hx(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function Cy(e,t,n,r,s,a){const i=[],o=s.keySet,c=s.catchall._zod,u=c.def.type,l=c.optout==="optional";for(const d in t){if(o.has(d))continue;if(u==="never"){i.push(d);continue}const f=c.run({value:t[d],issues:[]},r);f instanceof Promise?e.push(f.then(h=>Ei(h,n,d,t,l))):Ei(f,n,d,t,l)}return i.length&&n.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const Tk=O("$ZodObject",(e,t)=>{if(Ze.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const o=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...o};return Object.defineProperty(t,"shape",{value:c}),c}})}const r=lo(()=>Ay(t));Oe(e._zod,"propValues",()=>{const o=t.shape,c={};for(const u in o){const l=o[u]._zod;if(l.values){c[u]??(c[u]=new Set);for(const d of l.values)c[u].add(d)}}return c});const s=Vs,a=t.catchall;let i;e._zod.parse=(o,c)=>{i??(i=r.value);const u=o.value;if(!s(u))return o.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),o;o.value={};const l=[],d=i.shape;for(const f of i.keys){const h=d[f],p=h._zod.optout==="optional",m=h._zod.run({value:u[f],issues:[]},c);m instanceof Promise?l.push(m.then(b=>Ei(b,o,f,u,p))):Ei(m,o,f,u,p)}return a?Cy(l,u,o,c,r.value,e):l.length?Promise.all(l).then(()=>o):o}}),Sk=O("$ZodObjectJIT",(e,t)=>{Tk.init(e,t);const n=e._zod.parse,r=lo(()=>Ay(t)),s=f=>{const h=new J1(["shape","payload","ctx"]),p=r.value,m=E=>{const x=sp(E);return`shape[${x}]._zod.run({ value: input[${x}], issues: [] }, ctx)`};h.write("const input = payload.value;");const b=Object.create(null);let _=0;for(const E of p.keys)b[E]=`key_${_++}`;h.write("const newResult = {};");for(const E of p.keys){const x=b[E],I=sp(E),j=f[E]?._zod?.optout==="optional";h.write(`const ${x} = ${m(E)};`),j?h.write(`
        if (${x}.issues.length) {
          if (${I} in input) {
            payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${I}, ...iss.path] : [${I}]
            })));
          }
        }
        
        if (${x}.value === undefined) {
          if (${I} in input) {
            newResult[${I}] = undefined;
          }
        } else {
          newResult[${I}] = ${x}.value;
        }
        
      `):h.write(`
        if (${x}.issues.length) {
          payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${I}, ...iss.path] : [${I}]
          })));
        }
        
        if (${x}.value === undefined) {
          if (${I} in input) {
            newResult[${I}] = undefined;
          }
        } else {
          newResult[${I}] = ${x}.value;
        }
        
      `)}h.write("payload.value = newResult;"),h.write("return payload;");const w=h.compile();return(E,x)=>w(f,E,x)};let a;const i=Vs,o=!uy.jitless,u=o&&Zx.value,l=t.catchall;let d;e._zod.parse=(f,h)=>{d??(d=r.value);const p=f.value;return i(p)?o&&u&&h?.async===!1&&h.jitless!==!0?(a||(a=s(t.shape)),f=a(f,h),l?Cy([],p,f,h,d,e):f):n(f,h):(f.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),f)}});function op(e,t,n,r){for(const a of e)if(a.issues.length===0)return t.value=a.value,t;const s=e.filter(a=>!Br(a));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(a=>a.issues.map(i=>nr(i,r,tr())))}),t)}const $y=O("$ZodUnion",(e,t)=>{Ze.init(e,t),Oe(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),Oe(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),Oe(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),Oe(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(a=>a._zod.pattern);return new RegExp(`^(${s.map(a=>ld(a.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(s,a)=>{if(n)return r(s,a);let i=!1;const o=[];for(const c of t.options){const u=c._zod.run({value:s.value,issues:[]},a);if(u instanceof Promise)o.push(u),i=!0;else{if(u.issues.length===0)return u;o.push(u)}}return i?Promise.all(o).then(c=>op(c,s,e,a)):op(o,s,e,a)}}),xk=O("$ZodDiscriminatedUnion",(e,t)=>{t.inclusive=!1,$y.init(e,t);const n=e._zod.parse;Oe(e._zod,"propValues",()=>{const s={};for(const a of t.options){const i=a._zod.propValues;if(!i||Object.keys(i).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(a)}"`);for(const[o,c]of Object.entries(i)){s[o]||(s[o]=new Set);for(const u of c)s[o].add(u)}}return s});const r=lo(()=>{const s=t.options,a=new Map;for(const i of s){const o=i._zod.propValues?.[t.discriminator];if(!o||o.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(const c of o){if(a.has(c))throw new Error(`Duplicate discriminator value "${String(c)}"`);a.set(c,i)}}return a});e._zod.parse=(s,a)=>{const i=s.value;if(!Vs(i))return s.issues.push({code:"invalid_type",expected:"object",input:i,inst:e}),s;const o=r.value.get(i?.[t.discriminator]);return o?o._zod.run(s,a):t.unionFallback?n(s,a):(s.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:i,path:[t.discriminator],inst:e}),s)}}),kk=O("$ZodIntersection",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{const s=n.value,a=t.left._zod.run({value:s,issues:[]},r),i=t.right._zod.run({value:s,issues:[]},r);return a instanceof Promise||i instanceof Promise?Promise.all([a,i]).then(([c,u])=>cp(n,c,u)):cp(n,a,i)}});function Uu(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Xr(e)&&Xr(t)){const n=Object.keys(t),r=Object.keys(e).filter(a=>n.indexOf(a)!==-1),s={...e,...t};for(const a of r){const i=Uu(e[a],t[a]);if(!i.valid)return{valid:!1,mergeErrorPath:[a,...i.mergeErrorPath]};s[a]=i.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const s=e[r],a=t[r],i=Uu(s,a);if(!i.valid)return{valid:!1,mergeErrorPath:[r,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function cp(e,t,n){const r=new Map;let s;for(const o of t.issues)if(o.code==="unrecognized_keys"){s??(s=o);for(const c of o.keys)r.has(c)||r.set(c,{}),r.get(c).l=!0}else e.issues.push(o);for(const o of n.issues)if(o.code==="unrecognized_keys")for(const c of o.keys)r.has(c)||r.set(c,{}),r.get(c).r=!0;else e.issues.push(o);const a=[...r].filter(([,o])=>o.l&&o.r).map(([o])=>o);if(a.length&&s&&e.issues.push({...s,keys:a}),Br(e))return e;const i=Uu(t.value,n.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const Ik=O("$ZodRecord",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{const s=n.value;if(!Xr(s))return n.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),n;const a=[],i=t.keyType._zod.values;if(i){n.value={};const o=new Set;for(const u of i)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){o.add(typeof u=="number"?u.toString():u);const l=t.valueType._zod.run({value:s[u],issues:[]},r);l instanceof Promise?a.push(l.then(d=>{d.issues.length&&n.issues.push(...Zr(u,d.issues)),n.value[u]=d.value})):(l.issues.length&&n.issues.push(...Zr(u,l.issues)),n.value[u]=l.value)}let c;for(const u in s)o.has(u)||(c=c??[],c.push(u));c&&c.length>0&&n.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:c})}else{n.value={};for(const o of Reflect.ownKeys(s)){if(o==="__proto__")continue;let c=t.keyType._zod.run({value:o,issues:[]},r);if(c instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof o=="string"&&vy.test(o)&&c.issues.length){const d=t.keyType._zod.run({value:Number(o),issues:[]},r);if(d instanceof Promise)throw new Error("Async schemas not supported in object keys currently");d.issues.length===0&&(c=d)}if(c.issues.length){t.mode==="loose"?n.value[o]=s[o]:n.issues.push({code:"invalid_key",origin:"record",issues:c.issues.map(d=>nr(d,r,tr())),input:o,path:[o],inst:e});continue}const l=t.valueType._zod.run({value:s[o],issues:[]},r);l instanceof Promise?a.push(l.then(d=>{d.issues.length&&n.issues.push(...Zr(o,d.issues)),n.value[c.value]=d.value})):(l.issues.length&&n.issues.push(...Zr(o,l.issues)),n.value[c.value]=l.value)}}return a.length?Promise.all(a).then(()=>n):n}}),Ok=O("$ZodEnum",(e,t)=>{Ze.init(e,t);const n=ly(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(s=>qx.has(typeof s)).map(s=>typeof s=="string"?Yr(s):s.toString()).join("|")})$`),e._zod.parse=(s,a)=>{const i=s.value;return r.has(i)||s.issues.push({code:"invalid_value",values:n,input:i,inst:e}),s}}),Ak=O("$ZodLiteral",(e,t)=>{if(Ze.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?Yr(r):r?Yr(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,s)=>{const a=r.value;return n.has(a)||r.issues.push({code:"invalid_value",values:t.values,input:a,inst:e}),r}}),Ck=O("$ZodTransform",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new cy(e.constructor.name);const s=t.transform(n.value,n);if(r.async)return(s instanceof Promise?s:Promise.resolve(s)).then(i=>(n.value=i,n));if(s instanceof Promise)throw new Hr;return n.value=s,n}});function up(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const wo=O("$ZodOptional",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Oe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Oe(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ld(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>up(a,n.value)):up(s,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),$k=O("$ZodExactOptional",(e,t)=>{wo.init(e,t),Oe(e._zod,"values",()=>t.innerType._zod.values),Oe(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(n,r)=>t.innerType._zod.run(n,r)}),Rk=O("$ZodNullable",(e,t)=>{Ze.init(e,t),Oe(e._zod,"optin",()=>t.innerType._zod.optin),Oe(e._zod,"optout",()=>t.innerType._zod.optout),Oe(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ld(n.source)}|null)$`):void 0}),Oe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Nk=O("$ZodDefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>lp(a,t)):lp(s,t)}});function lp(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Pk=O("$ZodPrefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Mk=O("$ZodNonOptional",(e,t)=>{Ze.init(e,t),Oe(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>dp(a,e)):dp(s,e)}});function dp(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Lk=O("$ZodCatch",(e,t)=>{Ze.init(e,t),Oe(e._zod,"optin",()=>t.innerType._zod.optin),Oe(e._zod,"optout",()=>t.innerType._zod.optout),Oe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(a=>(n.value=a.value,a.issues.length&&(n.value=t.catchValue({...n,error:{issues:a.issues.map(i=>nr(i,r,tr()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>nr(a,r,tr()))},input:n.value}),n.issues=[]),n)}}),jk=O("$ZodPipe",(e,t)=>{Ze.init(e,t),Oe(e._zod,"values",()=>t.in._zod.values),Oe(e._zod,"optin",()=>t.in._zod.optin),Oe(e._zod,"optout",()=>t.out._zod.optout),Oe(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const a=t.out._zod.run(n,r);return a instanceof Promise?a.then(i=>Da(i,t.in,r)):Da(a,t.in,r)}const s=t.in._zod.run(n,r);return s instanceof Promise?s.then(a=>Da(a,t.out,r)):Da(s,t.out,r)}});function Da(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const zk=O("$ZodReadonly",(e,t)=>{Ze.init(e,t),Oe(e._zod,"propValues",()=>t.innerType._zod.propValues),Oe(e._zod,"values",()=>t.innerType._zod.values),Oe(e._zod,"optin",()=>t.innerType?._zod?.optin),Oe(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(fp):fp(s)}});function fp(e){return e.value=Object.freeze(e.value),e}const Dk=O("$ZodCustom",(e,t)=>{It.init(e,t),Ze.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,s=t.fn(r);if(s instanceof Promise)return s.then(a=>hp(a,n,r,e));hp(s,n,r,e)}});function hp(e,t,n,r){if(!e){const s={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(s.params=r._zod.def.params),t.issues.push(Gs(s))}}var pp;class Uk{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];return this._map.set(t,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const s={...r,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Fk(){return new Uk}(pp=globalThis).__zod_globalRegistry??(pp.__zod_globalRegistry=Fk());const st=globalThis.__zod_globalRegistry;function Bk(e,t){return new e({type:"string",...ee(t)})}function Zk(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...ee(t)})}function mp(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...ee(t)})}function qk(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...ee(t)})}function Hk(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...ee(t)})}function Vk(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...ee(t)})}function Gk(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...ee(t)})}function Jk(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...ee(t)})}function Wk(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...ee(t)})}function Kk(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...ee(t)})}function Xk(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...ee(t)})}function Yk(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...ee(t)})}function Qk(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...ee(t)})}function eI(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...ee(t)})}function tI(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...ee(t)})}function nI(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...ee(t)})}function rI(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...ee(t)})}function sI(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...ee(t)})}function aI(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...ee(t)})}function iI(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...ee(t)})}function oI(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...ee(t)})}function cI(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...ee(t)})}function uI(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...ee(t)})}function lI(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...ee(t)})}function dI(e,t){return new e({type:"string",format:"date",check:"string_format",...ee(t)})}function fI(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...ee(t)})}function hI(e,t){return new e({type:"string",format:"duration",check:"string_format",...ee(t)})}function pI(e,t){return new e({type:"number",checks:[],...ee(t)})}function mI(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...ee(t)})}function Ry(e){return new e({type:"unknown"})}function Ny(e,t){return new e({type:"never",...ee(t)})}function gp(e,t){return new Ty({check:"less_than",...ee(t),value:e,inclusive:!1})}function Kc(e,t){return new Ty({check:"less_than",...ee(t),value:e,inclusive:!0})}function _p(e,t){return new Sy({check:"greater_than",...ee(t),value:e,inclusive:!1})}function Xc(e,t){return new Sy({check:"greater_than",...ee(t),value:e,inclusive:!0})}function yp(e,t){return new L1({check:"multiple_of",...ee(t),value:e})}function Py(e,t){return new z1({check:"max_length",...ee(t),maximum:e})}function Ti(e,t){return new D1({check:"min_length",...ee(t),minimum:e})}function My(e,t){return new U1({check:"length_equals",...ee(t),length:e})}function gI(e,t){return new F1({check:"string_format",format:"regex",...ee(t),pattern:e})}function _I(e){return new B1({check:"string_format",format:"lowercase",...ee(e)})}function yI(e){return new Z1({check:"string_format",format:"uppercase",...ee(e)})}function wI(e,t){return new q1({check:"string_format",format:"includes",...ee(t),includes:e})}function bI(e,t){return new H1({check:"string_format",format:"starts_with",...ee(t),prefix:e})}function vI(e,t){return new V1({check:"string_format",format:"ends_with",...ee(t),suffix:e})}function us(e){return new G1({check:"overwrite",tx:e})}function EI(e){return us(t=>t.normalize(e))}function TI(){return us(e=>e.trim())}function SI(){return us(e=>e.toLowerCase())}function xI(){return us(e=>e.toUpperCase())}function kI(){return us(e=>Bx(e))}function II(e,t,n){return new e({type:"array",element:t,...ee(n)})}function OI(e,t,n){return new e({type:"custom",check:"custom",fn:t,...ee(n)})}function AI(e){const t=CI(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Gs(r,n.value,t._zod.def));else{const s=r;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),n.issues.push(Gs(s))}},e(n.value,n)));return t}function CI(e,t){const n=new It({check:"custom",...ee(t)});return n._zod.check=e,n}function Si(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??st,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function Ne(e,t,n={path:[],schemaPath:[]}){var r;const s=e._zod.def,a=t.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;const i={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,i);const o=e._zod.toJSONSchema?.();if(o)i.schema=o;else{const l={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,i.schema,l);else{const f=i.schema,h=t.processors[s.type];if(!h)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);h(e,t,f,l)}const d=e._zod.parent;d&&(i.ref||(i.ref=d),Ne(d,t,l),t.seen.get(d).isParent=!0)}const c=t.metadataRegistry.get(e);return c&&Object.assign(i.schema,c),t.io==="input"&&gt(e)&&(delete i.schema.examples,delete i.schema.default),t.io==="input"&&i.schema._prefault&&((r=i.schema).default??(r.default=i.schema._prefault)),delete i.schema._prefault,t.seen.get(e).schema}function xi(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const i of e.seen.entries()){const o=e.metadataRegistry.get(i[0])?.id;if(o){const c=r.get(o);if(c&&c!==i[0])throw new Error(`Duplicate schema id "${o}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(o,i[0])}}const s=i=>{const o=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const d=e.external.registry.get(i[0])?.id,f=e.external.uri??(p=>p);if(d)return{ref:f(d)};const h=i[1].defId??i[1].schema.id??`schema${e.counter++}`;return i[1].defId=h,{defId:h,ref:`${f("__shared")}#/${o}/${h}`}}if(i[1]===n)return{ref:"#"};const u=`#/${o}/`,l=i[1].schema.id??`__schema${e.counter++}`;return{defId:l,ref:u+l}},a=i=>{if(i[1].schema.$ref)return;const o=i[1],{ref:c,defId:u}=s(i);o.def={...o.schema},u&&(o.defId=u);const l=o.schema;for(const d in l)delete l[d];l.$ref=c};if(e.cycles==="throw")for(const i of e.seen.entries()){const o=i[1];if(o.cycle)throw new Error(`Cycle detected: #/${o.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const i of e.seen.entries()){const o=i[1];if(t===i[0]){a(i);continue}if(e.external){const u=e.external.registry.get(i[0])?.id;if(t!==i[0]&&u){a(i);continue}}if(e.metadataRegistry.get(i[0])?.id){a(i);continue}if(o.cycle){a(i);continue}if(o.count>1&&e.reused==="ref"){a(i);continue}}}function ki(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=i=>{const o=e.seen.get(i);if(o.ref===null)return;const c=o.def??o.schema,u={...c},l=o.ref;if(o.ref=null,l){r(l);const f=e.seen.get(l),h=f.schema;if(h.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(c.allOf=c.allOf??[],c.allOf.push(h)):Object.assign(c,h),Object.assign(c,u),i._zod.parent===l)for(const m in c)m==="$ref"||m==="allOf"||m in u||delete c[m];if(h.$ref&&f.def)for(const m in c)m==="$ref"||m==="allOf"||m in f.def&&JSON.stringify(c[m])===JSON.stringify(f.def[m])&&delete c[m]}const d=i._zod.parent;if(d&&d!==l){r(d);const f=e.seen.get(d);if(f?.schema.$ref&&(c.$ref=f.schema.$ref,f.def))for(const h in c)h==="$ref"||h==="allOf"||h in f.def&&JSON.stringify(c[h])===JSON.stringify(f.def[h])&&delete c[h]}e.override({zodSchema:i,jsonSchema:c,path:o.path??[]})};for(const i of[...e.seen.entries()].reverse())r(i[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const i=e.external.registry.get(t)?.id;if(!i)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(i)}Object.assign(s,n.def??n.schema);const a=e.external?.defs??{};for(const i of e.seen.entries()){const o=i[1];o.def&&o.defId&&(a[o.defId]=o.def)}e.external||Object.keys(a).length>0&&(e.target==="draft-2020-12"?s.$defs=a:s.definitions=a);try{const i=JSON.parse(JSON.stringify(s));return Object.defineProperty(i,"~standard",{value:{...t["~standard"],jsonSchema:{input:Ii(t,"input",e.processors),output:Ii(t,"output",e.processors)}},enumerable:!1,writable:!1}),i}catch{throw new Error("Error converting schema to JSON.")}}function gt(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const r=e._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return gt(r.element,n);if(r.type==="set")return gt(r.valueType,n);if(r.type==="lazy")return gt(r.getter(),n);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return gt(r.innerType,n);if(r.type==="intersection")return gt(r.left,n)||gt(r.right,n);if(r.type==="record"||r.type==="map")return gt(r.keyType,n)||gt(r.valueType,n);if(r.type==="pipe")return gt(r.in,n)||gt(r.out,n);if(r.type==="object"){for(const s in r.shape)if(gt(r.shape[s],n))return!0;return!1}if(r.type==="union"){for(const s of r.options)if(gt(s,n))return!0;return!1}if(r.type==="tuple"){for(const s of r.items)if(gt(s,n))return!0;return!!(r.rest&&gt(r.rest,n))}return!1}const $I=(e,t={})=>n=>{const r=Si({...n,processors:t});return Ne(e,r),xi(r,e),ki(r,e)},Ii=(e,t,n={})=>r=>{const{libraryOptions:s,target:a}=r??{},i=Si({...s??{},target:a,io:t,processors:n});return Ne(e,i),xi(i,e),ki(i,e)},RI={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Ly=(e,t,n,r)=>{const s=n;s.type="string";const{minimum:a,maximum:i,format:o,patterns:c,contentEncoding:u}=e._zod.bag;if(typeof a=="number"&&(s.minLength=a),typeof i=="number"&&(s.maxLength=i),o&&(s.format=RI[o]??o,s.format===""&&delete s.format,o==="time"&&delete s.format),u&&(s.contentEncoding=u),c&&c.size>0){const l=[...c];l.length===1?s.pattern=l[0].source:l.length>1&&(s.allOf=[...l.map(d=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:d.source}))])}},jy=(e,t,n,r)=>{const s=n,{minimum:a,maximum:i,format:o,multipleOf:c,exclusiveMaximum:u,exclusiveMinimum:l}=e._zod.bag;typeof o=="string"&&o.includes("int")?s.type="integer":s.type="number",typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=l,s.exclusiveMinimum=!0):s.exclusiveMinimum=l),typeof a=="number"&&(s.minimum=a,typeof l=="number"&&t.target!=="draft-04"&&(l>=a?delete s.minimum:delete s.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=u,s.exclusiveMaximum=!0):s.exclusiveMaximum=u),typeof i=="number"&&(s.maximum=i,typeof u=="number"&&t.target!=="draft-04"&&(u<=i?delete s.maximum:delete s.exclusiveMaximum)),typeof c=="number"&&(s.multipleOf=c)},NI=(e,t,n,r)=>{n.type="boolean"},PI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema")},MI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema")},LI=(e,t,n,r)=>{t.target==="openapi-3.0"?(n.type="string",n.nullable=!0,n.enum=[null]):n.type="null"},jI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema")},zI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema")},zy=(e,t,n,r)=>{n.not={}},DI=(e,t,n,r)=>{},Dy=(e,t,n,r)=>{},UI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},Uy=(e,t,n,r)=>{const s=e._zod.def,a=ly(s.entries);a.every(i=>typeof i=="number")&&(n.type="number"),a.every(i=>typeof i=="string")&&(n.type="string"),n.enum=a},Fy=(e,t,n,r)=>{const s=e._zod.def,a=[];for(const i of s.values)if(i===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof i=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");a.push(Number(i))}else a.push(i);if(a.length!==0)if(a.length===1){const i=a[0];n.type=i===null?"null":typeof i,t.target==="draft-04"||t.target==="openapi-3.0"?n.enum=[i]:n.const=i}else a.every(i=>typeof i=="number")&&(n.type="number"),a.every(i=>typeof i=="string")&&(n.type="string"),a.every(i=>typeof i=="boolean")&&(n.type="boolean"),a.every(i=>i===null)&&(n.type="null"),n.enum=a},FI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema")},BI=(e,t,n,r)=>{const s=n,a=e._zod.pattern;if(!a)throw new Error("Pattern not found in template literal");s.type="string",s.pattern=a.source},ZI=(e,t,n,r)=>{const s=n,a={type:"string",format:"binary",contentEncoding:"binary"},{minimum:i,maximum:o,mime:c}=e._zod.bag;i!==void 0&&(a.minLength=i),o!==void 0&&(a.maxLength=o),c?c.length===1?(a.contentMediaType=c[0],Object.assign(s,a)):(Object.assign(s,a),s.anyOf=c.map(u=>({contentMediaType:u}))):Object.assign(s,a)},qI=(e,t,n,r)=>{n.type="boolean"},By=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},HI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema")},Zy=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},VI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema")},GI=(e,t,n,r)=>{if(t.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema")},qy=(e,t,n,r)=>{const s=n,a=e._zod.def,{minimum:i,maximum:o}=e._zod.bag;typeof i=="number"&&(s.minItems=i),typeof o=="number"&&(s.maxItems=o),s.type="array",s.items=Ne(a.element,t,{...r,path:[...r.path,"items"]})},Hy=(e,t,n,r)=>{const s=n,a=e._zod.def;s.type="object",s.properties={};const i=a.shape;for(const u in i)s.properties[u]=Ne(i[u],t,{...r,path:[...r.path,"properties",u]});const o=new Set(Object.keys(i)),c=new Set([...o].filter(u=>{const l=a.shape[u]._zod;return t.io==="input"?l.optin===void 0:l.optout===void 0}));c.size>0&&(s.required=Array.from(c)),a.catchall?._zod.def.type==="never"?s.additionalProperties=!1:a.catchall?a.catchall&&(s.additionalProperties=Ne(a.catchall,t,{...r,path:[...r.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},Vy=(e,t,n,r)=>{const s=e._zod.def,a=s.inclusive===!1,i=s.options.map((o,c)=>Ne(o,t,{...r,path:[...r.path,a?"oneOf":"anyOf",c]}));a?n.oneOf=i:n.anyOf=i},Gy=(e,t,n,r)=>{const s=e._zod.def,a=Ne(s.left,t,{...r,path:[...r.path,"allOf",0]}),i=Ne(s.right,t,{...r,path:[...r.path,"allOf",1]}),o=u=>"allOf"in u&&Object.keys(u).length===1,c=[...o(a)?a.allOf:[a],...o(i)?i.allOf:[i]];n.allOf=c},JI=(e,t,n,r)=>{const s=n,a=e._zod.def;s.type="array";const i=t.target==="draft-2020-12"?"prefixItems":"items",o=t.target==="draft-2020-12"||t.target==="openapi-3.0"?"items":"additionalItems",c=a.items.map((f,h)=>Ne(f,t,{...r,path:[...r.path,i,h]})),u=a.rest?Ne(a.rest,t,{...r,path:[...r.path,o,...t.target==="openapi-3.0"?[a.items.length]:[]]}):null;t.target==="draft-2020-12"?(s.prefixItems=c,u&&(s.items=u)):t.target==="openapi-3.0"?(s.items={anyOf:c},u&&s.items.anyOf.push(u),s.minItems=c.length,u||(s.maxItems=c.length)):(s.items=c,u&&(s.additionalItems=u));const{minimum:l,maximum:d}=e._zod.bag;typeof l=="number"&&(s.minItems=l),typeof d=="number"&&(s.maxItems=d)},Jy=(e,t,n,r)=>{const s=n,a=e._zod.def;s.type="object";const i=a.keyType,c=i._zod.bag?.patterns;if(a.mode==="loose"&&c&&c.size>0){const l=Ne(a.valueType,t,{...r,path:[...r.path,"patternProperties","*"]});s.patternProperties={};for(const d of c)s.patternProperties[d.source]=l}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(s.propertyNames=Ne(a.keyType,t,{...r,path:[...r.path,"propertyNames"]})),s.additionalProperties=Ne(a.valueType,t,{...r,path:[...r.path,"additionalProperties"]});const u=i._zod.values;if(u){const l=[...u].filter(d=>typeof d=="string"||typeof d=="number");l.length>0&&(s.required=l)}},Wy=(e,t,n,r)=>{const s=e._zod.def,a=Ne(s.innerType,t,r),i=t.seen.get(e);t.target==="openapi-3.0"?(i.ref=s.innerType,n.nullable=!0):n.anyOf=[a,{type:"null"}]},Ky=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType},Xy=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType,n.default=JSON.parse(JSON.stringify(s.defaultValue))},Yy=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType,t.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},Qy=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType;let i;try{i=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=i},ew=(e,t,n,r)=>{const s=e._zod.def,a=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;Ne(a,t,r);const i=t.seen.get(e);i.ref=a},tw=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType,n.readOnly=!0},WI=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType},hd=(e,t,n,r)=>{const s=e._zod.def;Ne(s.innerType,t,r);const a=t.seen.get(e);a.ref=s.innerType},KI=(e,t,n,r)=>{const s=e._zod.innerType;Ne(s,t,r);const a=t.seen.get(e);a.ref=s},wp={string:Ly,number:jy,boolean:NI,bigint:PI,symbol:MI,null:LI,undefined:jI,void:zI,never:zy,any:DI,unknown:Dy,date:UI,enum:Uy,literal:Fy,nan:FI,template_literal:BI,file:ZI,success:qI,custom:By,function:HI,transform:Zy,map:VI,set:GI,array:qy,object:Hy,union:Vy,intersection:Gy,tuple:JI,record:Jy,nullable:Wy,nonoptional:Ky,default:Xy,prefault:Yy,catch:Qy,pipe:ew,readonly:tw,promise:WI,optional:hd,lazy:KI};function Fu(e,t){if("_idmap"in e){const r=e,s=Si({...t,processors:wp}),a={};for(const c of r._idmap.entries()){const[u,l]=c;Ne(l,s)}const i={},o={registry:r,uri:t?.uri,defs:a};s.external=o;for(const c of r._idmap.entries()){const[u,l]=c;xi(s,l),i[u]=ki(s,l)}if(Object.keys(a).length>0){const c=s.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[c]:a}}return{schemas:i}}const n=Si({...t,processors:wp});return Ne(e,n),xi(n,e),ki(n,e)}function De(e){if(typeof e!="object"||e===null)return!1;const t=e;if(!("_zod"in t))return!1;const n=t._zod;return typeof n=="object"&&n!==null&&"def"in n}function Xe(e){if(typeof e!="object"||e===null)return!1;const t=e;if(!("_def"in t)||"_zod"in t)return!1;const n=t._def;return typeof n=="object"&&n!=null&&"typeName"in n}function XI(e){return De(e)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),Xe(e)}function yn(e){return!e||typeof e!="object"||Array.isArray(e)?!1:!!(De(e)||Xe(e))}function nw(e){return typeof e=="object"&&e!==null&&"_def"in e&&typeof e._def=="object"&&e._def!==null&&"typeName"in e._def&&e._def.typeName==="ZodLiteral"}function rw(e){return De(e)?typeof e=="object"&&e!==null&&"_zod"in e&&typeof e._zod=="object"&&e._zod!==null&&"def"in e._zod&&typeof e._zod.def=="object"&&e._zod.def!==null&&"type"in e._zod.def&&e._zod.def.type==="literal":!1}function YI(e){return!!(nw(e)||rw(e))}async function sw(e,t){if(De(e))try{return{success:!0,data:await _y(e,t)}}catch(n){return{success:!1,error:n}}if(Xe(e))return await e.safeParseAsync(t);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function bo(e,t){if(De(e))return await _y(e,t);if(Xe(e))return await e.parseAsync(t);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function QI(e,t){if(De(e))try{return{success:!0,data:po(e,t)}}catch(n){return{success:!1,error:n}}if(Xe(e))return e.safeParse(t);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function eO(e,t){if(De(e))return po(e,t);if(Xe(e))return e.parse(t);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function vo(e){if(De(e))return st.get(e)?.description;if(Xe(e)||"description"in e&&typeof e.description=="string")return e.description}function tO(e){if(!yn(e))return!1;if(Xe(e)){const t=e._def;if(t.typeName==="ZodObject"){const n=e;return!n.shape||Object.keys(n.shape).length===0}if(t.typeName==="ZodRecord")return!0}if(De(e)){const t=e._zod.def;if(t.type==="object"){const n=e;return!n.shape||Object.keys(n.shape).length===0}if(t.type==="record")return!0}return typeof e=="object"&&e!==null&&!("shape"in e)}function pd(e){return yn(e)?Xe(e)?e._def.typeName==="ZodString":De(e)?e._zod.def.type==="string":!1:!1}function md(e){return typeof e=="object"&&e!==null&&"_def"in e&&typeof e._def=="object"&&e._def!==null&&"typeName"in e._def&&e._def.typeName==="ZodObject"}function bn(e){return De(e)?typeof e=="object"&&e!==null&&"_zod"in e&&typeof e._zod=="object"&&e._zod!==null&&"def"in e._zod&&typeof e._zod.def=="object"&&e._zod.def!==null&&"type"in e._zod.def&&e._zod.def.type==="object":!1}function Eo(e){return De(e)?typeof e=="object"&&e!==null&&"_zod"in e&&typeof e._zod=="object"&&e._zod!==null&&"def"in e._zod&&typeof e._zod.def=="object"&&e._zod.def!==null&&"type"in e._zod.def&&e._zod.def.type==="array":!1}function aw(e){return De(e)?typeof e=="object"&&e!==null&&"_zod"in e&&typeof e._zod=="object"&&e._zod!==null&&"def"in e._zod&&typeof e._zod.def=="object"&&e._zod.def!==null&&"type"in e._zod.def&&e._zod.def.type==="optional":!1}function iw(e){return De(e)?typeof e=="object"&&e!==null&&"_zod"in e&&typeof e._zod=="object"&&e._zod!==null&&"def"in e._zod&&typeof e._zod.def=="object"&&e._zod.def!==null&&"type"in e._zod.def&&e._zod.def.type==="nullable":!1}function nO(e){return!!(md(e)||bn(e))}function Bu(e){if(Xe(e))return e.shape;if(De(e))return e._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function rO(e,t){if(Xe(e))return e.extend(t);if(De(e))return hy(e,t);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function sO(e){if(Xe(e))return e.partial();if(De(e))return py(wo,e,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Oi(e,t=!1){if(Xe(e))return e.strict();if(bn(e)){const n=e._zod.def.shape;if(t)for(const[a,i]of Object.entries(e._zod.def.shape)){if(bn(i)){const c=Oi(i,t);n[a]=c}else if(Eo(i)){let c=i._zod.def.element;bn(c)&&(c=Oi(c,t)),n[a]=ut(i,{...i._zod.def,element:c})}else n[a]=i;const o=st.get(i);o&&st.add(n[a],o)}const r=ut(e,{...e._zod.def,shape:n,catchall:Ny(Oy)}),s=st.get(e);return s&&st.add(r,s),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Zu(e,t=!1){if(md(e))return e.passthrough();if(bn(e)){const n=e._zod.def.shape;if(t)for(const[a,i]of Object.entries(e._zod.def.shape)){if(bn(i)){const c=Zu(i,t);n[a]=c}else if(Eo(i)){let c=i._zod.def.element;bn(c)&&(c=Zu(c,t)),n[a]=ut(i,{...i._zod.def,element:c})}else n[a]=i;const o=st.get(i);o&&st.add(n[a],o)}const r=ut(e,{...e._zod.def,shape:n,catchall:Ry(Iy)}),s=st.get(e);return s&&st.add(r,s),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function aO(e){if(Xe(e))try{const t=e.parse(void 0);return()=>t}catch{return}if(De(e))try{const t=po(e,void 0);return()=>t}catch{return}}function iO(e){return Xe(e)&&"typeName"in e._def&&e._def.typeName==="ZodEffects"}function oO(e){return De(e)&&e._zod.def.type==="pipe"}function lr(e,t,n){const r=n.get(e);if(r!==void 0)return r;if(Xe(e))return iO(e)?lr(e._def.schema,t,n):e;if(De(e)){let s=e;if(oO(e)&&(s=lr(e._zod.def.in,t,n)),t){if(bn(s)){const i={};for(const[o,c]of Object.entries(s._zod.def.shape))i[o]=lr(c,t,n);s=ut(s,{...s._zod.def,shape:i})}else if(Eo(s)){const i=lr(s._zod.def.element,t,n);s=ut(s,{...s._zod.def,element:i})}else if(aw(s)){const i=lr(s._zod.def.innerType,t,n);s=ut(s,{...s._zod.def,innerType:i})}else if(iw(s)){const i=lr(s._zod.def.innerType,t,n);s=ut(s,{...s._zod.def,innerType:i})}}const a=st.get(e);return a&&st.add(s,a),n.set(e,s),s}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function ow(e,t=!1){return lr(e,t,new WeakMap)}function cO(e,t){if(Xe(e)){const n=Bu(e),r={};for(const[s,a]of Object.entries(n))t(s,a)?r[s]=a.optional():r[s]=a;return e.extend(r)}if(De(e)){const n=Bu(e),r={...e._zod.def.shape};for(const[i,o]of Object.entries(n))t(i,o)&&(r[i]=new wo({type:"optional",innerType:o}));const s=ut(e,{...e._zod.def,shape:r}),a=st.get(e);return a&&st.add(s,a),s}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function cw(e){return e instanceof Error&&(e.constructor.name==="ZodError"||e.constructor.name==="$ZodError")}function Yc(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}const uO=["*","_","`"];function lO(e){let t="";for(const[n,r]of Object.entries(e))t+=`	classDef ${n} ${r};
`;return t}function dO(e,t,n){const{firstNode:r,lastNode:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:c=9}=n??{};let u=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){const p="default",m={[p]:"{0}({1})"};r!==void 0&&(m[r]="{0}([{1}]):::first"),s!==void 0&&(m[s]="{0}([{1}]):::last");for(const[b,_]of Object.entries(e)){const w=_.name.split(":").pop()??"";let x=uO.some(P=>w.startsWith(P)&&w.endsWith(P))?`<p>${w}</p>`:w;Object.keys(_.metadata??{}).length&&(x+=`<hr/><small><em>${Object.entries(_.metadata??{}).map(([P,j])=>`${P} = ${j}`).join(`
`)}</em></small>`);const I=(m[b]??m[p]).replace("{0}",Yc(b)).replace("{1}",x);u+=`	${I}
`}}const l={};for(const p of t){const m=p.source.split(":"),b=p.target.split(":"),_=m.filter((w,E)=>w===b[E]).join(":");l[_]||(l[_]=[]),l[_].push(p)}const d=new Set;function f(p){return[...p].sort((m,b)=>m.split(":").length-b.split(":").length)}function h(p,m){const b=p.length===1&&p[0].source===p[0].target;if(m&&!b){const w=m.split(":").pop();if(d.has(m))throw new Error(`Found duplicate subgraph '${w}' at '${m} -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(m),u+=`	subgraph ${w}
`}const _=f(Object.keys(l).filter(w=>w.startsWith(`${m}:`)&&w!==m&&w.split(":").length===m.split(":").length+1));for(const w of _)h(l[w],w);for(const w of p){const{source:E,target:x,data:I,conditional:P}=w;let j="";if(I!==void 0){let v=I;const oe=v.split(" ");oe.length>c&&(v=Array.from({length:Math.ceil(oe.length/c)},(le,K)=>oe.slice(K*c,(K+1)*c).join(" ")).join("&nbsp;<br>&nbsp;")),j=P?` -. &nbsp;${v}&nbsp; .-> `:` -- &nbsp;${v}&nbsp; --> `}else j=P?" -.-> ":" --> ";u+=`	${Yc(E)}${j}${Yc(x)};
`}m&&!b&&(u+=`	end
`)}h(l[""]??[],"");for(const p in l)!p.includes(":")&&p!==""&&h(l[p],p);return i&&(u+=lO(a??{})),u}async function fO(e,t){let n=t?.backgroundColor??"white";const r=t?.imageType??"png",s=Ux(e);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const a=`https://mermaid.ink/img/${s}?bgColor=${n}&type=${r}`,i=await fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}const hO=Symbol("Let zodToJsonSchema decide on which parser to use"),pO={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},mO=e=>({...pO,...e}),gO=e=>{const t=mO(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}},uw=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};function kt(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?uw(t,e.currentPath):t.join("/")}}function lw(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ae(e,t,n,r,s){e[t]=n,lw(e,t,r,s)}var Se;(function(e){e.assertEqual=s=>{};function t(s){}e.assertIs=t;function n(s){throw new Error}e.assertNever=n,e.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},e.getValidEnumValues=s=>{const a=e.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return e.objectValues(i)},e.objectValues=s=>e.objectKeys(s).map(function(a){return s[a]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},e.find=(s,a)=>{for(const i of s)if(a(i))return i},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}e.joinValues=r,e.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Se||(Se={}));var bp;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(bp||(bp={}));const V=Se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Gn=e=>{switch(typeof e){case"undefined":return V.undefined;case"string":return V.string;case"number":return Number.isNaN(e)?V.nan:V.number;case"boolean":return V.boolean;case"function":return V.function;case"bigint":return V.bigint;case"symbol":return V.symbol;case"object":return Array.isArray(e)?V.array:e===null?V.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?V.promise:typeof Map<"u"&&e instanceof Map?V.map:typeof Set<"u"&&e instanceof Set?V.set:typeof Date<"u"&&e instanceof Date?V.date:V.object;default:return V.unknown}},R=Se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class zn extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(a){return a.message},r={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let o=r,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(i))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(this),r}static assert(t){if(!(t instanceof zn))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n=Object.create(null),r=[];for(const s of this.issues)if(s.path.length>0){const a=s.path[0];n[a]=n[a]||[],n[a].push(t(s))}else r.push(t(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}zn.create=e=>new zn(e);const qu=(e,t)=>{let n;switch(e.code){case R.invalid_type:e.received===V.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case R.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Se.jsonStringifyReplacer)}`;break;case R.unrecognized_keys:n=`Unrecognized key(s) in object: ${Se.joinValues(e.keys,", ")}`;break;case R.invalid_union:n="Invalid input";break;case R.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Se.joinValues(e.options)}`;break;case R.invalid_enum_value:n=`Invalid enum value. Expected ${Se.joinValues(e.options)}, received '${e.received}'`;break;case R.invalid_arguments:n="Invalid function arguments";break;case R.invalid_return_type:n="Invalid function return type";break;case R.invalid_date:n="Invalid date";break;case R.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Se.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case R.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case R.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case R.custom:n="Invalid input";break;case R.invalid_intersection_types:n="Intersection results could not be merged";break;case R.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case R.not_finite:n="Number must be finite";break;default:n=t.defaultError,Se.assertNever(e)}return{message:n}};let _O=qu;function yO(){return _O}const wO=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const c=r.filter(u=>!!u).slice().reverse();for(const u of c)o=u(i,{data:t,defaultError:o}).message;return{...s,path:a,message:o}};function F(e,t){const n=yO(),r=wO({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===qu?void 0:qu].filter(s=>!!s)});e.common.issues.push(r)}class Lt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const s of n){if(s.status==="aborted")return pe;s.status==="dirty"&&t.dirty(),r.push(s.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const s of n){const a=await s.key,i=await s.value;r.push({key:a,value:i})}return Lt.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return pe;a.status==="dirty"&&t.dirty(),i.status==="dirty"&&t.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:t.value,value:r}}}const pe=Object.freeze({status:"aborted"}),Ss=e=>({status:"dirty",value:e}),Ft=e=>({status:"valid",value:e}),vp=e=>e.status==="aborted",Ep=e=>e.status==="dirty",Qr=e=>e.status==="valid",Ai=e=>typeof Promise<"u"&&e instanceof Promise;var J;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(J||(J={}));class rr{constructor(t,n,r,s){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Tp=(e,t)=>{if(Qr(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new zn(e.common.issues);return this._error=n,this._error}}};function ye(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(i,o)=>{const{message:c}=e;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:c??n??o.defaultError}},description:s}}let ve=class{get description(){return this._def.description}_getType(t){return Gn(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Gn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Lt,ctx:{common:t.parent.common,data:t.data,parsedType:Gn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(Ai(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Gn(t)},s=this._parseSync({data:t,path:r.path,parent:r});return Tp(r,s)}"~validate"(t){const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Gn(t)};if(!this["~standard"].async)try{const r=this._parseSync({data:t,path:[],parent:n});return Qr(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(r=>Qr(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Gn(t)},s=this._parse({data:t,path:r.path,parent:r}),a=await(Ai(s)?s:Promise.resolve(s));return Tp(r,a)}refine(t,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=t(s),o=()=>a.addIssue({code:R.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(t,n){return this._refinement((r,s)=>t(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(t){return new ts({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Xn.create(this,this._def)}nullable(){return ns.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return es.create(this)}promise(){return Ni.create(this,this._def)}or(t){return $i.create([this,t],this._def)}and(t){return Ri.create(this,t,this._def)}transform(t){return new ts({...ye(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new Ku({...ye(this._def),innerType:this,defaultValue:n,typeName:k.ZodDefault})}brand(){return new BO({typeName:k.ZodBranded,type:this,...ye(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new Xu({...ye(this._def),innerType:this,catchValue:n,typeName:k.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return _d.create(this,t)}readonly(){return Yu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const bO=/^c[^\s-]{8,}$/i,vO=/^[0-9a-z]+$/,EO=/^[0-9A-HJKMNP-TV-Z]{26}$/i,TO=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,SO=/^[a-z0-9_-]{21}$/i,xO=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kO=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,IO=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,OO="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Qc;const AO=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,CO=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,$O=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,RO=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,NO=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,PO=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,dw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",MO=new RegExp(`^${dw}$`);function fw(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function LO(e){return new RegExp(`^${fw(e)}$`)}function jO(e){let t=`${dw}T${fw(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function zO(e,t){return!!((t==="v4"||!t)&&AO.test(e)||(t==="v6"||!t)&&$O.test(e))}function DO(e,t){if(!xO.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||t&&s.alg!==t)}catch{return!1}}function UO(e,t){return!!((t==="v4"||!t)&&CO.test(e)||(t==="v6"||!t)&&RO.test(e))}let Hu=class xs extends ve{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==V.string){const a=this._getOrReturnCtx(t);return F(a,{code:R.invalid_type,expected:V.string,received:a.parsedType}),pe}const r=new Lt;let s;for(const a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(s=this._getOrReturnCtx(t,s),F(s,{code:R.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")t.data.length>a.value&&(s=this._getOrReturnCtx(t,s),F(s,{code:R.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const i=t.data.length>a.value,o=t.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(t,s),i?F(s,{code:R.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&F(s,{code:R.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")IO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"email",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Qc||(Qc=new RegExp(OO,"u")),Qc.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"emoji",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")TO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"uuid",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")SO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"nanoid",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")bO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"cuid",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")vO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"cuid2",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")EO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"ulid",code:R.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{s=this._getOrReturnCtx(t,s),F(s,{validation:"url",code:R.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"regex",code:R.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?jO(a).test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?MO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?LO(a).test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{code:R.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?kO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"duration",code:R.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?zO(t.data,a.version)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"ip",code:R.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?DO(t.data,a.alg)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"jwt",code:R.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?UO(t.data,a.version)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"cidr",code:R.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?NO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"base64",code:R.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?PO.test(t.data)||(s=this._getOrReturnCtx(t,s),F(s,{validation:"base64url",code:R.invalid_string,message:a.message}),r.dirty()):Se.assertNever(a);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(s=>t.test(s),{validation:n,code:R.invalid_string,...J.errToObj(r)})}_addCheck(t){return new xs({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...J.errToObj(t)})}url(t){return this._addCheck({kind:"url",...J.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...J.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...J.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...J.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...J.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...J.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...J.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...J.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...J.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...J.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...J.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...J.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1,...J.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...J.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...J.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...J.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n?.position,...J.errToObj(n?.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...J.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...J.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...J.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...J.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...J.errToObj(n)})}nonempty(t){return this.min(1,J.errToObj(t))}trim(){return new xs({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new xs({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new xs({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};Hu.create=e=>new Hu({checks:[],typeName:k.ZodString,coerce:e?.coerce??!1,...ye(e)});function FO(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r,a=Number.parseInt(e.toFixed(s).replace(".","")),i=Number.parseInt(t.toFixed(s).replace(".",""));return a%i/10**s}let Sp=class Vu extends ve{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==V.number){const a=this._getOrReturnCtx(t);return F(a,{code:R.invalid_type,expected:V.number,received:a.parsedType}),pe}let r;const s=new Lt;for(const a of this._def.checks)a.kind==="int"?Se.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),F(r,{code:R.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?FO(t.data,a.value)!==0&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),F(r,{code:R.not_finite,message:a.message}),s.dirty()):Se.assertNever(a);return{status:s.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,J.toString(n))}gt(t,n){return this.setLimit("min",t,!1,J.toString(n))}lte(t,n){return this.setLimit("max",t,!0,J.toString(n))}lt(t,n){return this.setLimit("max",t,!1,J.toString(n))}setLimit(t,n,r,s){return new Vu({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:J.toString(s)}]})}_addCheck(t){return new Vu({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:J.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:J.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:J.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:J.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:J.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:J.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:J.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:J.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:J.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Se.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};Sp.create=e=>new Sp({checks:[],typeName:k.ZodNumber,coerce:e?.coerce||!1,...ye(e)});class Js extends ve{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==V.bigint)return this._getInvalidInput(t);let r;const s=new Lt;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),F(r,{code:R.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Se.assertNever(a);return{status:s.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return F(n,{code:R.invalid_type,expected:V.bigint,received:n.parsedType}),pe}gte(t,n){return this.setLimit("min",t,!0,J.toString(n))}gt(t,n){return this.setLimit("min",t,!1,J.toString(n))}lte(t,n){return this.setLimit("max",t,!0,J.toString(n))}lt(t,n){return this.setLimit("max",t,!1,J.toString(n))}setLimit(t,n,r,s){return new Js({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:J.toString(s)}]})}_addCheck(t){return new Js({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:J.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:J.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:J.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:J.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:J.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Js.create=e=>new Js({checks:[],typeName:k.ZodBigInt,coerce:e?.coerce??!1,...ye(e)});class xp extends ve{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==V.boolean){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.boolean,received:r.parsedType}),pe}return Ft(t.data)}}xp.create=e=>new xp({typeName:k.ZodBoolean,coerce:e?.coerce||!1,...ye(e)});class Ci extends ve{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==V.date){const a=this._getOrReturnCtx(t);return F(a,{code:R.invalid_type,expected:V.date,received:a.parsedType}),pe}if(Number.isNaN(t.data.getTime())){const a=this._getOrReturnCtx(t);return F(a,{code:R.invalid_date}),pe}const r=new Lt;let s;for(const a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(s=this._getOrReturnCtx(t,s),F(s,{code:R.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(s=this._getOrReturnCtx(t,s),F(s,{code:R.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Se.assertNever(a);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Ci({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:J.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:J.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}Ci.create=e=>new Ci({checks:[],coerce:e?.coerce||!1,typeName:k.ZodDate,...ye(e)});class kp extends ve{_parse(t){if(this._getType(t)!==V.symbol){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.symbol,received:r.parsedType}),pe}return Ft(t.data)}}kp.create=e=>new kp({typeName:k.ZodSymbol,...ye(e)});class Ip extends ve{_parse(t){if(this._getType(t)!==V.undefined){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.undefined,received:r.parsedType}),pe}return Ft(t.data)}}Ip.create=e=>new Ip({typeName:k.ZodUndefined,...ye(e)});class Op extends ve{_parse(t){if(this._getType(t)!==V.null){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.null,received:r.parsedType}),pe}return Ft(t.data)}}Op.create=e=>new Op({typeName:k.ZodNull,...ye(e)});class Gu extends ve{constructor(){super(...arguments),this._any=!0}_parse(t){return Ft(t.data)}}Gu.create=e=>new Gu({typeName:k.ZodAny,...ye(e)});let Ap=class extends ve{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ft(t.data)}};Ap.create=e=>new Ap({typeName:k.ZodUnknown,...ye(e)});let sr=class extends ve{_parse(t){const n=this._getOrReturnCtx(t);return F(n,{code:R.invalid_type,expected:V.never,received:n.parsedType}),pe}};sr.create=e=>new sr({typeName:k.ZodNever,...ye(e)});class Cp extends ve{_parse(t){if(this._getType(t)!==V.undefined){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.void,received:r.parsedType}),pe}return Ft(t.data)}}Cp.create=e=>new Cp({typeName:k.ZodVoid,...ye(e)});let es=class ni extends ve{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),s=this._def;if(n.parsedType!==V.array)return F(n,{code:R.invalid_type,expected:V.array,received:n.parsedType}),pe;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&(F(n,{code:i?R.too_big:R.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(F(n,{code:R.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(F(n,{code:R.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new rr(n,i,n.path,o)))).then(i=>Lt.mergeArray(r,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new rr(n,i,n.path,o)));return Lt.mergeArray(r,a)}get element(){return this._def.type}min(t,n){return new ni({...this._def,minLength:{value:t,message:J.toString(n)}})}max(t,n){return new ni({...this._def,maxLength:{value:t,message:J.toString(n)}})}length(t,n){return new ni({...this._def,exactLength:{value:t,message:J.toString(n)}})}nonempty(t){return this.min(1,t)}};es.create=(e,t)=>new es({type:e,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...ye(t)});function jr(e){if(e instanceof Dn){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Xn.create(jr(r))}return new Dn({...e._def,shape:()=>t})}else return e instanceof es?new es({...e._def,type:jr(e.element)}):e instanceof Xn?Xn.create(jr(e.unwrap())):e instanceof ns?ns.create(jr(e.unwrap())):e instanceof Tr?Tr.create(e.items.map(t=>jr(t))):e}let Dn=class Kt extends ve{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Se.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==V.object){const u=this._getOrReturnCtx(t);return F(u,{code:R.invalid_type,expected:V.object,received:u.parsedType}),pe}const{status:r,ctx:s}=this._processInputParams(t),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof sr&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const c=[];for(const u of i){const l=a[u],d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new rr(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof sr){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")o.length>0&&(F(s,{code:R.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new rr(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const d=await l.key,f=await l.value;u.push({key:d,value:f,alwaysSet:l.alwaysSet})}return u}).then(u=>Lt.mergeObjectSync(r,u)):Lt.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(t){return J.errToObj,new Kt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{const s=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:J.errToObj(t).message??s}:{message:s}}}:{}})}strip(){return new Kt({...this._def,unknownKeys:"strip"})}passthrough(){return new Kt({...this._def,unknownKeys:"passthrough"})}extend(t){return new Kt({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Kt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:k.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Kt({...this._def,catchall:t})}pick(t){const n={};for(const r of Se.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Kt({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Se.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Kt({...this._def,shape:()=>n})}deepPartial(){return jr(this)}partial(t){const n={};for(const r of Se.objectKeys(this.shape)){const s=this.shape[r];t&&!t[r]?n[r]=s:n[r]=s.optional()}return new Kt({...this._def,shape:()=>n})}required(t){const n={};for(const r of Se.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Xn;)a=a._def.innerType;n[r]=a}return new Kt({...this._def,shape:()=>n})}keyof(){return hw(Se.objectKeys(this.shape))}};Dn.create=(e,t)=>new Dn({shape:()=>e,unknownKeys:"strip",catchall:sr.create(),typeName:k.ZodObject,...ye(t)});Dn.strictCreate=(e,t)=>new Dn({shape:()=>e,unknownKeys:"strict",catchall:sr.create(),typeName:k.ZodObject,...ye(t)});Dn.lazycreate=(e,t)=>new Dn({shape:e,unknownKeys:"strip",catchall:sr.create(),typeName:k.ZodObject,...ye(t)});let $i=class extends ve{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new zn(o.ctx.common.issues));return F(n,{code:R.invalid_union,unionErrors:i}),pe}if(n.common.async)return Promise.all(r.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const c of r){const u={...n,common:{...n.common,issues:[]},parent:null},l=c._parseSync({data:n.data,path:n.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(c=>new zn(c));return F(n,{code:R.invalid_union,unionErrors:o}),pe}}get options(){return this._def.options}};$i.create=(e,t)=>new $i({options:e,typeName:k.ZodUnion,...ye(t)});function Ju(e,t){const n=Gn(e),r=Gn(t);if(e===t)return{valid:!0,data:e};if(n===V.object&&r===V.object){const s=Se.objectKeys(t),a=Se.objectKeys(e).filter(o=>s.indexOf(o)!==-1),i={...e,...t};for(const o of a){const c=Ju(e[o],t[o]);if(!c.valid)return{valid:!1};i[o]=c.data}return{valid:!0,data:i}}else if(n===V.array&&r===V.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let a=0;a<e.length;a++){const i=e[a],o=t[a],c=Ju(i,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return n===V.date&&r===V.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let Ri=class extends ve{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=(a,i)=>{if(vp(a)||vp(i))return pe;const o=Ju(a.value,i.value);return o.valid?((Ep(a)||Ep(i))&&n.dirty(),{status:n.value,value:o.data}):(F(r,{code:R.invalid_intersection_types}),pe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Ri.create=(e,t,n)=>new Ri({left:e,right:t,typeName:k.ZodIntersection,...ye(n)});class Tr extends ve{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.array)return F(r,{code:R.invalid_type,expected:V.array,received:r.parsedType}),pe;if(r.data.length<this._def.items.length)return F(r,{code:R.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),pe;!this._def.rest&&r.data.length>this._def.items.length&&(F(r,{code:R.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((i,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new rr(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Lt.mergeArray(n,i)):Lt.mergeArray(n,a)}get items(){return this._def.items}rest(t){return new Tr({...this._def,rest:t})}}Tr.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tr({items:e,typeName:k.ZodTuple,rest:null,...ye(t)})};class $p extends ve{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.map)return F(r,{code:R.invalid_type,expected:V.map,received:r.parsedType}),pe;const s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,c],u)=>({key:s._parse(new rr(r,o,r.path,[u,"key"])),value:a._parse(new rr(r,c,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of i){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return pe;(u.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(u.value,l.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const c of i){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return pe;(u.status==="dirty"||l.status==="dirty")&&n.dirty(),o.set(u.value,l.value)}return{status:n.value,value:o}}}}$p.create=(e,t,n)=>new $p({valueType:t,keyType:e,typeName:k.ZodMap,...ye(n)});class Ws extends ve{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.set)return F(r,{code:R.invalid_type,expected:V.set,received:r.parsedType}),pe;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(F(r,{code:R.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(F(r,{code:R.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(c){const u=new Set;for(const l of c){if(l.status==="aborted")return pe;l.status==="dirty"&&n.dirty(),u.add(l.value)}return{status:n.value,value:u}}const o=[...r.data.values()].map((c,u)=>a._parse(new rr(r,c,r.path,u)));return r.common.async?Promise.all(o).then(c=>i(c)):i(o)}min(t,n){return new Ws({...this._def,minSize:{value:t,message:J.toString(n)}})}max(t,n){return new Ws({...this._def,maxSize:{value:t,message:J.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}Ws.create=(e,t)=>new Ws({valueType:e,minSize:null,maxSize:null,typeName:k.ZodSet,...ye(t)});class Rp extends ve{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Rp.create=(e,t)=>new Rp({getter:e,typeName:k.ZodLazy,...ye(t)});let Np=class extends ve{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return F(n,{received:n.data,code:R.invalid_literal,expected:this._def.value}),pe}return{status:"valid",value:t.data}}get value(){return this._def.value}};Np.create=(e,t)=>new Np({value:e,typeName:k.ZodLiteral,...ye(t)});function hw(e,t){return new gd({values:e,typeName:k.ZodEnum,...ye(t)})}let gd=class Wu extends ve{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return F(n,{expected:Se.joinValues(r),received:n.parsedType,code:R.invalid_type}),pe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return F(n,{received:n.data,code:R.invalid_enum_value,options:r}),pe}return Ft(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return Wu.create(t,{...this._def,...n})}exclude(t,n=this._def){return Wu.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};gd.create=hw;class Pp extends ve{_parse(t){const n=Se.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==V.string&&r.parsedType!==V.number){const s=Se.objectValues(n);return F(r,{expected:Se.joinValues(s),received:r.parsedType,code:R.invalid_type}),pe}if(this._cache||(this._cache=new Set(Se.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const s=Se.objectValues(n);return F(r,{received:r.data,code:R.invalid_enum_value,options:s}),pe}return Ft(t.data)}get enum(){return this._def.values}}Pp.create=(e,t)=>new Pp({values:e,typeName:k.ZodNativeEnum,...ye(t)});class Ni extends ve{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==V.promise&&n.common.async===!1)return F(n,{code:R.invalid_type,expected:V.promise,received:n.parsedType}),pe;const r=n.parsedType===V.promise?n.data:Promise.resolve(n.data);return Ft(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Ni.create=(e,t)=>new Ni({type:e,typeName:k.ZodPromise,...ye(t)});class ts extends ve{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=this._def.effect||null,a={addIssue:i=>{F(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return pe;const c=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return c.status==="aborted"?pe:c.status==="dirty"||n.value==="dirty"?Ss(c.value):c});{if(n.value==="aborted")return pe;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?pe:o.status==="dirty"||n.value==="dirty"?Ss(o.value):o}}if(s.type==="refinement"){const i=o=>{const c=s.refinement(o,a);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?pe:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?pe:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Qr(i))return pe;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>Qr(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):pe);Se.assertNever(s)}}ts.create=(e,t,n)=>new ts({schema:e,typeName:k.ZodEffects,effect:t,...ye(n)});ts.createWithPreprocess=(e,t,n)=>new ts({schema:t,effect:{type:"preprocess",transform:e},typeName:k.ZodEffects,...ye(n)});let Xn=class extends ve{_parse(t){return this._getType(t)===V.undefined?Ft(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Xn.create=(e,t)=>new Xn({innerType:e,typeName:k.ZodOptional,...ye(t)});let ns=class extends ve{_parse(t){return this._getType(t)===V.null?Ft(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ns.create=(e,t)=>new ns({innerType:e,typeName:k.ZodNullable,...ye(t)});let Ku=class extends ve{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===V.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};Ku.create=(e,t)=>new Ku({innerType:e,typeName:k.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ye(t)});let Xu=class extends ve{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ai(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new zn(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new zn(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Xu.create=(e,t)=>new Xu({innerType:e,typeName:k.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ye(t)});class Mp extends ve{_parse(t){if(this._getType(t)!==V.nan){const r=this._getOrReturnCtx(t);return F(r,{code:R.invalid_type,expected:V.nan,received:r.parsedType}),pe}return{status:"valid",value:t.data}}}Mp.create=e=>new Mp({typeName:k.ZodNaN,...ye(e)});class BO extends ve{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class _d extends ve{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?pe:a.status==="dirty"?(n.dirty(),Ss(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?pe:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(t,n){return new _d({in:t,out:n,typeName:k.ZodPipeline})}}let Yu=class extends ve{_parse(t){const n=this._def.innerType._parse(t),r=s=>(Qr(s)&&(s.value=Object.freeze(s.value)),s);return Ai(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}};Yu.create=(e,t)=>new Yu({innerType:e,typeName:k.ZodReadonly,...ye(t)});var k;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(k||(k={}));const To=Hu.create,Lp=Gu.create;sr.create;es.create;const So=Dn.create;$i.create;Ri.create;Tr.create;gd.create;Ni.create;Xn.create;ns.create;function ZO(e,t){const n={type:"array"};return e.type?._def&&e.type?._def?.typeName!==k.ZodAny&&(n.items=Ie(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ae(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ae(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ae(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ae(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function qO(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Ae(n,"minimum",r.value,r.message,t):Ae(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ae(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ae(n,"maximum",r.value,r.message,t):Ae(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ae(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ae(n,"multipleOf",r.value,r.message,t);break}return n}function HO(){return{type:"boolean"}}function pw(e,t){return Ie(e.type._def,t)}const VO=(e,t)=>Ie(e.innerType._def,t);function mw(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(s=>mw(e,t,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return GO(e,t)}}const GO=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Ae(n,"minimum",r.value,r.message,t);break;case"max":Ae(n,"maximum",r.value,r.message,t);break}return n};function JO(e,t){return{...Ie(e.innerType._def,t),default:e.defaultValue()}}function WO(e,t){return t.effectStrategy==="input"?Ie(e.schema._def,t):kt(t)}function KO(e){return{type:"string",enum:Array.from(e.values)}}const XO=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function YO(e,t){const n=[Ie(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Ie(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(XO(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function QO(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let eu;const Ht={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(eu===void 0&&(eu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),eu),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function gw(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Ae(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Ae(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Vt(n,"email",r.message,t);break;case"format:idn-email":Vt(n,"idn-email",r.message,t);break;case"pattern:zod":mt(n,Ht.email,r.message,t);break}break;case"url":Vt(n,"uri",r.message,t);break;case"uuid":Vt(n,"uuid",r.message,t);break;case"regex":mt(n,r.regex,r.message,t);break;case"cuid":mt(n,Ht.cuid,r.message,t);break;case"cuid2":mt(n,Ht.cuid2,r.message,t);break;case"startsWith":mt(n,RegExp(`^${tu(r.value,t)}`),r.message,t);break;case"endsWith":mt(n,RegExp(`${tu(r.value,t)}$`),r.message,t);break;case"datetime":Vt(n,"date-time",r.message,t);break;case"date":Vt(n,"date",r.message,t);break;case"time":Vt(n,"time",r.message,t);break;case"duration":Vt(n,"duration",r.message,t);break;case"length":Ae(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),Ae(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":mt(n,RegExp(tu(r.value,t)),r.message,t);break;case"ip":r.version!=="v6"&&Vt(n,"ipv4",r.message,t),r.version!=="v4"&&Vt(n,"ipv6",r.message,t);break;case"base64url":mt(n,Ht.base64url,r.message,t);break;case"jwt":mt(n,Ht.jwt,r.message,t);break;case"cidr":r.version!=="v6"&&mt(n,Ht.ipv4Cidr,r.message,t),r.version!=="v4"&&mt(n,Ht.ipv6Cidr,r.message,t);break;case"emoji":mt(n,Ht.emoji(),r.message,t);break;case"ulid":mt(n,Ht.ulid,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Vt(n,"binary",r.message,t);break;case"contentEncoding:base64":Ae(n,"contentEncoding","base64",r.message,t);break;case"pattern:zod":mt(n,Ht.base64,r.message,t);break}break;case"nanoid":mt(n,Ht.nanoid,r.message,t);break}return n}function tu(e,t){return t.patternStrategy==="escape"?tA(e):e}const eA=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function tA(e){let t="";for(let n=0;n<e.length;n++)eA.has(e[n])||(t+="\\"),t+=e[n];return t}function Vt(e,t,n,r){e.format||e.anyOf?.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ae(e,"format",t,n,r)}function mt(e,t,n,r){e.pattern||e.allOf?.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:jp(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ae(e,"pattern",jp(t,r),n,r)}function jp(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let s="",a=!1,i=!1,o=!1;for(let c=0;c<r.length;c++){if(a){s+=r[c],a=!1;continue}if(n.i){if(i){if(r[c].match(/[a-z]/)){o?(s+=r[c],s+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&r[c+2]?.match(/[a-z]/)?(s+=r[c],o=!0):s+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){s+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(n.m){if(r[c]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[c]==="."){s+=i?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}s+=r[c],r[c]==="\\"?a=!0:i&&r[c]==="]"?i=!1:!i&&r[c]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function _w(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===k.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,s)=>({...r,[s]:Ie(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??kt(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Ie(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(e.keyType?._def.typeName===k.ZodString&&e.keyType._def.checks?.length){const{type:r,...s}=gw(e.keyType._def,t);return{...n,propertyNames:s}}else{if(e.keyType?._def.typeName===k.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===k.ZodBranded&&e.keyType._def.type._def.typeName===k.ZodString&&e.keyType._def.type._def.checks?.length){const{type:r,...s}=pw(e.keyType._def,t);return{...n,propertyNames:s}}}return n}function nA(e,t){if(t.mapStrategy==="record")return _w(e,t);const n=Ie(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||kt(t),r=Ie(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||kt(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function rA(e){const t=e.values,r=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function sA(e){return e.target==="openAi"?void 0:{not:kt({...e,currentPath:[...e.currentPath,"not"]})}}function aA(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Pi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function iA(e,t){if(t.target==="openApi3")return zp(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in Pi&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=Pi[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":return a._def.value===null?[...s,"null"]:s;case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return zp(e,t)}const zp=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,s)=>Ie(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function oA(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:Pi[e.innerType._def.typeName],nullable:!0}:{type:[Pi[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=Ie(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=Ie(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function cA(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",lw(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Ae(n,"minimum",r.value,r.message,t):Ae(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ae(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ae(n,"maximum",r.value,r.message,t):Ae(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ae(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ae(n,"multipleOf",r.value,r.message,t);break}return n}function uA(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},s=[],a=e.shape();for(const o in a){let c=a[o];if(c===void 0||c._def===void 0)continue;let u=dA(c);u&&n&&(c._def.typeName==="ZodOptional"&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);const l=Ie(c._def,{...t,currentPath:[...t.currentPath,"properties",o],propertyPath:[...t.currentPath,"properties",o]});l!==void 0&&(r.properties[o]=l,u||s.push(o))}s.length&&(r.required=s);const i=lA(e,t);return i!==void 0&&(r.additionalProperties=i),r}function lA(e,t){if(e.catchall._def.typeName!=="ZodNever")return Ie(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function dA(e){try{return e.isOptional()}catch{return!0}}const fA=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Ie(e.innerType._def,t);const n=Ie(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:kt(t)},n]}:kt(t)},hA=(e,t)=>{if(t.pipeStrategy==="input")return Ie(e.in._def,t);if(t.pipeStrategy==="output")return Ie(e.out._def,t);const n=Ie(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=Ie(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function pA(e,t){return Ie(e.type._def,t)}function mA(e,t){const r={type:"array",uniqueItems:!0,items:Ie(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ae(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ae(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function gA(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>Ie(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Ie(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>Ie(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function _A(e){return{not:kt(e)}}function yA(e){return kt(e)}const wA=(e,t)=>Ie(e.innerType._def,t),bA=(e,t,n)=>{switch(t){case k.ZodString:return gw(e,n);case k.ZodNumber:return cA(e,n);case k.ZodObject:return uA(e,n);case k.ZodBigInt:return qO(e,n);case k.ZodBoolean:return HO();case k.ZodDate:return mw(e,n);case k.ZodUndefined:return _A(n);case k.ZodNull:return aA(n);case k.ZodArray:return ZO(e,n);case k.ZodUnion:case k.ZodDiscriminatedUnion:return iA(e,n);case k.ZodIntersection:return YO(e,n);case k.ZodTuple:return gA(e,n);case k.ZodRecord:return _w(e,n);case k.ZodLiteral:return QO(e,n);case k.ZodEnum:return KO(e);case k.ZodNativeEnum:return rA(e);case k.ZodNullable:return oA(e,n);case k.ZodOptional:return fA(e,n);case k.ZodMap:return nA(e,n);case k.ZodSet:return mA(e,n);case k.ZodLazy:return()=>e.getter()._def;case k.ZodPromise:return pA(e,n);case k.ZodNaN:case k.ZodNever:return sA(n);case k.ZodEffects:return WO(e,n);case k.ZodAny:return kt(n);case k.ZodUnknown:return yA(n);case k.ZodDefault:return JO(e,n);case k.ZodBranded:return pw(e,n);case k.ZodReadonly:return wA(e,n);case k.ZodCatch:return VO(e,n);case k.ZodPipeline:return hA(e,n);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(r=>{})()}};function Ie(e,t,n=!1){const r=t.seen.get(e);if(t.override){const o=t.override?.(e,t,r,n);if(o!==hO)return o}if(r&&!n){const o=vA(r,t);if(o!==void 0)return o}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=bA(e,e.typeName,t),i=typeof a=="function"?Ie(a(),t):a;if(i&&EA(e,t,i),t.postProcess){const o=t.postProcess(i,e,t);return s.jsonSchema=i,o}return s.jsonSchema=i,i}const vA=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:uw(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),kt(t)):t.$refStrategy==="seen"?kt(t):void 0}},EA=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),TA=(e,t)=>{const n=gO(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((o,[c,u])=>({...o,[c]:Ie(u._def,{...n,currentPath:[...n.basePath,n.definitionPath,c]},!0)??kt(n)}),{}):void 0;const s=typeof t=="string"?t:t?.name,a=Ie(e._def,n,!1)??kt(n);n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=s===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function wr(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const r=e.length;if(r!==t.length)return!1;for(let s=0;s<r;s++)if(!wr(e[s],t[s]))return!1;return!0}if(n==="object"){if(!e||!t)return e===t;const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const i of r)if(!wr(e[i],t[i]))return!1;return!0}return e===t}function Xt(e){return encodeURI(SA(e))}function SA(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}const xA={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},kA={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},IA={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let OA=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Wn(e,t=Object.create(null),n=OA,r=""){if(e&&typeof e=="object"&&!Array.isArray(e)){const a=e.$id||e.id;if(a){const i=new URL(a,n.href);i.hash.length>1?t[i.href]=e:(i.hash="",r===""?n=i:Wn(e,t,n))}}else if(e!==!0&&e!==!1)return t;const s=n.href+(r?"#"+r:"");if(t[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(t[s]=e,e===!0||e===!1)return t;if(e.__absolute_uri__===void 0&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:s}),e.$ref&&e.__absolute_ref__===void 0){const a=new URL(e.$ref,n.href);a.hash=a.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:a.href})}if(e.$recursiveRef&&e.__absolute_recursive_ref__===void 0){const a=new URL(e.$recursiveRef,n.href);a.hash=a.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:a.href})}if(e.$anchor){const a=new URL("#"+e.$anchor,n.href);t[a.href]=e}for(let a in e){if(IA[a])continue;const i=`${r}/${Xt(a)}`,o=e[a];if(Array.isArray(o)){if(xA[a]){const c=o.length;for(let u=0;u<c;u++)Wn(o[u],t,n,`${i}/${u}`)}}else if(kA[a])for(let c in o)Wn(o[c],t,n,`${i}/${Xt(c)}`);else Wn(o,t,n,i)}return t}const AA=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,CA=[0,31,28,31,30,31,30,31,31,30,31,30,31],$A=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,RA=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,NA=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,PA=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,MA=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,LA=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,jA=/^(?:\/(?:[^~/]|~0|~1)*)*$/,zA=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,DA=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,UA=e=>{if(e[0]==='"')return!1;const[t,n,...r]=e.split("@");return!t||!n||r.length!==0||t.length>64||n.length>253||t[0]==="."||t.endsWith(".")||t.includes("..")||!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)?!1:n.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},FA=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,BA=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,ZA=e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e));function hn(e){return e.test.bind(e)}const Dp={date:yw,time:ww.bind(void 0,!1),"date-time":VA,duration:ZA,uri:WA,"uri-reference":hn(NA),"uri-template":hn(PA),url:hn(MA),email:UA,hostname:hn(RA),ipv4:hn(FA),ipv6:hn(BA),regex:XA,uuid:hn(LA),"json-pointer":hn(jA),"json-pointer-uri-fragment":hn(zA),"relative-json-pointer":hn(DA)};function qA(e){return e%4===0&&(e%100!==0||e%400===0)}function yw(e){const t=e.match(AA);if(!t)return!1;const n=+t[1],r=+t[2],s=+t[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&qA(n)?29:CA[r])}function ww(e,t){const n=t.match($A);if(!n)return!1;const r=+n[1],s=+n[2],a=+n[3],i=!!n[5];return(r<=23&&s<=59&&a<=59||r==23&&s==59&&a==60)&&(!e||i)}const HA=/t|\s/i;function VA(e){const t=e.split(HA);return t.length==2&&yw(t[0])&&ww(!0,t[1])}const GA=/\/|:/,JA=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function WA(e){return GA.test(e)&&JA.test(e)}const KA=/[^\\]\\Z/;function XA(e){if(KA.test(e))return!1;try{return new RegExp(e,"u"),!0}catch{return!1}}function YA(e){let t=0,n=e.length,r=0,s;for(;r<n;)t++,s=e.charCodeAt(r++),s>=55296&&s<=56319&&r<n&&(s=e.charCodeAt(r),(s&64512)==56320&&r++);return t}function je(e,t,n="2019-09",r=Wn(t),s=!0,a=null,i="#",o="#",c=Object.create(null)){if(t===!0)return{valid:!0,errors:[]};if(t===!1)return{valid:!1,errors:[{instanceLocation:i,keyword:"false",keywordLocation:i,error:"False boolean schema."}]};const u=typeof e;let l;switch(u){case"boolean":case"number":case"string":l=u;break;case"object":e===null?l="null":Array.isArray(e)?l="array":l="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}const{$ref:d,$recursiveRef:f,$recursiveAnchor:h,type:p,const:m,enum:b,required:_,not:w,anyOf:E,allOf:x,oneOf:I,if:P,then:j,else:v,format:oe,properties:le,patternProperties:K,additionalProperties:Ge,unevaluatedProperties:Ot,minProperties:z,maxProperties:N,propertyNames:M,dependentRequired:G,dependentSchemas:X,dependencies:H,prefixItems:re,items:ge,additionalItems:fe,unevaluatedItems:ke,contains:He,minContains:Ee,maxContains:y,minItems:g,maxItems:A,uniqueItems:T,minimum:we,maximum:$e,exclusiveMinimum:Pe,exclusiveMaximum:Je,multipleOf:at,minLength:Zt,maxLength:Fe,pattern:zt,__absolute_ref__:Ir,__absolute_recursive_ref__:pa}=t,U=[];if(h===!0&&a===null&&(a=t),f==="#"){const ae=a===null?r[pa]:a,te=`${o}/$recursiveRef`,de=je(e,a===null?t:a,n,r,s,ae,i,te,c);de.valid||U.push({instanceLocation:i,keyword:"$recursiveRef",keywordLocation:te,error:"A subschema had errors."},...de.errors)}if(d!==void 0){const te=r[Ir||d];if(te===void 0){let D=`Unresolved $ref "${d}".`;throw Ir&&Ir!==d&&(D+=`  Absolute URI "${Ir}".`),D+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(D)}const de=`${o}/$ref`,Z=je(e,te,n,r,s,a,i,de,c);if(Z.valid||U.push({instanceLocation:i,keyword:"$ref",keywordLocation:de,error:"A subschema had errors."},...Z.errors),n==="4"||n==="7")return{valid:U.length===0,errors:U}}if(Array.isArray(p)){let ae=p.length,te=!1;for(let de=0;de<ae;de++)if(l===p[de]||p[de]==="integer"&&l==="number"&&e%1===0&&e===e){te=!0;break}te||U.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${p.join('", "')}".`})}else p==="integer"?(l!=="number"||e%1||e!==e)&&U.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${p}".`}):p!==void 0&&l!==p&&U.push({instanceLocation:i,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${p}".`});if(m!==void 0&&(l==="object"||l==="array"?wr(e,m)||U.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):e!==m&&U.push({instanceLocation:i,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),b!==void 0&&(l==="object"||l==="array"?b.some(ae=>wr(e,ae))||U.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(b)}.`}):b.some(ae=>e===ae)||U.push({instanceLocation:i,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(b)}.`})),w!==void 0){const ae=`${o}/not`;je(e,w,n,r,s,a,i,ae).valid&&U.push({instanceLocation:i,keyword:"not",keywordLocation:ae,error:'Instance matched "not" schema.'})}let or=[];if(E!==void 0){const ae=`${o}/anyOf`,te=U.length;let de=!1;for(let Z=0;Z<E.length;Z++){const D=E[Z],ce=Object.create(c),ie=je(e,D,n,r,s,h===!0?a:null,i,`${ae}/${Z}`,ce);U.push(...ie.errors),de=de||ie.valid,ie.valid&&or.push(ce)}de?U.length=te:U.splice(te,0,{instanceLocation:i,keyword:"anyOf",keywordLocation:ae,error:"Instance does not match any subschemas."})}if(x!==void 0){const ae=`${o}/allOf`,te=U.length;let de=!0;for(let Z=0;Z<x.length;Z++){const D=x[Z],ce=Object.create(c),ie=je(e,D,n,r,s,h===!0?a:null,i,`${ae}/${Z}`,ce);U.push(...ie.errors),de=de&&ie.valid,ie.valid&&or.push(ce)}de?U.length=te:U.splice(te,0,{instanceLocation:i,keyword:"allOf",keywordLocation:ae,error:"Instance does not match every subschema."})}if(I!==void 0){const ae=`${o}/oneOf`,te=U.length,de=I.filter((Z,D)=>{const ce=Object.create(c),ie=je(e,Z,n,r,s,h===!0?a:null,i,`${ae}/${D}`,ce);return U.push(...ie.errors),ie.valid&&or.push(ce),ie.valid}).length;de===1?U.length=te:U.splice(te,0,{instanceLocation:i,keyword:"oneOf",keywordLocation:ae,error:`Instance does not match exactly one subschema (${de} matches).`})}if((l==="object"||l==="array")&&Object.assign(c,...or),P!==void 0){const ae=`${o}/if`;if(je(e,P,n,r,s,a,i,ae,c).valid){if(j!==void 0){const de=je(e,j,n,r,s,a,i,`${o}/then`,c);de.valid||U.push({instanceLocation:i,keyword:"if",keywordLocation:ae,error:'Instance does not match "then" schema.'},...de.errors)}}else if(v!==void 0){const de=je(e,v,n,r,s,a,i,`${o}/else`,c);de.valid||U.push({instanceLocation:i,keyword:"if",keywordLocation:ae,error:'Instance does not match "else" schema.'},...de.errors)}}if(l==="object"){if(_!==void 0)for(const Z of _)Z in e||U.push({instanceLocation:i,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${Z}".`});const ae=Object.keys(e);if(z!==void 0&&ae.length<z&&U.push({instanceLocation:i,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${z} properties.`}),N!==void 0&&ae.length>N&&U.push({instanceLocation:i,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${N} properties.`}),M!==void 0){const Z=`${o}/propertyNames`;for(const D in e){const ce=`${i}/${Xt(D)}`,ie=je(D,M,n,r,s,a,ce,Z);ie.valid||U.push({instanceLocation:i,keyword:"propertyNames",keywordLocation:Z,error:`Property name "${D}" does not match schema.`},...ie.errors)}}if(G!==void 0){const Z=`${o}/dependantRequired`;for(const D in G)if(D in e){const ce=G[D];for(const ie of ce)ie in e||U.push({instanceLocation:i,keyword:"dependentRequired",keywordLocation:Z,error:`Instance has "${D}" but does not have "${ie}".`})}}if(X!==void 0)for(const Z in X){const D=`${o}/dependentSchemas`;if(Z in e){const ce=je(e,X[Z],n,r,s,a,i,`${D}/${Xt(Z)}`,c);ce.valid||U.push({instanceLocation:i,keyword:"dependentSchemas",keywordLocation:D,error:`Instance has "${Z}" but does not match dependant schema.`},...ce.errors)}}if(H!==void 0){const Z=`${o}/dependencies`;for(const D in H)if(D in e){const ce=H[D];if(Array.isArray(ce))for(const ie of ce)ie in e||U.push({instanceLocation:i,keyword:"dependencies",keywordLocation:Z,error:`Instance has "${D}" but does not have "${ie}".`});else{const ie=je(e,ce,n,r,s,a,i,`${Z}/${Xt(D)}`);ie.valid||U.push({instanceLocation:i,keyword:"dependencies",keywordLocation:Z,error:`Instance has "${D}" but does not match dependant schema.`},...ie.errors)}}}const te=Object.create(null);let de=!1;if(le!==void 0){const Z=`${o}/properties`;for(const D in le){if(!(D in e))continue;const ce=`${i}/${Xt(D)}`,ie=je(e[D],le[D],n,r,s,a,ce,`${Z}/${Xt(D)}`);if(ie.valid)c[D]=te[D]=!0;else if(de=s,U.push({instanceLocation:i,keyword:"properties",keywordLocation:Z,error:`Property "${D}" does not match schema.`},...ie.errors),de)break}}if(!de&&K!==void 0){const Z=`${o}/patternProperties`;for(const D in K){const ce=new RegExp(D,"u"),ie=K[D];for(const vt in e){if(!ce.test(vt))continue;const Md=`${i}/${Xt(vt)}`,Ld=je(e[vt],ie,n,r,s,a,Md,`${Z}/${Xt(D)}`);Ld.valid?c[vt]=te[vt]=!0:(de=s,U.push({instanceLocation:i,keyword:"patternProperties",keywordLocation:Z,error:`Property "${vt}" matches pattern "${D}" but does not match associated schema.`},...Ld.errors))}}}if(!de&&Ge!==void 0){const Z=`${o}/additionalProperties`;for(const D in e){if(te[D])continue;const ce=`${i}/${Xt(D)}`,ie=je(e[D],Ge,n,r,s,a,ce,Z);ie.valid?c[D]=!0:(de=s,U.push({instanceLocation:i,keyword:"additionalProperties",keywordLocation:Z,error:`Property "${D}" does not match additional properties schema.`},...ie.errors))}}else if(!de&&Ot!==void 0){const Z=`${o}/unevaluatedProperties`;for(const D in e)if(!c[D]){const ce=`${i}/${Xt(D)}`,ie=je(e[D],Ot,n,r,s,a,ce,Z);ie.valid?c[D]=!0:U.push({instanceLocation:i,keyword:"unevaluatedProperties",keywordLocation:Z,error:`Property "${D}" does not match unevaluated properties schema.`},...ie.errors)}}}else if(l==="array"){A!==void 0&&e.length>A&&U.push({instanceLocation:i,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${A}).`}),g!==void 0&&e.length<g&&U.push({instanceLocation:i,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${g}).`});const ae=e.length;let te=0,de=!1;if(re!==void 0){const Z=`${o}/prefixItems`,D=Math.min(re.length,ae);for(;te<D;te++){const ce=je(e[te],re[te],n,r,s,a,`${i}/${te}`,`${Z}/${te}`);if(c[te]=!0,!ce.valid&&(de=s,U.push({instanceLocation:i,keyword:"prefixItems",keywordLocation:Z,error:"Items did not match schema."},...ce.errors),de))break}}if(ge!==void 0){const Z=`${o}/items`;if(Array.isArray(ge)){const D=Math.min(ge.length,ae);for(;te<D;te++){const ce=je(e[te],ge[te],n,r,s,a,`${i}/${te}`,`${Z}/${te}`);if(c[te]=!0,!ce.valid&&(de=s,U.push({instanceLocation:i,keyword:"items",keywordLocation:Z,error:"Items did not match schema."},...ce.errors),de))break}}else for(;te<ae;te++){const D=je(e[te],ge,n,r,s,a,`${i}/${te}`,Z);if(c[te]=!0,!D.valid&&(de=s,U.push({instanceLocation:i,keyword:"items",keywordLocation:Z,error:"Items did not match schema."},...D.errors),de))break}if(!de&&fe!==void 0){const D=`${o}/additionalItems`;for(;te<ae;te++){const ce=je(e[te],fe,n,r,s,a,`${i}/${te}`,D);c[te]=!0,ce.valid||(de=s,U.push({instanceLocation:i,keyword:"additionalItems",keywordLocation:D,error:"Items did not match additional items schema."},...ce.errors))}}}if(He!==void 0)if(ae===0&&Ee===void 0)U.push({instanceLocation:i,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(Ee!==void 0&&ae<Ee)U.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${ae}) than minContains (${Ee}).`});else{const Z=`${o}/contains`,D=U.length;let ce=0;for(let ie=0;ie<ae;ie++){const vt=je(e[ie],He,n,r,s,a,`${i}/${ie}`,Z);vt.valid?(c[ie]=!0,ce++):U.push(...vt.errors)}ce>=(Ee||0)&&(U.length=D),Ee===void 0&&y===void 0&&ce===0?U.splice(D,0,{instanceLocation:i,keyword:"contains",keywordLocation:Z,error:"Array does not contain item matching schema."}):Ee!==void 0&&ce<Ee?U.push({instanceLocation:i,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Ee} items matching schema. Only ${ce} items were found.`}):y!==void 0&&ce>y&&U.push({instanceLocation:i,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${y} items matching schema. ${ce} items were found.`})}if(!de&&ke!==void 0){const Z=`${o}/unevaluatedItems`;for(te;te<ae;te++){if(c[te])continue;const D=je(e[te],ke,n,r,s,a,`${i}/${te}`,Z);c[te]=!0,D.valid||U.push({instanceLocation:i,keyword:"unevaluatedItems",keywordLocation:Z,error:"Items did not match unevaluated items schema."},...D.errors)}}if(T)for(let Z=0;Z<ae;Z++){const D=e[Z],ce=typeof D=="object"&&D!==null;for(let ie=0;ie<ae;ie++){if(Z===ie)continue;const vt=e[ie];(D===vt||ce&&(typeof vt=="object"&&vt!==null)&&wr(D,vt))&&(U.push({instanceLocation:i,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${Z} and ${ie}.`}),Z=Number.MAX_SAFE_INTEGER,ie=Number.MAX_SAFE_INTEGER)}}}else if(l==="number"){if(n==="4"?(we!==void 0&&(Pe===!0&&e<=we||e<we)&&U.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${Pe?"or equal to ":""} ${we}.`}),$e!==void 0&&(Je===!0&&e>=$e||e>$e)&&U.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${Je?"or equal to ":""} ${$e}.`})):(we!==void 0&&e<we&&U.push({instanceLocation:i,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${we}.`}),$e!==void 0&&e>$e&&U.push({instanceLocation:i,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${$e}.`}),Pe!==void 0&&e<=Pe&&U.push({instanceLocation:i,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${Pe}.`}),Je!==void 0&&e>=Je&&U.push({instanceLocation:i,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${Je}.`})),at!==void 0){const ae=e%at;Math.abs(0-ae)>=11920929e-14&&Math.abs(at-ae)>=11920929e-14&&U.push({instanceLocation:i,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${at}.`})}}else if(l==="string"){const ae=Zt===void 0&&Fe===void 0?0:YA(e);Zt!==void 0&&ae<Zt&&U.push({instanceLocation:i,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${ae} < ${Zt}).`}),Fe!==void 0&&ae>Fe&&U.push({instanceLocation:i,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${ae} > ${Fe}).`}),zt!==void 0&&!new RegExp(zt,"u").test(e)&&U.push({instanceLocation:i,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),oe!==void 0&&Dp[oe]&&!Dp[oe](e)&&U.push({instanceLocation:i,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${oe}".`})}return{valid:U.length===0,errors:U}}class QA{schema;draft;shortCircuit;lookup;constructor(t,n="2019-09",r=!0){this.schema=t,this.draft=n,this.shortCircuit=r,this.lookup=Wn(t)}validate(t){return je(t,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(t,n){n&&(t={...t,$id:n}),Wn(t,this.lookup)}}var eC={};be(eC,{Validator:()=>QA,deepCompareStrict:()=>wr,toJsonSchema:()=>tn,validatesOnlyStrings:()=>Ms});function tn(e,t){if(De(e)){const n=ow(e,!0);if(bn(n)){const r=Oi(n,!0);return Fu(r,t)}else return Fu(e,t)}return Xe(e)?TA(e):e}function Ms(e){if(!e||typeof e!="object"||Object.keys(e).length===0||Array.isArray(e))return!1;if("type"in e)return typeof e.type=="string"?e.type==="string":Array.isArray(e.type)?e.type.every(t=>t==="string"):!1;if("enum"in e)return Array.isArray(e.enum)&&e.enum.length>0&&e.enum.every(t=>typeof t=="string");if("const"in e)return typeof e.const=="string";if("allOf"in e&&Array.isArray(e.allOf))return e.allOf.some(t=>Ms(t));if("anyOf"in e&&Array.isArray(e.anyOf)||"oneOf"in e&&Array.isArray(e.oneOf)){const t="anyOf"in e?e.anyOf:e.oneOf;return t.length>0&&t.every(n=>Ms(n))}if("not"in e)return!1;if("$ref"in e&&typeof e.$ref=="string"){const t=e.$ref,n=Wn(e);return n[t]?Ms(n[t]):!1}return!1}var tC={};be(tC,{Graph:()=>yd});function nC(e,t){if(e!==void 0&&!Ps(e))return e;if(cd(t))try{let n=t.getName();return n=n.startsWith("Runnable")?n.slice(8):n,n}catch{return t.getName()}else return t.name??"UnknownSchema"}function rC(e){return cd(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...tn(e.data.schema),title:e.data.name}}}var yd=class bw{nodes={};edges=[];constructor(t){this.nodes=t?.nodes??this.nodes,this.edges=t?.edges??this.edges}toJSON(){const t={};return Object.values(this.nodes).forEach((n,r)=>{t[n.id]=Ps(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:t[n.id],...rC(n)})),edges:this.edges.map(n=>{const r={source:t[n.source],target:t[n.target]};return typeof n.data<"u"&&(r.data=n.data),typeof n.conditional<"u"&&(r.conditional=n.conditional),r})}}addNode(t,n,r){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const s=n??pr(),a={id:s,data:t,name:nC(n,t),metadata:r};return this.nodes[s]=a,a}removeNode(t){delete this.nodes[t.id],this.edges=this.edges.filter(n=>n.source!==t.id&&n.target!==t.id)}addEdge(t,n,r,s){if(this.nodes[t.id]===void 0)throw new Error(`Source node ${t.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const a={source:t.id,target:n.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){return Up(this)}lastNode(){return Fp(this)}extend(t,n=""){let r=n;Object.values(t.nodes).map(u=>u.id).every(Ps)&&(r="");const a=u=>r?`${r}:${u}`:u;Object.entries(t.nodes).forEach(([u,l])=>{this.nodes[a(u)]={...l,id:a(u)}});const i=t.edges.map(u=>({...u,source:a(u.source),target:a(u.target)}));this.edges=[...this.edges,...i];const o=t.firstNode(),c=t.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,c?{id:a(c.id),data:c.data}:void 0]}trimFirstNode(){const t=this.firstNode();t&&Up(this,[t.id])&&this.removeNode(t)}trimLastNode(){const t=this.lastNode();t&&Fp(this,[t.id])&&this.removeNode(t)}reid(){const t=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),n=new Map;Object.values(t).forEach(s=>{n.set(s,(n.get(s)||0)+1)});const r=s=>{const a=t[s];return Ps(s)&&n.get(a)===1?a:s};return new bw({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,a])=>[r(s),{...a,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(t){const{withStyles:n,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=t??{},i=this.reid(),o=i.firstNode(),c=i.lastNode();return dO(i.nodes,i.edges,{firstNode:o?.id,lastNode:c?.id,withStyles:n,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(t){const n=this.drawMermaid(t);return fO(n,{backgroundColor:t?.backgroundColor})}};function Up(e,t=[]){const n=new Set(e.edges.filter(s=>!t.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(e.nodes))!t.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function Fp(e,t=[]){const n=new Set(e.edges.filter(s=>!t.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(e.nodes))!t.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function sC(e){const t=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of e)r.enqueue(t.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(t.encode(`event: end

`)),r.close()}});return on.fromReadableStream(n)}function Bp(e){return typeof e=="object"&&e!==null&&typeof e[Symbol.iterator]=="function"&&typeof e.next=="function"}const aC=e=>e!=null&&typeof e=="object"&&"next"in e&&typeof e.next=="function";function Qu(e){return typeof e=="object"&&e!==null&&typeof e[Symbol.asyncIterator]=="function"}function*Zp(e,t){for(;;){const{value:n,done:r}=an.runWithConfig(Ln(e),t.next.bind(t),!0);if(r)break;yield n}}async function*el(e,t){const n=t[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await an.runWithConfig(Ln(e),n.next.bind(t),!0);if(s)break;yield r}}function et(e,t){return e&&!Array.isArray(e)&&!(e instanceof Date)&&typeof e=="object"?e:{[t]:e}}var Ve=class extends Vr{lc_runnable=!0;name;getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new wd({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new rs({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new kw({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Te);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const n=Object.fromEntries(Object.entries(e).filter(([r])=>r!=="runId"));return Array.from({length:t},(r,s)=>Te(s===0?e:n))}return Array.from({length:t},()=>Te(e))}async batch(e,t,n){const r=this._getOptionsList(t??{},e.length),s=r[0]?.maxConcurrency??n?.maxConcurrency,a=new oa({maxConcurrency:s,onFailedAttempt:o=>{throw o}}),i=e.map((o,c)=>a.call(async()=>{try{return await this.invoke(o,r[c])}catch(u){if(n?.returnExceptions)return u;throw u}}));return Promise.all(i)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const n=Te(t),r=new xr({generator:this._streamIterator(e,n),config:n});return await r.setup,on.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Te(e):t=Te({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){const r=Te(n),a=await(await Mt(r))?.handleChainStart(this.toJSON(),et(t,"input"),r.runId,r?.runType,void 0,void 0,r?.runName??this.getName());delete r.runId;let i;try{const o=e.call(this,t,r,a);i=await jn(o,n?.signal)}catch(o){throw await a?.handleChainError(o),o}return await a?.handleChainEnd(et(i,"output")),i}async _batchWithConfig(e,t,n,r){const s=this._getOptionsList(n??{},t.length),a=await Promise.all(s.map(Mt)),i=await Promise.all(a.map(async(c,u)=>{const l=await c?.handleChainStart(this.toJSON(),et(t[u],"input"),s[u].runId,s[u].runType,void 0,void 0,s[u].runName??this.getName());return delete s[u].runId,l}));let o;try{const c=e.call(this,t,s,i,r);o=await jn(c,s?.[0]?.signal)}catch(c){throw await Promise.all(i.map(u=>u?.handleChainError(c))),c}return await Promise.all(i.map(c=>c?.handleChainEnd(et(o,"output")))),o}_concatOutputChunks(e,t){return er(e,t)}async*_transformStreamWithConfig(e,t,n){let r,s=!0,a,i=!0;const o=Te(n),c=await Mt(o),u=this;async function*l(){for await(const f of e){if(s)if(r===void 0)r=f;else try{r=u._concatOutputChunks(r,f)}catch{r=void 0,s=!1}yield f}}let d;try{const f=await ey(t.bind(this),l(),async()=>c?.handleChainStart(this.toJSON(),{input:""},o.runId,o.runType,void 0,void 0,o.runName??this.getName(),void 0,{lc_defers_inputs:!0}),n?.signal,o);delete o.runId,d=f.setup;const h=d?.handlers.find(kx);let p=f.output;h!==void 0&&d!==void 0&&(p=h.tapOutputIterable(d.runId,p));const m=d?.handlers.find(sy);m!==void 0&&d!==void 0&&(p=m.tapOutputIterable(d.runId,p));for await(const b of p)if(yield b,i)if(a===void 0)a=b;else try{a=this._concatOutputChunks(a,b)}catch{a=void 0,i=!1}}catch(f){throw await d?.handleChainError(f,void 0,void 0,void 0,{inputs:et(r,"input")}),f}await d?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:et(r,"input")})}getGraph(e){const t=new yd,n=t.addNode({name:`${this.getName()}Input`,schema:Lp()}),r=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Lp()});return t.addEdge(n,r),t.addEdge(r,s),t}pipe(e){return new ca({first:this,last:nn(e)})}pick(e){return this.pipe(new Iw(e))}assign(e){return this.pipe(new bd(new ls({steps:e})))}async*transform(e,t){let n;for await(const r of e)n===void 0?n=r:n=this._concatOutputChunks(n,r);yield*this._streamIterator(n,Te(t))}async*streamLog(e,t,n){const r=new ju({...n,autoClose:!1,_schemaFormat:"original"}),s=Te(t);yield*this._streamLog(e,r,s)}async*_streamLog(e,t,n){const{callbacks:r}=n;if(r===void 0)n.callbacks=[t];else if(Array.isArray(r))n.callbacks=r.concat([t]);else{const o=r.copy();o.addHandler(t,!0),n.callbacks=o}const s=this.stream(e,n);async function a(){try{const o=await s;for await(const c of o){const u=new $n({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(u)}}finally{await t.writer.close()}}const i=a();try{for await(const o of t)yield o}finally{await i}}streamEvents(e,t,n){let r;if(t.version==="v1")r=this._streamEventsV1(e,t,n);else if(t.version==="v2")r=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?sC(r):on.fromAsyncGenerator(r)}async*_streamEventsV2(e,t,n){const r=new Ix({...n,autoClose:!1}),s=Te(t),a=s.runId??pr();s.runId=a;const i=s.callbacks;if(i===void 0)s.callbacks=[r];else if(Array.isArray(i))s.callbacks=i.concat(r);else{const h=i.copy();h.addHandler(r,!0),s.callbacks=h}const o=new AbortController,c=this;async function u(){let h,p=null;try{t?.signal?"any"in AbortSignal?h=AbortSignal.any([o.signal,t.signal]):(h=t.signal,p=()=>{o.abort()},t.signal.addEventListener("abort",p,{once:!0})):h=o.signal;const m=await c.stream(e,{...s,signal:h}),b=r.tapOutputIterable(a,m);for await(const _ of b)if(o.signal.aborted)break}finally{await r.finish(),h&&p&&h.removeEventListener("abort",p)}}const l=u();let d=!1,f;try{for await(const h of r){if(!d){h.data.input=e,d=!0,f=h.run_id,yield h;continue}h.run_id===f&&h.event.endsWith("_end")&&h.data?.input&&delete h.data.input,yield h}}finally{o.abort(),await l}}async*_streamEventsV1(e,t,n){let r,s=!1;const a=Te(t),i=a.tags??[],o=a.metadata??{},c=a.runName??this.getName(),u=new ju({...n,autoClose:!1,_schemaFormat:"streaming_events"}),l=new Dx({...n}),d=this._streamLog(e,u,a);for await(const h of d){if(r?r=r.concat(h):r=od.fromRunLogPatch(h),r.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const _={...r.state},w={run_id:_.id,event:`on_${_.type}_start`,name:c,tags:i,metadata:o,data:{input:e}};l.includeEvent(w,_.type)&&(yield w)}const p=h.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),m=[...new Set(p)];for(const _ of m){let w,E={};const x=r.state.logs[_];if(x.end_time===void 0?x.streamed_output.length>0?w="stream":w="start":w="end",w==="start")x.inputs!==void 0&&(E.input=x.inputs);else if(w==="end")x.inputs!==void 0&&(E.input=x.inputs),E.output=x.final_output;else if(w==="stream"){const I=x.streamed_output.length;if(I!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${I} instead. Encountered in: "${x.name}"`);E={chunk:x.streamed_output[0]},x.streamed_output=[]}yield{event:`on_${x.type}_${w}`,name:x.name,run_id:x.id,tags:x.tags,metadata:x.metadata,data:E}}const{state:b}=r;if(b.streamed_output.length>0){const _=b.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${b.name}"`);const w={chunk:b.streamed_output[0]};b.streamed_output=[];const E={event:`on_${b.type}_stream`,run_id:b.id,tags:i,metadata:o,name:c,data:w};l.includeEvent(E,b.type)&&(yield E)}}const f=r?.state;if(f!==void 0){const h={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:i,metadata:o,data:{output:f.final_output}};l.includeEvent(h,f.type)&&(yield h)}}static isRunnable(e){return cd(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new rs({bound:this,config:{},configFactories:[r=>({callbacks:[new oy({config:r,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return lC(this,e)}},rs=class vw extends Ve{static lc_name(){return"RunnableBinding"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;bound;config;kwargs;configFactories;constructor(t){super(t),this.bound=t.bound,this.kwargs=t.kwargs,this.config=t.config,this.configFactories=t.configFactories}getName(t){return this.bound.getName(t)}async _mergeConfig(...t){const n=wi(this.config,...t);return wi(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}withConfig(t){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...t}})}withRetry(t){return new wd({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:t?.stopAfterAttempt,...t})}async invoke(t,n){return this.bound.invoke(t,await this._mergeConfig(n,this.kwargs))}async batch(t,n,r){const s=Array.isArray(n)?await Promise.all(n.map(async a=>this._mergeConfig(Te(a),this.kwargs))):await this._mergeConfig(Te(n),this.kwargs);return this.bound.batch(t,s,r)}_concatOutputChunks(t,n){return this.bound._concatOutputChunks(t,n)}async*_streamIterator(t,n){yield*this.bound._streamIterator(t,await this._mergeConfig(Te(n),this.kwargs))}async stream(t,n){return this.bound.stream(t,await this._mergeConfig(Te(n),this.kwargs))}async*transform(t,n){yield*this.bound.transform(t,await this._mergeConfig(Te(n),this.kwargs))}streamEvents(t,n,r){const s=this,a=async function*(){yield*s.bound.streamEvents(t,{...await s._mergeConfig(Te(n),s.kwargs),version:n.version},r)};return on.fromAsyncGenerator(a())}static isRunnableBinding(t){return t.bound&&Ve.isRunnable(t.bound)}withListeners({onStart:t,onEnd:n,onError:r}){return new vw({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new oy({config:s,onStart:t,onEnd:n,onError:r})]})]})}},iC=class Ew extends Ve{static lc_name(){return"RunnableEach"}lc_serializable=!0;lc_namespace=["langchain_core","runnables"];bound;constructor(t){super(t),this.bound=t.bound}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async _invoke(t,n,r){return this.bound.batch(t,Le(n,{callbacks:r?.getChild()}))}withListeners({onStart:t,onEnd:n,onError:r}){return new Ew({bound:this.bound.withListeners({onStart:t,onEnd:n,onError:r})})}},wd=class extends rs{static lc_name(){return"RunnableRetry"}lc_namespace=["langchain_core","runnables"];maxAttemptNumber=3;onFailedAttempt=()=>{};constructor(e){super(e),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){const r=e>1?`retry:attempt:${e}`:void 0;return Le(t,{callbacks:n?.getChild(r)})}async _invoke(e,t,n){return zu(r=>super.invoke(e,this._patchConfigForRetry(r,t,n)),{onFailedAttempt:({error:r})=>this.onFailedAttempt(r,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,r){const s={};try{await zu(async a=>{const i=e.map((d,f)=>f).filter(d=>s[d.toString()]===void 0||s[d.toString()]instanceof Error),o=i.map(d=>e[d]),c=i.map(d=>this._patchConfigForRetry(a,t?.[d],n?.[d])),u=await super.batch(o,c,{...r,returnExceptions:!0});let l;for(let d=0;d<u.length;d+=1){const f=u[d],h=i[d];f instanceof Error&&l===void 0&&(l=f,l.input=o[d]),s[h.toString()]=f}if(l)throw l;return u},{onFailedAttempt:({error:a})=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(r?.returnExceptions!==!0)throw a}return Object.keys(s).sort((a,i)=>parseInt(a,10)-parseInt(i,10)).map(a=>s[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},ca=class ks extends Ve{static lc_name(){return"RunnableSequence"}first;middle=[];last;omitSequenceTags=!1;lc_serializable=!0;lc_namespace=["langchain_core","runnables"];constructor(t){super(t),this.first=t.first,this.middle=t.middle??this.middle,this.last=t.last,this.name=t.name,this.omitSequenceTags=t.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(t,n){const r=Te(n),a=await(await Mt(r))?.handleChainStart(this.toJSON(),et(t,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i=t,o;try{const c=[this.first,...this.middle];for(let u=0;u<c.length;u+=1){const d=c[u].invoke(i,Le(r,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`)}));i=await jn(d,n?.signal)}if(n?.signal?.aborted)throw Zs(n.signal);o=await this.last.invoke(i,Le(r,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await a?.handleChainError(c),c}return await a?.handleChainEnd(et(o,"output")),o}async batch(t,n,r){const s=this._getOptionsList(n??{},t.length),a=await Promise.all(s.map(Mt)),i=await Promise.all(a.map(async(c,u)=>{const l=await c?.handleChainStart(this.toJSON(),et(t[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName);return delete s[u].runId,l}));let o=t;try{for(let c=0;c<this.steps.length;c+=1){const l=this.steps[c].batch(o,i.map((d,f)=>{const h=d?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Le(s[f],{callbacks:h})}),r);o=await jn(l,s[0]?.signal)}}catch(c){throw await Promise.all(i.map(u=>u?.handleChainError(c))),c}return await Promise.all(i.map(c=>c?.handleChainEnd(et(o,"output")))),o}_concatOutputChunks(t,n){return this.last._concatOutputChunks(t,n)}async*_streamIterator(t,n){const r=await Mt(n),{runId:s,...a}=n??{},i=await r?.handleChainStart(this.toJSON(),et(t,"input"),s,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last];let c=!0,u;async function*l(){yield t}try{let d=o[0].transform(l(),Le(a,{callbacks:i?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,Le(a,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(const f of d)if(n?.signal?.throwIfAborted(),yield f,c)if(u===void 0)u=f;else try{u=this._concatOutputChunks(u,f)}catch{u=void 0,c=!1}}catch(d){throw await i?.handleChainError(d),d}await i?.handleChainEnd(et(u,"output"))}getGraph(t){const n=new yd;let r=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(t);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),n.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&n.addEdge(r,o),r=i.lastNode()}),n}pipe(t){return ks.isRunnableSequence(t)?new ks({first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}):new ks({first:this.first,middle:[...this.middle,this.last],last:nn(t),name:this.name})}static isRunnableSequence(t){return Array.isArray(t.middle)&&Ve.isRunnable(t)}static from([t,...n],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new ks({...s,first:nn(t),middle:n.slice(0,-1).map(nn),last:nn(n[n.length-1])})}},ls=class Tw extends Ve{static lc_name(){return"RunnableMap"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;steps;getStepsKeys(){return Object.keys(this.steps)}constructor(t){super(t),this.steps={};for(const[n,r]of Object.entries(t.steps))this.steps[n]=nn(r)}static from(t){return new Tw({steps:t})}async invoke(t,n){const r=Te(n),a=await(await Mt(r))?.handleChainStart(this.toJSON(),{input:t},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;const i={};try{const o=Object.entries(this.steps).map(async([c,u])=>{i[c]=await u.invoke(t,Le(r,{callbacks:a?.getChild(`map:key:${c}`)}))});await jn(Promise.all(o),n?.signal)}catch(o){throw await a?.handleChainError(o),o}return await a?.handleChainEnd(i),i}async*_transform(t,n,r){const s={...this.steps},a=ad(t,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,c],u)=>{const l=c.transform(a[u],Le(r,{callbacks:n?.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;i.size;){const o=Promise.race(i.values()),{key:c,result:u,gen:l}=await jn(o,r?.signal);i.delete(c),u.done||(yield{[c]:u.value},i.set(c,l.next().then(d=>({key:c,gen:l,result:d}))))}}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*r(){yield t}const s=Te(n),a=new xr({generator:this.transform(r(),s),config:s});return await a.setup,on.fromAsyncGenerator(a)}},oC=class Sw extends Ve{lc_serializable=!1;lc_namespace=["langchain_core","runnables"];func;constructor(t){if(super(t),!sd(t.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=t.func}async invoke(t,n){const[r]=this._getOptionsList(n??{},1),s=await Mt(r),a=this.func(Le(r,{callbacks:s}),t);return jn(a,r?.signal)}async*_streamIterator(t,n){const[r]=this._getOptionsList(n??{},1),s=await this.invoke(t,n);if(Qu(s)){for await(const a of s)r?.signal?.throwIfAborted(),yield a;return}if(aC(s)){for(;;){r?.signal?.throwIfAborted();const a=s.next();if(a.done)break;yield a.value}return}yield s}static from(t){return new Sw({func:t})}};function cC(e){if(sd(e))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Fn=class xw extends Ve{static lc_name(){return"RunnableLambda"}lc_namespace=["langchain_core","runnables"];func;constructor(t){if(sd(t.func))return oC.from(t.func);super(t),cC(t.func),this.func=t.func}static from(t){return new xw({func:t})}async _invoke(t,n,r){return new Promise((s,a)=>{const i=Le(n,{callbacks:r?.getChild(),recursionLimit:(n?.recursionLimit??Jc)-1});an.runWithConfig(Ln(i),async()=>{try{let o=await this.func(t,{...i});if(o&&Ve.isRunnable(o)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(t,{...i,recursionLimit:(i.recursionLimit??Jc)-1})}else if(Qu(o)){let c;for await(const u of el(i,o))if(n?.signal?.throwIfAborted(),c===void 0)c=u;else try{c=this._concatOutputChunks(c,u)}catch{c=u}o=c}else if(Bp(o)){let c;for(const u of Zp(i,o))if(n?.signal?.throwIfAborted(),c===void 0)c=u;else try{c=this._concatOutputChunks(c,u)}catch{c=u}o=c}s(o)}catch(o){a(o)}})})}async invoke(t,n){return this._callWithConfig(this._invoke.bind(this),t,n)}async*_transform(t,n,r){let s;for await(const o of t)if(s===void 0)s=o;else try{s=this._concatOutputChunks(s,o)}catch{s=o}const a=Le(r,{callbacks:n?.getChild(),recursionLimit:(r?.recursionLimit??Jc)-1}),i=await new Promise((o,c)=>{an.runWithConfig(Ln(a),async()=>{try{const u=await this.func(s,{...a,config:a});o(u)}catch(u){c(u)}})});if(i&&Ve.isRunnable(i)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");const o=await i.stream(s,a);for await(const c of o)yield c}else if(Qu(i))for await(const o of el(a,i))r?.signal?.throwIfAborted(),yield o;else if(Bp(i))for(const o of Zp(a,i))r?.signal?.throwIfAborted(),yield o;else yield i}transform(t,n){return this._transformStreamWithConfig(t,this._transform.bind(this),n)}async stream(t,n){async function*r(){yield t}const s=Te(n),a=new xr({generator:this.transform(r(),s),config:s});return await a.setup,on.fromAsyncGenerator(a)}},uC=class extends ls{},kw=class extends Ve{static lc_name(){return"RunnableWithFallbacks"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnable;fallbacks;constructor(e){super(e),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const n=Te(t),r=await Mt(n),{runId:s,...a}=n,i=await r?.handleChainStart(this.toJSON(),et(e,"input"),s,void 0,void 0,void 0,a?.runName),o=Le(a,{callbacks:i?.getChild()});return await an.runWithConfig(o,async()=>{let u;for(const l of this.runnables()){n?.signal?.throwIfAborted();try{const d=await l.invoke(e,o);return await i?.handleChainEnd(et(d,"output")),d}catch(d){u===void 0&&(u=d)}}throw u===void 0?new Error("No error stored at end of fallback."):(await i?.handleChainError(u),u)})}async*_streamIterator(e,t){const n=Te(t),r=await Mt(n),{runId:s,...a}=n,i=await r?.handleChainStart(this.toJSON(),et(e,"input"),s,void 0,void 0,void 0,a?.runName);let o,c;for(const l of this.runnables()){n?.signal?.throwIfAborted();const d=Le(a,{callbacks:i?.getChild()});try{const f=await l.stream(e,d);c=el(d,f);break}catch(f){o===void 0&&(o=f)}}if(c===void 0){const l=o??new Error("No error stored at end of fallback.");throw await i?.handleChainError(l),l}let u;try{for await(const l of c){yield l;try{u=u===void 0?u:this._concatOutputChunks(u,l)}catch{u=void 0}}}catch(l){throw await i?.handleChainError(l),l}await i?.handleChainEnd(et(u,"output"))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");const r=this._getOptionsList(t??{},e.length),s=await Promise.all(r.map(o=>Mt(o))),a=await Promise.all(s.map(async(o,c)=>{const u=await o?.handleChainStart(this.toJSON(),et(e[c],"input"),r[c].runId,void 0,void 0,void 0,r[c].runName);return delete r[c].runId,u}));let i;for(const o of this.runnables()){r[0].signal?.throwIfAborted();try{const c=await o.batch(e,a.map((u,l)=>Le(r[l],{callbacks:u?.getChild()})),n);return await Promise.all(a.map((u,l)=>u?.handleChainEnd(et(c[l],"output")))),c}catch(c){i===void 0&&(i=c)}}throw i?(await Promise.all(a.map(o=>o?.handleChainError(i))),i):new Error("No error stored at end of fallbacks.")}};function nn(e){if(typeof e=="function")return new Fn({func:e});if(Ve.isRunnable(e))return e;if(!Array.isArray(e)&&typeof e=="object"){const t={};for(const[n,r]of Object.entries(e))t[n]=nn(r);return new ls({steps:t})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var bd=class extends Ve{static lc_name(){return"RunnableAssign"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;mapper;constructor(e){e instanceof ls&&(e={mapper:e}),super(e),this.mapper=e.mapper}async invoke(e,t){const n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){const r=this.mapper.getStepsKeys(),[s,a]=ad(e),i=this.mapper.transform(a,Le(n,{callbacks:t?.getChild()})),o=i.next();for await(const c of s){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const u=Object.fromEntries(Object.entries(c).filter(([l])=>!r.includes(l)));Object.keys(u).length>0&&(yield u)}yield(await o).value;for await(const c of i)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const r=Te(t),s=new xr({generator:this.transform(n(),r),config:r});return await s.setup,on.fromAsyncGenerator(s)}},Iw=class extends Ve{static lc_name(){return"RunnablePick"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;keys;constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}const r=Te(t),s=new xr({generator:this.transform(n(),r),config:r});return await s.setup,on.fromAsyncGenerator(s)}},tl=class extends rs{name;description;schema;constructor(e){const t=ca.from([Fn.from(async n=>{let r;if($s(n))try{r=await bo(this.schema,n.args)}catch{throw new hi("Received tool input did not match expected schema",JSON.stringify(n.args))}else r=n;return r}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function lC(e,t){const n=t.name??e.getName(),r=t.description??vo(t.schema);return pd(t.schema)?new tl({name:n,description:r,schema:So({input:To()}).transform(s=>s.input),bound:e}):new tl({name:n,description:r,schema:t.schema,bound:e})}const Mi=(e,t)=>{const n=[...new Set(t?.map(s=>{if(typeof s=="string")return s;const a=new s({});if(!("getType"in a)||typeof a.getType!="function")throw new Error("Invalid type provided.");return a.getType()}))],r=e.getType();return n.some(s=>s===r)};function dC(e,t){return Array.isArray(e)?qp(e,t):Fn.from(n=>qp(n,e))}function qp(e,t={}){const{includeNames:n,excludeNames:r,includeTypes:s,excludeTypes:a,includeIds:i,excludeIds:o}=t,c=[];for(const u of e)if(!(r&&u.name&&r.includes(u.name))){{if(a&&Mi(u,a))continue;if(o&&u.id&&o.includes(u.id))continue}s||i||n?(n&&u.name&&n.some(l=>l===u.name)||s&&Mi(u,s)||i&&u.id&&i.some(l=>l===u.id))&&c.push(u):c.push(u)}return c}function fC(e){return Array.isArray(e)?Hp(e):Fn.from(Hp)}function Hp(e){if(!e.length)return[];const t=[];for(const n of e){const r=n,s=t.pop();if(!s)t.push(r);else if(r.getType()==="tool"||r.getType()!==s.getType())t.push(s,r);else{const a=pi(s),i=pi(r),o=a.concat(i);typeof a.content=="string"&&typeof i.content=="string"&&(o.content=`${a.content}
${i.content}`),t.push(mC(o))}}return t}function hC(e,t){if(Array.isArray(e)){const n=e;if(!t)throw new Error("Options parameter is required when providing messages.");return Vp(n,t)}else{const n=e;return Fn.from(r=>Vp(r,n)).withConfig({runName:"trim_messages"})}}async function Vp(e,t){const{maxTokens:n,tokenCounter:r,strategy:s="last",allowPartial:a=!1,endOn:i,startOn:o,includeSystem:c=!1,textSplitter:u}=t;if(o&&s==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(c&&s==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let l;"getNumTokens"in r?l=async f=>(await Promise.all(f.map(p=>r.getNumTokens(p.content)))).reduce((p,m)=>p+m,0):l=async f=>r(f);let d=Aw;if(u&&("splitText"in u?d=u.splitText:d=async f=>u(f)),s==="first")return Ow(e,{maxTokens:n,tokenCounter:l,textSplitter:d,partialStrategy:a?"first":void 0,endOn:i});if(s==="last")return pC(e,{maxTokens:n,tokenCounter:l,textSplitter:d,allowPartial:a,includeSystem:c,startOn:o,endOn:i});throw new Error(`Unrecognized strategy: '${s}'. Must be one of 'first' or 'last'.`)}async function Ow(e,t){const{maxTokens:n,tokenCounter:r,textSplitter:s,partialStrategy:a,endOn:i}=t;let o=[...e],c=0;for(let u=0;u<o.length;u+=1){const l=u>0?o.slice(0,-u):o;if(await r(l)<=n){c=o.length-u;break}}if(c<o.length&&a){let u=!1;if(Array.isArray(o[c].content)){const l=o[c];if(typeof l.content=="string")throw new Error("Expected content to be an array.");const d=l.content.length,f=a==="last"?[...l.content].reverse():l.content;for(let h=1;h<=d;h+=1){const p=a==="first"?f.slice(0,h):f.slice(-h),m=Object.fromEntries(Object.entries(l).filter(([w])=>w!=="type"&&!w.startsWith("lc_"))),b=vd(l.getType(),{...m,content:p}),_=[...o.slice(0,c),b];if(await r(_)<=n)o=_,c+=1,u=!0;else break}u&&a==="last"&&(l.content=[...f].reverse())}if(!u){const l=o[c];let d;if(Array.isArray(l.content)&&l.content.some(f=>typeof f=="string"||f.type==="text")?d=l.content.find(h=>h.type==="text"&&h.text)?.text:typeof l.content=="string"&&(d=l.content),d){const f=await s(d),h=f.length;a==="last"&&f.reverse();for(let p=0;p<h-1;p+=1)if(f.pop(),l.content=f.join(""),await r([...o.slice(0,c),l])<=n){a==="last"&&(l.content=[...f].reverse().join("")),o=[...o.slice(0,c),l],c+=1;break}}}}if(i){const u=Array.isArray(i)?i:[i];for(;c>0&&!Mi(o[c-1],u);)c-=1}return o.slice(0,c)}async function pC(e,t){const{allowPartial:n=!1,includeSystem:r=!1,endOn:s,startOn:a,...i}=t;let o=e.map(l=>{const d=Object.fromEntries(Object.entries(l).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return vd(l.getType(),d,Dl(l))});if(s){const l=Array.isArray(s)?s:[s];for(;o.length>0&&!Mi(o[o.length-1],l);)o=o.slice(0,-1)}const c=r&&o[0]?.getType()==="system";let u=c?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return u=await Ow(u,{...i,partialStrategy:n?"last":void 0,endOn:a}),c?[u[0],...u.slice(1).reverse()]:u.reverse()}const Gp={human:{message:sn,messageChunk:ra},ai:{message:wt,messageChunk:Sn},system:{message:Mn,messageChunk:Yn},developer:{message:Mn,messageChunk:Yn},tool:{message:En,messageChunk:ea},function:{message:eo,messageChunk:na},generic:{message:Sr,messageChunk:ta},remove:{message:fi,messageChunk:fi}};function vd(e,t,n){let r,s;switch(e){case"human":n?r=new ra(t):s=new sn(t);break;case"ai":if(n){let a={...t};"tool_calls"in a&&(a={...a,tool_call_chunks:a.tool_calls?.map(i=>({...i,type:"tool_call_chunk",index:void 0,args:JSON.stringify(i.args)}))}),r=new Sn(a)}else s=new wt(t);break;case"system":n?r=new Yn(t):s=new Mn(t);break;case"developer":n?r=new Yn({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):s=new Mn({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)n?r=new ea(t):s=new En(t);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(n)r=new na(t);else{if(!t.name)throw new Error("FunctionMessage must have a 'name' field");s=new eo(t)}break;case"generic":if("role"in t)n?r=new ta(t):s=new Sr(t);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${e}`)}if(n&&r)return r;if(s)return s;throw new Error(`Unrecognized message type ${e}`)}function mC(e){const t=e.getType();let n;const r=Object.fromEntries(Object.entries(e).filter(([s])=>!["type","tool_call_chunks"].includes(s)&&!s.startsWith("lc_")));if(t in Gp&&(n=vd(t,r)),!n)throw new Error(`Unrecognized message chunk class ${t}. Supported classes are ${Object.keys(Gp)}`);return n}function Aw(e){const t=e.split(`
`);return Promise.resolve([...t.slice(0,-1).map(n=>`${n}
`),t[t.length-1]])}const gC=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"],_C=["image","video","audio","text-plain","file"],yC=["text","reasoning",...gC,..._C];var wC={};be(wC,{AIMessage:()=>wt,AIMessageChunk:()=>Sn,BaseMessage:()=>Un,BaseMessageChunk:()=>ar,ChatMessage:()=>Sr,ChatMessageChunk:()=>ta,DEFAULT_MERGE_IGNORE_KEYS:()=>Xg,FunctionMessage:()=>eo,FunctionMessageChunk:()=>na,HumanMessage:()=>sn,HumanMessageChunk:()=>ra,KNOWN_BLOCK_TYPES:()=>yC,RemoveMessage:()=>fi,SystemMessage:()=>Mn,SystemMessageChunk:()=>Yn,ToolMessage:()=>En,ToolMessageChunk:()=>ea,_isMessageFieldWithRole:()=>e_,_mergeDicts:()=>ft,_mergeLists:()=>Qs,_mergeObj:()=>Yg,_mergeStatus:()=>Kg,coerceMessageLikeToMessage:()=>Rs,collapseToolCallChunks:()=>u_,convertToChunk:()=>pi,convertToOpenAIImageBlock:()=>qg,convertToProviderContentBlock:()=>Ml,defaultTextSplitter:()=>Aw,defaultToolCallParser:()=>Bl,filterMessages:()=>dC,getBufferString:()=>Hl,iife:()=>c_,isAIMessage:()=>no,isAIMessageChunk:()=>Tu,isBase64ContentBlock:()=>Pl,isBaseMessage:()=>Jn,isBaseMessageChunk:()=>Dl,isChatMessage:()=>g0,isChatMessageChunk:()=>_0,isDataContentBlock:()=>vn,isDirectToolOutput:()=>Fl,isFunctionMessage:()=>y0,isFunctionMessageChunk:()=>w0,isHumanMessage:()=>b0,isHumanMessageChunk:()=>v0,isIDContentBlock:()=>Zg,isMessage:()=>Hg,isOpenAIToolCallArray:()=>f0,isPlainTextContentBlock:()=>jv,isSystemMessage:()=>E0,isSystemMessageChunk:()=>T0,isToolMessage:()=>r_,isToolMessageChunk:()=>s_,isURLContentBlock:()=>Nl,mapChatMessagesToStoredMessages:()=>F0,mapStoredMessageToChatMessage:()=>Vl,mapStoredMessagesToChatMessages:()=>U0,mergeContent:()=>Pn,mergeMessageRuns:()=>fC,mergeResponseMetadata:()=>t_,mergeUsageMetadata:()=>Ul,parseBase64DataUrl:()=>zs,parseMimeType:()=>wu,trimMessages:()=>hC});const br=e=>e();function ua(e){return e?!!(/^o\d/.test(e??"")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat")):!1}function bC(e){return e.role!=="system"&&e.role!=="developer"&&e.role!=="assistant"&&e.role!=="user"&&e.role!=="function"&&e.role!=="tool"&&console.warn(`Unknown message role: ${e.role}`),e.role}function Jp(e){return e.metadata?.filename??e.metadata?.name??e.metadata?.title}function Li(e){const t=e.metadata?.filename??e.metadata?.name??e.metadata?.title;if(!t)throw new Error("a filename or name or title is needed via meta-data for OpenAI when working with multimodal blocks");return t}function la(e){const t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!Sr.isInstance(e))throw new Error("Invalid generic chat message");return bC(e);default:throw new Error(`Unknown message type: ${t}`)}}function vC(e){return e.includes("gpt-5.2-pro")}function EC(e){const{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i,azureOpenAIEndpoint:o}=e;if((r||i)&&s&&t)return`${s}/${t}`;if((r||i)&&o&&t)return`${o}/openai/deployments/${t}`;if(r||i){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${t}`}return a}function Wp(e){return typeof Headers<"u"&&e!==null&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Headers]"}function TC(e){const t=br(()=>{if(Wp(e))return e;if(Array.isArray(e))return new Headers(e);if(typeof e=="object"&&e!==null&&"values"in e&&Wp(e.values))return e.values;if(typeof e=="object"&&e!==null){const n=Object.entries(e).filter(([,r])=>typeof r=="string").map(([r,s])=>[r,s]);return new Headers(n)}return new Headers});return Object.fromEntries(t.entries())}function SC(){let e=Gl();return(e==="node"||e==="deno")&&(e=`(${e}/${process.version}; ${process.platform}; ${process.arch})`),e}function xC(e,t=!1,n="1.0.0"){const r=TC(e),s=SC(),a=`langchainjs${t?"-azure":""}-openai`;return{...r,"User-Agent":r["User-Agent"]?`${a}/${n} (${s})${r["User-Agent"]}`:`${a}/${n} (${s})`}}function Ed(e){return e!==void 0&&Array.isArray(e.lc_namespace)}function Td(e){return e!==void 0&&Ve.isRunnable(e)&&"lc_name"in e.constructor&&typeof e.constructor.lc_name=="function"&&e.constructor.lc_name()==="RunnableToolLike"}function Sd(e){return!!e&&typeof e=="object"&&"name"in e&&"schema"in e&&(yn(e.schema)||e.schema!=null&&typeof e.schema=="object"&&"type"in e.schema&&typeof e.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(e.schema.type))}function xo(e){return Sd(e)||Td(e)||Ed(e)}var kC={};be(kC,{convertToOpenAIFunction:()=>Cw,convertToOpenAITool:()=>$w,isLangChainTool:()=>xo,isRunnableToolLike:()=>Td,isStructuredTool:()=>Ed,isStructuredToolParams:()=>Sd});function Cw(e,t){const n=typeof t=="number"?void 0:t;return{name:e.name,description:e.description,parameters:tn(e.schema),...n?.strict!==void 0?{strict:n.strict}:{}}}function $w(e,t){const n=typeof t=="number"?void 0:t;let r;return xo(e)?r={type:"function",function:Cw(e)}:r=e,n?.strict!==void 0&&(r.function.strict=n.strict),r}var IC={};be(IC,{extendInteropZodObject:()=>rO,getInteropZodDefaultGetter:()=>aO,getInteropZodObjectShape:()=>Bu,getSchemaDescription:()=>vo,interopParse:()=>eO,interopParseAsync:()=>bo,interopSafeParse:()=>QI,interopSafeParseAsync:()=>sw,interopZodObjectMakeFieldsOptional:()=>cO,interopZodObjectPartial:()=>sO,interopZodObjectPassthrough:()=>Zu,interopZodObjectStrict:()=>Oi,interopZodTransformInputSchema:()=>ow,isInteropZodError:()=>cw,isInteropZodLiteral:()=>YI,isInteropZodObject:()=>nO,isInteropZodSchema:()=>yn,isShapelessZodSchema:()=>tO,isSimpleStringZodSchema:()=>pd,isZodArrayV4:()=>Eo,isZodLiteralV3:()=>nw,isZodLiteralV4:()=>rw,isZodNullableV4:()=>iw,isZodObjectV3:()=>md,isZodObjectV4:()=>bn,isZodOptionalV4:()=>aw,isZodSchema:()=>XI,isZodSchemaV3:()=>Xe,isZodSchemaV4:()=>De});function OC(e,t){let n;return xo(e)?n=$w(e):n=e,t?.strict!==void 0&&(n.function.strict=t.strict),n}function AC(e){return e.anyOf!==void 0&&Array.isArray(e.anyOf)}function CC(e){const t=["namespace functions {",""];for(const n of e)n.description&&t.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(t.push(`type ${n.name} = (_: {`),t.push(Rw(n.parameters,0)),t.push("}) => any;")):t.push(`type ${n.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join(`
`)}function Rw(e,t){const n=[];for(const[r,s]of Object.entries(e.properties??{}))s.description&&t<2&&n.push(`// ${s.description}`),e.required?.includes(r)?n.push(`${r}: ${ji(s,t)},`):n.push(`${r}?: ${ji(s,t)},`);return n.map(r=>" ".repeat(t)+r).join(`
`)}function ji(e,t){if(AC(e))return e.anyOf.map(n=>ji(n,t)).join(" | ");switch(e.type){case"string":return e.enum?e.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return e.enum?e.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return e.enum?e.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Rw(e,t+2),"}"].join(`
`);case"array":return e.items?`${ji(e.items,t)}[]`:"any[]";default:return""}}function Nw(e){if(e)return e==="any"||e==="required"?"required":e==="auto"?"auto":e==="none"?"none":typeof e=="string"?{type:"function",function:{name:e}}:e}function xd(e){return"type"in e&&e.type!=="function"}function $C(e){return typeof e=="object"&&e!==null&&"extras"in e&&typeof e.extras=="object"&&e.extras!==null&&"providerToolDefinition"in e.extras&&typeof e.extras.providerToolDefinition=="object"&&e.extras.providerToolDefinition!==null}function RC(e){return e!=null&&typeof e=="object"&&"type"in e&&e.type!=="function"}function zi(e){return typeof e=="object"&&e!==null&&"metadata"in e&&typeof e.metadata=="object"&&e.metadata!==null&&"customTool"in e.metadata&&typeof e.metadata.customTool=="object"&&e.metadata.customTool!==null}function Pw(e){return"type"in e&&e.type==="custom"&&"custom"in e&&typeof e.custom=="object"&&e.custom!==null}function NC(e){if(e.type==="custom_tool_call")return{...e,type:"tool_call",call_id:e.id,id:e.call_id,name:e.name,isCustomTool:!0,args:{input:e.input}}}function PC(e){if(e.type==="computer_call")return{...e,type:"tool_call",call_id:e.id,id:e.call_id,name:"computer_use",isComputerTool:!0,args:{action:e.action}}}function MC(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="tool_call"&&"isComputerTool"in e&&e.isComputerTool===!0}function LC(e){return typeof e=="object"&&e!==null&&"type"in e&&e.type==="tool_call"&&"isCustomTool"in e&&e.isCustomTool===!0}function jC(e){const t=()=>{if(e.custom.format){if(e.custom.format.type==="grammar")return{type:"grammar",definition:e.custom.format.grammar.definition,syntax:e.custom.format.grammar.syntax};if(e.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:e.custom.name,description:e.custom.description,format:t()}}function zC(e){const t=()=>{if(e.format){if(e.format.type==="grammar")return{type:"grammar",grammar:{definition:e.format.definition,syntax:e.format.syntax}};if(e.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:e.name,description:e.description,format:t()}}}const DC=O("ZodISODateTime",(e,t)=>{ok.init(e,t),Ue.init(e,t)});function UC(e){return lI(DC,e)}const FC=O("ZodISODate",(e,t)=>{ck.init(e,t),Ue.init(e,t)});function BC(e){return dI(FC,e)}const ZC=O("ZodISOTime",(e,t)=>{uk.init(e,t),Ue.init(e,t)});function qC(e){return fI(ZC,e)}const HC=O("ZodISODuration",(e,t)=>{lk.init(e,t),Ue.init(e,t)});function VC(e){return hI(HC,e)}const GC=(e,t)=>{gy.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Qx(e,n)},flatten:{value:n=>Yx(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Du,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Du,2)}},isEmpty:{get(){return e.issues.length===0}}})},Bt=O("ZodError",GC,{Parent:Error}),JC=ho(Bt),WC=mo(Bt),KC=go(Bt),XC=_o(Bt),YC=s1(Bt),QC=a1(Bt),e$=i1(Bt),t$=o1(Bt),n$=c1(Bt),r$=u1(Bt),s$=l1(Bt),a$=d1(Bt),qe=O("ZodType",(e,t)=>(Ze.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:Ii(e,"input"),output:Ii(e,"output")}}),e.toJSONSchema=$I(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(ir(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),e.with=e.check,e.clone=(n,r)=>ut(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>JC(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>KC(e,n,r),e.parseAsync=async(n,r)=>WC(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>XC(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>YC(e,n,r),e.decode=(n,r)=>QC(e,n,r),e.encodeAsync=async(n,r)=>e$(e,n,r),e.decodeAsync=async(n,r)=>t$(e,n,r),e.safeEncode=(n,r)=>n$(e,n,r),e.safeDecode=(n,r)=>r$(e,n,r),e.safeEncodeAsync=async(n,r)=>s$(e,n,r),e.safeDecodeAsync=async(n,r)=>a$(e,n,r),e.refine=(n,r)=>e.check(Q$(n,r)),e.superRefine=n=>e.check(eR(n)),e.overwrite=n=>e.check(us(n)),e.optional=()=>Qp(e),e.exactOptional=()=>U$(e),e.nullable=()=>em(e),e.nullish=()=>Qp(em(e)),e.nonoptional=n=>V$(e,n),e.array=()=>da(e),e.or=n=>C$([e,n]),e.and=n=>N$(e,n),e.transform=n=>tm(e,z$(n)),e.default=n=>Z$(e,n),e.prefault=n=>H$(e,n),e.catch=n=>J$(e,n),e.pipe=n=>tm(e,n),e.readonly=()=>X$(e),e.describe=n=>{const r=e.clone();return st.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){return st.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return st.get(e);const r=e.clone();return st.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=n=>n(e),e)),Mw=O("_ZodString",(e,t)=>{fd.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(r,s,a)=>Ly(e,r,s);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(gI(...r)),e.includes=(...r)=>e.check(wI(...r)),e.startsWith=(...r)=>e.check(bI(...r)),e.endsWith=(...r)=>e.check(vI(...r)),e.min=(...r)=>e.check(Ti(...r)),e.max=(...r)=>e.check(Py(...r)),e.length=(...r)=>e.check(My(...r)),e.nonempty=(...r)=>e.check(Ti(1,...r)),e.lowercase=r=>e.check(_I(r)),e.uppercase=r=>e.check(yI(r)),e.trim=()=>e.check(TI()),e.normalize=(...r)=>e.check(EI(...r)),e.toLowerCase=()=>e.check(SI()),e.toUpperCase=()=>e.check(xI()),e.slugify=()=>e.check(kI())}),i$=O("ZodString",(e,t)=>{fd.init(e,t),Mw.init(e,t),e.email=n=>e.check(Zk(o$,n)),e.url=n=>e.check(Jk(c$,n)),e.jwt=n=>e.check(uI(T$,n)),e.emoji=n=>e.check(Wk(u$,n)),e.guid=n=>e.check(mp(Kp,n)),e.uuid=n=>e.check(qk(Ua,n)),e.uuidv4=n=>e.check(Hk(Ua,n)),e.uuidv6=n=>e.check(Vk(Ua,n)),e.uuidv7=n=>e.check(Gk(Ua,n)),e.nanoid=n=>e.check(Kk(l$,n)),e.guid=n=>e.check(mp(Kp,n)),e.cuid=n=>e.check(Xk(d$,n)),e.cuid2=n=>e.check(Yk(f$,n)),e.ulid=n=>e.check(Qk(h$,n)),e.base64=n=>e.check(iI(b$,n)),e.base64url=n=>e.check(oI(v$,n)),e.xid=n=>e.check(eI(p$,n)),e.ksuid=n=>e.check(tI(m$,n)),e.ipv4=n=>e.check(nI(g$,n)),e.ipv6=n=>e.check(rI(_$,n)),e.cidrv4=n=>e.check(sI(y$,n)),e.cidrv6=n=>e.check(aI(w$,n)),e.e164=n=>e.check(cI(E$,n)),e.datetime=n=>e.check(UC(n)),e.date=n=>e.check(BC(n)),e.time=n=>e.check(qC(n)),e.duration=n=>e.check(VC(n))});function Nt(e){return Bk(i$,e)}const Ue=O("ZodStringFormat",(e,t)=>{ze.init(e,t),Mw.init(e,t)}),o$=O("ZodEmail",(e,t)=>{Y1.init(e,t),Ue.init(e,t)}),Kp=O("ZodGUID",(e,t)=>{K1.init(e,t),Ue.init(e,t)}),Ua=O("ZodUUID",(e,t)=>{X1.init(e,t),Ue.init(e,t)}),c$=O("ZodURL",(e,t)=>{Q1.init(e,t),Ue.init(e,t)}),u$=O("ZodEmoji",(e,t)=>{ek.init(e,t),Ue.init(e,t)}),l$=O("ZodNanoID",(e,t)=>{tk.init(e,t),Ue.init(e,t)}),d$=O("ZodCUID",(e,t)=>{nk.init(e,t),Ue.init(e,t)}),f$=O("ZodCUID2",(e,t)=>{rk.init(e,t),Ue.init(e,t)}),h$=O("ZodULID",(e,t)=>{sk.init(e,t),Ue.init(e,t)}),p$=O("ZodXID",(e,t)=>{ak.init(e,t),Ue.init(e,t)}),m$=O("ZodKSUID",(e,t)=>{ik.init(e,t),Ue.init(e,t)}),g$=O("ZodIPv4",(e,t)=>{dk.init(e,t),Ue.init(e,t)}),_$=O("ZodIPv6",(e,t)=>{fk.init(e,t),Ue.init(e,t)}),y$=O("ZodCIDRv4",(e,t)=>{hk.init(e,t),Ue.init(e,t)}),w$=O("ZodCIDRv6",(e,t)=>{pk.init(e,t),Ue.init(e,t)}),b$=O("ZodBase64",(e,t)=>{mk.init(e,t),Ue.init(e,t)}),v$=O("ZodBase64URL",(e,t)=>{_k.init(e,t),Ue.init(e,t)}),E$=O("ZodE164",(e,t)=>{yk.init(e,t),Ue.init(e,t)}),T$=O("ZodJWT",(e,t)=>{bk.init(e,t),Ue.init(e,t)}),Lw=O("ZodNumber",(e,t)=>{ky.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(r,s,a)=>jy(e,r,s),e.gt=(r,s)=>e.check(_p(r,s)),e.gte=(r,s)=>e.check(Xc(r,s)),e.min=(r,s)=>e.check(Xc(r,s)),e.lt=(r,s)=>e.check(gp(r,s)),e.lte=(r,s)=>e.check(Kc(r,s)),e.max=(r,s)=>e.check(Kc(r,s)),e.int=r=>e.check(Xp(r)),e.safe=r=>e.check(Xp(r)),e.positive=r=>e.check(_p(0,r)),e.nonnegative=r=>e.check(Xc(0,r)),e.negative=r=>e.check(gp(0,r)),e.nonpositive=r=>e.check(Kc(0,r)),e.multipleOf=(r,s)=>e.check(yp(r,s)),e.step=(r,s)=>e.check(yp(r,s)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function dt(e){return pI(Lw,e)}const S$=O("ZodNumberFormat",(e,t)=>{vk.init(e,t),Lw.init(e,t)});function Xp(e){return mI(S$,e)}const x$=O("ZodUnknown",(e,t)=>{Iy.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Dy()});function Yp(){return Ry(x$)}const k$=O("ZodNever",(e,t)=>{Oy.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>zy(e,n,r)});function I$(e){return Ny(k$,e)}const O$=O("ZodArray",(e,t)=>{Ek.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>qy(e,n,r,s),e.element=t.element,e.min=(n,r)=>e.check(Ti(n,r)),e.nonempty=n=>e.check(Ti(1,n)),e.max=(n,r)=>e.check(Py(n,r)),e.length=(n,r)=>e.check(My(n,r)),e.unwrap=()=>e.element});function da(e,t){return II(O$,e,t)}const A$=O("ZodObject",(e,t)=>{Sk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Hy(e,n,r,s),Oe(e,"shape",()=>t.shape),e.keyof=()=>Id(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Yp()}),e.loose=()=>e.clone({...e._zod.def,catchall:Yp()}),e.strict=()=>e.clone({...e._zod.def,catchall:I$()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>hy(e,n),e.safeExtend=n=>Wx(e,n),e.merge=n=>Kx(e,n),e.pick=n=>Gx(e,n),e.omit=n=>Jx(e,n),e.partial=(...n)=>py(zw,e,n[0]),e.required=(...n)=>Xx(Dw,e,n[0])});function ht(e,t){const n={type:"object",shape:e??{},...ee(t)};return new A$(n)}const jw=O("ZodUnion",(e,t)=>{$y.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Vy(e,n,r,s),e.options=t.options});function C$(e,t){return new jw({type:"union",options:e,...ee(t)})}const $$=O("ZodDiscriminatedUnion",(e,t)=>{jw.init(e,t),xk.init(e,t)});function kd(e,t,n){return new $$({type:"union",options:t,discriminator:e,...ee(n)})}const R$=O("ZodIntersection",(e,t)=>{kk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Gy(e,n,r,s)});function N$(e,t){return new R$({type:"intersection",left:e,right:t})}const P$=O("ZodRecord",(e,t)=>{Ik.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Jy(e,n,r,s),e.keyType=t.keyType,e.valueType=t.valueType});function M$(e,t,n){return new P$({type:"record",keyType:e,valueType:t,...ee(n)})}const nl=O("ZodEnum",(e,t)=>{Ok.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(r,s,a)=>Uy(e,r,s),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,s)=>{const a={};for(const i of r)if(n.has(i))a[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new nl({...t,checks:[],...ee(s),entries:a})},e.exclude=(r,s)=>{const a={...t.entries};for(const i of r)if(n.has(i))delete a[i];else throw new Error(`Key ${i} not found in enum`);return new nl({...t,checks:[],...ee(s),entries:a})}});function Id(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new nl({type:"enum",entries:n,...ee(t)})}const L$=O("ZodLiteral",(e,t)=>{Ak.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Fy(e,n,r),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function jt(e,t){return new L$({type:"literal",values:Array.isArray(e)?e:[e],...ee(t)})}const j$=O("ZodTransform",(e,t)=>{Ck.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Zy(e,n),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new cy(e.constructor.name);n.addIssue=a=>{if(typeof a=="string")n.issues.push(Gs(a,n.value,t));else{const i=a;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),n.issues.push(Gs(i))}};const s=t.transform(n.value,n);return s instanceof Promise?s.then(a=>(n.value=a,n)):(n.value=s,n)}});function z$(e){return new j$({type:"transform",transform:e})}const zw=O("ZodOptional",(e,t)=>{wo.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>hd(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function Qp(e){return new zw({type:"optional",innerType:e})}const D$=O("ZodExactOptional",(e,t)=>{$k.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>hd(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function U$(e){return new D$({type:"optional",innerType:e})}const F$=O("ZodNullable",(e,t)=>{Rk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Wy(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function em(e){return new F$({type:"nullable",innerType:e})}const B$=O("ZodDefault",(e,t)=>{Nk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Xy(e,n,r,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Z$(e,t){return new B$({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():fy(t)}})}const q$=O("ZodPrefault",(e,t)=>{Pk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Yy(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function H$(e,t){return new q$({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():fy(t)}})}const Dw=O("ZodNonOptional",(e,t)=>{Mk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Ky(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function V$(e,t){return new Dw({type:"nonoptional",innerType:e,...ee(t)})}const G$=O("ZodCatch",(e,t)=>{Lk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>Qy(e,n,r,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function J$(e,t){return new G$({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const W$=O("ZodPipe",(e,t)=>{jk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>ew(e,n,r,s),e.in=t.in,e.out=t.out});function tm(e,t){return new W$({type:"pipe",in:e,out:t})}const K$=O("ZodReadonly",(e,t)=>{zk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>tw(e,n,r,s),e.unwrap=()=>e._zod.def.innerType});function X$(e){return new K$({type:"readonly",innerType:e})}const Y$=O("ZodCustom",(e,t)=>{Dk.init(e,t),qe.init(e,t),e._zod.processJSONSchema=(n,r,s)=>By(e,n)});function Q$(e,t={}){return OI(Y$,e,t)}function eR(e){return AI(e)}const tR=Symbol("Let zodToJsonSchema decide on which parser to use"),nm={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},nR=e=>typeof e=="string"?{...nm,basePath:["#"],definitions:{},name:e}:{...nm,basePath:["#"],definitions:{},...e},rl=e=>"_def"in e?e._def:e;function rR(e){if(!e)return!0;for(const t in e)return!1;return!0}const sR=e=>{const t=nR(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([r,s])=>[rl(s),{def:rl(s),path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function Uw(e,t,n,r){r?.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ce(e,t,n,r,s){e[t]=n,Uw(e,t,r,s)}function aR(){return{}}function iR(e,t){const n={type:"array"};return e.type?._def?.typeName!==k.ZodAny&&(n.items=xe(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ce(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ce(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ce(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ce(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function oR(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Ce(n,"minimum",r.value,r.message,t):Ce(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ce(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ce(n,"maximum",r.value,r.message,t):Ce(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ce(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ce(n,"multipleOf",r.value,r.message,t);break}return n}function cR(){return{type:"boolean"}}function uR(e,t){return xe(e.type._def,t)}const lR=(e,t)=>xe(e.innerType._def,t);function Fw(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>Fw(e,t,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return dR(e,t)}}const dR=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Ce(n,"minimum",r.value,r.message,t);break;case"max":Ce(n,"maximum",r.value,r.message,t);break}return n};function fR(e,t){return{...xe(e.innerType._def,t),default:e.defaultValue()}}function hR(e,t,n){return t.effectStrategy==="input"?xe(e.schema._def,t,n):{}}function pR(e){return{type:"string",enum:[...e.values]}}const mR=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function gR(e,t){const n=[xe(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),xe(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(mR(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...c}=a;i=c}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function _R(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let nu;const cr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(nu===void 0&&(nu=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),nu),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Bw(e,t){const n={type:"string"};function r(s){return t.patternStrategy==="escape"?yR(s):s}if(e.checks)for(const s of e.checks)switch(s.kind){case"min":Ce(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,t);break;case"max":Ce(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Gt(n,"email",s.message,t);break;case"format:idn-email":Gt(n,"idn-email",s.message,t);break;case"pattern:zod":Jt(n,cr.email,s.message,t);break}break;case"url":Gt(n,"uri",s.message,t);break;case"uuid":Gt(n,"uuid",s.message,t);break;case"regex":Jt(n,s.regex,s.message,t);break;case"cuid":Jt(n,cr.cuid,s.message,t);break;case"cuid2":Jt(n,cr.cuid2,s.message,t);break;case"startsWith":Jt(n,RegExp(`^${r(s.value)}`),s.message,t);break;case"endsWith":Jt(n,RegExp(`${r(s.value)}$`),s.message,t);break;case"datetime":Gt(n,"date-time",s.message,t);break;case"date":Gt(n,"date",s.message,t);break;case"time":Gt(n,"time",s.message,t);break;case"duration":Gt(n,"duration",s.message,t);break;case"length":Ce(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,t),Ce(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,t);break;case"includes":{Jt(n,RegExp(r(s.value)),s.message,t);break}case"ip":{s.version!=="v6"&&Gt(n,"ipv4",s.message,t),s.version!=="v4"&&Gt(n,"ipv6",s.message,t);break}case"emoji":Jt(n,cr.emoji,s.message,t);break;case"ulid":{Jt(n,cr.ulid,s.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Gt(n,"binary",s.message,t);break}case"contentEncoding:base64":{Ce(n,"contentEncoding","base64",s.message,t);break}case"pattern:zod":{Jt(n,cr.base64,s.message,t);break}}break}case"nanoid":Jt(n,cr.nanoid,s.message,t)}return n}const yR=e=>Array.from(e).map(t=>/[a-zA-Z0-9]/.test(t)?t:`\\${t}`).join(""),Gt=(e,t,n,r)=>{e.format||e.anyOf?.some(s=>s.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ce(e,"format",t,n,r)},Jt=(e,t,n,r)=>{e.pattern||e.allOf?.some(s=>s.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:rm(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ce(e,"pattern",rm(t,r),n,r)},rm=(e,t)=>{const n=typeof e=="function"?e():e;if(!t.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},s=r.i?n.source.toLowerCase():n.source;let a="",i=!1,o=!1,c=!1;for(let u=0;u<s.length;u++){if(i){a+=s[u],i=!1;continue}if(r.i){if(o){if(s[u].match(/[a-z]/)){c?(a+=s[u],a+=`${s[u-2]}-${s[u]}`.toUpperCase(),c=!1):s[u+1]==="-"&&s[u+2]?.match(/[a-z]/)?(a+=s[u],c=!0):a+=`${s[u]}${s[u].toUpperCase()}`;continue}}else if(s[u].match(/[a-z]/)){a+=`[${s[u]}${s[u].toUpperCase()}]`;continue}}if(r.m){if(s[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(s[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&s[u]==="."){a+=o?`${s[u]}\r
`:`[${s[u]}\r
]`;continue}a+=s[u],s[u]==="\\"?i=!0:o&&s[u]==="]"?o=!1:!o&&s[u]==="["&&(o=!0)}try{const u=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a};function Zw(e,t){if(t.target==="openApi3"&&e.keyType?._def.typeName===k.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,s)=>({...r,[s]:xe(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:xe(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if(t.target==="openApi3")return n;if(e.keyType?._def.typeName===k.ZodString&&e.keyType._def.checks?.length){const r=Object.entries(Bw(e.keyType._def,t)).reduce((s,[a,i])=>a==="type"?s:{...s,[a]:i},{});return{...n,propertyNames:r}}else if(e.keyType?._def.typeName===k.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};return n}function wR(e,t){if(t.mapStrategy==="record")return Zw(e,t);const n=xe(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},r=xe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function bR(e){const t=e.values,r=Object.keys(e.values).filter(a=>typeof t[t[a]]!="number").map(a=>t[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function vR(){return{not:{}}}function ER(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Di={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function TR(e,t){if(t.target==="openApi3")return sm(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in Di&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=Di[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return sm(e,t)}const sm=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,s)=>xe(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function SR(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"||t.nullableStrategy==="property"?{type:Di[e.innerType._def.typeName],nullable:!0}:{type:[Di[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=xe(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=xe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function xR(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Uw(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Ce(n,"minimum",r.value,r.message,t):Ce(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ce(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ce(n,"maximum",r.value,r.message,t):Ce(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ce(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ce(n,"multipleOf",r.value,r.message,t);break}return n}function kR(e,t){return t.removeAdditionalStrategy==="strict"?e.catchall._def.typeName==="ZodNever"?e.unknownKeys!=="strict":xe(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:e.catchall._def.typeName==="ZodNever"?e.unknownKeys==="passthrough":xe(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function IR(e,t){const n={type:"object",...Object.entries(e.shape()).reduce((r,[s,a])=>{if(a===void 0||a._def===void 0)return r;const i=[...t.currentPath,"properties",s],o=xe(a._def,{...t,currentPath:i,propertyPath:i});if(o===void 0)return r;if(t.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&typeof a._def?.defaultValue>"u")throw new Error(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...r.properties,[s]:o},required:a.isOptional()&&!t.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:kR(e,t)};return n.required.length||delete n.required,n}const OR=(e,t)=>{if(t.propertyPath&&t.currentPath.slice(0,t.propertyPath.length).toString()===t.propertyPath.toString())return xe(e.innerType._def,{...t,currentPath:t.currentPath});const n=xe(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},AR=(e,t)=>{if(t.pipeStrategy==="input")return xe(e.in._def,t);if(t.pipeStrategy==="output")return xe(e.out._def,t);const n=xe(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=xe(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function CR(e,t){return xe(e.type._def,t)}function $R(e,t){const r={type:"array",uniqueItems:!0,items:xe(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ce(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ce(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function RR(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>xe(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:xe(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>xe(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function NR(){return{not:{}}}function PR(){return{}}const MR=(e,t)=>xe(e.innerType._def,t);function xe(e,t,n=!1){const r=t.seen.get(e);if(t.override){const i=t.override?.(e,t,r,n);if(i!==tR)return i}if(r&&!n){const i=LR(r,t);if(i!==void 0)return"$ref"in i&&t.seenRefs.add(i.$ref),i}const s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);const a=zR(e,e.typeName,t,n);return a&&DR(e,t,a),s.jsonSchema=a,a}const LR=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":const n=e.path.slice(t.basePath.length+1).join("_");return n!==t.name&&t.nameStrategy==="duplicate-ref"&&(t.definitions[n]=e.def),{$ref:[...t.basePath,t.definitionPath,n].join("/")};case"relative":return{$ref:jR(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,s)=>t.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):t.$refStrategy==="seen"?{}:void 0}},jR=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},zR=(e,t,n,r)=>{switch(t){case k.ZodString:return Bw(e,n);case k.ZodNumber:return xR(e,n);case k.ZodObject:return IR(e,n);case k.ZodBigInt:return oR(e,n);case k.ZodBoolean:return cR();case k.ZodDate:return Fw(e,n);case k.ZodUndefined:return NR();case k.ZodNull:return ER(n);case k.ZodArray:return iR(e,n);case k.ZodUnion:case k.ZodDiscriminatedUnion:return TR(e,n);case k.ZodIntersection:return gR(e,n);case k.ZodTuple:return RR(e,n);case k.ZodRecord:return Zw(e,n);case k.ZodLiteral:return _R(e,n);case k.ZodEnum:return pR(e);case k.ZodNativeEnum:return bR(e);case k.ZodNullable:return SR(e,n);case k.ZodOptional:return OR(e,n);case k.ZodMap:return wR(e,n);case k.ZodSet:return $R(e,n);case k.ZodLazy:return xe(e.getter()._def,n);case k.ZodPromise:return CR(e,n);case k.ZodNaN:case k.ZodNever:return vR();case k.ZodEffects:return hR(e,n,r);case k.ZodAny:return aR();case k.ZodUnknown:return PR();case k.ZodDefault:return fR(e,n);case k.ZodBranded:return uR(e,n);case k.ZodReadonly:return MR(e,n);case k.ZodCatch:return lR(e,n);case k.ZodPipeline:return AR(e,n);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(s=>{})()}},DR=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),UR=(e,t)=>{const n=sR(t),r=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=xe(e._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},a=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;a!==void 0&&(s.title=a);const i=(()=>{if(rR(n.definitions))return;const c={},u=new Set;for(let l=0;l<500;l++){const d=Object.entries(n.definitions).filter(([f])=>!u.has(f));if(d.length===0)break;for(const[f,h]of d)c[f]=xe(rl(h),{...n,currentPath:[...n.basePath,n.definitionPath,f]},!0)??{},u.add(f)}return c})(),o=r===void 0?i?{...s,[n.definitionPath]:i}:s:n.nameStrategy==="duplicate-ref"?{...s,...i||n.seenRefs.size?{[n.definitionPath]:{...i,...n.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...i,[r]:s}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function FR(e){if(e.type!=="object")throw new Error(`Root schema must have type: 'object' but got type: ${e.type?`'${e.type}'`:"undefined"}`);const t=structuredClone(e);return An(t,[],t)}function sl(e){if(typeof e=="boolean")return!1;if(e.type==="null")return!0;for(const t of e.oneOf??[])if(sl(t))return!0;for(const t of e.anyOf??[])if(sl(t))return!0;return!1}function An(e,t,n){if(typeof e=="boolean")throw new TypeError(`Expected object schema but got boolean; path=${t.join("/")}`);if(!dr(e))throw new TypeError(`Expected ${JSON.stringify(e)} to be an object; path=${t.join("/")}`);const r=e.$defs;if(dr(r))for(const[f,h]of Object.entries(r))An(h,[...t,"$defs",f],n);const s=e.definitions;if(dr(s))for(const[f,h]of Object.entries(s))An(h,[...t,"definitions",f],n);e.type==="object"&&!("additionalProperties"in e)&&(e.additionalProperties=!1);const i=e.required??[],o=e.properties;if(dr(o)){for(const[f,h]of Object.entries(o))if(!sl(h)&&!i.includes(f))throw new Error(`Zod field at \`${[...t,"properties",f].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);e.required=Object.keys(o),e.properties=Object.fromEntries(Object.entries(o).map(([f,h])=>[f,An(h,[...t,"properties",f],n)]))}const c=e.items;dr(c)&&(e.items=An(c,[...t,"items"],n));const u=e.anyOf;Array.isArray(u)&&(e.anyOf=u.map((f,h)=>An(f,[...t,"anyOf",String(h)],n)));const l=e.allOf;if(Array.isArray(l))if(l.length===1){const f=An(l[0],[...t,"allOf","0"],n);Object.assign(e,f),delete e.allOf}else e.allOf=l.map((f,h)=>An(f,[...t,"allOf",String(h)],n));e.default===null&&delete e.default;const d=e.$ref;if(d&&ZR(e,1)){if(typeof d!="string")throw new TypeError(`Received non-string $ref - ${d}; path=${t.join("/")}`);const f=BR(n,d);if(typeof f=="boolean")throw new Error(`Expected \`$ref: ${d}\` to resolve to an object schema but got boolean`);if(!dr(f))throw new Error(`Expected \`$ref: ${d}\` to resolve to an object but got ${JSON.stringify(f)}`);return Object.assign(e,{...f,...e}),delete e.$ref,An(e,t,n)}return e}function BR(e,t){if(!t.startsWith("#/"))throw new Error(`Unexpected $ref format ${JSON.stringify(t)}; Does not start with #/`);const n=t.slice(2).split("/");let r=e;for(const s of n){if(!dr(r))throw new Error(`encountered non-object entry while resolving ${t} - ${JSON.stringify(r)}`);const a=r[s];if(a===void 0)throw new Error(`Key ${s} not found while resolving ${t}`);r=a}return r}function dr(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function ZR(e,t){let n=0;for(const r in e)if(n++,n>t)return!0;return!1}function qR(e,t){return UR(e,{openaiStrictMode:!0,name:t.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function HR(e){return FR(Fu(e,{target:"draft-7"}))}function VR(e){return"_zod"in e}function GR(e,t,n){return dv({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:VR(e)?HR(e):qR(e,{name:t})}},r=>e.parse(JSON.parse(r)))}const am=["jsonSchema","functionCalling","jsonMode"];function JR(e,t){if(typeof t<"u"&&!am.includes(t))throw new Error(`Invalid method: ${t}. Supported methods are: ${am.join(", ")}`);const n=!e.startsWith("gpt-3")&&!e.startsWith("gpt-4-")&&e!=="gpt-4";if(n&&!t)return"jsonSchema";if(!n&&t==="jsonSchema")throw new Error(`JSON Schema is not supported for model "${e}". Please use a different method, e.g. "functionCalling" or "jsonMode".`);return t??"functionCalling"}function WR(e,t){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),n}function KR(e,t,n){if(Xe(e))return GR(e,t,n);if(De(e))return WR({type:"json_schema",json_schema:{...n,name:t,strict:!0,schema:tn(e,{cycles:"ref",reused:"ref",override(r){r.jsonSchema.title=t}})}},r=>po(e,JSON.parse(r)));throw new Error("Unsupported schema response format")}function XR(e,t){if(t&&typeof t=="object"&&"images"in t&&Array.isArray(t.images)){const n=t.images.filter(r=>typeof r?.image_url?.url=="string").map(r=>({type:"image",url:r.image_url.url}));return[{type:"text",text:e},...n]}return e}const YR={"gpt-4.1-nano":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-3-small":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:8192,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-05-13":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-08-06":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1-mini":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-3.5-turbo":{maxInputTokens:16385,imageInputs:!1,audioInputs:!1,pdfInputs:!1,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!1,imageUrlInputs:!1,pdfToolMessage:!1,imageToolMessage:!1,toolChoice:!0},"text-embedding-3-large":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:3072,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4-turbo":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-preview":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-mini":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"codex-mini-latest":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-nano":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-codex":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o1:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-mini":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-mini":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:65536,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-ada-002":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-11-20":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o3:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-chat-latest":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-mini":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-pro":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:272e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0}};var QR=YR,eN={};be(eN,{BasePromptValue:()=>ko,ChatPromptValue:()=>Hw,ImagePromptValue:()=>tN,StringPromptValue:()=>qw});var ko=class extends Vr{},qw=class extends ko{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(e){super({value:e}),this.value=e}toString(){return this.value}toChatMessages(){return[new sn(this.value)]}},Hw=class extends ko{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),this.messages=e.messages}toString(){return Hl(this.messages)}toChatMessages(){return this.messages}},tN=class extends ko{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new sn({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},q="0123456789abcdef".split(""),nN=[-2147483648,8388608,32768,128],Wt=[24,16,8,0],Fa=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],nt=[];function cn(e,t){t?(nt[0]=nt[16]=nt[1]=nt[2]=nt[3]=nt[4]=nt[5]=nt[6]=nt[7]=nt[8]=nt[9]=nt[10]=nt[11]=nt[12]=nt[13]=nt[14]=nt[15]=0,this.blocks=nt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}cn.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if(n!=="string"){if(n==="object"){if(e===null)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw new Error(ERROR)}else throw new Error(ERROR);t=!0}for(var r,s=0,a,i=e.length,o=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(a=this.start;s<i&&a<64;++s)o[a>>>2]|=e[s]<<Wt[a++&3];else for(a=this.start;s<i&&a<64;++s)r=e.charCodeAt(s),r<128?o[a>>>2]|=r<<Wt[a++&3]:r<2048?(o[a>>>2]|=(192|r>>>6)<<Wt[a++&3],o[a>>>2]|=(128|r&63)<<Wt[a++&3]):r<55296||r>=57344?(o[a>>>2]|=(224|r>>>12)<<Wt[a++&3],o[a>>>2]|=(128|r>>>6&63)<<Wt[a++&3],o[a>>>2]|=(128|r&63)<<Wt[a++&3]):(r=65536+((r&1023)<<10|e.charCodeAt(++s)&1023),o[a>>>2]|=(240|r>>>18)<<Wt[a++&3],o[a>>>2]|=(128|r>>>12&63)<<Wt[a++&3],o[a>>>2]|=(128|r>>>6&63)<<Wt[a++&3],o[a>>>2]|=(128|r&63)<<Wt[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};cn.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=nN[t&3],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}};cn.prototype.hash=function(){var e=this.h0,t=this.h1,n=this.h2,r=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=this.blocks,u,l,d,f,h,p,m,b,_,w,E;for(u=16;u<64;++u)h=c[u-15],l=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3,h=c[u-2],d=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,c[u]=c[u-16]+l+c[u-7]+d<<0;for(E=t&n,u=0;u<64;u+=4)this.first?(this.is224?(b=300032,h=c[0]-1413257819,o=h-150054599<<0,r=h+24177077<<0):(b=704751109,h=c[0]-210244248,o=h-1521486534<<0,r=h+143694565<<0),this.first=!1):(l=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),b=e&t,f=b^e&n^E,m=s&a^~s&i,h=o+d+m+Fa[u]+c[u],p=l+f,o=r+h<<0,r=h+p<<0),l=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),_=r&e,f=_^r&t^b,m=i&o^~i&s,h=a+d+m+Fa[u+1]+c[u+1],p=l+f,i=n+h<<0,n=h+p<<0,l=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),w=n&r,f=w^n&e^_,m=a&i^~a&o,h=s+d+m+Fa[u+2]+c[u+2],p=l+f,a=t+h<<0,t=h+p<<0,l=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),E=t&n,f=E^t&r^w,m=a&i^~a&o,h=s+d+m+Fa[u+3]+c[u+3],p=l+f,s=e+h<<0,e=h+p<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0,this.h5=this.h5+a<<0,this.h6=this.h6+i<<0,this.h7=this.h7+o<<0};cn.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=q[e>>>28&15]+q[e>>>24&15]+q[e>>>20&15]+q[e>>>16&15]+q[e>>>12&15]+q[e>>>8&15]+q[e>>>4&15]+q[e&15]+q[t>>>28&15]+q[t>>>24&15]+q[t>>>20&15]+q[t>>>16&15]+q[t>>>12&15]+q[t>>>8&15]+q[t>>>4&15]+q[t&15]+q[n>>>28&15]+q[n>>>24&15]+q[n>>>20&15]+q[n>>>16&15]+q[n>>>12&15]+q[n>>>8&15]+q[n>>>4&15]+q[n&15]+q[r>>>28&15]+q[r>>>24&15]+q[r>>>20&15]+q[r>>>16&15]+q[r>>>12&15]+q[r>>>8&15]+q[r>>>4&15]+q[r&15]+q[s>>>28&15]+q[s>>>24&15]+q[s>>>20&15]+q[s>>>16&15]+q[s>>>12&15]+q[s>>>8&15]+q[s>>>4&15]+q[s&15]+q[a>>>28&15]+q[a>>>24&15]+q[a>>>20&15]+q[a>>>16&15]+q[a>>>12&15]+q[a>>>8&15]+q[a>>>4&15]+q[a&15]+q[i>>>28&15]+q[i>>>24&15]+q[i>>>20&15]+q[i>>>16&15]+q[i>>>12&15]+q[i>>>8&15]+q[i>>>4&15]+q[i&15];return this.is224||(c+=q[o>>>28&15]+q[o>>>24&15]+q[o>>>20&15]+q[o>>>16&15]+q[o>>>12&15]+q[o>>>8&15]+q[o>>>4&15]+q[o&15]),c};cn.prototype.toString=cn.prototype.hex;cn.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,r=this.h3,s=this.h4,a=this.h5,i=this.h6,o=this.h7,c=[e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255];return this.is224||c.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),c};cn.prototype.array=cn.prototype.digest;cn.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};const Vw=(...e)=>new cn(!1,!0).update(e.join("")).hex();var rN={};be(rN,{sha256:()=>Vw});var sN={};be(sN,{BaseCache:()=>Jw,InMemoryCache:()=>Ww,defaultHashKeyEncoder:()=>Gw,deserializeStoredGeneration:()=>aN,serializeGeneration:()=>iN});const Gw=(...e)=>Vw(e.join("_"));function aN(e){return e.message!==void 0?{text:e.text,message:Vl(e.message)}:{text:e.text}}function iN(e){const t={text:e.text};return e.message!==void 0&&(t.message=e.message.toDict()),t}var Jw=class{keyEncoder=Gw;makeDefaultKeyEncoder(e){this.keyEncoder=e}};const oN=new Map;var Ww=class Kw extends Jw{cache;constructor(t){super(),this.cache=t??new Map}lookup(t,n){return Promise.resolve(this.cache.get(this.keyEncoder(t,n))??null)}async update(t,n,r){this.cache.set(this.keyEncoder(t,n),r)}static global(){return new Kw(oN)}},hs={},im;function cN(){if(im)return hs;im=1,hs.byteLength=o,hs.toByteArray=u,hs.fromByteArray=f;for(var e=[],t=[],n=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=r.length;s<a;++s)e[s]=r[s],t[r.charCodeAt(s)]=s;t[45]=62,t[95]=63;function i(h){var p=h.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var m=h.indexOf("=");m===-1&&(m=p);var b=m===p?0:4-m%4;return[m,b]}function o(h){var p=i(h),m=p[0],b=p[1];return(m+b)*3/4-b}function c(h,p,m){return(p+m)*3/4-m}function u(h){var p,m=i(h),b=m[0],_=m[1],w=new n(c(h,b,_)),E=0,x=_>0?b-4:b,I;for(I=0;I<x;I+=4)p=t[h.charCodeAt(I)]<<18|t[h.charCodeAt(I+1)]<<12|t[h.charCodeAt(I+2)]<<6|t[h.charCodeAt(I+3)],w[E++]=p>>16&255,w[E++]=p>>8&255,w[E++]=p&255;return _===2&&(p=t[h.charCodeAt(I)]<<2|t[h.charCodeAt(I+1)]>>4,w[E++]=p&255),_===1&&(p=t[h.charCodeAt(I)]<<10|t[h.charCodeAt(I+1)]<<4|t[h.charCodeAt(I+2)]>>2,w[E++]=p>>8&255,w[E++]=p&255),w}function l(h){return e[h>>18&63]+e[h>>12&63]+e[h>>6&63]+e[h&63]}function d(h,p,m){for(var b,_=[],w=p;w<m;w+=3)b=(h[w]<<16&16711680)+(h[w+1]<<8&65280)+(h[w+2]&255),_.push(l(b));return _.join("")}function f(h){for(var p,m=h.length,b=m%3,_=[],w=16383,E=0,x=m-b;E<x;E+=w)_.push(d(h,E,E+w>x?x:E+w));return b===1?(p=h[m-1],_.push(e[p>>2]+e[p<<4&63]+"==")):b===2&&(p=(h[m-2]<<8)+h[m-1],_.push(e[p>>10]+e[p>>4&63]+e[p<<2&63]+"=")),_.join("")}return hs}var uN=cN();const lN=Qi(uN);var dN=Object.defineProperty,fN=(e,t,n)=>t in e?dN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,hN=(e,t,n)=>(fN(e,t+"",n),n);function pN(e,t){let n=Array.from({length:e.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const a=e.slice(n[s].start,n[s+1].end),i=t.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function mN(e,t){return e.length===1?[t.get(e.join(","))]:pN(e,t).map(n=>t.get(e.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function gN(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var al=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;const n=e.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[a,i,...o]=s.split(" "),c=Number.parseInt(i,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,s]of Object.entries(n)){const a=lN.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(e,t=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=al.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(t==="all"?Object.keys(this.specialTokens):t),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):n);if(o.size>0){const u=al.specialTokenRegex([...o]),l=e.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;s.lastIndex=l,u=s.exec(e),!(u==null||i.has(u[0]));)l=u.index+1;const d=u?.index??e.length;for(const h of e.substring(c,d).matchAll(r)){const p=this.textEncoder.encode(h[0]),m=this.rankMap.get(p.join(","));if(m!=null){a.push(m);continue}a.push(...mN(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),c=u.index+u[0].length}return a}decode(e){const t=[];let n=0;for(let a=0;a<e.length;++a){const i=e[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(t.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const a of t)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},Xw=al;hN(Xw,"specialTokenRegex",e=>new RegExp(e.map(t=>gN(t)).join("|"),"g"));function _N(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var yN={};be(yN,{encodingForModel:()=>Od,getEncoding:()=>Yw});const Ba={},wN=new oa({});async function Yw(e){return e in Ba||(Ba[e]=wN.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(t=>t.json()).then(t=>new Xw(t)).catch(t=>{throw delete Ba[e],t})),await Ba[e]}async function Od(e){return Yw(_N(e))}var bN={};be(bN,{BaseLangChain:()=>Cd,BaseLanguageModel:()=>$d,calculateMaxTokens:()=>EN,getEmbeddingContextSize:()=>vN,getModelContextSize:()=>Qw,getModelNameForTiktoken:()=>Io,isOpenAITool:()=>Ad});const Io=e=>e.startsWith("gpt-5")?"gpt-5":e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,vN=e=>{switch(e){case"text-embedding-ada-002":return 8191;default:return 2046}},Qw=e=>{switch(Io(e)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function Ad(e){return typeof e!="object"||!e?!1:!!("type"in e&&e.type==="function"&&"function"in e&&typeof e.function=="object"&&e.function&&"name"in e.function&&"parameters"in e.function)}const EN=async({prompt:e,modelName:t})=>{let n;try{n=(await Od(Io(t))).encode(e).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),n=Math.ceil(e.length/4)}return Qw(t)-n},TN=()=>!1;var Cd=class extends Ve{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),this.verbose=e.verbose??TN(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},$d=class extends Cd{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:e,callbackManager:t,...n}){const{cache:r,...s}=n;super({callbacks:e??t,...s}),typeof r=="object"?this.cache=r:r?this.cache=Ww.global():this.cache=void 0,this.caller=new oa(n??{})}_encoding;async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(r=>typeof r=="string"?r:r.type==="text"&&"text"in r?r.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Od("modelName"in this?Io(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new qw(e):Array.isArray(e)?new Hw(e.map(Rs)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,i])=>i!==void 0).map(([a,i])=>`${a}:${JSON.stringify(i)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}},ss=class extends Ve{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(e){super(e),e&&(this.func=e.func)}async invoke(e,t){const n=Te(t);return this.func&&await this.func(e,n),this._callWithConfig(r=>Promise.resolve(r),e,n)}async*transform(e,t){const n=Te(t);let r,s=!0;for await(const a of this._transformStreamWithConfig(e,i=>i,n))if(yield a,s)if(r===void 0)r=a;else try{r=er(r,a)}catch{r=void 0,s=!1}this.func&&r!==void 0&&await this.func(r,n)}static assign(e){return new bd(new ls({steps:e}))}};const SN=e=>e();function ru(e){const t=e.constructor;return new t({...e,content:e.contentBlocks,response_metadata:{...e.response_metadata,output_version:"v1"}})}var xN={};be(xN,{BaseChatModel:()=>Rd,SimpleChatModel:()=>kN});function su(e){const t=[];for(const n of e){let r=n;if(Array.isArray(n.content))for(let s=0;s<n.content.length;s++){const a=n.content[s];(Nl(a)||Pl(a))&&r===n&&(r=new n.constructor({...r,content:[...n.content.slice(0,s),qg(a),...n.content.slice(s+1)]}))}t.push(r)}return t}var Rd=class fr extends $d{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(t){super(t),this.outputVersion=SN(()=>{const n=t.outputVersion??wn("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}_separateRunnableConfigFromCallOptionsCompat(t){const[n,r]=super._separateRunnableConfigFromCallOptions(t);return r.signal=n.signal,[n,r]}async invoke(t,n){const r=fr._convertInputToPromptValue(t);return(await this.generatePrompt([r],n,n?.callbacks)).generations[0][0].message}async*_streamResponseChunks(t,n,r){throw new Error("Not implemented.")}async*_streamIterator(t,n){if(this._streamResponseChunks===fr.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,n);else{const s=fr._convertInputToPromptValue(t).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(n),o={...a.metadata,...this.getLsParams(i)},c=await xt.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this?.invocationParams(i),batch_size:1},l=i.outputVersion??this.outputVersion,d=await c?.handleChatModelStart(this.toJSON(),[su(s)],a.runId,void 0,u,void 0,void 0,a.runName);let f,h;try{for await(const p of this._streamResponseChunks(s,i,d?.[0])){if(i.signal?.throwIfAborted(),p.message.id==null){const m=d?.at(0)?.runId;m!=null&&p.message._updateId(`run-${m}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},l==="v1"?yield ru(p.message):yield p.message,f?f=f.concat(p):f=p,Tu(p.message)&&p.message.usage_metadata!==void 0&&(h={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}i.signal?.throwIfAborted()}catch(p){throw await Promise.all((d??[]).map(m=>m?.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p?.handleLLMEnd({generations:[[f]],llmOutput:h})))}}getLsParams(t){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:t.stop,ls_provider:n}}async _generateUncached(t,n,r,s){const a=t.map(f=>f.map(Rs));let i;if(s!==void 0&&s.length===a.length)i=s;else{const f={...r.metadata,...this.getLsParams(n)},h=await xt.configure(r.callbacks,this.callbacks,r.tags,this.tags,f,this.metadata,{verbose:this.verbose}),p={options:n,invocation_params:this?.invocationParams(n),batch_size:1};i=await h?.handleChatModelStart(this.toJSON(),a.map(su),r.runId,void 0,p,void 0,void 0,r.runName)}const o=n.outputVersion??this.outputVersion,c=[],u=[];if(!!i?.[0].handlers.find(Wl)&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==fr.prototype._streamResponseChunks)try{const f=await this._streamResponseChunks(a[0],n,i?.[0]);let h,p;for await(const m of f){if(n.signal?.aborted){const b=h?.message;throw new vu("Model invocation was aborted.",b)}if(m.message.id==null){const b=i?.at(0)?.runId;b!=null&&m.message._updateId(`run-${b}`)}h===void 0?h=m:h=er(h,m),Tu(m.message)&&m.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:m.message.usage_metadata.input_tokens,completionTokens:m.message.usage_metadata.output_tokens,totalTokens:m.message.usage_metadata.total_tokens}})}if(n.signal?.aborted){const m=h?.message;throw new vu("Model invocation was aborted.",m)}if(h===void 0)throw new Error("Received empty response from chat model call.");c.push([h]),await i?.[0].handleLLMEnd({generations:c,llmOutput:p})}catch(f){throw await i?.[0].handleLLMError(f),f}else{const f=await Promise.allSettled(a.map(async(h,p)=>{const m=await this._generate(h,{...n,promptIndex:p},i?.[p]);if(o==="v1")for(const b of m.generations)b.message=ru(b.message);return m}));await Promise.all(f.map(async(h,p)=>{if(h.status==="fulfilled"){const m=h.value;for(const b of m.generations){if(b.message.id==null){const _=i?.at(0)?.runId;_!=null&&b.message._updateId(`run-${_}`)}b.message.response_metadata={...b.generationInfo,...b.message.response_metadata}}return m.generations.length===1&&(m.generations[0].message.response_metadata={...m.llmOutput,...m.generations[0].message.response_metadata}),c[p]=m.generations,u[p]=m.llmOutput,i?.[p]?.handleLLMEnd({generations:[m.generations],llmOutput:m.llmOutput})}else return await i?.[p]?.handleLLMError(h.reason),Promise.reject(h.reason)}))}const d={generations:c,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(d,Hs,{value:i?{runIds:i?.map(f=>f.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:t,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:a}){const i=t.map(_=>_.map(Rs)),o={...a.metadata,...this.getLsParams(s)},c=await xt.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this?.invocationParams(s),batch_size:1},l=await c?.handleChatModelStart(this.toJSON(),i.map(su),a.runId,void 0,u,void 0,void 0,a.runName),d=[],h=(await Promise.allSettled(i.map(async(_,w)=>{const E=fr._convertInputToPromptValue(_).toString(),x=await n.lookup(E,r);return x==null&&d.push(w),x}))).map((_,w)=>({result:_,runManager:l?.[w]})).filter(({result:_})=>_.status==="fulfilled"&&_.value!=null||_.status==="rejected"),p=s.outputVersion??this.outputVersion,m=[];await Promise.all(h.map(async({result:_,runManager:w},E)=>{if(_.status==="fulfilled"){const x=_.value;return m[E]=x.map(I=>("message"in I&&Jn(I.message)&&no(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},p==="v1"&&(I.message=ru(I.message))),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),x.length&&await w?.handleLLMNewToken(x[0].text),w?.handleLLMEnd({generations:[x]},void 0,void 0,void 0,{cached:!0})}else return await w?.handleLLMError(_.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(_.reason)}));const b={generations:m,missingPromptIndices:d,startedRunManagers:l};return Object.defineProperty(b,Hs,{value:l?{runIds:l?.map(_=>_.runId)}:void 0,configurable:!0}),b}async generate(t,n,r){let s;Array.isArray(n)?s={stop:n}:s=n;const a=t.map(p=>p.map(Rs)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);const{cache:c}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d,startedRunManagers:f}=await this._generateCached({messages:a,cache:c,llmStringKey:u,parsedOptions:o,handledOptions:i});let h={};if(d.length>0){const p=await this._generateUncached(d.map(m=>a[m]),o,i,f!==void 0?d.map(m=>f?.[m]):void 0);await Promise.all(p.generations.map(async(m,b)=>{const _=d[b];l[_]=m;const w=fr._convertInputToPromptValue(a[_]).toString();return c.update(w,u,m)})),h=p.llmOutput??{}}return{generations:l,llmOutput:h}}invocationParams(t){return{}}_modelType(){return"base_chat_model"}async generatePrompt(t,n,r){const s=t.map(a=>a.toChatMessages());return this.generate(s,n,r)}withStructuredOutput(t,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n?.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=t,s=n?.name,a=vo(r)??"A function available to call.",i=n?.method,o=n?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let c=s??"extract",u;yn(r)?u=[{type:"function",function:{name:c,description:a,parameters:tn(r)}}]:("name"in r&&(c=r.name),u=[{type:"function",function:{name:c,description:a,parameters:r}}]);const l=this.bindTools(u),d=Fn.from(m=>{if(!Sn.isInstance(m))throw new Error("Input is not an AIMessageChunk.");if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");const b=m.tool_calls.find(_=>_.name===c);if(!b)throw new Error(`No tool call found with name ${c}.`);return b.args});if(!o)return l.pipe(d).withConfig({runName:"StructuredOutput"});const f=ss.assign({parsed:(m,b)=>d.invoke(m.raw,b)}),h=ss.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[h]});return ca.from([{raw:l},p]).withConfig({runName:"StructuredOutputRunnable"})}},kN=class extends Rd{async _generate(e,t,n){const r=await this._call(e,t,n),s=new wt(r);if(typeof s.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:s.content,message:s}]}}},IN=class extends Ve{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(e){super(e),this.runnables=e.runnables}async invoke(e,t){const{key:n,input:r}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.invoke(r,Te(t))}async batch(e,t,n){const r=e.map(d=>d.key),s=e.map(d=>d.input);if(r.find(d=>this.runnables[d]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const i=r.map(d=>this.runnables[d]),o=this._getOptionsList(t??{},e.length),c=o[0]?.maxConcurrency??n?.maxConcurrency,u=c&&c>0?c:e.length,l=[];for(let d=0;d<s.length;d+=u){const f=s.slice(d,d+u).map((p,m)=>i[m].invoke(p,o[m])),h=await Promise.all(f);l.push(h)}return l.flat()}async stream(e,t){const{key:n,input:r}=e,s=this.runnables[n];if(s===void 0)throw new Error(`No runnable associated with key "${n}".`);return s.stream(r,t)}},ON=class extends Ve{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(e){super(e),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([s,a])=>[nn(s),nn(a)]),r=nn(e[e.length-1]);return new this({branches:n,default:r})}async _invoke(e,t,n){let r;for(let s=0;s<this.branches.length;s+=1){const[a,i]=this.branches[s];if(await a.invoke(e,Le(t,{callbacks:n?.getChild(`condition:${s+1}`)}))){r=await i.invoke(e,Le(t,{callbacks:n?.getChild(`branch:${s+1}`)}));break}}return r||(r=await this.default.invoke(e,Le(t,{callbacks:n?.getChild("branch:default")}))),r}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const r=await(await Mt(t))?.handleChainStart(this.toJSON(),et(e,"input"),t?.runId,void 0,void 0,void 0,t?.runName);let s,a=!0,i;try{for(let o=0;o<this.branches.length;o+=1){const[c,u]=this.branches[o];if(await c.invoke(e,Le(t,{callbacks:r?.getChild(`condition:${o+1}`)}))){i=await u.stream(e,Le(t,{callbacks:r?.getChild(`branch:${o+1}`)}));for await(const d of i)if(yield d,a)if(s===void 0)s=d;else try{s=er(s,d)}catch{s=void 0,a=!1}break}}if(i===void 0){i=await this.default.stream(e,Le(t,{callbacks:r?.getChild("branch:default")}));for await(const o of i)if(yield o,a)if(s===void 0)s=o;else try{s=er(s,o)}catch{s=void 0,a=!1}}}catch(o){throw await r?.handleChainError(o),o}await r?.handleChainEnd(s??{})}},AN=class extends rs{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(e){let t=Fn.from((a,i)=>this._enterHistory(a,i??{})).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(t=ss.assign({[n]:t}).withConfig({runName:"insertHistory"}));const r=t.pipe(e.runnable.withListeners({onEnd:(a,i)=>this._exitHistory(a,i??{})})).withConfig({runName:"RunnableWithMessageHistory"}),s=e.config??{};super({...e,config:s,bound:r}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!Jn(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?t=e[n][0]:t=e[n]}else t=e;if(typeof t=="string")return[new sn(t)];if(Array.isArray(t))return t;if(Jn(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!Jn(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[n]}else t=e;if(typeof t=="string")return[new wt(t)];if(Array.isArray(t))return t;if(Jn(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){const r=await(t?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?r.concat(this._getInputMessages(e)):r}async _exitHistory(e,t){const n=t.configurable?.messageHistory;let r;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?r=e.inputs[0]:r=e.inputs;let s=this._getInputMessages(r);if(this.historyMessagesKey===void 0){const o=await n.getMessages();s=s.slice(o.length)}const a=e.outputs;if(!a)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const i=this._getOutputMessages(a);await n.addMessages([...s,...i])}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const r={[this.inputMessagesKey??"input"]:"foo"},s={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(r)}, ${JSON.stringify(s)})`)}const{sessionId:n}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(n),t}},CN={};be(CN,{RouterRunnable:()=>IN,Runnable:()=>Ve,RunnableAssign:()=>bd,RunnableBinding:()=>rs,RunnableBranch:()=>ON,RunnableEach:()=>iC,RunnableLambda:()=>Fn,RunnableMap:()=>ls,RunnableParallel:()=>uC,RunnablePassthrough:()=>ss,RunnablePick:()=>Iw,RunnableRetry:()=>wd,RunnableSequence:()=>ca,RunnableToolLike:()=>tl,RunnableWithFallbacks:()=>kw,RunnableWithMessageHistory:()=>AN,_coerceToRunnable:()=>nn,ensureConfig:()=>Te,getCallbackManagerForConfig:()=>Mt,mergeConfigs:()=>wi,patchConfig:()=>Le,pickRunnableConfigKeys:()=>Ln,raceWithSignal:()=>jn});var eb=class extends Ve{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,r)=>this.parseResult([{text:n}],r?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,r)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],r?.callbacks),e,{...t,runType:"parser"})}},Oo=class extends eb{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},Nn=class extends Error{llmOutput;observation;sendToLLM;constructor(e,t,n,r=!1){if(super(e),this.llmOutput=t,this.observation=n,this.sendToLLM=r,r&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Zl(this,"OUTPUT_PARSING_FAILURE")}},fa=class extends Oo{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},Ao=class extends fa{diff=!1;constructor(e){super(e),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(const r of e){if(typeof r!="string"&&typeof r.content!="string")throw new Error("Cannot handle non-string output.");let s;if(Dl(r)){if(typeof r.content!="string")throw new Error("Cannot handle non-string message output.");s=new Kr({message:r,text:r.content})}else if(Jn(r)){if(typeof r.content!="string")throw new Error("Cannot handle non-string message output.");s=new Kr({message:pi(r),text:r.content})}else s=new Wr({text:r});n===void 0?n=s:n=n.concat(s);const a=await this.parsePartialResult([n]);a!=null&&!wr(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}},$N=class extends fa{static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},ha=class extends fa{re;async*_transform(e){let t="";for await(const n of e)if(typeof n=="string"?t+=n:t+=n.content,this.re){const r=[...t.matchAll(this.re)];if(r.length>1){let s=0;for(const a of r.slice(0,-1))yield[a[1]],s+=(a.index??0)+a[0].length;t=t.slice(s)}}else{const r=await this.parse(t);if(r.length>1){for(const s of r.slice(0,-1))yield[s];t=r[r.length-1]}}for(const n of await this.parse(t))yield[n]}},RN=class extends ha{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(e){try{return e.trim().split(",").map(t=>t.trim())}catch{throw new Nn(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},NN=class extends ha{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:e,separator:t}){super(...arguments),this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&t.length!==this.length)throw new Nn(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){throw Object.getPrototypeOf(t)===Nn.prototype?t:new Nn(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},PN=class extends ha{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},MN=class extends ha{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}},LN=class extends fa{static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,n)=>t+this._messageContentToString(n),"")}},Ui=class extends Oo{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),this.schema=e}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=So(Object.fromEntries(Object.entries(e).map(([n,r])=>[n,To().describe(r)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(tn(this.schema))}
\`\`\`
`}async parse(e){try{const t=e.trim(),r=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await bo(this.schema,JSON.parse(r))}catch(t){throw new Nn(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}},tb=class extends Ui{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const t=e?.interpolationDepth??1;if(t<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(tn(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){const n=e;if("type"in n){let r=!1,s;if(Array.isArray(n.type)){const o=n.type.findIndex(c=>c==="null");o!==-1&&(r=!0,n.type.splice(o,1)),s=n.type.join(" | ")}else s=n.type;if(n.type==="object"&&n.properties){const o=n.description?` // ${n.description}`:"";return`{
${Object.entries(n.properties).map(([u,l])=>{const d=n.required?.includes(u)?"":" (optional)";return`${" ".repeat(t)}"${u}": ${this._schemaToInstruction(l,t+2)}${d}`}).join(`
`)}
${" ".repeat(t-2)}}${o}`}if(n.type==="array"&&n.items){const o=n.description?` // ${n.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(n.items,t+2)}
${" ".repeat(t-2)}] ${o}`}const a=r?" (nullable)":"",i=n.description?` // ${n.description}`:"";return`${s}${i}${a}`}if("anyOf"in n)return n.anyOf.map(r=>this._schemaToInstruction(r,t)).join(`
${" ".repeat(t-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=So(Object.fromEntries(Object.entries(e).map(([n,r])=>[n,To().describe(r)])));return new this(t)}},jN=class extends Oo{structuredInputParser;constructor({inputSchema:e}){super(...arguments),this.structuredInputParser=new tb(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(n){throw new Nn(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}},zN={};be(zN,{applyPatch:()=>Jr,compare:()=>id});var il=class extends Ao{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?id(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Eu(e[0].text)}async parse(e){return Eu(e,JSON.parse)}getFormatInstructions(){return""}_baseMessageToString(e){return e.text}};const DN=function(){const e={};e.parser=function(y,g){return new n(y,g)},e.SAXParser=n,e.SAXStream=u,e.createStream=c,e.MAX_BUFFER_LENGTH=64*1024;const t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(y,g){if(!(this instanceof n))return new n(y,g);var A=this;s(A),A.q=A.c="",A.bufferCheckPosition=e.MAX_BUFFER_LENGTH,A.opt=g||{},A.opt.lowercase=A.opt.lowercase||A.opt.lowercasetags,A.looseCase=A.opt.lowercase?"toLowerCase":"toUpperCase",A.tags=[],A.closed=A.closedRoot=A.sawRoot=!1,A.tag=A.error=null,A.strict=!!y,A.noscript=!!(y||A.opt.noscript),A.state=v.BEGIN,A.strictEntities=A.opt.strictEntities,A.ENTITIES=A.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),A.attribList=[],A.opt.xmlns&&(A.ns=Object.create(p)),A.trackPosition=A.opt.position!==!1,A.trackPosition&&(A.position=A.line=A.column=0),le(A,"onready")}Object.create||(Object.create=function(y){function g(){}g.prototype=y;var A=new g;return A}),Object.keys||(Object.keys=function(y){var g=[];for(var A in y)y.hasOwnProperty(A)&&g.push(A);return g});function r(y){for(var g=Math.max(e.MAX_BUFFER_LENGTH,10),A=0,T=0,we=t.length;T<we;T++){var $e=y[t[T]].length;if($e>g)switch(t[T]){case"textNode":Ge(y);break;case"cdata":K(y,"oncdata",y.cdata),y.cdata="";break;case"script":K(y,"onscript",y.script),y.script="";break;default:z(y,"Max buffer length exceeded: "+t[T])}A=Math.max(A,$e)}var Pe=e.MAX_BUFFER_LENGTH-A;y.bufferCheckPosition=Pe+y.position}function s(y){for(var g=0,A=t.length;g<A;g++)y[t[g]]=""}function a(y){Ge(y),y.cdata!==""&&(K(y,"oncdata",y.cdata),y.cdata=""),y.script!==""&&(K(y,"onscript",y.script),y.script="")}n.prototype={end:function(){N(this)},write:Ee,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var i=ReadableStream;i||(i=function(){});var o=e.EVENTS.filter(function(y){return y!=="error"&&y!=="end"});function c(y,g){return new u(y,g)}function u(y,g){if(!(this instanceof u))return new u(y,g);i.apply(this),this._parser=new n(y,g),this.writable=!0,this.readable=!0;var A=this;this._parser.onend=function(){A.emit("end")},this._parser.onerror=function(T){A.emit("error",T),A._parser.error=null},this._decoder=null,o.forEach(function(T){Object.defineProperty(A,"on"+T,{get:function(){return A._parser["on"+T]},set:function(we){if(!we)return A.removeAllListeners(T),A._parser["on"+T]=we,we;A.on(T,we)},enumerable:!0,configurable:!1})})}u.prototype=Object.create(i.prototype,{constructor:{value:u}}),u.prototype.write=function(y){return this._parser.write(y.toString()),this.emit("data",y),!0},u.prototype.end=function(y){return y&&y.length&&this.write(y),this._parser.end(),!0},u.prototype.on=function(y,g){var A=this;return!A._parser["on"+y]&&o.indexOf(y)!==-1&&(A._parser["on"+y]=function(){var T=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);T.splice(0,0,y),A.emit.apply(A,T)}),i.prototype.on.call(A,y,g)};var l="[CDATA[",d="DOCTYPE",f="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",p={xml:f,xmlns:h},m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,_=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function E(y){return y===" "||y===`
`||y==="\r"||y==="	"}function x(y){return y==='"'||y==="'"}function I(y){return y===">"||E(y)}function P(y,g){return y.test(g)}function j(y,g){return!P(y,g)}var v=0;e.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(y){var g=e.ENTITIES[y],A=typeof g=="number"?String.fromCharCode(g):g;e.ENTITIES[y]=A});for(var oe in e.STATE)e.STATE[e.STATE[oe]]=oe;v=e.STATE;function le(y,g,A){y[g]&&y[g](A)}function K(y,g,A){y.textNode&&Ge(y),le(y,g,A)}function Ge(y){y.textNode=Ot(y.opt,y.textNode),y.textNode&&le(y,"ontext",y.textNode),y.textNode=""}function Ot(y,g){return y.trim&&(g=g.trim()),y.normalize&&(g=g.replace(/\s+/g," ")),g}function z(y,g){return Ge(y),y.trackPosition&&(g+=`
Line: `+y.line+`
Column: `+y.column+`
Char: `+y.c),g=new Error(g),y.error=g,le(y,"onerror",g),y}function N(y){return y.sawRoot&&!y.closedRoot&&M(y,"Unclosed root tag"),y.state!==v.BEGIN&&y.state!==v.BEGIN_WHITESPACE&&y.state!==v.TEXT&&z(y,"Unexpected end"),Ge(y),y.c="",y.closed=!0,le(y,"onend"),n.call(y,y.strict,y.opt),y}function M(y,g){if(typeof y!="object"||!(y instanceof n))throw new Error("bad call to strictFail");y.strict&&z(y,g)}function G(y){y.strict||(y.tagName=y.tagName[y.looseCase]());var g=y.tags[y.tags.length-1]||y,A=y.tag={name:y.tagName,attributes:{}};y.opt.xmlns&&(A.ns=g.ns),y.attribList.length=0,K(y,"onopentagstart",A)}function X(y,g){var A=y.indexOf(":"),T=A<0?["",y]:y.split(":"),we=T[0],$e=T[1];return g&&y==="xmlns"&&(we="xmlns",$e=""),{prefix:we,local:$e}}function H(y){if(y.strict||(y.attribName=y.attribName[y.looseCase]()),y.attribList.indexOf(y.attribName)!==-1||y.tag.attributes.hasOwnProperty(y.attribName)){y.attribName=y.attribValue="";return}if(y.opt.xmlns){var g=X(y.attribName,!0),A=g.prefix,T=g.local;if(A==="xmlns")if(T==="xml"&&y.attribValue!==f)M(y,"xml: prefix must be bound to "+f+`
Actual: `+y.attribValue);else if(T==="xmlns"&&y.attribValue!==h)M(y,"xmlns: prefix must be bound to "+h+`
Actual: `+y.attribValue);else{var we=y.tag,$e=y.tags[y.tags.length-1]||y;we.ns===$e.ns&&(we.ns=Object.create($e.ns)),we.ns[T]=y.attribValue}y.attribList.push([y.attribName,y.attribValue])}else y.tag.attributes[y.attribName]=y.attribValue,K(y,"onattribute",{name:y.attribName,value:y.attribValue});y.attribName=y.attribValue=""}function re(y,g){if(y.opt.xmlns){var A=y.tag,T=X(y.tagName);A.prefix=T.prefix,A.local=T.local,A.uri=A.ns[T.prefix]||"",A.prefix&&!A.uri&&(M(y,"Unbound namespace prefix: "+JSON.stringify(y.tagName)),A.uri=T.prefix);var we=y.tags[y.tags.length-1]||y;A.ns&&we.ns!==A.ns&&Object.keys(A.ns).forEach(function(or){K(y,"onopennamespace",{prefix:or,uri:A.ns[or]})});for(var $e=0,Pe=y.attribList.length;$e<Pe;$e++){var Je=y.attribList[$e],at=Je[0],Zt=Je[1],Fe=X(at,!0),zt=Fe.prefix,Ir=Fe.local,pa=zt===""?"":A.ns[zt]||"",U={name:at,value:Zt,prefix:zt,local:Ir,uri:pa};zt&&zt!=="xmlns"&&!pa&&(M(y,"Unbound namespace prefix: "+JSON.stringify(zt)),U.uri=zt),y.tag.attributes[at]=U,K(y,"onattribute",U)}y.attribList.length=0}y.tag.isSelfClosing=!!g,y.sawRoot=!0,y.tags.push(y.tag),K(y,"onopentag",y.tag),g||(!y.noscript&&y.tagName.toLowerCase()==="script"?y.state=v.SCRIPT:y.state=v.TEXT,y.tag=null,y.tagName=""),y.attribName=y.attribValue="",y.attribList.length=0}function ge(y){if(!y.tagName){M(y,"Weird empty close tag."),y.textNode+="</>",y.state=v.TEXT;return}if(y.script){if(y.tagName!=="script"){y.script+="</"+y.tagName+">",y.tagName="",y.state=v.SCRIPT;return}K(y,"onscript",y.script),y.script=""}var g=y.tags.length,A=y.tagName;y.strict||(A=A[y.looseCase]());for(var T=A;g--;){var we=y.tags[g];if(we.name!==T)M(y,"Unexpected close tag");else break}if(g<0){M(y,"Unmatched closing tag: "+y.tagName),y.textNode+="</"+y.tagName+">",y.state=v.TEXT;return}y.tagName=A;for(var $e=y.tags.length;$e-- >g;){var Pe=y.tag=y.tags.pop();y.tagName=y.tag.name,K(y,"onclosetag",y.tagName);var Je={};for(var at in Pe.ns)Je[at]=Pe.ns[at];var Zt=y.tags[y.tags.length-1]||y;y.opt.xmlns&&Pe.ns!==Zt.ns&&Object.keys(Pe.ns).forEach(function(Fe){var zt=Pe.ns[Fe];K(y,"onclosenamespace",{prefix:Fe,uri:zt})})}g===0&&(y.closedRoot=!0),y.tagName=y.attribValue=y.attribName="",y.attribList.length=0,y.state=v.TEXT}function fe(y){var g=y.entity,A=g.toLowerCase(),T,we="";return y.ENTITIES[g]?y.ENTITIES[g]:y.ENTITIES[A]?y.ENTITIES[A]:(g=A,g.charAt(0)==="#"&&(g.charAt(1)==="x"?(g=g.slice(2),T=parseInt(g,16),we=T.toString(16)):(g=g.slice(1),T=parseInt(g,10),we=T.toString(10))),g=g.replace(/^0+/,""),isNaN(T)||we.toLowerCase()!==g?(M(y,"Invalid character entity"),"&"+y.entity+";"):String.fromCodePoint(T))}function ke(y,g){g==="<"?(y.state=v.OPEN_WAKA,y.startTagPosition=y.position):E(g)||(M(y,"Non-whitespace before first tag."),y.textNode=g,y.state=v.TEXT)}function He(y,g){var A="";return g<y.length&&(A=y.charAt(g)),A}function Ee(y){var g=this;if(this.error)throw this.error;if(g.closed)return z(g,"Cannot write after close. Assign an onready handler.");if(y===null)return N(g);typeof y=="object"&&(y=y.toString());for(var A=0,T="";T=He(y,A++),g.c=T,!!T;)switch(g.trackPosition&&(g.position++,T===`
`?(g.line++,g.column=0):g.column++),g.state){case v.BEGIN:if(g.state=v.BEGIN_WHITESPACE,T==="\uFEFF")continue;ke(g,T);continue;case v.BEGIN_WHITESPACE:ke(g,T);continue;case v.TEXT:if(g.sawRoot&&!g.closedRoot){for(var we=A-1;T&&T!=="<"&&T!=="&";)T=He(y,A++),T&&g.trackPosition&&(g.position++,T===`
`?(g.line++,g.column=0):g.column++);g.textNode+=y.substring(we,A-1)}T==="<"&&!(g.sawRoot&&g.closedRoot&&!g.strict)?(g.state=v.OPEN_WAKA,g.startTagPosition=g.position):(!E(T)&&(!g.sawRoot||g.closedRoot)&&M(g,"Text data outside of root node."),T==="&"?g.state=v.TEXT_ENTITY:g.textNode+=T);continue;case v.SCRIPT:T==="<"?g.state=v.SCRIPT_ENDING:g.script+=T;continue;case v.SCRIPT_ENDING:T==="/"?g.state=v.CLOSE_TAG:(g.script+="<"+T,g.state=v.SCRIPT);continue;case v.OPEN_WAKA:if(T==="!")g.state=v.SGML_DECL,g.sgmlDecl="";else if(!E(T))if(P(m,T))g.state=v.OPEN_TAG,g.tagName=T;else if(T==="/")g.state=v.CLOSE_TAG,g.tagName="";else if(T==="?")g.state=v.PROC_INST,g.procInstName=g.procInstBody="";else{if(M(g,"Unencoded <"),g.startTagPosition+1<g.position){var $e=g.position-g.startTagPosition;T=new Array($e).join(" ")+T}g.textNode+="<"+T,g.state=v.TEXT}continue;case v.SGML_DECL:(g.sgmlDecl+T).toUpperCase()===l?(K(g,"onopencdata"),g.state=v.CDATA,g.sgmlDecl="",g.cdata=""):g.sgmlDecl+T==="--"?(g.state=v.COMMENT,g.comment="",g.sgmlDecl=""):(g.sgmlDecl+T).toUpperCase()===d?(g.state=v.DOCTYPE,(g.doctype||g.sawRoot)&&M(g,"Inappropriately located doctype declaration"),g.doctype="",g.sgmlDecl=""):T===">"?(K(g,"onsgmldeclaration",g.sgmlDecl),g.sgmlDecl="",g.state=v.TEXT):(x(T)&&(g.state=v.SGML_DECL_QUOTED),g.sgmlDecl+=T);continue;case v.SGML_DECL_QUOTED:T===g.q&&(g.state=v.SGML_DECL,g.q=""),g.sgmlDecl+=T;continue;case v.DOCTYPE:T===">"?(g.state=v.TEXT,K(g,"ondoctype",g.doctype),g.doctype=!0):(g.doctype+=T,T==="["?g.state=v.DOCTYPE_DTD:x(T)&&(g.state=v.DOCTYPE_QUOTED,g.q=T));continue;case v.DOCTYPE_QUOTED:g.doctype+=T,T===g.q&&(g.q="",g.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:g.doctype+=T,T==="]"?g.state=v.DOCTYPE:x(T)&&(g.state=v.DOCTYPE_DTD_QUOTED,g.q=T);continue;case v.DOCTYPE_DTD_QUOTED:g.doctype+=T,T===g.q&&(g.state=v.DOCTYPE_DTD,g.q="");continue;case v.COMMENT:T==="-"?g.state=v.COMMENT_ENDING:g.comment+=T;continue;case v.COMMENT_ENDING:T==="-"?(g.state=v.COMMENT_ENDED,g.comment=Ot(g.opt,g.comment),g.comment&&K(g,"oncomment",g.comment),g.comment=""):(g.comment+="-"+T,g.state=v.COMMENT);continue;case v.COMMENT_ENDED:T!==">"?(M(g,"Malformed comment"),g.comment+="--"+T,g.state=v.COMMENT):g.state=v.TEXT;continue;case v.CDATA:T==="]"?g.state=v.CDATA_ENDING:g.cdata+=T;continue;case v.CDATA_ENDING:T==="]"?g.state=v.CDATA_ENDING_2:(g.cdata+="]"+T,g.state=v.CDATA);continue;case v.CDATA_ENDING_2:T===">"?(g.cdata&&K(g,"oncdata",g.cdata),K(g,"onclosecdata"),g.cdata="",g.state=v.TEXT):T==="]"?g.cdata+="]":(g.cdata+="]]"+T,g.state=v.CDATA);continue;case v.PROC_INST:T==="?"?g.state=v.PROC_INST_ENDING:E(T)?g.state=v.PROC_INST_BODY:g.procInstName+=T;continue;case v.PROC_INST_BODY:if(!g.procInstBody&&E(T))continue;T==="?"?g.state=v.PROC_INST_ENDING:g.procInstBody+=T;continue;case v.PROC_INST_ENDING:T===">"?(K(g,"onprocessinginstruction",{name:g.procInstName,body:g.procInstBody}),g.procInstName=g.procInstBody="",g.state=v.TEXT):(g.procInstBody+="?"+T,g.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:P(b,T)?g.tagName+=T:(G(g),T===">"?re(g):T==="/"?g.state=v.OPEN_TAG_SLASH:(E(T)||M(g,"Invalid character in tag name"),g.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:T===">"?(re(g,!0),ge(g)):(M(g,"Forward-slash in opening tag not followed by >"),g.state=v.ATTRIB);continue;case v.ATTRIB:if(E(T))continue;T===">"?re(g):T==="/"?g.state=v.OPEN_TAG_SLASH:P(m,T)?(g.attribName=T,g.attribValue="",g.state=v.ATTRIB_NAME):M(g,"Invalid attribute name");continue;case v.ATTRIB_NAME:T==="="?g.state=v.ATTRIB_VALUE:T===">"?(M(g,"Attribute without value"),g.attribValue=g.attribName,H(g),re(g)):E(T)?g.state=v.ATTRIB_NAME_SAW_WHITE:P(b,T)?g.attribName+=T:M(g,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if(T==="=")g.state=v.ATTRIB_VALUE;else{if(E(T))continue;M(g,"Attribute without value"),g.tag.attributes[g.attribName]="",g.attribValue="",K(g,"onattribute",{name:g.attribName,value:""}),g.attribName="",T===">"?re(g):P(m,T)?(g.attribName=T,g.state=v.ATTRIB_NAME):(M(g,"Invalid attribute name"),g.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:if(E(T))continue;x(T)?(g.q=T,g.state=v.ATTRIB_VALUE_QUOTED):(M(g,"Unquoted attribute value"),g.state=v.ATTRIB_VALUE_UNQUOTED,g.attribValue=T);continue;case v.ATTRIB_VALUE_QUOTED:if(T!==g.q){T==="&"?g.state=v.ATTRIB_VALUE_ENTITY_Q:g.attribValue+=T;continue}H(g),g.q="",g.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:E(T)?g.state=v.ATTRIB:T===">"?re(g):T==="/"?g.state=v.OPEN_TAG_SLASH:P(m,T)?(M(g,"No whitespace between attributes"),g.attribName=T,g.attribValue="",g.state=v.ATTRIB_NAME):M(g,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!I(T)){T==="&"?g.state=v.ATTRIB_VALUE_ENTITY_U:g.attribValue+=T;continue}H(g),T===">"?re(g):g.state=v.ATTRIB;continue;case v.CLOSE_TAG:if(g.tagName)T===">"?ge(g):P(b,T)?g.tagName+=T:g.script?(g.script+="</"+g.tagName,g.tagName="",g.state=v.SCRIPT):(E(T)||M(g,"Invalid tagname in closing tag"),g.state=v.CLOSE_TAG_SAW_WHITE);else{if(E(T))continue;j(m,T)?g.script?(g.script+="</"+T,g.state=v.SCRIPT):M(g,"Invalid tagname in closing tag."):g.tagName=T}continue;case v.CLOSE_TAG_SAW_WHITE:if(E(T))continue;T===">"?ge(g):M(g,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:var Pe,Je;switch(g.state){case v.TEXT_ENTITY:Pe=v.TEXT,Je="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:Pe=v.ATTRIB_VALUE_QUOTED,Je="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:Pe=v.ATTRIB_VALUE_UNQUOTED,Je="attribValue";break}if(T===";")if(g.opt.unparsedEntities){var at=fe(g);g.entity="",g.state=Pe,g.write(at)}else g[Je]+=fe(g),g.entity="",g.state=Pe;else P(g.entity.length?w:_,T)?g.entity+=T:(M(g,"Invalid character in entity name"),g[Je]+="&"+g.entity+T,g.entity="",g.state=Pe);continue;default:throw new Error(g,"Unknown state: "+g.state)}return g.position>=g.bufferCheckPosition&&r(g),g}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||(function(){var y=String.fromCharCode,g=Math.floor,A=function(){var T=16384,we=[],$e,Pe,Je=-1,at=arguments.length;if(!at)return"";for(var Zt="";++Je<at;){var Fe=Number(arguments[Je]);if(!isFinite(Fe)||Fe<0||Fe>1114111||g(Fe)!==Fe)throw RangeError("Invalid code point: "+Fe);Fe<=65535?we.push(Fe):(Fe-=65536,$e=(Fe>>10)+55296,Pe=Fe%1024+56320,we.push($e,Pe)),(Je+1===at||we.length>T)&&(Zt+=y.apply(null,we),we.length=0)}return Zt};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:A,configurable:!0,writable:!0}):String.fromCodePoint=A})(),e},UN=DN(),ol=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var FN=class extends Ao{tags;constructor(e){super(e),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(e,t){if(t)return e?id(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return cl(e[0].text)}async parse(e){return cl(e)}getFormatInstructions(){return!!(this.tags&&this.tags.length>0)?ol.replace("{tags}",this.tags?.join(", ")??""):ol}};const BN=e=>e.split(`
`).map(t=>t.replace(/^\s+/,"")).join(`
`).trim(),nb=e=>{if(Object.keys(e).length===0)return{};const t={};return e.children.length>0?(t[e.name]=e.children.map(nb),t):(t[e.name]=e.text??void 0,t)};function cl(e){const t=BN(e),n=UN.parser(!0);let r={};const s=[];n.onopentag=o=>{const c={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};s.length>0?s[s.length-1].children.push(c):r=c,o.isSelfClosing||s.push(c)},n.onclosetag=()=>{if(s.length>0){const o=s.pop();s.length===0&&o&&(r=o)}},n.ontext=o=>{if(s.length>0){const c=s[s.length-1];c.text+=o}},n.onattribute=o=>{if(s.length>0){const c=s[s.length-1];c.attributes[o.name]=o.value}};const a=/```(xml)?(.*)```/s.exec(t),i=a?a[2]:t;return n.write(i).close(),r&&r.name==="?xml"&&(r=r.children[0]),nb(r)}var ZN={};be(ZN,{AsymmetricStructuredOutputParser:()=>jN,BaseCumulativeTransformOutputParser:()=>Ao,BaseLLMOutputParser:()=>eb,BaseOutputParser:()=>Oo,BaseTransformOutputParser:()=>fa,BytesOutputParser:()=>$N,CommaSeparatedListOutputParser:()=>RN,CustomListOutputParser:()=>NN,JsonMarkdownStructuredOutputParser:()=>tb,JsonOutputParser:()=>il,ListOutputParser:()=>ha,MarkdownListOutputParser:()=>MN,NumberedListOutputParser:()=>PN,OutputParserException:()=>Nn,StringOutputParser:()=>LN,StructuredOutputParser:()=>Ui,XMLOutputParser:()=>FN,XML_FORMAT_INSTRUCTIONS:()=>ol,parseJsonMarkdown:()=>Eu,parsePartialJson:()=>to,parseXMLMarkdown:()=>cl});function Co(e,t){if(e.function===void 0)return;let n;if(t?.partial)try{n=to(e.function.arguments??"{}")}catch{return}else try{n=JSON.parse(e.function.arguments)}catch(s){throw new Nn([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:e.function.name,args:n,type:"tool_call"};return t?.returnId&&(r.id=e.id),r}function rb(e){if(e.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function Ls(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}var sb=class extends Ao{static lc_name(){return"JsonOutputToolsParser"}returnId=!1;lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;constructor(e){super(e),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){const n=e[0].message;let r;if(no(n)&&n.tool_calls?.length?r=n.tool_calls.map(a=>{const{id:i,...o}=a;return this.returnId?{id:i,...o}:o}):n.additional_kwargs.tool_calls!==void 0&&(r=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(i=>Co(i,{returnId:this.returnId,partial:t}))),!r)return[];const s=[];for(const a of r)if(a!==void 0){const i={type:a.name,args:a.args,id:a.id};s.push(i)}return s}},ul=class extends sb{static lc_name(){return"JsonOutputKeyToolsParser"}lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;returnId=!1;keyName;returnSingle=!1;zodSchema;constructor(e){super(e),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await sw(this.zodSchema,e);if(t.success)return t.data;throw new Nn(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const n=(await super.parsePartialResult(e)).filter(s=>s.type===this.keyName);let r=n;if(n.length)return this.returnId||(r=n.map(s=>s.args)),this.returnSingle?r[0]:r}async parseResult(e){const n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let r=n;return n.length?(this.returnId||(r=n.map(a=>a.args)),this.returnSingle?this._validateResult(r[0]):await Promise.all(r.map(a=>this._validateResult(a)))):void 0}},qN={};be(qN,{JsonOutputKeyToolsParser:()=>ul,JsonOutputToolsParser:()=>sb,convertLangChainToolCallToOpenAI:()=>rb,makeInvalidToolCall:()=>Ls,parseToolCall:()=>Co});var Nd=class extends Rd{temperature;topP;frequencyPenalty;presencePenalty;n;logitBias;model="gpt-3.5-turbo";modelKwargs;stop;stopSequences;user;timeout;streaming=!1;streamUsage=!0;maxTokens;logprobs;topLogprobs;apiKey;organization;__includeRawResponse;client;clientConfig;supportsStrictToolCalling;audio;modalities;reasoning;zdrEnabled;service_tier;promptCacheKey;promptCacheRetention;verbosity;defaultOptions;_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","reasoning_effort","service_tier"]}lc_serializable=!0;get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","promptCacheKey","promptCacheRetention","verbosity"]}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(e){super(e??{});const t=typeof e?.configuration?.apiKey=="string"||typeof e?.configuration?.apiKey=="function"?e?.configuration?.apiKey:void 0;this.apiKey=e?.apiKey??t??wn("OPENAI_API_KEY"),this.organization=e?.configuration?.organization??wn("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoning=e?.reasoning,this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.promptCacheKey=e?.promptCacheKey??this.promptCacheKey,this.promptCacheRetention=e?.promptCacheRetention??this.promptCacheRetention,this.verbosity=e?.verbosity??this.verbosity,this.disableStreaming=e?.disableStreaming===!0,this.streaming=e?.streaming===!0,this.disableStreaming&&(this.streaming=!1),e?.streaming===!1&&(this.disableStreaming=!0),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}_getReasoningParams(e){if(!ua(this.model))return;let t;return this.reasoning!==void 0&&(t={...t,...this.reasoning}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),e?.reasoningEffort!==void 0&&t?.effort===void 0&&(t={...t,effort:e.reasoningEffort}),t}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&yn(e.json_schema.schema)?KR(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){const n={baseURL:this.clientConfig.baseURL},r=EC(n),s={...this.clientConfig,baseURL:r,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,s.defaultHeaders=xC(s.defaultHeaders),this.client=new _e(s)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,t){return zi(e)?zC(e.metadata.customTool):Ad(e)?t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:OC(e,t)}bindTools(e,t){let n;return t?.strict!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.withConfig({tools:e.map(r=>xd(r)||zi(r)?r:$C(r)?r.extras.providerToolDefinition:this._convertChatOpenAIToolToCompletionsTool(r,{strict:n})),...t})}async stream(e,t){return super.stream(e,this._combineCallOptions(t))}async invoke(e,t){return super.invoke(e,this._combineCallOptions(t))}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let t=0,n=0,r=0;this.model==="gpt-3.5-turbo-0301"?(n=4,r=-1):(n=3,r=1);const s=await Promise.all(e.map(async a=>{const[i,o]=await Promise.all([this.getNumTokens(a.content),this.getNumTokens(la(a))]),c=a.name!==void 0?r+await this.getNumTokens(a.name):0;let u=i+n+o+c;const l=a;if(l._getType()==="function"&&(u-=2),l.additional_kwargs?.function_call&&(u+=3),l?.additional_kwargs.function_call?.name&&(u+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))}catch(d){console.error("Error parsing function arguments",d,JSON.stringify(l.additional_kwargs.function_call)),u+=await this.getNumTokens(l.additional_kwargs.function_call?.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:s}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>n.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)))).reduce((n,r)=>n+r,0)}async _getEstimatedTokenCountFromPrompt(e,t,n){let r=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){const s=CC(t);r+=await this.getNumTokens(s),r+=9}return t&&e.find(s=>s._getType()==="system")&&(r-=4),n==="none"?r+=1:typeof n=="object"&&(r+=await this.getNumTokens(n.name)+4),r}async moderateContent(e,t){const n=this._getClientOptions(t?.options),r=t?.model??"omni-moderation-latest",s={input:e,model:r};return this.caller.call(async()=>{try{return await this.client.moderations.create(s,n)}catch(a){throw Rl(a)}})}get profile(){return QR[this.model]??{}}_getStructuredOutputMethod(e){const t={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if(t?.method===void 0)return"jsonSchema"}else t.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return t.method}withStructuredOutput(e,t){let n,r;const{schema:s,name:a,includeRaw:i}={...t,schema:e};if(t?.strict!==void 0&&t.method==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");const o=JR(this.model,t?.method);if(o==="jsonMode"){yn(s)?r=Ui.fromZodSchema(s):r=new il;const d=tn(s);n=this.withConfig({outputVersion:"v0",response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:a??"extract",...d}}})}else if(o==="jsonSchema"){const d={name:a??"extract",description:vo(s),schema:s,strict:t?.strict},f=tn(d.schema);if(n=this.withConfig({outputVersion:"v0",response_format:{type:"json_schema",json_schema:d},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:d.name,description:d.description,...f}}}),yn(s)){const h=Ui.fromZodSchema(s);r=Fn.from(p=>"parsed"in p.additional_kwargs?p.additional_kwargs.parsed:h)}else r=new il}else{let d=a??"extract";if(yn(s)){const f=tn(s);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:{name:d,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:d}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:d,...f}},...t?.strict!==void 0?{strict:t.strict}:{}}),r=new ul({returnSingle:!0,keyName:d,zodSchema:s})}else{let f;typeof s.name=="string"&&typeof s.parameters=="object"&&s.parameters!=null?(f=s,d=s.name):(d=s.title??d,f={name:d,description:s.description??"",parameters:s});const h=tn(s);n=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:d}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:d,...h}},...t?.strict!==void 0?{strict:t.strict}:{}}),r=new ul({returnSingle:!0,keyName:d})}}if(!i)return n.pipe(r);const c=ss.assign({parsed:(d,f)=>r.invoke(d.raw,f)}),u=ss.assign({parsed:()=>null}),l=c.withFallbacks({fallbacks:[u]});return ca.from([{raw:n},l])}};const ab={providerName:"ChatOpenAI",fromStandardTextBlock(e){return{type:"text",text:e.text}},fromStandardImageBlock(e){if(e.source_type==="url")return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if(e.source_type==="base64")return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if(e.source_type==="url"){const t=zs({dataUrl:e.url});if(!t)throw new Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);const n=t.mime_type||e.mime_type||"";let r;try{r=wu(n)}catch{throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if(r.type!=="audio"||r.subtype!=="wav"&&r.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:t.data}}}if(e.source_type==="base64"){let t;try{t=wu(e.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if(t.type!=="audio"||t.subtype!=="wav"&&t.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw new Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if(e.source_type==="url"){const t=zs({dataUrl:e.url}),n=Li(e);if(!t)throw new Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:n}:{}}}}if(e.source_type==="base64"){const t=Li(e);return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:t}:{}}}}if(e.source_type==="id")return{type:"file",file:{file_id:e.id}};throw new Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}},HN=({message:e,rawResponse:t,includeRawResponse:n})=>{const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],a=[];for(const u of r??[])try{s.push(Co(u,{returnId:!0}))}catch(l){a.push(Ls(u,l.message))}const i={function_call:e.function_call,tool_calls:r};n!==void 0&&(i.__raw_response=t);const o={model_provider:"openai",model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};e.audio&&(i.audio=e.audio);const c=XR(e.content||"",t.choices?.[0]?.message);return new wt({content:c,tool_calls:s,invalid_tool_calls:a,additional_kwargs:i,response_metadata:o,id:t.id})}default:return new Sr(e.content||"",e.role??"unknown")}},VN=({delta:e,rawResponse:t,includeRawResponse:n,defaultRole:r})=>{const s=e.role??r,a=e.content??"";let i;e.function_call?i={function_call:e.function_call}:e.tool_calls?i={tool_calls:e.tool_calls}:i={},n&&(i.__raw_response=t),e.audio&&(i.audio={...e.audio,index:t.choices[0].index});const o={model_provider:"openai",usage:{...t.usage}};if(s==="user")return new ra({content:a,response_metadata:o});if(s==="assistant"){const c=[];if(Array.isArray(e.tool_calls))for(const u of e.tool_calls)c.push({name:u.function?.name,args:u.function?.arguments,id:u.id,index:u.index,type:"tool_call_chunk"});return new Sn({content:a,tool_call_chunks:c,additional_kwargs:i,id:t.id,response_metadata:o})}else return s==="system"?new Yn({content:a,response_metadata:o}):s==="developer"?new Yn({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new na({content:a,additional_kwargs:i,name:e.name,response_metadata:o}):s==="tool"?new ea({content:a,additional_kwargs:i,tool_call_id:e.tool_call_id,response_metadata:o}):new ta({content:a,role:s,response_metadata:o})},GN=e=>{if(e.type==="image"){if(e.url)return{type:"image_url",image_url:{url:e.url}};if(e.data)return{type:"image_url",image_url:{url:`data:${e.mimeType};base64,${e.data}`}}}if(e.type==="audio"&&e.data){const t=c_(()=>{const[,n]=e.mimeType.split("/");return n==="wav"||n==="mp3"?n:"wav"});return{type:"input_audio",input_audio:{data:e.data.toString(),format:t}}}if(e.type==="file"){if(e.data){const t=Li(e);return{type:"file",file:{file_data:`data:${e.mimeType};base64,${e.data}`,filename:t}}}if(e.fileId)return{type:"file",file:{file_id:e.fileId}}}},JN=({message:e,model:t})=>{let n=la(e);if(n==="system"&&ua(t)&&(n="developer"),n==="developer")return{role:"developer",content:e.contentBlocks.filter(s=>s.type==="text")};if(n==="system")return{role:"system",content:e.contentBlocks.filter(s=>s.type==="text")};if(n==="assistant")return{role:"assistant",content:e.contentBlocks.filter(s=>s.type==="text")};if(n==="tool"&&En.isInstance(e))return{role:"tool",tool_call_id:e.tool_call_id,content:e.contentBlocks.filter(s=>s.type==="text")};if(n==="function")return{role:"function",name:e.name??"",content:e.contentBlocks.filter(s=>s.type==="text").join("")};function*r(s){for(const a of s){a.type==="text"&&(yield{type:"text",text:a.text});const i=GN(a);i&&(yield i)}}return{role:"user",content:Array.from(r(e.contentBlocks))}},om=({messages:e,model:t})=>e.flatMap(n=>{if("output_version"in n.response_metadata&&n.response_metadata?.output_version==="v1")return JN({message:n});let r=la(n);r==="system"&&ua(t)&&(r="developer");const s=typeof n.content=="string"?n.content:n.content.map(i=>vn(i)?Ml(i,ab):i),a={role:r,content:s};if(n.name!=null&&(a.name=n.name),n.additional_kwargs.function_call!=null&&(a.function_call=n.additional_kwargs.function_call),wt.isInstance(n)&&n.tool_calls?.length?a.tool_calls=n.tool_calls.map(rb):(n.additional_kwargs.tool_calls!=null&&(a.tool_calls=n.additional_kwargs.tool_calls),En.isInstance(n)&&n.tool_call_id!=null&&(a.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){const i={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[a,i]}return a});var WN=class extends Nd{invocationParams(e,t){let n;e?.strict!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let r={};e?.stream_options!==void 0?r={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(r={stream_options:{include_usage:!0}});const s={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(i=>this._convertChatOpenAIToolToCompletionsTool(i,{strict:n})):void 0,tool_choice:Nw(e?.tool_choice),response_format:this._getResponseFormat(e?.response_format),seed:e?.seed,...r,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,prompt_cache_retention:e?.promptCacheRetention??this.promptCacheRetention,verbosity:e?.verbosity??this.verbosity};e?.prediction!==void 0&&(s.prediction=e.prediction),this.service_tier!==void 0&&(s.service_tier=this.service_tier),e?.service_tier!==void 0&&(s.service_tier=e.service_tier);const a=this._getReasoningParams(e);return a!==void 0&&a.effort!==void 0&&(s.reasoning_effort=a.effort),ua(s.model)?s.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:s.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,s}async _generate(e,t,n){t.signal?.throwIfAborted();const r={},s=this.invocationParams(t),a=om({messages:e,model:this.model});if(s.stream){const i=this._streamResponseChunks(e,t,n),o={};for await(const h of i){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};const p=h.generationInfo?.completion??0;o[p]===void 0?o[p]=h:o[p]=o[p].concat(h)}const c=Object.entries(o).sort(([h],[p])=>parseInt(h,10)-parseInt(p,10)).map(([h,p])=>p),{functions:u,function_call:l}=this.invocationParams(t),d=await this._getEstimatedTokenCountFromPrompt(e,u,l),f=await this._getNumTokensFromGenerations(c);return r.input_tokens=d,r.output_tokens=f,r.total_tokens=d+f,{generations:c,llmOutput:{estimatedTokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}else{const i=await this.completionWithRetry({...s,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:o,prompt_tokens:c,total_tokens:u,prompt_tokens_details:l,completion_tokens_details:d}=i?.usage??{};o&&(r.output_tokens=(r.output_tokens??0)+o),c&&(r.input_tokens=(r.input_tokens??0)+c),u&&(r.total_tokens=(r.total_tokens??0)+u),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(r.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(d?.audio_tokens!==null||d?.reasoning_tokens!==null)&&(r.output_token_details={...d?.audio_tokens!==null&&{audio:d?.audio_tokens},...d?.reasoning_tokens!==null&&{reasoning:d?.reasoning_tokens}});const f=[];for(const h of i?.choices??[]){const m={text:h.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(h.message??{role:"assistant"},i)};m.generationInfo={...h.finish_reason?{finish_reason:h.finish_reason}:{},...h.logprobs?{logprobs:h.logprobs}:{}},no(m.message)&&(m.message.usage_metadata=r),m.message=new wt(Object.fromEntries(Object.entries(m.message).filter(([b])=>!b.startsWith("lc_")))),f.push(m)}return{generations:f,llmOutput:{tokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}}async*_streamResponseChunks(e,t,n){const r=om({messages:e,model:this.model}),s={...this.invocationParams(t,{streaming:!0}),messages:r,stream:!0};let a;const i=await this.completionWithRetry(s,t);let o;for await(const c of i){if(t.signal?.aborted)return;const u=c?.choices?.[0];if(c.usage&&(o=c.usage),!u)continue;const{delta:l}=u;if(!l)continue;const d=this._convertCompletionsDeltaToBaseMessageChunk(l,c,a);a=l.role??a;const f={prompt:t.promptIndex??0,completion:u.index??0};if(typeof d.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const h={...f};u.finish_reason!=null&&(h.finish_reason=u.finish_reason,h.system_fingerprint=c.system_fingerprint,h.model_name=c.model,h.service_tier=c.service_tier),this.logprobs&&(h.logprobs=u.logprobs);const p=new Kr({message:d,text:d.content,generationInfo:h});yield p,await n?.handleLLMNewToken(p.text??"",f,void 0,void 0,void 0,{chunk:p})}if(o){const c={...o.prompt_tokens_details?.audio_tokens!==null&&{audio:o.prompt_tokens_details?.audio_tokens},...o.prompt_tokens_details?.cached_tokens!==null&&{cache_read:o.prompt_tokens_details?.cached_tokens}},u={...o.completion_tokens_details?.audio_tokens!==null&&{audio:o.completion_tokens_details?.audio_tokens},...o.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:o.completion_tokens_details?.reasoning_tokens}};yield new Kr({message:new Sn({content:"",response_metadata:{usage:{...o}},usage_metadata:{input_tokens:o.prompt_tokens,output_tokens:o.completion_tokens,total_tokens:o.total_tokens,...Object.keys(c).length>0&&{input_token_details:c},...Object.keys(u).length>0&&{output_token_details:u}}}),text:""})}if(t.signal?.aborted)throw new Error("AbortError")}async completionWithRetry(e,t){const n=this._getClientOptions(t),r=e.response_format&&e.response_format.type==="json_schema";return this.caller.call(async()=>{try{return r&&!e.stream?await this.client.chat.completions.parse(e,n):await this.client.chat.completions.create(e,n)}catch(s){throw Rl(s)}})}_convertCompletionsDeltaToBaseMessageChunk(e,t,n){return VN({delta:e,rawResponse:t,includeRawResponse:this.__includeRawResponse,defaultRole:n})}_convertCompletionsMessageToBaseMessage(e,t){return HN({message:e,rawResponse:t,includeRawResponse:this.__includeRawResponse})}};const Fi="__openai_function_call_ids__";function ib(e){return e.type==="url_citation"?{type:"citation",source:"url_citation",url:e.url,title:e.title,startIndex:e.start_index,endIndex:e.end_index}:e.type==="file_citation"?{type:"citation",source:"file_citation",title:e.filename,startIndex:e.index,file_id:e.file_id}:e.type==="container_file_citation"?{type:"citation",source:"container_file_citation",title:e.filename,startIndex:e.start_index,endIndex:e.end_index,file_id:e.file_id,container_id:e.container_id}:e.type==="file_path"?{type:"citation",source:"file_path",startIndex:e.index,file_id:e.file_id}:{type:"non_standard",value:e}}const ob=e=>{const t={...e?.input_tokens_details?.cached_tokens!=null&&{cache_read:e?.input_tokens_details?.cached_tokens}},n={...e?.output_tokens_details?.reasoning_tokens!=null&&{reasoning:e?.output_tokens_details?.reasoning_tokens}};return{input_tokens:e?.input_tokens??0,output_tokens:e?.output_tokens??0,total_tokens:e?.total_tokens??0,input_token_details:t,output_token_details:n}},cb=e=>{if(e.error){const o=new Error(e.error.message);throw o.name=e.error.code,o}let t;const n=[],r=[],s=[],a={model_provider:"openai",model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},i={};for(const o of e.output)if(o.type==="message")t=o.id,n.push(...o.content.flatMap(c=>c.type==="output_text"?("parsed"in c&&c.parsed!=null&&(i.parsed=c.parsed),{type:"text",text:c.text,annotations:c.annotations.map(ib)}):c.type==="refusal"?(i.refusal=c.refusal,[]):c));else if(o.type==="function_call"){const c={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{r.push(Co(c,{returnId:!0}))}catch(u){let l;typeof u=="object"&&u!=null&&"message"in u&&typeof u.message=="string"&&(l=u.message),s.push(Ls(c,l))}i[Fi]??={},o.id&&(i[Fi][o.call_id]=o.id)}else if(o.type==="reasoning"){i.reasoning=o;const c=o.summary?.map(u=>u.text).filter(Boolean).join("");c&&n.push({type:"reasoning",reasoning:c})}else if(o.type==="custom_tool_call"){const c=NC(o);c?r.push(c):s.push(Ls(o,"Malformed custom tool call"))}else if(o.type==="computer_call"){const c=PC(o);c?r.push(c):s.push(Ls(o,"Malformed computer call"))}else o.type==="image_generation_call"?(o.result&&n.push({type:"image",mimeType:"image/png",data:o.result,id:o.id,metadata:{status:o.status}}),i.tool_outputs??=[],i.tool_outputs.push(o)):(i.tool_outputs??=[],i.tool_outputs.push(o));return new wt({id:t,content:n,tool_calls:r,invalid_tool_calls:s,usage_metadata:ob(e.usage),additional_kwargs:i,response_metadata:a})},KN=e=>{const t=(e.summary.length>1?e.summary.reduce((n,r)=>{const s=n[n.length-1];return s.index===r.index?s.text+=r.text:n.push(r),n},[{...e.summary[0]}]):e.summary).map(n=>Object.fromEntries(Object.entries(n).filter(([r])=>r!=="index")));return{...e,summary:t}},XN=e=>{const t=[];let n={},r;const s=[],a={model_provider:"openai"},i={};let o;if(e.type==="response.output_text.delta")t.push({type:"text",text:e.delta,index:e.content_index});else if(e.type==="response.output_text.annotation.added")t.push({type:"text",text:"",annotations:[ib(e.annotation)],index:e.content_index});else if(e.type==="response.output_item.added"&&e.item.type==="message")o=e.item.id;else if(e.type==="response.output_item.added"&&e.item.type==="function_call")s.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),i[Fi]={[e.item.call_id]:e.item.id};else if(e.type==="response.output_item.done"&&e.item.type==="computer_call")s.push({type:"tool_call_chunk",name:"computer_use",args:JSON.stringify({action:e.item.action}),id:e.item.call_id,index:e.output_index}),i.tool_outputs=[e.item];else if(e.type==="response.output_item.done"&&e.item.type==="image_generation_call")e.item.result&&t.push({type:"image",mimeType:"image/png",data:e.item.result,id:e.item.id,metadata:{status:e.item.status}}),i.tool_outputs=[e.item];else if(e.type==="response.output_item.done"&&["web_search_call","file_search_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","custom_tool_call"].includes(e.item.type))i.tool_outputs=[e.item];else if(e.type==="response.created")a.id=e.response.id,a.model_name=e.response.model,a.model=e.response.model;else if(e.type==="response.completed"){const c=cb(e.response);r=ob(e.response.usage),e.response.text?.format?.type==="json_schema"&&(i.parsed??=JSON.parse(c.text));for(const[u,l]of Object.entries(e.response))u!=="id"&&(a[u]=l)}else if(e.type==="response.function_call_arguments.delta"||e.type==="response.custom_tool_call_input.delta")s.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if(e.type==="response.web_search_call.completed"||e.type==="response.file_search_call.completed")n={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(e.type==="response.refusal.done")i.refusal=e.refusal;else if(e.type==="response.output_item.added"&&"item"in e&&e.item.type==="reasoning"){const c=e.item.summary?e.item.summary.map((l,d)=>({...l,index:d})):void 0;i.reasoning={id:e.item.id,type:e.item.type,...c?{summary:c}:{}};const u=e.item.summary?.map(l=>l.text).filter(Boolean).join("");u&&t.push({type:"reasoning",reasoning:u})}else if(e.type==="response.reasoning_summary_part.added")i.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]},e.part.text&&t.push({type:"reasoning",reasoning:e.part.text});else if(e.type==="response.reasoning_summary_text.delta")i.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]},e.delta&&t.push({type:"reasoning",reasoning:e.delta});else return e.type==="response.image_generation_call.partial_image",null;return new Kr({text:t.map(c=>c.text).join(""),message:new Sn({id:o,content:t,tool_call_chunks:s,usage_metadata:r,additional_kwargs:i,response_metadata:a}),generationInfo:n})},YN=e=>{const t=wt.isInstance(e)&&e.response_metadata?.model_provider==="openai";function*n(){const r=br(()=>{try{const _=la(e);return _==="system"||_==="developer"||_==="assistant"||_==="user"?_:"assistant"}catch{return"assistant"}});let s;const a=new Set,i=new Set,o=new Map,c=new Map;function*u(){if(!s)return;const _=s.content;(typeof _=="string"&&_.length>0||Array.isArray(_)&&_.length>0)&&(yield s),s=void 0}const l=_=>{s||(s={type:"message",role:r,content:[]}),typeof s.content=="string"?s.content=s.content.length>0?[{type:"input_text",text:s.content},..._]:[..._]:s.content.push(..._)},d=_=>{if(typeof _=="string")return _;try{return JSON.stringify(_??{})}catch{return"{}"}},f=_=>{const w=br(()=>{const E=_.metadata?.detail;return E==="low"||E==="high"||E==="auto"?E:"auto"});if(_.fileId)return{type:"input_image",detail:w,file_id:_.fileId};if(_.url)return{type:"input_image",detail:w,image_url:_.url};if(_.data){const E=typeof _.data=="string"?_.data:Buffer.from(_.data).toString("base64"),x=_.mimeType??"image/png";return{type:"input_image",detail:w,image_url:`data:${x};base64,${E}`}}},h=_=>{if(_.fileId){const w=Jp(_);return{type:"input_file",file_id:_.fileId,...w?{filename:w}:{}}}if(_.url){const w=Jp(_);return{...w?{filename:w}:{},type:"input_file",file_url:_.url}}if(_.data){const w=Li(_),E=typeof _.data=="string"?_.data:Buffer.from(_.data).toString("base64");return{type:"input_file",file_data:`data:${_.mimeType??"application/octet-stream"};base64,${E}`,...w?{filename:w}:{}}}},p=_=>{const w=br(()=>{if(Array.isArray(_.summary)){const P=_.summary?.map(j=>j?.text).filter(j=>typeof j=="string")??[];if(P.length>0)return P}return _.reasoning?[_.reasoning]:[]}),E=w.length>0?w.map(I=>({type:"summary_text",text:I})):[{type:"summary_text",text:""}],x={type:"reasoning",id:_.id??"",summary:E};return _.reasoning&&(x.content=[{type:"reasoning_text",text:_.reasoning}]),x},m=_=>({type:"function_call",name:_.name??"",call_id:_.id??"",arguments:d(_.args)}),b=_=>{const w=d(_.output),E=_.status==="success"?"completed":_.status==="error"?"incomplete":void 0;return{type:"function_call_output",call_id:_.toolCallId??"",output:w,...E?{status:E}:{}}};for(const _ of e.contentBlocks)if(_.type==="text")l([{type:"input_text",text:_.text}]);else if(_.type!=="invalid_tool_call"){if(_.type==="reasoning")yield*u(),yield p(_);else if(_.type==="tool_call"){yield*u();const w=_.id??"";w&&(a.add(w),o.delete(w)),yield m(_)}else if(_.type==="tool_call_chunk"){if(_.id){const w=o.get(_.id)??{name:_.name,args:[]};_.name&&(w.name=_.name),_.args&&w.args.push(_.args),o.set(_.id,w)}}else if(_.type==="server_tool_call"){yield*u();const w=_.id??"";w&&(i.add(w),c.delete(w)),yield m(_)}else if(_.type==="server_tool_call_chunk"){if(_.id){const w=c.get(_.id)??{name:_.name,args:[]};_.name&&(w.name=_.name),_.args&&w.args.push(_.args),c.set(_.id,w)}}else if(_.type==="server_tool_call_result")yield*u(),yield b(_);else if(_.type!=="audio")if(_.type==="file"){const w=h(_);w&&l([w])}else if(_.type==="image"){const w=f(_);w&&l([w])}else if(_.type==="video"){const w=h(_);w&&l([w])}else _.type==="text-plain"?_.text&&l([{type:"input_text",text:_.text}]):_.type==="non_standard"&&t&&(yield*u(),yield _.value)}yield*u();for(const[_,w]of o){if(!_||a.has(_))continue;const E=w.args.join("");!w.name&&!E||(yield{type:"function_call",call_id:_,name:w.name??"",arguments:E})}for(const[_,w]of c){if(!_||i.has(_))continue;const E=w.args.join("");!w.name&&!E||(yield{type:"function_call",call_id:_,name:w.name??"",arguments:E})}}return Array.from(n())},cm=({messages:e,zdrEnabled:t,model:n})=>e.flatMap(r=>{const s=r.response_metadata;if(s?.output_version==="v1")return YN(r);const a=r.additional_kwargs;let i=la(r);if(i==="system"&&ua(n)&&(i="developer"),i==="function")throw new Error("Function messages are not supported in Responses API");if(i==="tool"){const o=r;if(a?.type==="computer_call_output")return{type:"computer_call_output",output:(()=>{if(typeof o.content=="string")return{type:"input_image",image_url:o.content};if(Array.isArray(o.content)){const l=o.content.find(h=>h.type==="input_image");if(l)return l;const d=o.content.find(h=>h.type==="computer_screenshot");if(d)return d;const f=o.content.find(h=>h.type==="image_url");if(f)return{type:"input_image",image_url:typeof f.image_url=="string"?f.image_url:f.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:o.tool_call_id};if(o.additional_kwargs?.customTool)return{type:"custom_tool_call_output",call_id:o.tool_call_id,output:o.content};const c=Array.isArray(o.content)&&o.content.every(u=>typeof u=="object"&&u!==null&&"type"in u&&(u.type==="input_file"||u.type==="input_image"||u.type==="input_text"));return{type:"function_call_output",call_id:o.tool_call_id,id:o.id?.startsWith("fc_")?o.id:void 0,output:c?o.content:typeof o.content!="string"?JSON.stringify(o.content):o.content}}if(i==="assistant"){if(!t&&s?.output!=null&&Array.isArray(s?.output)&&s?.output.length>0&&s?.output.every(f=>"type"in f))return s?.output;const o=[];if(a?.reasoning&&!t){const f=KN(a.reasoning);o.push(f)}let{content:c}=r;a?.refusal&&(typeof c=="string"&&(c=[{type:"output_text",text:c,annotations:[]}]),c=[...c,{type:"refusal",refusal:a.refusal}]),(typeof c=="string"||c.length>0)&&o.push({type:"message",role:"assistant",...r.id&&!t&&r.id.startsWith("msg_")?{id:r.id}:{},content:br(()=>typeof c=="string"?c:c.flatMap(f=>f.type==="text"?{type:"output_text",text:f.text,annotations:f.annotations??[]}:f.type==="output_text"||f.type==="refusal"?f:[]))});const u=a?.[Fi];wt.isInstance(r)&&r.tool_calls?.length?o.push(...r.tool_calls.map(f=>LC(f)?{type:"custom_tool_call",id:f.call_id,call_id:f.id??"",input:f.args.input,name:f.name}:MC(f)?{type:"computer_call",id:f.call_id,call_id:f.id??"",action:f.args.action}:{type:"function_call",name:f.name,arguments:JSON.stringify(f.args),call_id:f.id,...t?{}:{id:u?.[f.id]}})):a?.tool_calls&&o.push(...a.tool_calls.map(f=>({type:"function_call",name:f.function.name,call_id:f.id,arguments:f.function.arguments,...t?{}:{id:u?.[f.id]}})));const l=s?.output?.length?s?.output:a.tool_outputs,d=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(l!=null){const h=l?.filter(p=>d.includes(p.type));h.length>0&&o.push(...h)}return o}if(i==="user"||i==="system"||i==="developer"){if(typeof r.content=="string")return{type:"message",role:i,content:r.content};const o=[],c=r.content.flatMap(u=>{if(u.type==="mcp_approval_response"&&o.push({type:"mcp_approval_response",approval_request_id:u.approval_request_id,approve:u.approve}),vn(u))return Ml(u,ab);if(u.type==="text")return{type:"input_text",text:u.text};if(u.type==="image_url"){const l=br(()=>{if(typeof u.image_url=="string")return u.image_url;if(typeof u.image_url=="object"&&u.image_url!==null&&"url"in u.image_url)return u.image_url.url}),d=br(()=>{if(typeof u.image_url=="string")return"auto";if(typeof u.image_url=="object"&&u.image_url!==null&&"detail"in u.image_url)return u.image_url.detail});return{type:"input_image",image_url:l,detail:d}}return u.type==="input_text"||u.type==="input_image"||u.type==="input_file"?u:[]});return c.length>0&&o.push({type:"message",role:i,content:c}),o}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${i}`),[]});var QN=class extends Nd{invocationParams(e){let t;e?.strict!==void 0&&(t=e.strict),t===void 0&&this.supportsStrictToolCalling!==void 0&&(t=this.supportsStrictToolCalling);const n={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?this._reduceChatOpenAITools(e.tools,{stream:this.streaming,strict:t}):void 0,tool_choice:RC(e?.tool_choice)?e?.tool_choice:(()=>{const s=Nw(e?.tool_choice);if(typeof s=="object"&&"type"in s){if(s.type==="function")return{type:"function",name:s.function.name};if(s.type==="allowed_tools")return{type:"allowed_tools",mode:s.allowed_tools.mode,tools:s.allowed_tools.tools};if(s.type==="custom")return{type:"custom",name:s.custom.name}}})(),text:(()=>{if(e?.text)return e.text;const s=this._getResponseFormat(e?.response_format);return s?.type==="json_schema"?s.json_schema.schema!=null?{format:{type:"json_schema",schema:s.json_schema.schema,description:s.json_schema.description,name:s.json_schema.name,strict:s.json_schema.strict},verbosity:e?.verbosity}:void 0:{format:s,verbosity:e?.verbosity}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,prompt_cache_retention:e?.promptCacheRetention??this.promptCacheRetention,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},r=this._getReasoningParams(e);return r!==void 0&&(n.reasoning=r),n}async _generate(e,t,n){t.signal?.throwIfAborted();const r=this.invocationParams(t);if(r.stream){const s=this._streamResponseChunks(e,t,n);let a;for await(const i of s)i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},a=a?.concat(i)??i;return{generations:a?[a]:[],llmOutput:{estimatedTokenUsage:a?.message?.usage_metadata}}}else{const s=await this.completionWithRetry({input:cm({messages:e,zdrEnabled:this.zdrEnabled??!1,model:this.model}),...r,stream:!1},{signal:t?.signal,...t?.options});return{generations:[{text:s.output_text,message:cb(s)}],llmOutput:{id:s.id,estimatedTokenUsage:s.usage?{promptTokens:s.usage.input_tokens,completionTokens:s.usage.output_tokens,totalTokens:s.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(e,t,n){const r=await this.completionWithRetry({...this.invocationParams(t),input:cm({messages:e,zdrEnabled:this.zdrEnabled??!1,model:this.model}),stream:!0},t);for await(const s of r){if(t.signal?.aborted)return;const a=XN(s);a!=null&&(yield a,await n?.handleLLMNewToken(a.text||"",{prompt:t.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:a}))}}async completionWithRetry(e,t){return this.caller.call(async()=>{const n=this._getClientOptions(t);try{return e.text?.format?.type==="json_schema"&&!e.stream?await this.client.responses.parse(e,n):await this.client.responses.create(e,n)}catch(r){throw Rl(r)}})}_reduceChatOpenAITools(e,t){const n=[];for(const r of e)if(xd(r))r.type==="image_generation"&&t?.stream&&(r.partial_images=1),n.push(r);else if(zi(r)){const s=r.metadata.customTool;n.push({type:"custom",name:s.name,description:s.description,format:s.format})}else Ad(r)?n.push({type:"function",name:r.function.name,parameters:r.function.parameters,description:r.function.description,strict:t?.strict??null}):Pw(r)&&n.push(jC(r));return n}},eP=class ub extends Nd{useResponsesApi=!1;responses;completions;get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}get callKeys(){return[...super.callKeys,"useResponsesApi"]}constructor(t){super(t),this.fields=t,this.useResponsesApi=t?.useResponsesApi??!1,this.responses=t?.responses??new QN(t),this.completions=t?.completions??new WN(t)}_useResponsesApi(t){const n=t?.tools?.some(xd),r=t?.previous_response_id!=null||t?.text!=null||t?.truncation!=null||t?.include!=null||t?.reasoning?.summary!=null||this.reasoning?.summary!=null,s=t?.tools?.some(Pw)||t?.tools?.some(zi);return this.useResponsesApi||n||r||s||vC(this.model)}getLsParams(t){const n=this._combineCallOptions(t);return this._useResponsesApi(t)?this.responses.getLsParams(n):this.completions.getLsParams(n)}invocationParams(t){const n=this._combineCallOptions(t);return this._useResponsesApi(t)?this.responses.invocationParams(n):this.completions.invocationParams(n)}async _generate(t,n,r){return this._useResponsesApi(n)?this.responses._generate(t,n,r):this.completions._generate(t,n,r)}async*_streamResponseChunks(t,n,r){if(this._useResponsesApi(n)){yield*this.responses._streamResponseChunks(t,this._combineCallOptions(n),r);return}yield*this.completions._streamResponseChunks(t,this._combineCallOptions(n),r)}withConfig(t){const n=new ub(this.fields);return n.defaultOptions={...this.defaultOptions,...t},n}},tP={};be(tP,{BaseLLM:()=>lb,LLM:()=>nP});var lb=class Is extends $d{lc_namespace=["langchain","llms",this._llmType()];async invoke(t,n){const r=Is._convertInputToPromptValue(t);return(await this.generatePrompt([r],n,n?.callbacks)).generations[0][0].text}async*_streamResponseChunks(t,n,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(t){const[n,r]=super._separateRunnableConfigFromCallOptions(t);return r.signal=n.signal,[n,r]}async*_streamIterator(t,n){if(this._streamResponseChunks===Is.prototype._streamResponseChunks)yield this.invoke(t,n);else{const r=Is._convertInputToPromptValue(t),[s,a]=this._separateRunnableConfigFromCallOptionsCompat(n),i=await xt.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this?.invocationParams(a),batch_size:1},c=await i?.handleLLMStart(this.toJSON(),[r.toString()],s.runId,void 0,o,void 0,void 0,s.runName);let u=new Wr({text:""});try{for await(const l of this._streamResponseChunks(r.toString(),a,c?.[0]))u?u=u.concat(l):u=l,typeof l.text=="string"&&(yield l.text)}catch(l){throw await Promise.all((c??[]).map(d=>d?.handleLLMError(l))),l}await Promise.all((c??[]).map(l=>l?.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(t,n,r){const s=t.map(a=>a.toString());return this.generate(s,n,r)}invocationParams(t){return{}}_flattenLLMResult(t){const n=[];for(let r=0;r<t.generations.length;r+=1){const s=t.generations[r];if(r===0)n.push({generations:[s],llmOutput:t.llmOutput});else{const a=t.llmOutput?{...t.llmOutput,tokenUsage:{}}:void 0;n.push({generations:[s],llmOutput:a})}}return n}async _generateUncached(t,n,r,s){let a;if(s!==void 0&&s.length===t.length)a=s;else{const u=await xt.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),l={options:n,invocation_params:this?.invocationParams(n),batch_size:t.length};a=await u?.handleLLMStart(this.toJSON(),t,r.runId,void 0,l,void 0,void 0,r?.runName)}const i=!!a?.[0].handlers.find(Wl);let o;if(i&&t.length===1&&this._streamResponseChunks!==Is.prototype._streamResponseChunks)try{const u=await this._streamResponseChunks(t[0],n,a?.[0]);let l;for await(const d of u)l===void 0?l=d:l=er(l,d);if(l===void 0)throw new Error("Received empty response from chat model call.");o={generations:[[l]],llmOutput:{}},await a?.[0].handleLLMEnd(o)}catch(u){throw await a?.[0].handleLLMError(u),u}else{try{o=await this._generate(t,n,a?.[0])}catch(l){throw await Promise.all((a??[]).map(d=>d?.handleLLMError(l))),l}const u=this._flattenLLMResult(o);await Promise.all((a??[]).map((l,d)=>l?.handleLLMEnd(u[d])))}const c=a?.map(u=>u.runId)||void 0;return Object.defineProperty(o,Hs,{value:c?{runIds:c}:void 0,configurable:!0}),o}async _generateCached({prompts:t,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:a,runId:i}){const o=await xt.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this?.invocationParams(s),batch_size:t.length},u=await o?.handleLLMStart(this.toJSON(),t,i,void 0,c,void 0,void 0,a?.runName),l=[],f=(await Promise.allSettled(t.map(async(m,b)=>{const _=await n.lookup(m,r);return _==null&&l.push(b),_}))).map((m,b)=>({result:m,runManager:u?.[b]})).filter(({result:m})=>m.status==="fulfilled"&&m.value!=null||m.status==="rejected"),h=[];await Promise.all(f.map(async({result:m,runManager:b},_)=>{if(m.status==="fulfilled"){const w=m.value;return h[_]=w.map(E=>(E.generationInfo={...E.generationInfo,tokenUsage:{}},E)),w.length&&await b?.handleLLMNewToken(w[0].text),b?.handleLLMEnd({generations:[w]},void 0,void 0,void 0,{cached:!0})}else return await b?.handleLLMError(m.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(m.reason)}));const p={generations:h,missingPromptIndices:l,startedRunManagers:u};return Object.defineProperty(p,Hs,{value:u?{runIds:u?.map(m=>m.runId)}:void 0,configurable:!0}),p}async generate(t,n,r){if(!Array.isArray(t))throw new Error("Argument 'prompts' is expected to be a string[]");let s;Array.isArray(n)?s={stop:n}:s=n;const[a,i]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(t,i,a);const{cache:o}=this,c=this._getSerializedCacheKeyParametersForCall(i),{generations:u,missingPromptIndices:l,startedRunManagers:d}=await this._generateCached({prompts:t,cache:o,llmStringKey:c,parsedOptions:i,handledOptions:a,runId:a.runId});let f={};if(l.length>0){const h=await this._generateUncached(l.map(p=>t[p]),i,a,d!==void 0?l.map(p=>d?.[p]):void 0);await Promise.all(h.generations.map(async(p,m)=>{const b=l[m];return u[b]=p,o.update(t[b],c,p)})),f=h.llmOutput??{}}return{generations:u,llmOutput:f}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},nP=class extends lb{async _generate(e,t,n){return{generations:await Promise.all(e.map((s,a)=>this._call(s,{...t,promptIndex:a},n).then(i=>[{text:i}])))}}},rP={};be(rP,{chunkArray:()=>sP});const sP=(e,t)=>e.reduce((n,r,s)=>{const a=Math.floor(s/t),i=n[a]||[];return n[a]=i.concat([r]),n},[]);var aP={};be(aP,{Embeddings:()=>iP});var iP=class{caller;constructor(e){this.caller=new oa(e??{})}},oP={};be(oP,{BaseToolkit:()=>cP,DynamicStructuredTool:()=>hb,DynamicTool:()=>fb,StructuredTool:()=>Pd,Tool:()=>db,ToolInputParsingException:()=>hi,isLangChainTool:()=>xo,isRunnableToolLike:()=>Td,isStructuredTool:()=>Ed,isStructuredToolParams:()=>Sd,tool:()=>uP});var Pd=class extends Cd{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(e){super(e??{}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata,this.extras=e?.extras??this.extras}async invoke(e,t){let n,r=Te(wi(this.defaultConfig,t));return $s(e)?(n=e.args,r={...r,toolCall:e}):n=e,this.call(n,r)}async call(e,t,n){const r=$s(e)?e.args:e;let s;if(yn(this.schema))try{s=await bo(this.schema,r)}catch(h){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${h.message}`),cw(h)&&(p=`${p}

${t1(h)}`),new hi(p,JSON.stringify(e))}else{const h=je(r,this.schema);if(!h.valid){let p="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(p=`${p}
Details: ${h.errors.map(m=>`${m.keywordLocation}: ${m.error}`).join(`
`)}`),new hi(p,JSON.stringify(e))}s=r}const a=uo(t),o=await xt.configure(a.callbacks,this.callbacks,a.tags||n,this.tags,a.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let c;try{c=await this._call(s,o,a)}catch(h){throw await o?.handleToolError(h),h}let u,l;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[u,l]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else u=c;let d;$s(e)&&(d=e.id),!d&&x0(a)&&(d=a.toolCall.id);const f=lP({content:u,artifact:l,toolCallId:d,name:this.name,metadata:this.metadata});return await o?.handleToolEnd(f),f}},db=class extends Pd{schema=So({input:To().optional()}).transform(e=>e.input);constructor(e){super(e)}call(e,t){const n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,t)}},fb=class extends db{static lc_name(){return"DynamicTool"}name;description;func;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const n=uo(t);return n.runName===void 0&&(n.runName=this.name),super.call(e,n)}async _call(e,t,n){return this.func(e,t,n)}},hb=class extends Pd{static lc_name(){return"DynamicStructuredTool"}description;func;schema;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,n){const r=uo(t);return r.runName===void 0&&(r.runName=this.name),super.call(e,r,n)}_call(e,t,n){return this.func(e,t,n)}},cP=class{getTools(){return this.tools}};function uP(e,t){const n=pd(t.schema),r=Ms(t.schema);if(!t.schema||n||r)return new fb({...t,description:t.description??t.schema?.description??`${t.name} tool`,func:async(i,o,c)=>new Promise((u,l)=>{const d=Le(c,{callbacks:o?.getChild()});an.runWithConfig(Ln(d),async()=>{try{u(e(i,d))}catch(f){l(f)}})})});const s=t.schema,a=t.description??t.schema.description??`${t.name} tool`;return new hb({...t,description:a,schema:s,func:async(i,o,c)=>new Promise((u,l)=>{let d;const f=()=>{c?.signal&&d&&c.signal.removeEventListener("abort",d)};c?.signal&&(d=()=>{f(),l(Zs(c.signal))},c.signal.addEventListener("abort",d));const h=Le(c,{callbacks:o?.getChild()});an.runWithConfig(Ln(h),async()=>{try{const p=await e(i,h);if(c?.signal?.aborted){f();return}f(),u(p)}catch(p){f(),l(p)}})})})}function lP(e){const{content:t,artifact:n,toolCallId:r,metadata:s}=e;return r&&!Fl(t)?typeof t=="string"||Array.isArray(t)&&t.every(a=>typeof a=="object")?new En({status:"success",content:t,artifact:n,tool_call_id:r,name:e.name,metadata:s}):new En({status:"success",content:dP(t),artifact:n,tool_call_id:r,name:e.name,metadata:s}):t}function dP(e){try{return JSON.stringify(e)??""}catch{return`${e}`}}const fP=ht({type:jt("screenshot")}),hP=ht({type:jt("click"),x:dt(),y:dt(),button:Id(["left","right","wheel","back","forward"]).default("left")}),pP=ht({type:jt("double_click"),x:dt(),y:dt(),button:Id(["left","right","wheel","back","forward"]).default("left")}),mP=ht({type:jt("drag"),path:da(ht({x:dt(),y:dt()}))}),gP=ht({type:jt("keypress"),keys:da(Nt())}),_P=ht({type:jt("move"),x:dt(),y:dt()}),yP=ht({type:jt("scroll"),x:dt(),y:dt(),scroll_x:dt(),scroll_y:dt()}),wP=ht({type:jt("type"),text:Nt()}),bP=ht({type:jt("wait"),duration:dt().optional()}),vP=kd("type",[fP,hP,pP,mP,gP,_P,yP,wP,bP]);ht({action:vP});const EP=ht({type:jt("exec"),command:da(Nt()),env:M$(Nt(),Nt()).optional(),working_directory:Nt().optional(),timeout_ms:dt().optional(),user:Nt().optional()});kd("type",[EP]);ht({commands:da(Nt()).describe("Array of shell commands to execute"),timeout_ms:dt().optional().describe("Optional timeout in milliseconds for the commands"),max_output_length:dt().optional().describe("Optional maximum number of characters to return from each command")});const TP=ht({type:jt("create_file"),path:Nt(),diff:Nt()}),SP=ht({type:jt("update_file"),path:Nt(),diff:Nt()}),xP=ht({type:jt("delete_file"),path:Nt()});kd("type",[TP,SP,xP]);const kP=new eP({model:"qwen-vl-max-2025-08-13",apiKey:"sk-91af07eee1e8438c9b7bbb2b22f50468",configuration:{baseURL:"https://dashscope.aliyuncs.com/compatible-mode/v1"}}),IP=()=>{let e="AIfish",t=[];return{startChat:async s=>{try{const a=[e,...t,new sn(s)],i=await kP.invoke(a);return t.push(new sn(s)),t.push(i),t.length>20&&(t=t.slice(-20)),i.content}catch(a){return console.error(a),"AI"}},setSystemMessage:s=>{e=new Mn(s),console.log("ai---",e)}}},OP={class:"robot-container"},AP={key:0,class:"row"},CP=["src"],$P={key:1,class:"chatContainer"},RP={class:"header"},NP=["src"],PP={key:0,class:"robotMessage"},MP=["src"],LP={key:1,class:"userMessage"},jP=["src"],zP={key:0,class:"robotMessage"},DP=["src"],UP={class:"bottomBar"},FP=um({__name:"Robot",props:{formItem:{}},setup(e){const{startChat:t,setSystemMessage:n}=IP(),r=Ob(),s=e,a=Rr(!0),i=Rr([{role:"robot",message:"Hello! How can I assist you today?"}]),o=Rr(""),c=Rr(null),u=()=>{Sb(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})};gb(()=>i.value,()=>{u()},{deep:!0});const l=Rr(!1),d=_b(()=>r.theme.label==="light"?Dd.default_sun:Dd.default_moon);n(`fish,,,v-htmlcontent,,,js title,type,content,,v-html, js ${JSON.stringify(s?.formItem)}`);const f=async()=>{if(o.value.trim()==="")return;i.value.push({role:"user",message:o.value});const h=o.value;o.value="",l.value=!0;const p=await t(h);l.value=!1,i.value.push({role:"robot",message:p})};return(h,p)=>(In(),kn("div",OP,[Dt(a)?(In(),kn("div",AP,[tt("span",{class:yb(["robotTitle",Dt(r).theme.label==="light"?"bigTitle_sun":"bigTitle_moon"])},"Hi~",2),tt("div",{class:"iconContainer",onClick:p[0]||(p[0]=m=>a.value=!1)},[tt("img",{class:"robotIcon",src:Dt(r).theme.label==="light"?Dt(ma).default_sun:Dt(ma).default_moon,alt:"Robot Icon"},null,8,CP)])])):(In(),kn("div",$P,[tt("div",RP,[tt("img",{class:"deleteIcon",src:Dt(Ib).default_sun,alt:"Delete Icon",onClick:p[1]||(p[1]=m=>a.value=!0)},null,8,NP)]),tt("div",{class:"chatContent",ref_key:"chatContentRef",ref:c},[(In(!0),kn(wb,null,bb(Dt(i),(m,b)=>(In(),kn("div",{class:"messageDivider",key:b},[m?.role==="robot"?(In(),kn("div",PP,[tt("img",{class:"messageIcon",src:Dt(ma).default_moon,alt:""},null,8,MP),tt("span",null,jd(m?.message),1)])):$o("",!0),m?.role==="user"?(In(),kn("div",LP,[tt("span",null,jd(m?.message),1),tt("img",{class:"messageIcon",src:Dt(d),alt:""},null,8,jP)])):$o("",!0)]))),128)),Dt(l)?(In(),kn("div",zP,[tt("img",{class:"messageIcon",src:Dt(ma).default_moon,alt:""},null,8,DP),p[3]||(p[3]=tt("div",{class:"typingIndicator"},[tt("div",{class:"dot"}),tt("div",{class:"dot"}),tt("div",{class:"dot"})],-1))])):$o("",!0)],512),tt("div",UP,[vb(tt("input",{class:"userInput","onUpdate:modelValue":p[2]||(p[2]=m=>Tb(o)?o.value=m:null),type:"text"},null,512),[[Eb,Dt(o)]]),tt("button",{class:"userButton",onClick:f},"Send")])]))]))}}),BP=lm(FP,[["__scopeId","data-v-57fdf676"]]),ZP={class:"detail-container"},qP=um({__name:"[id]",async setup(e){let t,n;const s=Rr({id:"36",url:"",content:'<p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Contact Me:(Email)2747490496@qq.com</strong></span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Position</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Capability</strong></span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>1.</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"> </span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Vue3 Taro</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>PiniaVuex</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>2.Nuxt4</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"> SSR  SEO</span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>3.</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"> </span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Node.js</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>NestJs</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Express</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>4.</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>MySQLMongoDB</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong> Peisma/Sequelize</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"> </span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>ORM </strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>JWT</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span></p><p><strong>5.</strong><span style="font-size: 14px;"> </span><span style="font-size: 14px;"><strong>Axios</strong></span><span style="font-size: 14px;">  Axios </span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Experience</strong></span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 16px;"><u><strong>2025.12 - - </strong></u></span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong></strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">0-1</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong></strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"> </span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Taro</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+Vue+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>TypeScript</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>NestJS</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Prisma</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+Jenkins+GitLab+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Mysql</strong></span></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Details</strong></span></p><p><strong>1.</strong>  AI AI </p><p><strong>2</strong>./H5</p><p><strong>3</strong>.</p><p><strong>4.</strong></p><p><br></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong></strong></span></p><p><strong>1.</strong> useDidShow Taro  useDidShow </p><p><strong></strong> <strong>useDidShow</strong>   <strong>ref</strong> <strong></strong> <strong>refreshFabricList</strong> </p><p><strong>2.</strong><strong></strong><strong></strong>""</p><p><strong></strong><strong></strong>5-81-3 50%</p><p><strong>3.</strong><strong></strong><strong></strong>tokentokentoken</p><p><strong></strong>urlid+tokentoken+idtoken</p><p></p><p><br></p><p><img src="" alt="linctex.jpg" data-href="" style=""/></p><p><span style="color: rgb(51, 51, 51); background-color: rgba(219, 224, 232, 0.3); font-size: 16px;"><u><strong>2025.08 - 2025.12 () - </strong></u></span></p><p><strong></strong></p><p><strong>1.</strong> / </p><p><strong>2.</strong> Web/H5  /  Input Excel  PC /  Bug </p><p></p><p><strong>1</strong>.  </p><p><strong>2.</strong> / h5</p><p><strong>3.</strong>  / </p><p><br></p><p><strong>Project Experience</strong></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>( </strong></span><a href="https://github.com/ybcoo/blog" target="_blank"><strong>https://github.com/ybcoo/blog</strong></a> <span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>)</strong></span></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Link </strong></span><a href="https://ybcoo.github.io/blog/" target="_blank"><span style="color: rgb(66, 144, 247);"><u><strong>https://ybcoo.github.io/blog</strong></u></span></a></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Link </strong></span><a href="https://ybcoo.github.io/blog-manage-ts/" target="_blank"><span style="color: rgb(66, 144, 247);"><u><strong>https://ybcoo.github.io/blog-manage-ts</strong></u></span></a></p><p><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Nuxt4</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Node.js</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>NestJS</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Prisma</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Mysql</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>JWT</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+Pinia+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>Axios</strong></span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;">+Vue3+Scss+</span><span style="color: rgb(19, 19, 19); background-color: rgba(219, 224, 232, 0.3); font-size: 14px;"><strong>TypeScript</strong></span></p><p><strong>Nuxt4</strong><strong>NestJS</strong><strong>Mysql</strong></p><p> :</p><p>1.<strong>UI</strong>Nuxt4+Pinia</p><p>2.<strong>Pinia</strong></p><p>3.<strong>Vue3</strong>+<strong>Nuxt4</strong>+<strong>NestJS</strong><strong>PrismaORM</strong>JWT<strong>Axios</strong></p><p>4.css</p>',title:"Yu Bingcao",type:"experience"}),a=async()=>{try{const{data:i,error:o}=await mb({id:Number(kb().params.id),pageNum:1,pageSize:1});o.value&&console.error("Failed to fetch articles:",o.value);const{code:c,result:u}=i?.value??{},{list:l=[],total:d=0}=u||{};l.length>0&&(s.value=l[0])}catch(i){console.error(i)}};return[t,n]=xb(()=>a()),await t,n(),(i,o)=>(In(),kn("div",ZP,[zd(pb,{form:s.value},null,8,["form"]),zd(BP,{formItem:s.value},null,8,["formItem"])]))}}),E2=lm(qP,[["__scopeId","data-v-8b4ae484"]]);export{E2 as default};
